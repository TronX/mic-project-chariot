require(["jquery","jquery-ui","jquery-ui-iPad","js/jquery.WebGME","bootstrap","bootstrap-notify","underscore","backbone","js/WebGME","js/util","text!/gmeConfig.json","text!/package.json","js/logger","superagent","q","angular","angular-ui-bootstrap","isis-ui-components","isis-ui-components-templates"],function(e,t,n,i,o,r,s,a,l,c,d,h,p,g,u){"use strict";function f(e){function t(e){return e.charAt(0).toUpperCase()+e.slice(1)}function n(e){var n=u.defer();return E.debug("requestExtensionPoint",e),g.get("/api/"+e).end(function(i,o){var r="all"+t(e);200===o.status?(WebGMEGlobal[r]=o.body,E.debug("/api/"+e,WebGMEGlobal[r]),n.resolve()):(E.error("/api/"+e+"failed"),WebGMEGlobal[r]=[],n.reject(i))}),n.promise}function i(){var e=u.defer();return g.get("/api/plugins/metadata").end(function(t,n){200===n.status?(WebGMEGlobal.allPlugins=Object.keys(n.body),WebGMEGlobal.allPluginsMetadata=n.body,e.resolve()):(E.error("/api/"+name+"failed"),WebGMEGlobal.allPlugins=[],WebGMEGlobal.allPluginsMetadata={},e.reject(t))}),e.promise}return u.all([n("visualizers"),i(),n("decorators"),n("seeds"),n("addOns")]).nodeify(e)}function m(e){function t(e,t){var i=u.defer();return g.get("/api/orgs/"+t).end(function(t,o){200===o.status?o.body.admins.indexOf(e)>-1&&n.adminOrgs.push(o.body):E.error("failed getting org info",t),i.resolve()}),i.promise}var n,i=u.defer();return g.get("/api/user").end(function(e,o){200===o.status?(n=o.body||{_id:"N/A",orgs:[]},n.adminOrgs=[],u.allSettled(n.orgs.map(function(e){return t(n._id,e)})).then(function(){WebGMEGlobal.userInfo=n,i.resolve(n)})["catch"](i.reject)):i.reject(e)}),i.promise.nodeify(e)}function _(e){var t=u.defer();return g.get("/api/componentSettings").end(function(e,n){200===n.status?WebGMEGlobal.componentSettings=n.body:(E.warn("Could not obtain any default component settings (./config/components.json"),WebGMEGlobal.componentSettings={}),t.resolve()}),t.promise.nodeify(e)}function b(e){var t=u.defer();return v.visualization.extraCss.length>0?require(v.visualization.extraCss.map(function(e){return"css!"+e}),t.resolve,t.reject):t.resolve(),t.promise.nodeify(e)}var y,v=JSON.parse(d),C=JSON.parse(h),E=p.create("gme:main",v.client.log),D=u.defer();WebGMEGlobal.gmeConfig=v,WebGMEGlobal.version=C.version,WebGMEGlobal.NpmVersion=C.dist?C.version:"",WebGMEGlobal.GitHubVersion="",C._from&&(y=C._from.split("/"),WebGMEGlobal.GitHubVersion=y[y.length-1]),$(function(){var t,n,i,o;for(v.debug&&(DEBUG=v.debug),E.debug("domReady, got gmeConfig"),t=c.getURLParameterByName("debug").toLowerCase(),"true"===t?DEBUG=!0:"false"===t&&(DEBUG=!1),n=Object.keys(v.requirejsPaths),i=0;i<n.length;i+=1)v.requirejsPaths[n[i]]="/extlib/"+v.requirejsPaths[n[i]],E.debug("Requirejs path resolved: ",n[i],v.requirejsPaths[n[i]]);require.config({paths:v.requirejsPaths}),e.fn.extend({disable:function(e){return this.each(function(){var t=$(this);t.is("input, button")?this.disabled=e:t.toggleClass("disabled",e)})}}),o=angular.module("gmeApp",["ui.bootstrap","isis.ui.components","gme.ui.headerPanel"]).config(["$locationProvider",function(e){e.html5Mode({enabled:!0,requireBase:!1})}]),D.resolve(o)}),u.all([D.promise,b(),f(),m(),_()]).then(function(e){var t=e[0];l.start(function(e){t.value("gmeClient",e),angular.bootstrap(document,["gmeApp"])})})["catch"](function(e){throw E.error("Error at start up",e),e})}),define("js/jquery.WebGME",["jquery"],function(){"use strict";$.fn.extend({editOnDblClick:function(e){this.each(function(){$(this).on("dblclick.editOnDblClick",null,function(t){$(this).editInPlace(e),t.stopPropagation(),t.preventDefault()})})}}),$.fn.extend({editInPlace:function(e){function t(t){var c,d,h,p,g=t.width(),u=t.height();if(t.data("already-editing")===!0)return void t.find("input").select().focus();for(t.data("already-editing",!0),c=t.text(),e&&e.value&&(c=e.value),d=$("<input/>",{type:"text",value:c}),n&&""!==n&&d.addClass(n),h=Object.keys(i),p=h.length-1;p>=0;p--)d.css(h[p],i[h[p]]);u=Math.max(u,a),d.outerWidth(g).outerHeight(u),d.css({"box-sizing":"border-box",margin:"0px","line-height":u+"px","font-size":u-l}),t.html(d),d.focus(),d.keydown(function(e){switch(e.which){case 27:d.val(c),e.preventDefault(),e.stopPropagation(),$(this).blur();break;case 13:e.preventDefault(),e.stopPropagation(),$(this).blur();break;case 46:e.stopPropagation()}}).blur(function(){var e=d.val();""===e&&s===!1&&(e=c),t.html("").text(e),t.removeData("already-editing"),e!==c&&o&&o.call(t,c,e),r&&r.call(t)})}var n=e&&e["class"]||null,i=e&&e.css||{},o=e&&e.onChange||null,r=e&&e.onFinish||null,s=e&&e.enableEmpty||!1,a=16,l=5;this.each(function(){t($(this))})}}),document.createElement("canvas").getContext&&$.extend(window.CanvasRenderingContext2D.prototype,{ellipse:function(e,t,n,i,o){var r,s,a,l,c,d,h,p;e-=n,t-=i,r=2*n,s=2*i,a=r/2*.5522848,l=s/2*.5522848,c=e+r,d=t+s,h=e+r/2,p=t+s/2,this.beginPath(),this.moveTo(e,p),this.bezierCurveTo(e,p-l,h-a,t,h,t),this.bezierCurveTo(h+a,t,c,p-l,c,p),this.bezierCurveTo(c,p+l,h+a,d,h,d),this.bezierCurveTo(h-a,d,e,p+l,e,p),this.closePath(),o&&this.fill(),this.stroke()},circle:function(e,t,n,i){this.ellipse(e,t,n,n,i)}}),$.fn.extend({textWidth:function(){var e,t,n;return e=$(this).html(),t="<span>"+e+"</span>",$(this).html(t),n=$(this).find("span:first").width(),$(this).html(e),n}}),$.fn.extend({groupedAlphabetTabs:function(e){var t,n,i,o,r,s={groups:["A - E","F - J","K - O","P - T","U - Z"]},a={},l=$('<ul class="nav nav-tabs"></ul>'),c=$('<li class=""><a href="#" data-toggle="tab"></a></li>'),d=!1;for($.extend(a,s,e),t=l.clone(),a.extraTabs&&a.extraTabs.forEach(function(e){n=c.clone(),e.active===!0&&(n.addClass("active"),d=!0),n.find("a").text(e.title),n.data("filter",e.data),t.append(n)}),n=c.clone(),d===!1&&n.addClass("active"),n.find("a").text("ALL"),t.append(n),i=0;i<a.groups.length;i+=1)o=a.groups[i].split("-")[0].trim(),r=a.groups[i].split("-")[1].trim(),n=c.clone(),n.find("a").text(a.groups[i]),n.data("filter",[o,r]),t.append(n);this.each(function(){$(this).append(t.clone(!0)),$(this).on("click.groupedAlphabetTabs","li",function(t){var n=$(this).data("filter");e&&e.onClick&&e.onClick(n),t.preventDefault()})})}})}),define("js/logger",["debug"],function(e){"use strict";function t(n,i){var o,r="undefined"==typeof debug?e(n):debug(n),s={silly:0,input:1,verbose:2,prompt:3,debug:4,info:5,data:6,help:7,warn:8,error:9};if(!i)throw new Error("options required in logger");if(i.hasOwnProperty("level")===!1)throw new Error("options.level required in logger");return o=s[i.level],"undefined"==typeof o&&(o=s.info),r.debug=function(){r.enabled&&o<=s.debug&&(console.debug?r.log=console.debug.bind(console):r.log=console.log.bind(console),r.apply(this,arguments))},r.info=function(){r.enabled&&o<=s.info&&(r.log=console.info.bind(console),r.apply(this,arguments))},r.warn=function(){r.enabled&&o<=s.warn&&(r.log=console.warn.bind(console),r.apply(this,arguments))},r.error=function(){r.enabled&&o<=s.error?(r.log=console.error.bind(console),r.apply(this,arguments)):console.error.apply(console,arguments)},r.fork=function(e,o){return e=o?e:n+":"+e,t(e,i)},r.forkWithOptions=function(e,n){return t(e,n)},r}function n(e,n){return t(e,n.client.log)}return{create:t,createWithGmeConfig:n}}),define("common/storage/constants",[],function(){"use strict";return{VERSION:"1.1.0",MONGO_ID:"_id",COMMIT_TYPE:"commit",PROJECT_INFO_ID:"*info*",EMPTY_PROJECT_DATA:"empty",PROJECT_ID_SEP:"+",PROJECT_DISPLAYED_NAME_SEP:"/",DATABASE_ROOM:"database",ROOM_DIVIDER:"%",CONNECTED:"CONNECTED",DISCONNECTED:"DISCONNECTED",RECONNECTED:"RECONNECTED",INCOMPATIBLE_CONNECTION:"INCOMPATIBLE_CONNECTION",CONNECTION_ERROR:"CONNECTION_ERROR",SYNCED:"SYNCED",FORKED:"FORKED",CANCELED:"CANCELED",MERGED:"MERGED",BRANCH_STATUS:{SYNC:"SYNC",AHEAD_SYNC:"AHEAD_SYNC",AHEAD_NOT_SYNC:"AHEAD_NOT_SYNC",PULLING:"PULLING",MERGING:"MERGING",ERROR:"ERROR"},JWT_ABOUT_TO_EXPIRE:"JWT_ABOUT_TO_EXPIRE",JWT_EXPIRED:"JWT_EXPIRED",PROJECT_DELETED:"PROJECT_DELETED",PROJECT_CREATED:"PROJECT_CREATED",BRANCH_DELETED:"BRANCH_DELETED",BRANCH_CREATED:"BRANCH_CREATED",BRANCH_HASH_UPDATED:"BRANCH_HASH_UPDATED",TAG_DELETED:"TAG_DELETED",TAG_CREATED:"TAG_CREATED",COMMIT:"COMMIT",BRANCH_UPDATED:"BRANCH_UPDATED",NOTIFICATION:"NOTIFICATION",BRANCH_ROOM_SOCKETS:"BRANCH_ROOM_SOCKETS",PLUGIN_NOTIFICATION:"PLUGIN_NOTIFICATION",ADD_ON_NOTIFICATION:"ADD_ON_NOTIFICATION",CLIENT_STATE_NOTIFICATION:"CLIENT_STATE_NOTIFICATION"}}),define("common/storage/storageclasses/watchers",["common/storage/constants","q"],function(e,t){"use strict";function n(e,t,n){this.watchers={database:0,projects:{}},this.webSocket=e,this.logger=this.logger||t.fork("storage"),this.gmeConfig=n,this.logger.debug("StorageWatcher ctor"),this.connected=!1}return n.prototype.watchDatabase=function(n,i){var o=t.defer();return this.logger.debug("watchDatabase - handler added"),this.webSocket.addEventListener(e.PROJECT_DELETED,n),this.webSocket.addEventListener(e.PROJECT_CREATED,n),this.watchers.database+=1,this.logger.debug("Nbr of database watchers:",this.watchers.database),1===this.watchers.database?(this.logger.debug("First watcher will enter database room."),this.webSocket.watchDatabase({join:!0},function(e){e?o.reject(e):o.resolve()})):o.resolve(),o.promise.nodeify(i)},n.prototype.unwatchDatabase=function(n,i){var o=t.defer();return this.logger.debug("unwatchDatabase - handler will be removed"),this.logger.debug("Nbr of database watchers (before removal):",this.watchers.database),this.webSocket.removeEventListener(e.PROJECT_DELETED,n),this.webSocket.removeEventListener(e.PROJECT_CREATED,n),this.watchers.database-=1,0===this.watchers.database?(this.logger.debug("No more watchers will exit database room."),this.connected?this.webSocket.watchDatabase({join:!1},function(e){e?o.reject(e):o.resolve()}):o.resolve()):this.watchers.database<0?(this.logger.error("Number of database watchers became negative!"),o.reject(new Error("Number of database watchers became negative!"))):o.resolve(),o.promise.nodeify(i)},n.prototype.watchProject=function(n,i,o){var r=t.defer();return this.logger.debug("watchProject - handler added for project",n),this.webSocket.addEventListener(e.BRANCH_DELETED+n,i),this.webSocket.addEventListener(e.BRANCH_CREATED+n,i),this.webSocket.addEventListener(e.BRANCH_HASH_UPDATED+n,i),this.watchers.projects[n]=this.watchers.projects.hasOwnProperty(n)?this.watchers.projects[n]+1:1,this.logger.debug("Nbr of watchers for project:",n,this.watchers.projects[n]),1===this.watchers.projects[n]?(this.logger.debug("First watcher will enter project room:",n),this.webSocket.watchProject({projectId:n,join:!0},function(e){e?r.reject(e):r.resolve()})):r.resolve(),r.promise.nodeify(o)},n.prototype.unwatchProject=function(n,i,o){var r=t.defer();return this.logger.debug("unwatchProject - handler will be removed",n),this.logger.debug("Nbr of database watchers (before removal):",n,this.watchers.projects[n]),this.webSocket.removeEventListener(e.BRANCH_DELETED+n,i),this.webSocket.removeEventListener(e.BRANCH_CREATED+n,i),this.webSocket.removeEventListener(e.BRANCH_HASH_UPDATED+n,i),this.watchers.projects[n]=this.watchers.projects.hasOwnProperty(n)?this.watchers.projects[n]-1:-1,0===this.watchers.projects[n]?(this.logger.debug("No more watchers will exit project room:",n),delete this.watchers.projects[n],this.connected?this.webSocket.watchProject({projectId:n,join:!1},function(e){e?r.reject(e):r.resolve()}):r.resolve()):this.watchers.projects[n]<0?(this.logger.error("Number of project watchers became negative!:",n),r.reject(new Error("Number of project watchers became negative!"))):r.resolve(),r.promise.nodeify(o)},n.prototype._rejoinWatcherRooms=function(e){var n,i=[];this.logger.debug("rejoinWatcherRooms"),this.watchers.database>0&&(this.logger.debug("Rejoining database room."),i.push(t.ninvoke(this.webSocket,"watchDatabase",{join:!0})));for(n in this.watchers.projects)this.watchers.projects.hasOwnProperty(n)&&this.watchers.projects[n]>0&&(this.logger.debug("Rejoining project room",n,this.watchers.projects[n]),i.push(t.ninvoke(this.webSocket,"watchProject",{projectId:n,join:!0})));return t.all(i).nodeify(e)},n}),define("common/storage/storageclasses/simpleapi",["common/storage/storageclasses/watchers"],function(e){"use strict";function t(t,n,i){this.logger=this.logger||n.fork("storage"),e.call(this,t,n,i),this.webSocket=t,this.gmeConfig=i,this.logger.debug("StorageSimpleAPI ctor")}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.prototype.getProjects=function(e,t){this.logger.debug("invoking getProjects",{metadata:e}),this.webSocket.getProjects(e,t)},t.prototype.getBranches=function(e,t){var n={projectId:e};this.logger.debug("invoking getBranches",{metadata:n}),this.webSocket.getBranches(n,t)},t.prototype.getCommits=function(e,t,n,i){var o={projectId:e,before:t,number:n};this.logger.debug("invoking getCommits",{metadata:o}),this.webSocket.getCommits(o,i)},t.prototype.getHistory=function(e,t,n,i){var o={projectId:e,start:t,number:n};this.logger.debug("invoking getHistory",{metadata:o}),this.webSocket.getHistory(o,i)},t.prototype.squashCommits=function(e,t,n,i,o){var r={projectId:e,fromCommit:t,toCommitOrBranch:n,message:i};this.logger.debug("invoking squashCommits",{metadata:r}),this.webSocket.squashCommits(r,o)},t.prototype.getTags=function(e,t){var n={projectId:e};this.logger.debug("invoking getTags",{metadata:n}),this.webSocket.getTags(n,t)},t.prototype.getBranchHash=function(e,t,n){var i={projectId:e,branchName:t};this.logger.debug("invoking getBranchHash",{metadata:i}),this.webSocket.getBranchHash(i,n)},t.prototype.getLatestCommitData=function(e,t,n){var i={projectId:e,branchName:t};this.logger.debug("invoking getLatestCommitData",{metadata:i}),this.webSocket.getLatestCommitData(i,n)},t.prototype.getCommonAncestorCommit=function(e,t,n,i){var o={commitA:t,commitB:n,projectId:e};this.logger.debug("invoking getCommonAncestorCommit",{metadata:o}),this.webSocket.getCommonAncestorCommit(o,i)},t.prototype.createProject=function(e,t,n){var i=this,o={projectName:e,ownerId:t};void 0===n&&"function"==typeof t&&(n=t,o.ownerId=void 0),this.logger.debug("invoking createProject",{metadata:o}),this.webSocket.createProject(o,function(t,o){return t?(i.logger.error("cannot create project ",e,t),void n(t)):(i.logger.debug("Project created, projectId",o),void n(t,o))})},t.prototype.deleteProject=function(e,t){var n={projectId:e};this.logger.debug("invoking deleteProject",{metadata:n}),this.webSocket.deleteProject(n,t)},t.prototype.transferProject=function(e,t,n){var i={projectId:e,newOwnerId:t};this.logger.debug("invoking transferProject",{metadata:i}),this.webSocket.transferProject(i,n)},t.prototype.duplicateProject=function(e,t,n,i){var o={projectId:e,projectName:t,ownerId:n};void 0===i&&"function"==typeof n&&(i=n,o.ownerId=void 0),this.logger.debug("invoking duplicateProject",{metadata:o}),this.webSocket.duplicateProject(o,i)},t.prototype.setBranchHash=function(e,t,n,i,o){var r={projectId:e,branchName:t,newHash:n,oldHash:i};this.logger.debug("invoking setBranchHash",{metadata:r}),this.webSocket.setBranchHash(r,o)},t.prototype.createBranch=function(e,t,n,i){var o={projectId:e,branchName:t,newHash:n,oldHash:""};this.logger.debug("invoking createBranch",{metadata:o}),this.webSocket.setBranchHash(o,i)},t.prototype.deleteBranch=function(e,t,n,i){var o={projectId:e,branchName:t,newHash:"",oldHash:n};this.logger.debug("invoking deleteBranch",{metadata:o}),this.webSocket.setBranchHash(o,i)},t.prototype.createTag=function(e,t,n,i){var o={projectId:e,tagName:t,commitHash:n};this.logger.debug("invoking createTag",{metadata:o}),this.webSocket.createTag(o,i)},t.prototype.deleteTag=function(e,t,n){var i={projectId:e,tagName:t};this.logger.debug("invoking deleteTag",{metadata:i}),this.webSocket.deleteTag(i,n)},t.prototype.simpleRequest=function(e,t){this.logger.debug("invoking simpleRequest",{metadata:e}),this.webSocket.simpleRequest(e,t)},t.prototype.simpleQuery=function(e,t,n){this.logger.debug("invoking simpleQuery; workerId, parameters",e,{metadata:t}),this.webSocket.simpleQuery(e,t,n)},t.prototype.sendNotification=function(e,t){this.logger.debug("invoking sendNotification; ",{metadata:e}),this.webSocket.sendNotification(e,t)},t}),define("common/storage/storageclasses/objectloaders",["common/storage/storageclasses/simpleapi"],function(e){"use strict";function t(t,n,i){this.logger=this.logger||n.fork("storage"),e.call(this,t,n,i),this.webSocket=t,this.gmeConfig=i,this.loadBucket=[],this.loadBucketSize=0,this.loadBucketTimer=null,this.logger.debug("StorageObjectLoaders ctor")}return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.prototype.loadObject=function(e,t,n){function i(){var t=o.loadBucket;o.loadBucket=[],o.loadBucketTimer=null,o.loadBucketSize=0,o.loadObjects(e,t)}var o=this;this.logger.debug("loadObject",e,t),o.loadBucket.push({projectId:e,hash:t,cb:n}),o.loadBucketSize+=1,1===o.loadBucketSize&&(o.logger.debug("loadBucket was empty starting timer [ms]",o.gmeConfig.storage.loadBucketTimer),o.loadBucketTimer=setTimeout(function(){o.logger.debug("loadBucketTimer triggered, bucketSize:",o.loadBucketSize),i()},o.gmeConfig.storage.loadBucketTimer)),o.loadBucketSize===o.gmeConfig.storage.loadBucketSize&&(o.logger.debug("loadBuckSize reached will loadObjects, bucketSize:",o.loadBucketSize),clearTimeout(o.loadBucketTimer),i())},t.prototype.loadObjects=function(e,t){var n,i,o=this,r={};for(i=0;i<t.length;i++)r[t[i].hash]=!0;r=Object.keys(r),n={hashes:r,projectId:e},this.webSocket.loadObjects(n,function(e,n){for(o.logger.debug("loadObjects returned",{metadata:n}),i=0;i<t.length;i++)e?t[i].cb(e):"string"==typeof n[t[i].hash]?(o.logger.error(n[t[i].hash]),t[i].cb(new Error(n[t[i].hash]))):t[i].cb(e,n[t[i].hash])})},t.prototype.loadPaths=function(e,t,n,i){var o={projectId:e,pathsInfo:t,excludes:n};this.webSocket.loadPaths(o,i)},t}),define("common/util/assert",[],function(){"use strict";var e=function(e,t){if(!e){var n=new Error(t||"ASSERT failed");throw"undefined"==typeof TESTING&&(console.log("Throwing",n.stack),console.log()),n}};return e}),define("common/util/canon",[],function(){var e,t,n,i,o={},r=[].slice,s={}.hasOwnProperty;return o.stringify=function(){var n;return n=function(o){var s,a;switch(Object.prototype.toString.call(o)){case"[object Array]":return["Array"].concat(r.call(t(o,n)));case"[object Date]":return["Date"].concat(isFinite(+o)?o.getUTCFullYear()+"-"+i(o.getUTCMonth()+1)+"-"+i(o.getUTCDate())+"T"+i(o.getUTCHours())+":"+i(o.getUTCMinutes())+":"+i(o.getUTCSeconds())+"."+i(o.getUTCMilliseconds(),3)+"Z":null);case"[object Function]":throw new TypeError("functions cannot be serialized");case"[object Number]":return isFinite(o)?o:["Number",""+o];case"[object Object]":return s=function(e){return[e,n(o[e])]},(a=["Object"]).concat.apply(a,t(e(o).sort(),s));case"[object RegExp]":return["RegExp",""+o];case"[object Undefined]":return["Undefined"];default:return o}},function(e){return JSON.stringify(n(e))}}(),o.parse=function(){var e;return e=function(n){var i,o,s,a,l,c,d;if("[object Array]"!==Object.prototype.toString.call(n))return n;switch(l=n[0],o=2<=n.length?r.call(n,1):[],i=o[0],l){case"Array":return t(o,e);case"Date":return new Date(i);case"Number":return+i;case"Object":for(a={},s=c=0,d=o.length;d>c;s=c+=2)a[o[s]]=e(o[s+1]);return a;case"RegExp":return function(e,t,n){n.prototype=e.prototype;var i=new n,o=e.apply(i,t);return Object(o)===o?o:i}(RegExp,/^[\/](.+)[\/]([gimy]*)$/.exec(i).slice(1),function(){});case"Undefined":return void 0;default:throw new Error("invalid input")}},function(t){return e(JSON.parse(t))}}(),n=Array.prototype.map,t=function(e,t){var i,o,r,s;if(n&&e.map===n)return e.map(t);for(s=[],o=0,r=e.length;r>o;o++)i=e[o],s.push(t(i));return s},e=Object.keys||function(e){var t,n;n=[];for(t in e)s.call(e,t)&&n.push(t);return n},i=function(e,t){return null==t&&(t=2),(""+(1e3+e)).substr(4-t)},o}),define("common/util/random",["chance"],function(e){"use strict";function t(){var e,t="";if(c.length>0)for(e=0;e<c.length;e+=1)t+="(?!(^"+c[e]+"$))";return t+="^(-)?["+l+"]+$",new RegExp(t)}function n(e){return e.charAt(p(e.length))}function i(){var e=function(){return n(a)+n(a)+n(a)+n(a)};return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}function o(e,t){var i,o,s=t||1,a=0;do{for(a>=d&&(a=0,s+=1),i="",o=0;s>o;o+=1)i+=n(l);a+=1}while(e.hasOwnProperty(i)===!0||r(i)===!1);return i}function r(e){return"string"!=typeof e?!1:g.test(e)}function s(e){var t,n="NaN",i=!1;if(r(e))for(n=0,t=0;t<e.length;t+=1)"-"===e.charAt(t)?i=!0:(n*=l.length,n+=l.indexOf(e.charAt(t)));return n}var a="0123456789abcdef",l="0123456789qwertyuiopasdfghjklzxcvbnmQWERTYUIOPASDFGHJKLZXCVBNM",c=["atr","reg","ovr"],d=2,h=new e,p=function(e){return h.natural({max:e-1})},g=t(),u={generateGuid:i,generateRelid:o,isValidRelid:r,relidToInteger:s};return u}),define("common/core/constants",[],function(){"use strict";return{ATTRIBUTES_PROPERTY:"atr",REGISTRY_PROPERTY:"reg",OVERLAYS_PROPERTY:"ovr",COLLECTION_NAME_SUFFIX:"-inv",ALL_SETS_PROPERTY:"_sets",SET_MODIFIED_REGISTRY:"_sets_",MEMBER_RELATION:"member",BASE_POINTER:"base",PATH_SEP:"/",MUTABLE_PROPERTY:"_mutable",MINIMAL_RELID_LENGTH_PROPERTY:"_minlenrelid",DOES_NOT_HAVE_RELID_CHILDREN:{_sets:!0,_meta:!0},INHERITED_CHILD_HAS_OWN_RELATION_PROPERTY:"_hasownrelation",NULLPTR_NAME:"_null_pointer",NULLPTR_RELID:"_nullptr",META_SET_NAME:"MetaAspectSet",NULL_GUID:"00000000-0000-0000-0000-000000000000",OWN_GUID:"_relguid",CONSTRAINTS_RELID:"_constraints",C_DEF_PRIORITY:1,CONSTRAINT_REGISTRY_PREFIX:"_ch#_",TO_DELETE_STRING:"*to*delete*",SET_ITEMS:"items",SET_ITEMS_MAX:"max",SET_ITEMS_MIN:"min",META_ASPECTS:"aspects",META_CHILDREN:"children",META_NODE:"_meta",META_POINTER_PREFIX:"_p_",META_ASPECT_PREFIX:"_a_",ATTRIBUTE_TYPES:{STRING:"string",INTEGER:"integer",FLOAT:"float",BOOLEAN:"boolean",ASSET:"asset"},MIXINS_SET:"_mixins",MIXIN_ERROR_TYPE:{MISSING:"missing",ATTRIBUTE_COLLISION:"attribute collision",SET_COLLISION:"set collision",POINTER_COLLISION:"pointer collision",CONTAINMENT_COLLISION:"containment collision",ASPECT_COLLISION:"aspect collision",CONSTRAINT_COLLISION:"constraint collision"},EXPORT_TYPE_PROJECT:"project",EXPORT_TYPE_LIBRARY:"library",NAMESPACE_SEPARATOR:".",MAX_AGE:3,MAX_TICKS:2e3,MAX_MUTATE:3e4,MAXIMUM_STARTING_RELID_LENGTH:5}}),define("common/util/jsonPatcher",["common/util/canon","common/util/random","common/core/constants"],function(e,t,n){"use strict";function i(e){return e.replace(/\//g,"%2f")}function o(e){return e.replace(/%2f/g,"/")}function r(e,t){return 0===e.indexOf(t)}function s(e){return 0===e.indexOf("/ovr")}function a(e){return t.isValidRelid(e.substring(1))}function l(e){if("string"!=typeof e)return!1;var n,i=e.split("/"),o=!1;for(n=1;n<i.length;n+=1){if(t.isValidRelid(i[n])===!1)return!1;o=!0}return o}function c(t,n,o,s,a,c){var d,h,p,g=[],u=!1,f=!1;"/ovr/"===o?u=!0:r(o,"/ovr/")&&(f=!0);for(p in n)if(-1===s.indexOf(p)&&n.hasOwnProperty(p)&&!t.hasOwnProperty(p)){if(d={op:"add",path:o+i(p),value:n[p]},f||u)if(d.partialUpdates=[],d.updates=[],f)l(n[p])?(d.partialUpdates.push(n[p]),l(c)&&d.updates.push(c)):"/_nullptr"===n[p]&&d.updates.push("");else for(h in n[p])l(n[p][h])?(d.partialUpdates.push(n[p][h]),l(p)&&d.updates.push(p)):"/_nullptr"===n[p][h]&&d.updates.push("");g.push(d)}if(!a)for(p in n)-1===s.indexOf(p)&&n.hasOwnProperty(p)&&t.hasOwnProperty(p)&&e.stringify(t[p])!==e.stringify(n[p])&&(d={op:"replace",path:o+i(p),value:n[p]},f&&(d.partialUpdates=[],d.updates=[],l(n[p])?(d.partialUpdates.push(n[p]),l(c)&&d.updates.push(c)):"/_nullptr"===n[p]&&d.updates.push(""),l(t[p])?d.partialUpdates.push(t[p]):"/_nullptr"===t[p]&&d.updates.push("")),g.push(d));for(p in t)if(-1===s.indexOf(p)&&t.hasOwnProperty(p)&&!n.hasOwnProperty(p)){if(d={op:"remove",path:o+i(p)},f||u)if(d.partialUpdates=[],d.updates=[],f)l(t[p])?(d.partialUpdates.push(t[p]),l(c)&&d.updates.push(c)):"/_nullptr"===t[p]&&d.updates.push("");else for(h in t[p])l(t[p][h])?(d.partialUpdates.push(t[p][h]),l(p)&&d.updates.push(p)):"/_nullptr"===t[p][h]&&d.updates.push("");g.push(d)}return g}function d(e,t){var n,o,r,s,a;if(n=c(e,t,"/",["_id","ovr","atr","reg","_sets"],!1),e.atr&&t.atr?n=n.concat(c(e.atr,t.atr,"/atr/",[],!1)):e.atr?n.push({op:"remove",path:"/atr"}):t.atr&&n.push({op:"add",path:"/atr",value:t.atr}),e.reg&&t.reg?n=n.concat(c(e.reg,t.reg,"/reg/",[],!1)):e.reg?n.push({op:"remove",path:"/reg"}):t.reg&&n.push({op:"add",path:"/reg",value:t.reg}),e._sets&&t._sets){n=n.concat(c(e._sets,t._sets,"/_sets/",[],!0));for(a in t._sets)e._sets[a]&&(n=n.concat(c(e._sets[a],t._sets[a],"/_sets/"+i(a)+"/",[],!1)))}else e._sets?n.push({op:"remove",path:"/_sets"}):t._sets&&n.push({op:"add",path:"/_sets",value:t._sets});if(e.ovr&&t.ovr){n=n.concat(c(e.ovr,t.ovr,"/ovr/",[],!0));for(a in t.ovr)e.ovr[a]&&(n=n.concat(c(e.ovr[a],t.ovr[a],"/ovr/"+i(a)+"/",[],!1,a)))}else if(e.ovr||t.ovr){for(o={path:"/ovr",partialUpdates:[],updates:[]},e.ovr?o.op="remove":(o.op="add",o.value=t.ovr),r=c(e.ovr||{},t.ovr||{},"/ovr/",[],!0),s=0;s<r.length;s+=1)o.partialUpdates=o.partialUpdates.concat(r[s].partialUpdates),o.updates=o.updates.concat(r[s].updates);n.push(o)}return n}function h(e,t){var n,i,r,s,a,l=JSON.parse(JSON.stringify(e)),c=!1,d={status:"success",faults:[],patch:t,result:l};for(n=0;n<t.length;n+=1){for(r=(t[n].path+"").split("/").slice(1),a=l,i=0;i<r.length;i+=1)r[i]=o(r[i]);switch(s=r.pop(),c=!1,t[n].op){case"remove":if("string"==typeof t[n].path){for(i=0;i<r.length;i+=1){if(!a[r[i]]){c=!0;break}a=a[r[i]]}c||void 0===a[s]?(d.status="fail",d.faults.push(t[n])):delete a[s]}else d.status="fail",d.faults.push(t[n]);break;case"add":if("string"==typeof t[n].path&&void 0!==t[n].value){for(i=0;i<r.length;i+=1)a[r[i]]||(a[r[i]]={}),a=a[r[i]];a[s]=t[n].value}else d.status="fail",d.faults.push(t[n]);break;case"replace":if("string"==typeof t[n].path&&void 0!==t[n].value){for(i=0;i<r.length;i+=1){if(!a[r[i]]){c=!0;break}a=a[r[i]]}c||void 0===a[s]?(d.status="fail",d.faults.push(t[n])):a[s]=t[n].value}else d.status="fail",d.faults.push(t[n]);break;default:d.status="fail",d.faults.push(t[n])}}return d}function p(e,t){var n,i=t.split("/");n=t;do{if(e.load[n]||e.unload[n])return!0;i.pop(),n=i.join("/")}while(i.length>1);return!1}function g(e,t){var n,i;for(n=Object.keys(e.update),i=0;n>i;i+=1)r(n[i],t)&&delete e.update[t];for(n=Object.keys(e.partialUpdate),i=0;n>i;i+=1)r(n[i],t)&&delete e.partialUpdate[t]}function u(e,t,n,i){var o,r,l,c,d=e[n]&&e[n].patch,h=!1;if(d){for(o=0;o<d.length;o+=1)if(c=d[o].path,s(c)===!0){for(r=0;r<d[o].partialUpdates.length;r+=1)l=i+d[o].partialUpdates[r],p(t,l)===!1&&(t.partialUpdate[l]=!0);for(r=0;r<d[o].updates.length;r+=1)l=i+d[o].updates[r],p(t,l)===!1&&(t.update[l]=!0)}else if(a(c)===!0)switch(d[o].op){case"add":t.load[i+c]=!0,g(t,i+c);break;case"remove":t.unload[i+c]=!0,g(t,i+c);break;case"replace":u(e,t,d[o].value,i+c);break;default:throw new Error("Unexpected patch operation "+d[o])}else c!==m&&"/__v"!==c&&(h=!0);h&&(t.update[i]=!0)}}function f(e,t){var n;return e[t]&&e[t].patch?(n={load:{},unload:{},update:{},partialUpdate:{}},u(e,n,t,"")):n=null,n}var m=n.PATH_SEP+n.MINIMAL_RELID_LENGTH_PROPERTY;return{create:d,apply:h,getChangedNodes:f}}),define("common/regexp",[],function(){"use strict";var e=new RegExp("^#[0-9a-zA-Z_]*$"),t=new RegExp("^#[0-9a-zA-Z_]{40}$"),n=new RegExp("^[0-9a-zA-Z_]*$"),i=new RegExp("^[0-9a-zA-Z_]*$"),o=new RegExp("^\\*[0-9a-zA-Z_]*$"),r=new RegExp("^(?!system\\.)(?!_)[0-9a-zA-Z_+]*$"),s=new RegExp("^[^($|_).][^.]*$"),a=new RegExp("^[0-9a-zA-Z_]+$"),l=new RegExp("[!\"#$%&'()*+,./:;<=>?@[\\]^`{|}~ ]+","g"),c=new RegExp("<[a-z][\\s\\S]*>","i"),d=new RegExp("[a-z0-9]{8}(-[a-z0-9]{4}){3}-[a-z0-9]{12}","i"),h=new RegExp("^[0-9a-f]{40}$");return{HASH:e,DB_HASH:t,BRANCH:n,TAG:i,RAW_BRANCH:o,PROJECT:r,DOCUMENT_KEY:s,GUID:d,INVALID_CSS_CHARS:l,HTML_ELEMENT:c,PROJECT_NAME:a,BLOB_HASH:h}}),define("common/util/sha1",[],function(){return function(e){function t(e,t){return e<<t|e>>>32-t}function n(t,n){return e.charCodeAt(64*m+4*d+t)<<n}e+="";for(var i,o,r,s,a,l,c,d,h=Math,p=[1518500249,1859775393,2400959708,3395469782,1732584193,4023233417,2562383102,271733878,3285377520,4294967295],g=h.ceil(e.length/4)+2,u=h.ceil(g/16),f=[],m=0,_=[];u>m;m++)for(f[m]=[],d=0;16>d;d++)f[m][d]=n(0,24)|n(1,16)|n(2,8)|n(3,0);for(l=8*e.length-8,m=u-1,f[m][14]=l/(p[9]+1),f[m][14]=h.floor(f[m][14]),f[m][15]=l&p[9],m=0;u>m;m++){for(c=0;16>c;c++)_[c]=f[m][c];for(c=16;80>c;c++)_[c]=t(_[c-3]^_[c-8]^_[c-14]^_[c-16],1);for(i=p[4],o=p[5],r=p[6],s=p[7],a=p[8],c=0;80>c;c++){var b=h.floor(c/20),y=t(i,5)+(1>b?o&r^~o&s:2==b?o&r^o&s^r&s:o^r^s)+a+p[b]+_[c]&p[9];a=s,s=r,r=t(o,30),o=i,i=y}p[4]+=i,p[5]+=o,p[6]+=r,p[7]+=s,p[8]+=a}for(l="",z=4;z<9;z++)for(m=7;m>=0;m--)l+=((p[z]&p[9])>>>4*m&15).toString(16);return l}}),define("common/util/key",["common/util/sha1","common/util/assert","common/util/canon"],function(e,t,n){"use strict";function i(){var e,t,n="";for(e=0;40>e;e++)t=Math.floor(16*Math.random()),t=t>9?t+87:t+48,n+=String.fromCharCode(t);return n}var o=null;return function(r,s){switch(o=s.storage.keyType,t("string"==typeof o),o){case"rand160Bits":return i();default:return e(n.stringify(r))}}}),define("common/storage/util",["common/storage/constants","common/util/jsonPatcher","q","common/regexp","common/util/key"],function(e,t,n,i,o){"use strict";function r(e,t){var i=n.defer();return t.branchName?n.ninvoke(e,"getBranchHash",t.branchName).then(function(i){return t.commitHash=i,n.ninvoke(e,"loadObject",i)}).then(function(e){t.rootHash=e.root,i.resolve(e.root)})["catch"](i.reject):t.commitHash?n.ninvoke(e,"loadObject",t.commitHash).then(function(e){t.rootHash=e.root,i.resolve(e.root)})["catch"](i.reject):t.tagName?n.ninvoke(e,"getAllTags").then(function(i){if(i[t.tagName])return t.commitHash=i[t.tagName],n.ninvoke(e,"loadObject",i[t.tagName]);throw new Error("Unknown tag name ["+t.tagName+"]")}).then(function(e){t.rootHash=e.root,i.resolve(e.root)})["catch"](i.reject):t.rootHash?i.resolve(t.rootHash):i.reject(new Error("No valid input was given to search for rootHash")),i.promise}function s(e,t){var i,o=n.defer(),r=[],s=[];for(i=0;i<t.length;i+=1)r.push(n.ninvoke(e,"loadObject",t[i]));return n.allSettled(r).then(function(e){var t,n=null;for(t=0;t<e.length;t+=1)"fulfilled"===e[t].state?s.push(e[t].value):n=n||e[t].reason||new Error("unable to load");n?o.reject(n):o.resolve(s)}),o.promise}function a(e,t){var o,r,s=n.defer(),a={},l={},c=[t],d=null,h=!1;return r=setInterval(function(){if(!h){if(o=c.shift(),void 0===o)return clearInterval(r),void(d?s.reject(d):s.resolve({objects:Object.keys(a),assets:Object.keys(l)}));a[o]||(h=!0,e.loadObject(o,function(e,t){var n;if(d=d||e,!e&&t&&(a[o]=!0,t)){for(n in t)"string"==typeof t[n]&&i.HASH.test(t[n])&&c.push(t[n]);if(t.atr)for(n in t.atr)"string"==typeof t.atr[n]&&i.BLOB_HASH.test(t.atr[n])&&(l[t.atr[n]]=!0)}h=!1}))}},1),s.promise}return{CONSTANTS:e,getProjectFullNameFromProjectId:function(t){return t?t.replace(e.PROJECT_ID_SEP,e.PROJECT_DISPLAYED_NAME_SEP):void 0},getProjectDisplayedNameFromProjectId:function(t){return t?t.replace(e.PROJECT_ID_SEP," "+e.PROJECT_DISPLAYED_NAME_SEP+" "):void 0},getProjectIdFromProjectFullName:function(t){return t?t.replace(e.PROJECT_DISPLAYED_NAME_SEP,e.PROJECT_ID_SEP):void 0},getProjectIdFromOwnerIdAndProjectName:function(t,n){return t+e.PROJECT_ID_SEP+n},getProjectNameFromProjectId:function(t){return t?t.substring(t.indexOf(e.PROJECT_ID_SEP)+1):void 0},getOwnerFromProjectId:function(t){return t?t.substring(0,t.indexOf(e.PROJECT_ID_SEP)):void 0},getHashTaggedHash:function(e){return"string"==typeof e?"#"===e[0]?e:"#"+e:e},getPatchObject:function(n,i){var o={type:"patch",base:n[e.MONGO_ID],patch:t.create(n,i)};return o[e.MONGO_ID]=i[e.MONGO_ID],o},coreObjectHasOldAndNewData:function(e){return!!(e.oldHash&&e.newHash&&e.oldData&&e.newData)},getChangedNodes:t.getChangedNodes,applyPatch:t.apply,checkHashConsistency:function(t,n,i){var r;return"rand160Bits"===t.storage.keyType?r=!0:t.storage.disableHashChecks===!0?r=!0:(n[e.MONGO_ID]="",r=i==="#"+o(n,t)),r},getProjectJson:function(e,t,i){
var o,l=n.defer();return r(e,t||{}).then(function(t){return a(e,t)}).then(function(n){return o={rootHash:t.rootHash,projectId:e.projectId,branchName:t.branchName,commitHash:t.commitHash,hashes:n,objects:null},s(e,n.objects)}).then(function(e){o.objects=e,l.resolve(o)})["catch"](l.reject),l.promise.nodeify(i)},insertProjectJson:function(e,t,i,o){var r,s=n.defer(),a={},l=t.rootHash,c="Importing contents of ["+t.projectId+"@"+l+"]",d=t.objects;for(r=0;r<d.length;r+=1)a[d[r]._id]=d[r];return i=i||{},i.branch=i.branch||null,i.parentCommit=i.parentCommit||[],e.makeCommit(i.branch,i.parentCommit,l,a,i.commitMessage||c).then(function(e){s.resolve(e)})["catch"](s.reject),s.promise.nodeify(o)}}}),define("common/storage/project/cache",["common/util/assert","common/storage/constants","common/storage/util"],function(e,t,n){"use strict";function i(i,o,r,s){function a(n,i){return e(i[t.MONGO_ID]===n),g.debug("cacheInsert",n),p[n]?!1:(p[n]=i,++u>=s.storage.cache&&(h=p,p={},u=0),!0)}function l(e){var t,n=p[e];if("undefined"==typeof n&&(n=h[e],"undefined"==typeof n))for(t in c.queuedPersists)if(c.queuedPersists.hasOwnProperty(t)&&c.queuedPersists[t][e]){n=c.queuedPersists[t][e];break}return n}var c=this,d={},h={},p={},g=r.fork("ProjectCache"),u=0;g.debug("ctor",o),this.queuedPersists={},this.loadObject=function(n,r){var s;e("string"==typeof n&&"function"==typeof r),g.debug("loadObject",{metadata:n});var l=p[n];if("undefined"==typeof l)if(l=h[n],"undefined"==typeof l){for(s in c.queuedPersists)if(c.queuedPersists.hasOwnProperty(s)&&c.queuedPersists[s][n]){l=c.queuedPersists[s][n];break}if("undefined"==typeof l)return l=d[n],void("undefined"==typeof l?(l=[r],d[n]=l,g.debug("object set to be loaded from storage"),i.loadObject(o,n,function(t,i){if(e("object"==typeof i||"undefined"==typeof i),0!==l.length){e(d[n]===l),delete d[n],!t&&i&&a(n,i);for(var o;o=l.pop();)o(t,i)}})):(g.debug("object was already queued to be loaded"),l.push(r)));g.debug("object was erased from cache and backup but present in queuedPersists"),a(n,l)}else g.debug("object was in backup"),a(n,l);else g.debug("object was in cache");e("object"==typeof l&&null!==l&&l[t.MONGO_ID]===n),r(null,l)},this.loadPaths=function(e,t,n){g.debug("loadPaths",{metadata:{rootKey:e,paths:t}});var r,s,c,d,h={},p=[],u=l(e),f=t.length,m=[];if(!e)return g.debug("rootKey empty:",e),void n(null);if(u)for(p.push(e),h[e]=u;f--;)for(s=t[f].split("/"),s.shift(),c=u,r=0;r<s.length&&(d=c[s[r]],d);r+=1){if(c=l(d),"undefined"==typeof c){m.push({parentHash:d,path:"/"+s.slice(r+1).join("/")});break}p.push(d),h[d]=c}else m=t.map(function(t){return{parentHash:e,path:t}});return 0===m.length?(g.debug("All given paths already loaded"),void n(null)):(g.debug("loadPaths will request from server, pathsInfo:",m),void i.loadPaths(o,m,p,function(e,t){var i,o;if(!e&&t){for(i=Object.keys(t),o=0;o<i.length;o+=1)void 0!==t[i[o]]&&a(i[o],t[i[o]]);for(i=Object.keys(h),o=0;o<i.length;o+=1)a(i[o],h[i[o]]);n(null)}else g.error("loadingPaths failed",e||new Error("no object arrived from server")),n(e)}))},this.insertObject=function(n,i){e("object"==typeof n&&null!==n);var o=n[t.MONGO_ID];if(g.debug("insertObject",{metadata:o}),e("string"==typeof o),a(o,n)===!1)g.debug("object inserted was already in cache");else{var r=h[o];if("undefined"!=typeof r)g.debug("object inserted was already in back-up");else if(r=d[o],"undefined"!=typeof r){delete d[o];for(var s;s=r.pop();)s(null,n)}}i&&(i[o]=n)},this.insertPatchObject=function(i){e("object"==typeof i&&null!==i);var o,r,s=i[t.MONGO_ID];i.base&&"object"==typeof i.patch&&s?(o=l(i.base),o?(r=n.applyPatch(o,i.patch),"success"===r.status?(r.result[t.MONGO_ID]=s,this.insertObject(r.result)):g.error("patch application failed",r)):g.debug("the base ["+i.base+"] is not available from the cache so the patch object is ignored")):g.error("invalid patch object format",i)}}return i}),define("common/storage/project/interface",["common/storage/project/cache","common/storage/constants","common/storage/util"],function(e,t,n){"use strict";function i(i,o,r,s){this.projectId=i,this.projectName=n.getProjectNameFromProjectId(i),this.CONSTANTS=t,this.ID_NAME=t.MONGO_ID,this.logger=r.fork("Project:"+this.projectId),this.logger.debug("ctor",i),this.projectCache=new e(o,this.projectId,this.logger,s),this.insertObject=this.projectCache.insertObject,this.insertPatchObject=this.projectCache.insertPatchObject,this.loadObject=this.projectCache.loadObject,this.loadPaths=this.projectCache.loadPaths,this.makeCommit=function(e,t,n,i,o,r){throw new Error("makeCommit must be overridden in derived class")},this.setBranchHash=function(e,t,n,i){throw new Error("setBranchHash must be overridden in derived class")},this.getBranchHash=function(e,t){throw new Error("getBranchHash must be overridden in derived class")},this.createBranch=function(e,t,n){throw new Error("createBranch must be overridden in derived class")},this.deleteBranch=function(e,t,n){throw new Error("deleteBranch must be overridden in derived class")},this.getBranches=function(e){throw new Error("getBranches must be overridden in derived class")},this.getHistory=function(e,t,n){throw new Error("getHistory must be overridden in derived class")},this.getCommits=function(e,t,n){throw new Error("getCommits must be overridden in derived class")},this.createTag=function(e,t,n){throw new Error("createTag must be overridden in derived class")},this.deleteTag=function(e,t){throw new Error("deleteTag must be overridden in derived class")},this.getTags=function(e){throw new Error("getTags must be overridden in derived class")},this.getCommonAncestorCommit=function(e,t,n){throw new Error("getCommonAncestorCommit must be overridden in derived class")}}return i}),define("common/storage/project/branch",["common/storage/constants"],function(e){"use strict";function t(t,n){var i=this,o=n.fork("Branch:"+t),r="",s="",a=[],l=[],c=e.BRANCH_STATUS.SYNC;o.debug("ctor"),this.name=t,this.isOpen=!0,this.inSync=!0,this.branchStatusHandlers=[],this.hashUpdateHandlers=[],this.callbackQueue=[],this.errorList=[],this._remoteUpdateHandler=null,this.cleanUp=function(){var t,n;for(i.isOpen=!1,i.branchStatusHandlers=[],i.hashUpdateHandlers=[],i._remoteUpdateHandler=null,t=0;t<i.callbackQueue.length;t+=1)n={status:e.CANCELED,hash:a[t].commitObject[e.MONGO_ID]},i.callbackQueue[t](null,n);i.callbackQueue=[],a=[],l=[]},this.getLocalHash=function(){return s},this.getOriginHash=function(){return r},this.updateHashes=function(e,t){o.debug("updatingHashes"),null!==e&&(o.debug("localHash: old, new",s,e),s=e),null!==t&&(o.debug("originHash: old, new",r,t),r=t)},this.queueCommit=function(e,t){a.push(e),i.callbackQueue.push(t),o.debug("Adding new commit to queue",a.length)},this.getFirstCommit=function(e){var t;return e?(t=a.shift(),i.callbackQueue.shift(),o.debug("Removed commit from queue",a.length)):t=a[0],t},this.getMergedCommit=function(t){for(var n,i=l.length;i;)if(i-=1,l[i].commitObject[e.MONGO_ID]===t){n=l[i];break}return n||o.error("mergeCommit not available in updateQueue",t,JSON.stringify(l,null,2)),l=[],n},this.getCommitQueue=function(){return a},this.getCommitsForNewFork=function(t){var n,i,r,l=!1,c=[];for(o.debug("getCommitsForNewFork",t),0===a.length?(r=s,o.debug("No commits queued will fork from",r),t=t||r,l=t===r):t=t||a[a.length-1].commitObject[e.MONGO_ID],o.debug("Will fork up to commitHash",t),n=0;n<a.length;n+=1)if(i=a[n],r=i.commitObject[e.MONGO_ID],0!==n&&c.push(i),i.commitObject[e.MONGO_ID]===t){l=!0;break}return l===!1?(o.error("Could not find the specified commitHash",t),!1):{commitHash:r,queue:c}},this.queueUpdate=function(e){l.push(e),o.debug("Adding new update to queue",l.length)},this.getUpdateQueue=function(){return l},this.getFirstUpdate=function(e){var t;return e?(t=l.shift(),o.debug("Removed update from queue",l.length)):t=l[0],t},this.addBranchStatusHandler=function(e){i.branchStatusHandlers.push(e)},this.removeBranchStatusHandler=function(e){var t;for(t=0;t<i.branchStatusHandlers.length;t+=1)if(i.branchStatusHandlers[t]===e)return i.branchStatusHandlers.splice(t,1),!0;return!1},this.dispatchBranchStatus=function(t,n){var r;for(o.debug("dispatchBranchStatus old, new",c,t),c===e.BRANCH_STATUS.ERROR?(o.error("In error state, action from user required!"),t=c):c=t,n&&this.errorList.push(n instanceof Error?n:new Error(n)),r=0;r<i.branchStatusHandlers.length;r+=1)i.branchStatusHandlers[r](t,a,l)},this.addHashUpdateHandler=function(e){i.hashUpdateHandlers.push(e)},this.removeHashUpdateHandler=function(e){var t;for(t=0;t<i.hashUpdateHandlers.length;t+=1)if(i.hashUpdateHandlers[t]===e)return i.hashUpdateHandlers.splice(t,1),!0;return!1},this.dispatchHashUpdate=function(e,t){var n,o=null,r=i.hashUpdateHandlers.length,s=!0,c=function(e,n){o=o||e,s=s&&n===!0,r-=1,0===r&&t(o,s)};for(n=0;n<i.hashUpdateHandlers.length;n+=1)i.hashUpdateHandlers[n](e,a,l,c)}}return t}),define("common/storage/project/project",["common/storage/project/interface","common/storage/project/branch","q"],function(e,t,n){"use strict";function i(t,i,o,r){var s=this;this.branches={},e.call(this,t,i,o,r),this.makeCommit=function(e,t,o,r,a,l){return n.ninvoke(i,"makeCommit",s.projectId,e,t,o,r,a).nodeify(l)},this.setBranchHash=function(e,t,o,r){return n.ninvoke(i,"setBranchHash",s.projectId,e,t,o).nodeify(r)},this.getBranchHash=function(e,t){return n.ninvoke(i,"getBranchHash",s.projectId,e).nodeify(t)},this.createBranch=function(e,t,o){return n.ninvoke(i,"createBranch",s.projectId,e,t).nodeify(o)},this.deleteBranch=function(e,t,o){return n.ninvoke(i,"deleteBranch",s.projectId,e,t).nodeify(o)},this.getBranches=function(e){return n.ninvoke(i,"getBranches",s.projectId).nodeify(e)},this.createTag=function(e,t,o){return n.ninvoke(i,"createTag",s.projectId,e,t).nodeify(o)},this.deleteTag=function(e,t){return n.ninvoke(i,"deleteTag",s.projectId,e).nodeify(t)},this.getTags=function(e){return n.ninvoke(i,"getTags",s.projectId).nodeify(e)},this.getCommits=function(e,t,o){return n.ninvoke(i,"getCommits",s.projectId,e,t).nodeify(o)},this.getHistory=function(e,t,o){return n.ninvoke(i,"getHistory",s.projectId,e,t).nodeify(o)},this.getCommonAncestorCommit=function(e,t,o){return n.ninvoke(i,"getCommonAncestorCommit",s.projectId,e,t).nodeify(o)},this.squashCommits=function(e,t,o,r){return n.ninvoke(i,"squashCommits",s.projectId,e,t,o).nodeify(r)}}return i.prototype=Object.create(e.prototype),i.prototype.constructor=i,i}),define("common/storage/storageclasses/editorstorage",["common/storage/storageclasses/objectloaders","common/storage/constants","common/storage/project/project","common/storage/project/branch","common/util/assert","common/util/key","common/storage/util","q"],function(e,t,n,i,o,r,s,a){"use strict";function l(l,c,d){var h=this,p=c.fork("storage"),g={};h.logger=p,h.userId=null,h.serverVersion=null,e.call(this,l,c,d),this.open=function(e){l.connect(function(n,i){n?(p.error(n),e(t.CONNECTION_ERROR)):i===t.CONNECTED?(h.connected=!0,h.userId=l.userId,h.serverVersion=l.serverVersion,e(i)):i===t.RECONNECTED?(h.connected=!0,h._rejoinWatcherRooms().then(function(){return h._rejoinBranchRooms()}).then(function(){e(i)})["catch"](function(n){p.error("failing during reconnect",n),e(t.CONNECTION_ERROR)})):i===t.DISCONNECTED?(h.connected=!1,e(i)):i===t.INCOMPATIBLE_CONNECTION?e(i):i===t.JWT_ABOUT_TO_EXPIRE?e(i):i===t.JWT_EXPIRED?e(i):(p.error("unexpected connection state"),e(t.CONNECTION_ERROR))})},this.close=function(e){function t(t){t&&(p.error(t.message),n=t),p.debug("inside afterProjectClosed projectCnt",o),0===o&&(p.debug("Removing connect and disconnect events"),l.socket.removeAllListeners("connect"),l.socket.removeAllListeners("disconnect"),p.debug("Disconnecting web-socket"),l.disconnect(),h.connected=!1,l.clearAllEvents(),e(n))}var n=null,i=Object.keys(g),o=i.length;if(p.debug("Closing storage, openProjects",i),o>0)for(;o;)o-=1,this.closeProject(i[o],t);else p.debug("No projects were open, will disconnect directly"),t(null)},this.openProject=function(e,t){var i={projectId:e};return g[e]?void t(new Error("project is already open "+e)):void l.openProject(i,function(i,o,r){if(i)return void t(i);var s=new n(e,h,p,d);g[e]=s,t(null,s,o,r)})},this.closeProject=function(e,t){function n(n){n&&(p.error(n.message),s=n),p.debug("inside closeAndDelete branchCnt",i),0===i&&l.closeProject({projectId:e},function(n){p.debug("project closed on server."),delete g[e],t(n||s)})}var i,o,r=g[e],s=null;if(p.debug("closeProject",e),r)if(o=Object.keys(r.branches),i=o.length,i>0)for(p.warn("Branches still open for project, will be closed.",e,o);i;)i-=1,this.closeBranch(e,o[i],n);else n(null);else p.warn("Project is not open ",e),t(null)},this.openBranch=function(e,n,o,r,s){var a,c=g[e],d={projectId:e,branchName:n};return c?c.branches[n]?void s(new Error("Branch is already open "+n+", project: "+e)):(p.debug("openBranch, calling webSocket openBranch",e,n),void l.openBranch(d,function(d,g){var u;return d?void s(d):(a=new i(n,c.logger),c.branches[n]=a,a.latestCommitData=g,u=g.commitObject[t.MONGO_ID],a.updateHashes(u,u),a.addHashUpdateHandler(o),a.addBranchStatusHandler(r),a._remoteUpdateHandler=function(i,o,r){var s,l=o.commitObject[t.MONGO_ID];for(p.debug("_remoteUpdateHandler invoked for project, branch",e,n),s=0;s<o.coreObjects.length;s+=1)o.coreObjects[s]&&"patch"===o.coreObjects[s].type?c.insertPatchObject(o.coreObjects[s]):c.insertObject(o.coreObjects[s]);a.queueUpdate(o),a.updateHashes(null,l),0===a.getCommitQueue().length?1===a.getUpdateQueue().length&&h._pullNextQueuedCommit(e,n,r):p.debug("commitQueue is not empty, only updating originHash.")},void a._remoteUpdateHandler(null,g,function(t){l.addEventListener(l.getBranchUpdateEventName(e,n),a._remoteUpdateHandler),s(t,g)}))})):void s(new Error("Cannot open branch, "+n+", project "+e+" is not opened."))},this.closeBranch=function(e,t,n){var i,o=g[e];return p.debug("closeBranch",e,t),o?(i=o.branches[t])?(i.dispatchBranchStatus(null),l.removeEventListener(l.getBranchUpdateEventName(e,t),i._remoteUpdateHandler),i.cleanUp(),void l.closeBranch({projectId:e,branchName:t},function(e){delete o.branches[t],n(e)})):(p.warn("closeBranch: project does not have given branch.",e,t),void n(null)):(p.warn("closeBranch: project is not open",e,t),void n(null))},this.forkBranch=function(e,t,n,i,o){var r,s,a=g[e];return this.logger.debug("forkBranch",e,t,n,i),a?(r=a.branches[t])?(s=r.getCommitsForNewFork(i,n),h.logger.debug("forkBranch - forkData",s),s===!1?void o(new Error("Could not find specified commitHash: "+i)):void h.persistCommits(s.queue,function(t){return t?void o(t):void h.createBranch(e,n,s.commitHash,function(e){return e?(p.error("forkBranch - failed creating new branch",e),void o(e)):void o(null,s.commitHash)})})):void o(new Error("Cannot fork branch, branch is not open "+t+", project: "+e)):void o(new Error("Cannot fork branch, "+t+", project "+e+" is not opened."))},this.persistCommits=function(e,n){function i(r){var s=e[r];r<e.length?(s=e[r],p.debug("persistCommits - commitNext, currentCommitData",s),delete s.branchName,o=s.commitObject[t.MONGO_ID],l.makeCommit(s,function(e,t){return e?(p.error("persistCommits - failed committing",e),void n(e)):(p.debug("persistCommits - commit successful, hash",t),void i(r+=1))})):n(null,o)}var o;i(0)},this.makeCommit=function(e,n,i,o,r,a,c){var d,u,f,m,_=g[e],b={},y={rootHash:o,projectId:e,commitObject:null,coreObjects:{},changedNodes:null},v=Object.keys(r);for(m=0;m<v.length;m+=1)s.coreObjectHasOldAndNewData(r[v[m]])?(b[v[m]]=r[v[m]].newData,v[m]===o,y.coreObjects[v[m]]=s.getPatchObject(r[v[m]].oldData,r[v[m]].newData)):r[v[m]].newData&&r[v[m]].newHash?(y.coreObjects[v[m]]=r[v[m]].newData,b[v[m]]=r[v[m]].newData):(y.coreObjects[v[m]]=r[v[m]],b[v[m]]=r[v[m]]);y.changedNodes=s.getChangedNodes(y.coreObjects,o),y.commitObject=h._getCommitObject(e,i,y.rootHash,a),_?(_.insertObject(y.commitObject),u=y.commitObject[t.MONGO_ID],f=function(){delete _.projectCache.queuedPersists[u],h.logger.debug("Removed now persisted core-objects from cache: ",Object.keys(_.projectCache.queuedPersists).length),c.apply(null,arguments)},_.projectCache.queuedPersists[u]=b,p.debug("Queued non-persisted core-objects in cache: ",Object.keys(_.projectCache.queuedPersists).length)):f=c,"string"==typeof n&&(y.branchName=n,d=_?_.branches[n]:null),p.debug("makeCommit",y),d?(p.debug("makeCommit, branch is open will commit using commitQueue. branchName:",n),h._commitToBranch(e,n,y,i[0],f)):l.makeCommit(y,f)},this.setBranchHash=function(t,n,i,o,r){var s,a=g[t];p.debug("setBranchHash",t,n,i,o),a&&a.branches[n]?(s=a.branches[n],p.debug("setBranchHash, branch is open, will notify other local users about change"),a.loadObject(i,function(e,i){var s;return e?(p.error("setBranchHash, failed to load in commitObject"),void r(e)):(p.debug("setBranchHash, loaded commitObject"),s={projectId:t,branchName:n,coreObjects:{},changedNodes:null,commitObject:i,oldHash:o},void h._commitToBranch(t,n,s,o,r))})):e.prototype.setBranchHash.call(h,t,n,i,o,r)},this._commitToBranch=function(e,n,i,o,r){var s,a=g[e],l=i.commitObject._id,c=a.branches[n],d={commitData:i,local:!0};p.debug("_commitToBranch, [oldCommitHash, localHash]",o,c.getLocalHash()),o===c.getLocalHash()?(c.updateHashes(l,null),c.queueCommit(i,r),c.inSync===!1?c.dispatchBranchStatus(t.BRANCH_STATUS.AHEAD_NOT_SYNC):c.dispatchBranchStatus(t.BRANCH_STATUS.AHEAD_SYNC),s=1===c.getCommitQueue().length,c.dispatchHashUpdate(d,function(i,o){p.debug("_commitToBranch, dispatchHashUpdate done. [err, proceed]",i,o),i?(c.dispatchBranchStatus(t.BRANCH_STATUS.ERROR,i),r(new Error("Commit failed being loaded in users: "+i))):o===!0?s?(p.debug("_commitToBranch, commit was first in queue - will start pushing commit"),h._pushNextQueuedCommit(e,n)):p.debug("_commitToBranch, commit was NOT first in queue"):r(new Error("Commit halted when loaded in users: "+i))})):(p.warn("_commitToBranch, incoming commit parent was not the same as the localHash for the branch, commit will be canceled!"),r(null,{status:t.CANCELED,hash:l}))},this._pushNextQueuedCommit=function(e,n){var i,o=g[e],r=o.branches[n];p.debug("_pushNextQueuedCommit, length=",r.getCommitQueue().length),i=r.getFirstCommit(),p.debug("_pushNextQueuedCommit, makeCommit [from# -> to#]",i.commitObject.parents[0],i.commitObject._id),l.makeCommit(i,function(i,o){var s;i&&p.error("makeCommit failed",i),r.isOpen?(r.callbackQueue[0](i,o),!i&&o?o.status===t.SYNCED?(r.inSync=!0,r.updateHashes(null,o.hash),r.getFirstCommit(!0),0===r.getCommitQueue().length?r.dispatchBranchStatus(t.BRANCH_STATUS.SYNC):(r.dispatchBranchStatus(t.BRANCH_STATUS.AHEAD_SYNC),h._pushNextQueuedCommit(e,n))):o.status===t.MERGED?(r.inSync=!0,r.updateHashes(null,o.mergeHash),1===r.getCommitQueue().length?(s=r.getMergedCommit(o.mergeHash),r.dispatchBranchStatus(t.BRANCH_STATUS.MERGING),r.dispatchHashUpdate({commitData:s,local:!1},function(e,n){if(r.getFirstCommit(!0),e)p.error("Loading of merged commit failed with error",e,{metadata:s}),r.dispatchBranchStatus(t.BRANCH_STATUS.ERROR,e);else{if(n===!0)return p.debug("Merged commit was successfully loaded, updating localHash."),r.updateHashes(o.mergeHash,null),void r.dispatchBranchStatus(t.BRANCH_STATUS.SYNC);p.warn("Loading of update commit was aborted",{metadata:o.mergeHash})}})):(r.getFirstCommit(!0),r.dispatchBranchStatus(t.BRANCH_STATUS.MERGING),h._pushNextQueuedCommit(e,n))):o.status===t.FORKED?(r.inSync=!1,r.dispatchBranchStatus(t.BRANCH_STATUS.AHEAD_NOT_SYNC)):(i=new Error("Unsupported commit status "+o.status),p.error(i),r.dispatchBranchStatus(t.BRANCH_STATUS.ERROR,i)):r.dispatchBranchStatus(t.BRANCH_STATUS.ERROR,i)):p.error("_pushNextQueuedCommit returned from server but the branch was closed, the branch has probably been closed while waiting for the response.",e,n)})},this._pullNextQueuedCommit=function(e,n,i){o(g.hasOwnProperty(e),"Project not opened: "+e);var r,s,a=g[e],l=a.branches[n];if(!l){if(r=new Error("Branch, "+n+", not in project "+e+"."),!i)throw r;i(r)}return p.debug("About to update, updateQueue",{metadata:l.getUpdateQueue()}),0===l.getUpdateQueue().length?(p.debug("No queued updates, returns"),l.dispatchBranchStatus(t.BRANCH_STATUS.SYNC),void(i&&i(null))):(s=l.getFirstUpdate(),void(l.isOpen?(l.dispatchBranchStatus(t.BRANCH_STATUS.PULLING),l.dispatchHashUpdate({commitData:s,local:!1},function(o,r){var a=s.commitObject[t.MONGO_ID];if(o)p.error("Loading of update commit failed with error",o,{metadata:s}),l.dispatchBranchStatus(t.BRANCH_STATUS.ERROR,o);else{if(r===!0)return p.debug("New commit was successfully loaded, updating localHash."),l.updateHashes(a,null),l.getFirstUpdate(!0),void(0===l.getCommitQueue().length&&h._pullNextQueuedCommit(e,n,i));p.warn("Loading of update commit was aborted",{metadata:s})}i&&i(new Error("Loading the first commit was aborted"))})):p.error("_pullNextQueuedCommit returned from server but the branch was closed.",e,n)))},this._getCommitObject=function(e,n,i,o){o=o||"n/a";var s={root:i,parents:n,updater:[h.userId],time:(new Date).getTime(),message:o,type:t.COMMIT_TYPE,__v:t.VERSION},a="#"+r(s,d);return s[t.MONGO_ID]=a,s},this._rejoinBranchRooms=function(e){function n(e,n){var i=g[e],o=a.defer();return p.debug("_rejoinBranchRooms, rejoined branch room",e,n),i?i.getBranchHash(n).then(function(r){var s,a=i.branches[n];if(p.debug("_rejoinBranchRooms received branchHash",e,n,r),!a)throw new Error("_rejoinBranchRooms branch was closed "+e+":"+n);a.getCommitQueue().length>0?(s=a.getFirstCommit().commitObject._id,p.debug("_rejoinBranchRooms, commits were queued length=, firstQueuedCommitHash",a.getCommitQueue().length,s),i.getCommonAncestorCommit(r,s).then(function(i){function l(){d={status:t.SYNCED,hash:r},a.callbackQueue[0](null,d),a.inSync=!0,a.updateHashes(null,r),a.getFirstCommit(!0),0===a.getCommitQueue().length?a.dispatchBranchStatus(t.BRANCH_STATUS.SYNC):(a.dispatchBranchStatus(t.BRANCH_STATUS.AHEAD_SYNC),h._pushNextQueuedCommit(e,n))}function c(){d={status:t.FORKED,hash:r},a.callbackQueue[0](null,d),a.inSync=!1,a.dispatchBranchStatus(t.BRANCH_STATUS.AHEAD_NOT_SYNC)}var d;if(p.debug("_rejoinBranchRooms getCommonAncestorCommit",e,n,i),a.isOpen===!1)throw new Error("_rejoinBranchRooms branch was closed "+e+":"+n);i===s?l():(i===r,c()),o.resolve()})["catch"](function(t){try{t.message.indexOf("Commit object does not exist ["+s)>-1?(p.debug("First queued commit never made it to the server - push!"),h._pushNextQueuedCommit(e,n),o.resolve()):o.reject(t)}catch(t){o.reject(t)}})):(p.debug("_rejoinBranchRooms, no commits were queued during disconnect."),o.resolve())})["catch"](function(e){o.reject(e)}):o.reject(new Error("_rejoinBranchRooms project was closed "+e+":"+n)),o.promise}var i,o,r,s=[],c=[];p.debug("_rejoinBranchRooms");for(i in g)if(g.hasOwnProperty(i)){o=g[i],p.debug("_rejoinBranchRooms found project",i);for(r in o.branches)o.branches.hasOwnProperty(r)&&(p.debug("_rejoinBranchRooms joining branch",i,r),s.push({projectId:i,branchName:r}),c.push(a.ninvoke(l,"watchBranch",{projectId:i,branchName:r,join:!0})))}return a.all(c).then(function(){return a.all(s.map(function(e){return n(e.projectId,e.branchName)}))}).nodeify(e)}}return l.prototype=Object.create(e.prototype),l.prototype.constructor=l,l}),define("common/util/url",[],function(){"use strict";function e(e){var t,n,i,o;for(e=decodeURIComponent(e),t={},n=e.split(/[;] */),i=0;i<n.length;i++)o=n[i].split("="),t[o[0]]=o[1];return t}function t(e){return{$ref:e}}return{parseCookie:e,urlToRefObject:t}}),define("common/storage/socketio/browserclient",["common/util/url"],function(e){"use strict";function t(t,n){var i=t.fork("socketio-browserclient");this.connect=function(e){var t,o=window.location.protocol+"//"+window.location.host;window.__karma__&&(o=window.location.protocol+"//localhost:"+n.server.port),t=o+"/socket.io/socket.io.js",i.debug("Will require socketIO from",t),require([t],function(t){var r,s=t||window.io;i.debug('Connecting to "'+o+'" with options',n.socketIO.clientOptions),r=s.connect(o,n.socketIO.clientOptions),e(null,r)})},this.getToken=function(){var t=e.parseCookie(document.cookie);return t[n.authentication.jwt.cookieId]?t[n.authentication.jwt.cookieId]:void 0}}return t}),define("common/EventDispatcher",[],function(){"use strict";var e=function(){this._eventList={}};return e.prototype={_eventList:null,_getEvent:function(e,t){if(!this._eventList[e]){if(!t)return null;this._eventList[e]=[]}return this._eventList[e]},addEventListener:function(e,t){var n=this._getEvent(e,!0);n.push(t)},removeEventListener:function(e,t){var n=this._getEvent(e);if(n){var i=function(e,t){for(var n=0;n<e.length;n++)if(e[n]===t)return n;return-1},o=i(n,t);o>-1&&n.splice(o,1)}},removeAllEventListeners:function(e){var t=this._getEvent(e);t&&t.splice(0,t.length)},dispatchEvent:function(e,t){var n=this._getEventHandler(e);n&&n(this,t)},clearAllEvents:function(){this._eventList={}},_getEventHandler:function(e){var t=this._getEvent(e,!1);if(!t||0===t.length)return null;var n=function(e,n){for(var i=0;i<t.length;i++)t[i](e,n)};return n}},e}),define("common/storage/socketio/websocket",["common/EventDispatcher","common/storage/constants"],function(e,t){"use strict";function n(n,i,o){function r(e){return function(){"string"==typeof arguments[0]?e(new Error(arguments[0]),arguments[1]):e.apply(null,arguments)}}var s,a=this,l=i.fork("WebSocket"),c=!1;a.socket=null,a.userId=null,a.serverVersion=null,l.debug("ctor"),e.call(this),this.connect=function(e){l.debug("Connecting via ioClient."),s=!1,n.connect(function(i,r){return i?void e(i):(a.socket=r,a.socket.on("connect",function(){var i,r=[];if(c){for(l.debug("Socket got reconnected."),i=0;i<a.socket.sendBuffer.length;i+=1)"makeCommit"===a.socket.sendBuffer[i].data[0]?l.debug("Removed makeCommit from sendBuffer..."):r.push(a.socket.sendBuffer[i]);a.socket.receiveBuffer.length>0&&l.debug("receiveBuffer not empty after reconnect"),a.socket.sendBuffer=r,a.socket.emit("getConnectionInfo",{webgmeToken:n.getToken()},function(n,i){n?e(new Error("Could not get info on reconnect")):a.serverVersion===i.serverVersion?e(null,t.RECONNECTED):e(null,t.INCOMPATIBLE_CONNECTION)})}else l.debug("Socket got connected for the first time."),c=!0,a.socket.emit("getConnectionInfo",{webgmeToken:n.getToken()},function(n,i){n?e(new Error("Could not get info on connect")):(a.userId=i.userId||o.authentication.guestAccount,a.serverVersion=i.serverVersion,e(null,t.CONNECTED))})}),a.socket.on("disconnect",function(){l.debug("Socket got disconnected!"),e(null,t.DISCONNECTED),a.socket.io.skipReconnect===!0&&s===!1&&a.connect(e)}),a.socket.on(t.JWT_ABOUT_TO_EXPIRE,function(n){n.etype=t.JWT_ABOUT_TO_EXPIRE,l.debug("JWT_ABOUT_TO_EXPIRE event",{metadata:n}),e(null,t.JWT_ABOUT_TO_EXPIRE)}),a.socket.on(t.JWT_EXPIRED,function(n){n.etype=t.JWT_EXPIRED,l.debug("JWT_EXPIRED event",{metadata:n}),e(null,t.JWT_EXPIRED)}),a.socket.on(t.PROJECT_DELETED,function(e){e.etype=t.PROJECT_DELETED,l.debug("PROJECT_DELETED event",{metadata:e}),a.dispatchEvent(t.PROJECT_DELETED,e)}),a.socket.on(t.PROJECT_CREATED,function(e){e.etype=t.PROJECT_CREATED,l.debug("PROJECT_CREATED event",{metadata:e}),a.dispatchEvent(t.PROJECT_CREATED,e)}),a.socket.on(t.BRANCH_CREATED,function(e){e.etype=t.BRANCH_CREATED,l.debug("BRANCH_CREATED event",{metadata:e}),a.dispatchEvent(t.BRANCH_CREATED+e.projectId,e)}),a.socket.on(t.BRANCH_DELETED,function(e){e.etype=t.BRANCH_DELETED,l.debug("BRANCH_DELETED event",{metadata:e}),a.dispatchEvent(t.BRANCH_DELETED+e.projectId,e)}),a.socket.on(t.BRANCH_HASH_UPDATED,function(e){e.etype=t.BRANCH_HASH_UPDATED,l.debug("BRANCH_HASH_UPDATED event",{metadata:e}),a.dispatchEvent(t.BRANCH_HASH_UPDATED+e.projectId,e)}),a.socket.on(t.TAG_CREATED,function(e){e.etype=t.TAG_CREATED,l.debug("TAG_CREATED event",{metadata:e}),a.dispatchEvent(t.TAG_CREATED+e.projectId,e)}),a.socket.on(t.TAG_DELETED,function(e){e.etype=t.TAG_DELETED,l.debug("TAG_DELETED event",{metadata:e}),a.dispatchEvent(t.TAG_DELETED+e.projectId,e)}),a.socket.on(t.BRANCH_UPDATED,function(e){l.debug("BRANCH_UPDATED event",{metadata:e}),a.dispatchEvent(a.getBranchUpdateEventName(e.projectId,e.branchName),e)}),void a.socket.on(t.NOTIFICATION,function(e){l.debug("NOTIFICATION event",{metadata:e}),a.dispatchEvent(t.NOTIFICATION,e)}))})},this.disconnect=function(){s=!0,a.socket.disconnect(),c=!1},this.watchDatabase=function(e,t){e.webgmeToken=n.getToken(),a.socket.emit("watchDatabase",e,r(t))},this.watchProject=function(e,t){e.webgmeToken=n.getToken(),a.socket.emit("watchProject",e,r(t))},this.watchBranch=function(e,t){e.webgmeToken=n.getToken(),a.socket.emit("watchBranch",e,r(t))},this.openProject=function(e,t){e.webgmeToken=n.getToken(),a.socket.emit("openProject",e,r(t))},this.closeProject=function(e,t){e.webgmeToken=n.getToken(),a.socket.emit("closeProject",e,r(t))},this.openBranch=function(e,t){e.webgmeToken=n.getToken(),a.socket.emit("openBranch",e,r(t))},this.closeBranch=function(e,t){e.webgmeToken=n.getToken(),a.socket.emit("closeBranch",e,r(t))},this.makeCommit=function(e,t){e.webgmeToken=n.getToken(),a.socket.emit("makeCommit",e,r(t))},this.loadObjects=function(e,t){e.webgmeToken=n.getToken(),a.socket.emit("loadObjects",e,r(t))},this.loadPaths=function(e,t){e.webgmeToken=n.getToken(),a.socket.emit("loadPaths",e,r(t))},this.setBranchHash=function(e,t){e.webgmeToken=n.getToken(),a.socket.emit("setBranchHash",e,r(t))},this.getBranchHash=function(e,t){e.webgmeToken=n.getToken(),a.socket.emit("getBranchHash",e,r(t))},this.squashCommits=function(e,t){e.webgmeToken=n.getToken(),a.socket.emit("squashCommits",e,r(t))},this.getProjects=function(e,t){e.webgmeToken=n.getToken(),a.socket.emit("getProjects",e,r(t))},this.deleteProject=function(e,t){e.webgmeToken=n.getToken(),a.socket.emit("deleteProject",e,r(t))},this.createProject=function(e,t){e.webgmeToken=n.getToken(),a.socket.emit("createProject",e,r(t))},this.transferProject=function(e,t){e.webgmeToken=n.getToken(),a.socket.emit("transferProject",e,r(t))},this.duplicateProject=function(e,t){e.webgmeToken=n.getToken(),a.socket.emit("duplicateProject",e,r(t))},this.getBranches=function(e,t){e.webgmeToken=n.getToken(),a.socket.emit("getBranches",e,r(t))},this.createTag=function(e,t){e.webgmeToken=n.getToken(),a.socket.emit("createTag",e,r(t))},this.deleteTag=function(e,t){e.webgmeToken=n.getToken(),a.socket.emit("deleteTag",e,r(t))},this.getTags=function(e,t){e.webgmeToken=n.getToken(),a.socket.emit("getTags",e,r(t))},this.getCommits=function(e,t){e.webgmeToken=n.getToken(),a.socket.emit("getCommits",e,r(t))},this.getHistory=function(e,t){e.webgmeToken=n.getToken(),a.socket.emit("getHistory",e,r(t))},this.getLatestCommitData=function(e,t){e.webgmeToken=n.getToken(),a.socket.emit("getLatestCommitData",e,r(t))},this.getCommonAncestorCommit=function(e,t){e.webgmeToken=n.getToken(),a.socket.emit("getCommonAncestorCommit",e,r(t))},this.simpleRequest=function(e,t){e.webgmeToken=n.getToken(),a.socket.emit("simpleRequest",e,r(t))},this.simpleQuery=function(e,t,i){t.webgmeToken=n.getToken(),a.socket.emit("simpleQuery",e,t,r(i))},this.sendNotification=function(e,t){e.webgmeToken=n.getToken(),a.socket.emit("notification",e,r(t))},this.getBranchUpdateEventName=function(e,n){return t.BRANCH_UPDATED+e+t.ROOM_DIVIDER+n}}return n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n}),define("common/storage/browserstorage",["common/storage/storageclasses/editorstorage","common/storage/socketio/browserclient","common/storage/socketio/websocket"],function(e,t,n){"use strict";function i(i,o){var r=new t(i,o),s=new n(r,i,o),a=new e(s,i,o);return a}function o(e,t,n){return e.debug("getStorage"),r?(e.debug("Storage existed..."),n===!0&&(e.debug("Force new set to true, will create new one."),r=i(e,t))):(e.debug("No storage existed, will create new one.."),r=i(e,t)),r}var r;return{getStorage:o}}),function(){"use strict";function e(e){m=e}function t(e){if(!e)throw new Error("tasync internal error")}function n(e,t){if(0>e)return t;var n=new v;return setTimeout(function(){n.resolve(t)},e),n}function i(e){t("string"==typeof e);var n=e.indexOf("tasync_trace_start");
n>=0?n=e.lastIndexOf("\n",n)+1:("\n"!==e.charAt(e.length-1),n=void 0);var i=e.indexOf("tasync_trace_end");return i>=0?(i=e.indexOf("\n",i)+1,i>=0&&(i=e.indexOf("\n",i)+1)):i=0,e.substring(i,n)}function o(e,t){if(e instanceof Error||(e=new Error(e)),m){e.trace=i(e.stack);do e.trace+="*** callback ***\n",e.trace+=i(t.trace.stack),t=t.caller;while(t!==D)}return e}function r(e){v.call(this),this.handler=e}function s(e,t){if("function"!=typeof e||"function"!=typeof t)throw new Error("function arguments are expected");try{var n=e();if(n instanceof v){var i=new r(t);return n.register(i),i}return n}catch(o){return t(o)}}function a(e){if("function"!=typeof e)throw new Error("function argument is expected");return void 0===e.tasync_wraped&&(e.tasync_wraped=function(){var n=arguments,i=new v;if(n[n.length++]=function(e,t){e?i.reject(e instanceof Error?e:new Error(e)):i.resolve(t)},e.apply(this,n),i.state===_)return i;if(i.state===y)return i.value;throw t(i.state===b),i.value},e.tasync_wraped.tasync_unwraped=e),e.tasync_wraped}function l(e){this.callback=e}function c(e){if("function"!=typeof e)throw new Error("function argument is expected");return void 0===e.tasync_unwraped&&(e.tasync_unwraped=function(){var n=arguments,i=n[--n.length];t("function"==typeof i);var o;try{o=e.apply(this,n)}catch(r){return void i(r)}if(o instanceof v){t(o.state===_);var s=new l(i);o.register(s)}else i(null,o)},e.tasync_unwraped.tasync_wraped=e),e.tasync_unwraped}function d(e,t,n){v.call(this),this.func=e,this.that=t,this.args=n,this.caller=I,this.position=++I.subframes,this.path=this.getPath()}function h(e){this.running=0,this.limit=e,this.queue=[]}function p(e,n){for(var i=0,o=e.length;o>i;){var r=Math.floor((i+o)/2);t(r>=i&&o>r),n.compare(e[r])<0?i=r+1:o=r}e.splice(i,0,n)}function g(e,t){if("function"!=typeof e)throw new Error("function argument is expected");if("number"!=typeof t)throw new Error("number argument is expected");var n=new h(t);return function(){return n.execute(e,this,arguments)}}function u(e){v.call(this),this.first=e,this.missing=e instanceof v&&e.state===_?1:0}function f(e,t){return e instanceof v&&e.state===b?e:t instanceof v?t.state===y?e:t.state===b?t:(e instanceof u||(e=new u(e)),e.missing+=1,t.register(e),e):e}var m=!0,_=0,b=1,y=2,v=function(){this.state=_,this.value=[]};v.prototype.register=function(e){t(this.state===_),t("object"==typeof e&&null!==e),this.value.push(e)},v.prototype.resolve=function(e){t(this.state===_&&!(e instanceof v));var n=this.value;this.state=y,this.value=e;var i;for(i=0;i<n.length;++i)n[i].onResolved(e)},v.prototype.reject=function(e){t(this.state===_&&e instanceof Error);var n=this.value;this.state=b,this.value=e;var i;for(i=0;i<n.length;++i)n[i].onRejected(e)};var C=function(e,t){v.call(this),this.array=e,this.index=t};C.prototype=Object.create(v.prototype),C.prototype.onResolved=function(e){t(this.state===_);var n=this.array;for(n[this.index]=e;++this.index<n.length;)if(e=n[this.index],e instanceof v){if(e.state!==y)return e.state===_?void e.register(this):(t(e.state===b),void this.reject(e.value));n[this.index]=e.value}this.array=null,this.resolve(n)},C.prototype.onRejected=function(e){this.array=null,this.reject(e)};var E=function(e){if(!(e instanceof Array))throw new Error("array argument is expected");var n;for(n=0;n<e.length;++n){var i=e[n];if(i instanceof v){if(i.state!==y){if(i.state===_){var o=new C(e,n);return i.register(o),o}return t(i.state===b),i}e[n]=i.value}}return e},D={subframes:0},I=D,T=function(e,t,n,i){v.call(this),this.caller=I,this.position=++I.subframes,this.subframes=0,m&&(this.trace=new Error),this.func=e,this.that=t,this.args=n,this.index=i};T.prototype=Object.create(v.prototype),T.prototype.getPath=function(){for(var e=this.caller,t=[this.position];e!==D;)t.push(e.position),e=e.caller;return t},T.prototype.onRejected=function(e){this.args=null,this.reject(e)},T.prototype.onResolved=function(e){t(this.state===_);var n=this.args;for(n[this.index]=e;--this.index>=0;)if(e=n[this.index],e instanceof v){if(e.state!==y)return e.state===_?void e.register(this):(t(e.state===b),void this.reject(e.value));n[this.index]=e.value}t(I===D),I=this,this.args=null;try{e=this.func.apply(this.that,n)}catch(i){return I=D,void this.reject(o(i,this))}I=D,e instanceof v?(t(e.state===_),this.onResolved=this.resolve,e.register(this)):this.resolve(e)};var P=function(e,n,i){if("function"!=typeof e)throw new Error("function argument is expected");if(!(n instanceof Array))throw new Error("array argument is expected");for(var o=n.length;--o>=0;){var r=n[o];if(r instanceof v){if(r.state===_){var s=new T(e,i,n,o);return r.register(s),s}if(r.state!==y)return t(r.state===b),r;n[o]=r.value}}return e.apply(i,n)},N=function(e,t){v.call(this),this.caller=I,this.position=++I.subframes,this.subframes=0,m&&(this.trace=new Error),this.args=e,this.index=t};N.prototype=Object.create(v.prototype),N.prototype.getPath=T.prototype.getPath,N.prototype.onRejected=T.prototype.onRejected;var A=Function.call;N.prototype.onResolved=function(e){t(this.state===_);var n=this.args;for(n[this.index]=e;--this.index>=0;)if(e=n[this.index],e instanceof v){if(e.state!==y)return e.state===_?void e.register(this):(t(e.state===b),void this.reject(e.value));n[this.index]=e.value}t(I===D),I=this,this.args=null;try{var i=n[0];n[0]=null,e=A.apply(i,n)}catch(r){return I=D,void this.reject(o(r,this))}I=D,e instanceof v?(t(e.state===_),this.onResolved=this.resolve,e.register(this)):this.resolve(e)};var w=function(){for(var e=arguments.length;--e>=0;){var n=arguments[e];if(n instanceof v){if(n.state===_){var i=new N(arguments,e);return n.register(i),i}if(n.state!==y)return t(n.state===b),n;arguments[e]=n.value}}var o=arguments[0];return A.apply(o,arguments)};r.prototype=Object.create(v.prototype),r.prototype.onRejected=function(e){try{var t=this.handler(e);t instanceof v?(this.onRejected=v.prorotype.reject,t.register(this)):this.resolve(t)}catch(n){this.reject(n)}},r.prototype.onResolved=v.prototype.resolve,l.prototype.onRejected=function(e){this.callback(e)},l.prototype.onResolved=function(e){this.callback(null,e)},d.prototype=Object.create(v.prototype),d.prototype.execute=function(){var e;try{t(I===D),I=this,e=this.func.apply(this.that,this.args),I=D}catch(n){return I=D,void this.reject(n)}e instanceof v?(t(e.state===_),e.register(this)):this.resolve(e)},d.prototype.getPath=T.prototype.getPath,d.prototype.onResolved=v.prototype.resolve,d.prototype.onRejected=v.prototype.reject,d.prototype.compare=function(e){var t=this.path;e=e.path;var n,i=t.length<e.length?t.length:e.length;for(n=0;i>n;++n)if(t[n]!==e[n])return t[n]-e[n];return t.length-e.length},h.prototype.execute=function(e,n,i){if(this.running<this.limit){var o=e.apply(n,i);return o instanceof v&&(t(o.state===_),++this.running,o.register(this)),o}var r=new d(e,n,i);return p(this.queue,r),r},h.prototype.onResolved=function(){if(this.queue.length>0){var e=this.queue.pop();e.register(this),e.execute()}else--this.running},h.prototype.onRejected=h.prototype.onResolved,u.prototype=Object.create(v.prototype),u.prototype.onResolved=function(){0===--this.missing&&(t(this.state!==y),this.state===_&&(this.first instanceof v?(t(this.first.state===y),this.resolve(this.first.value)):this.resolve(this.first)))},u.prototype.onRejected=function(e){this.state===_&&this.reject(e)};var O={setTrace:e,delay:n,lift:E,apply:P,call:w,trycatch:s,wrap:a,unwrap:c,throttle:g,join:f};"function"==typeof define&&define.amd?define("common/core/tasync",[],function(){return O}):module.exports=O}(),define("common/core/corerel",["common/util/assert","common/core/tasync","common/util/random","common/core/constants"],function(e,t,n,i){"use strict";function o(e,t){var n=this;e=e||1e4,this._backup={},this._cache={},this._size=0,this.getItem=function(e){return n._cache[e]?n._cache[e]:n._backup[e]?n._backup[e]:null},this.setItem=function(i,o){n._cache[i]?t.warn("trying to add inverse relation object multiple times [#"+i+"]"):(n._size===e&&(n._size=0,n._backup=n._cache,n._cache={}),n._size+=1,n._cache[i]=o)}}function r(r,s){function a(e,t){if(!t)throw new Error(e)}function l(e){return e=r.normalize(e),"object"==typeof e.data&&null!==e.data}function c(e){a("coretree",r.isValidNode(e)),a("isobject",l(e))}function d(t,n,o){e(u.isValidNode(t)&&"string"==typeof n&&"string"==typeof o);var s,a;do{if(a=(r.getProperty(t,i.OVERLAYS_PROPERTY)||{})[n],a&&(s=a[o],void 0!==s))break;n="/"+r.getRelid(t)+n,t=r.getParent(t)}while(t);return{target:s,node:t}}function h(e){var t,n=u.getHash(e);if(n&&e.inverseOverlays){u._inverseCache.setItem(n,e.inverseOverlays);for(t in e.children)h(e.children[t])}}e("object"==typeof s),e("object"==typeof s.globConf),e("object"==typeof r);var p,g=r.logger,u=this;for(p in r)this[p]=r[p];this._inverseCache=new o(s.globConf.core.inverseRelationsCacheSize,g.fork("inverseCache")),g.debug("initialized CoreRel"),this.isValidNode=function(e){try{return c(e),!0}catch(t){return g.error(t.message,{metadata:{stack:t.stack,node:e}}),!1}},this.persist=function(e){var t=r.persist(e);return h(u.getRoot(e)),t},this.getInverseOverlayOfNode=function(e){var t,n,o,r,s,a={};if(e.inverseOverlays)return e.inverseOverlays;if(t=u.getHash(e),t&&(a=u._inverseCache.getItem(t)))return e.inverseOverlays=a,e.inverseOverlays;n=u.getProperty(e,i.OVERLAYS_PROPERTY),n=n||{},a={};for(o in n)for(r in n[o])s=n[o][r],a[s]=a[s]||{},a[s][r]=a[s][r]||[],a[s][r].push(o);return t&&u._inverseCache.setItem(t,a),e.inverseOverlays=a,e.inverseOverlays},this.isPointerName=function(t){return e("string"==typeof t),t===i.MUTABLE_PROPERTY?!1:!0},this.getAttributeNames=function(t){e(u.isValidNode(t));var n,o,s,a,l=[];for(n=r.getProperty(t,i.ATTRIBUTES_PROPERTY)||{},o=Object.keys(n),s=o.length;--s>=0;)a=o[s],""===a.charAt(0)?g.error("empty named attribute found in node ["+r.getPath(t)+"]"):"_"===a.charAt(0)||l.push(a);return l},this.getRegistryNames=function(t){e(u.isValidNode(t));var n,o,s,a,l=[];for(n=r.getProperty(t,i.REGISTRY_PROPERTY)||{},o=Object.keys(n),s=o.length;--s>=0;)a=o[s],""===o[s].charAt(0)?g.error("empty named attribute found in node ["+r.getPath(t)+"]"):"_"===o[s].charAt(0)||l.push(a);return l},this.getAttribute=function(e,t){return(r.getProperty(e,i.ATTRIBUTES_PROPERTY)||{})[t]},this.delAttribute=function(e,t){e=r.getChild(e,i.ATTRIBUTES_PROPERTY),r.deleteProperty(e,t)},this.setAttribute=function(e,t,n){e=r.getChild(e,i.ATTRIBUTES_PROPERTY),r.setProperty(e,t,n)},this.getRegistry=function(e,t){return(r.getProperty(e,i.REGISTRY_PROPERTY)||{})[t]},this.delRegistry=function(e,t){e=r.getChild(e,i.REGISTRY_PROPERTY),r.deleteProperty(e,t)},this.setRegistry=function(e,t,n){e=r.getChild(e,i.REGISTRY_PROPERTY),r.setProperty(e,t,n)},this.overlayRemove=function(t,n,o,s){e(u.isValidNode(t)),e(r.isValidPath(n)&&r.isValidPath(s)&&u.isPointerName(o)),e(""===r.getCommonPathPrefixData(n,s).common);var a,l,c=u.getChild(t,i.OVERLAYS_PROPERTY),d=t.inverseOverlays;a=r.getChild(c,n),e(a&&r.getProperty(a,o)===s),r.deleteProperty(a,o),0===r.getKeys(a).length&&r.deleteProperty(c,n),d&&!t.inverseOverlays&&(d=JSON.parse(JSON.stringify(d)),t.inverseOverlays=d),d&&d[s]&&d[s][o]&&(l=d[s][o].indexOf(n),-1!==l&&(d[s][o].splice(l,1),0===d[s][o].length&&(delete d[s][o],0===Object.keys(d[s]).length&&delete d[s])))},this.overlayQuery=function(t,n){e(u.isValidNode(t)&&r.isValidPath(n));var o,s,a,l=u.getProperty(t,i.OVERLAYS_PROPERTY)||{},c=u.getInverseOverlayOfNode(t),d=[],h=n+i.PATH_SEP;for(s in l)if(s===n||s.substr(0,h.length)===h)for(a in l[s])u.isPointerName(a)&&d.push({s:s,n:a,t:l[s][a],p:!0});for(s in c)if(s===n||s.substr(0,h.length)===h)for(a in c[s])for(o=0;o<c[s][a].length;o+=1)d.push({s:c[s][a][o],n:a,t:s,p:!1});return d},this.overlayInsert=function(t,n,o,s){e(u.isValidNode(t)),e(r.isValidPath(n)&&r.isValidPath(s)&&u.isPointerName(o)),e(""===r.getCommonPathPrefixData(n,s).common);var a=u.getChild(t,i.OVERLAYS_PROPERTY),l=t.inverseOverlays,c=u.getChild(a,n);e(void 0===u.getProperty(c,o)),u.setProperty(c,o,s),l&&!t.inverseOverlays&&(l=JSON.parse(JSON.stringify(l)),t.inverseOverlays=l),l&&(l[s]=l[s]||{},l[s][o]=l[s][o]||[],l[s][o].push(n))},this.createNode=function(t,n,i){t=t||{};var o=t.relid,s=t.parent;e(!s||u.isValidNode(s));var a;if(s){if(o){if(n&&n[o]||u.getChildrenRelids(s).indexOf(o)>-1)throw new Error('Given relid already used in parent "'+o+'".');a=r.getChild(s,o),s.childrenRelids=null}else a=u.createChild(s,n,i);r.setHashed(a,!0)}else a=r.createRoot();return a.inverseOverlays={},a},this.deleteNode=function(t){e(u.isValidNode(t));var n=r.getParent(t);e(null!==n),u.deleteChild(n,r.getRelid(t))},this.deleteChild=function(e,t){var n="/"+t;for(r.deleteProperty(e,t),e.childrenRelids&&(e.childrenRelids=null);e;){for(var o=u.overlayQuery(e,n),s=0;s<o.length;++s){var a=o[s];u.overlayRemove(e,a.s,a.n,a.t)}n=i.PATH_SEP+r.getRelid(e)+n,e=r.getParent(e)}},this.createChild=function(e,t,n){var i=r.createChild(e,t,n);return e.childrenRelids=null,i},this.copyNode=function(t,n,i,o){e(u.isValidNode(t)),e(!n||u.isValidNode(n));var s,a,l,c,d,h,p,g,f,m,_,b,y,v,C;if(t=r.normalize(t),C=t.inverseOverlays,n){if(a=r.getAncestor(t,n),a===t)return null;for(s=u.createChild(n,i,o),r.setHashed(s,!0),r.setData(s,r.copyData(t)),l=r.getPath(s,a),d=r.getParent(t),h="/"+r.getRelid(t),p=1;d;){for(g=u.overlayQuery(d,h),f=r.getAncestor(d,a),p=d===a?0:f===d?1:-1,b=0>p?r.getPath(d,a):r.getPath(a,d),m=0;m<g.length;++m)if(_=g[m],_.p){if(e(_.s.substr(0,h.length)===h),e(_.s===h||"/"===_.s.charAt(h.length)),0>p)y=l+_.s.substr(h.length),v=r.joinPaths(b,_.t),c=a;else if(0===p){var E=r.getCommonPathPrefixData(l,_.t);for(c=s;E.firstLength-->0;)c=r.getParent(c);y=r.joinPaths(E.first,_.s.substr(h.length)),v=E.second}else e(_.s.substr(0,h.length)===h),y=b+l+_.s.substr(h.length),v=_.t,c=d;u.overlayInsert(c,y,_.n,v)}h="/"+r.getRelid(d)+h,d=r.getParent(d)}}else s=r.createRoot(),r.setData(s,r.copyData(t));return C&&(s.inverseOverlays=JSON.parse(JSON.stringify(C))),s},this.copyNodes=function(e,t,n,i){var o,s,a,l,c,d,h=[],p=[],g=[];for(o=0;o<e.length;o++)h.push(r.getPath(e[o]));for(o=0;o<e.length;o++){for(l=u.getPointerNames(e[o]),c={},s=0;s<l.length;s++)a=h.indexOf(u.getPointerPath(e[o],l[s])),-1!==a&&(c[l[s]]=a);g.push(c)}for(o=0;o<e.length;o++)d=u.copyNode(e[o],t,n,i),p.push(d),n&&(n[u.getRelid(d)]=!0);for(o=0;o<g.length;o++)for(l=Object.keys(g[o]),s=0;s<l.length;s++)u.setPointer(p[o],l[s],p[g[o][l[s]]]);return p},this.moveNode=function(t,n,i,o){e(u.isValidNode(t)&&u.isValidNode(n));var s,a,l,c,d,h,p,g,f,m,_,b,y,v;if(t=r.normalize(t),s=r.getAncestor(t,n),s===t)return null;a=r.getParent(t),l="/"+r.getRelid(t),c=1;var C=t;for(i?t=i[r.getRelid(C)]?r.createChild(n,i,o):r.getChild(n,r.getRelid(C)):(t=r.getChild(n,r.getRelid(C)),r.isEmpty(t)||(t=r.createChild(n))),n.childrenRelids=null,r.setHashed(t,!0),r.setData(t,r.copyData(C)),d=r.getPath(t,s);a;){for(h=u.overlayQuery(a,l),p=r.getAncestor(a,s),c=a===s?0:p===a?1:-1,g=0>c?r.getPath(a,s):r.getPath(s,a),f=0;f<h.length;++f){if(y=h[f],u.overlayRemove(a,y.s,y.n,y.t),y.p||(v=y.s,y.s=y.t,y.t=v),e(y.s.substr(0,l.length)===l),e(y.s===l||"/"===y.s.charAt(l.length)),0>c)m=d+y.s.substr(l.length),_=r.joinPaths(g,y.t),b=s;else if(0===c){var E=r.getCommonPathPrefixData(d,y.t);for(b=t;E.firstLength-->0;)b=r.getParent(b);m=r.joinPaths(E.first,y.s.substr(l.length)),_=E.second}else e(y.s.substr(0,l.length)===l),m=g+d+y.s.substr(l.length),_=y.t,b=a;y.p||(v=y.s,y.s=y.t,y.t=v,v=m,m=_,_=v),u.overlayInsert(b,m,y.n,_)}l="/"+r.getRelid(a)+l,a=r.getParent(a)}return u.deleteNode(C),t},this.getChildrenRelids=function(t){return e(u.isValidNode(t)),t.childrenRelids||(t.childrenRelids=r.getKeys(t,u.isValidRelid)),t.childrenRelids},this.getChildrenPaths=function(e){var t,n=r.getPath(e),i=u.getChildrenRelids(e),o=[];for(t=0;t<i.length;t+=1)o.push(n+"/"+i[t]);return o},this.loadChildren=function(e){var n,i=u.getChildrenRelids(e),o=[];for(n=0;n<i.length;n+=1)o.push(r.loadChild(e,i[n]));return t.lift(o)},this.getPointerNames=function(e){return u.getPointerNamesFrom(e,"")},this.getPointerNamesFrom=function(t,n){e(u.isValidNode(t));var o=[];do{var s=(r.getProperty(t,i.OVERLAYS_PROPERTY)||{})[n];if(s)for(var a in s)e(-1===o.indexOf(a)),u.isPointerName(a)&&o.push(a);n="/"+r.getRelid(t)+n,t=r.getParent(t)}while(t);return o},this.getPointerPath=function(e,t){return u.getPointerPathFrom(e,"",t)},this.getPointerPathFrom=function(e,t,n){var i,o=d(e,t,n);return void 0!==o.target&&(i=r.joinPaths(r.getPath(o.node),o.target)),i},this.loadPointer=function(e,t){var n=d(e,"",t);return void 0!==n.target?r.loadByPath(n.node,n.target):null},this.getCollectionNames=function(t){e(u.isValidNode(t));var n,o,r=[],s="";do{if(o=u.getInverseOverlayOfNode(t),o[s])for(n in o[s])-1===r.indexOf(n)&&r.push(n);s=i.PATH_SEP+u.getRelid(t)+s,t=u.getParent(t)}while(t);return r},this.loadCollection=function(n,o){e(u.isValidNode(n)&&u.isPointerName(o));var r,s,a=[],l="";do{if(s=u.getInverseOverlayOfNode(n),s[l]&&s[l][o])for(r=0;r<s[l][o].length;r+=1)a.push(u.loadByPath(n,s[l][o][r]));l=i.PATH_SEP+u.getRelid(n)+l,n=u.getParent(n)}while(n);return t.lift(a)},this.getCollectionPaths=function(t,n){e(u.isValidNode(t)&&u.isPointerName(n));var o,r,s=[],a="",l="";do{if(o=u.getInverseOverlayOfNode(t),o[a]&&o[a][n])for(l=u.getPath(t),r=0;r<o[a][n].length;r+=1)s.push(l+o[a][n][r]);a=i.PATH_SEP+u.getRelid(t)+a,t=u.getParent(t)}while(t);return s},this.deletePointer=function(t,n){e(u.isValidNode(t)&&"string"==typeof n);var o,r="";do o=u.getProperty(t,i.OVERLAYS_PROPERTY),o&&o[r]&&o[r][n]&&u.overlayRemove(t,r,n,o[r][n]),r=i.PATH_SEP+u.getRelid(t)+r,t=u.getParent(t);while(t);return!1},this.setPointer=function(t,n,i){e(u.isValidNode(t)&&"string"==typeof n&&(!i||u.isValidNode(i)));var o,s,a;u.deletePointer(t,n),i&&(o=r.getAncestor(t,i),a=r.getPath(t,o),s=r.getPath(i,o),u.overlayInsert(o,a,n,s))},this.getChildrenHashes=function(e){var t,n=u.getChildrenRelids(e),i={};for(t=0;t<n.length;t++)i[n[t]]=r.getChildHash(e,n[t]);return i},this.isValidRelid=n.isValidRelid,this.isContainerPath=function(e,t){var n,i=(e||"").split("/"),o=(t||"").split("/");for(n=0;n<o.length;n+=1)if(o[n]!==i[n])return!1;return!0}}return r}),define("common/core/setcore",["common/util/assert","common/core/constants"],function(e,t){"use strict";function n(n,i){function o(e){n.setRegistry(e,t.SET_MODIFIED_REGISTRY,(n.getRegistry(e,t.SET_MODIFIED_REGISTRY)||0)+1)}function r(e,i){return n.getChild(n.getChild(e,t.ALL_SETS_PROPERTY),i)}function s(i,o){e("string"==typeof o);var r=n.getProperty(i,t.ALL_SETS_PROPERTY);return r&&r[o]}function a(e,i,o){var r,a,l;if(r=s(e,i))for(a=P.getRawKeys(r,P.isValidRelid),l=0;l<a.length;l+=1)if(n.getPointerPathFrom(e,"/"+t.ALL_SETS_PROPERTY+"/"+i+"/"+a[l],t.MEMBER_RELATION)===o)return a[l];return null}function l(e,t,n){var i=null;do{if(i=a(e,t,n))return i;e=P.getBase(e)}while(e);return i}function c(e,t,i){var o=l(e,t,i);return"string"==typeof o&&n.getChild(r(e,t),o)}function d(e,t,i){var o=a(e,t,i);return"string"==typeof o&&n.getChild(r(e,t),o)}function h(e){var n,i,o,r=[];if(n=P.getProperty(e,t.ALL_SETS_PROPERTY),n&&n[t.OVERLAYS_PROPERTY]&&n[t.OVERLAYS_PROPERTY][""])for(i=Object.keys(n[t.OVERLAYS_PROPERTY][""]),o=0;o<i.length;o+=1)i[o]!==t.MUTABLE_PROPERTY&&-1===r.indexOf(i[o])&&r.push(i[o]);return r}function p(e){var t,n,i=[];do{for(t=h(e),n=0;n<t.length;n+=1)-1===i.indexOf(t[n])&&i.push(t[n]);e=P.getBase(e)}while(e);return i}function g(n,i){e("string"==typeof i);var o=P.getProperty(n,t.ALL_SETS_PROPERTY);return o&&o[t.OVERLAYS_PROPERTY]&&o[t.OVERLAYS_PROPERTY][""]&&o[t.OVERLAYS_PROPERTY][""][i]?!0:!1}function u(e,t){do{if(g(e,t))return!0;e=P.getBase(e)}while(e);return!1}function f(e,t){var n,i,o,r=[];do{if(n=s(e,t))for(i=P.getRawKeys(n,P.isValidRelid),o=0;o<i.length;o+=1)-1===r.indexOf(i[o])&&r.push(i[o]);e=P.getBase(e)}while(e);return r}function m(e){var t=P.getPath(e);return t.substring(0,t.indexOf("/_"))}function _(e,i,o){var r,s,a="/"+t.ALL_SETS_PROPERTY+"/"+i+"/"+o;do{if(s=n.getPointerPathFrom(e,a,t.MEMBER_RELATION),void 0!==s&&(r=s,r!==m(e)))break;e=P.getBase(e)}while(e);return r}function b(e,t,n,i){var o,r,a=s(e,n);return a&&("string"==typeof i?(r=l(e,n,i),o=r&&a[r]&&a[r][t]):o=a[t]),o}function y(e,t,i,o){var r=b(e,t,i,o);return r?n.getRawKeys(r):[]}function v(e,t,n,i){var o,r,s=[];do{for(o=y(e,t,n,i),r=0;r<o.length;r+=1)-1===s.indexOf(o[r])&&s.push(o[r]);e=P.getBase(e)}while(e);return s}function C(e,t,n,i,o){var r=b(e,t,i,o);return r?r[n]:void 0}function E(e,t,n,i,o){var r;do{if(r=C(e,t,n,i,o),void 0!==r)return r;e=P.getBase(e)}while(e);return void 0}function D(e,i){var o=n.getChild(e,t.ALL_SETS_PROPERTY);void 0===n.getOwnPointerPath(o,i)&&P.createSet(e,i)}e("object"==typeof i),e("object"==typeof i.globConf),e("undefined"!=typeof i.logger);var I,T=i.logger,P=this;for(I in n)this[I]=n[I];T.debug("initialized SetCore"),this.getCollectionNames=function(e){var i,o=n.getCollectionNames(e);for(i=0;i<o.length;i++)if(o[i]===t.MEMBER_RELATION){o.splice(i,1);break}return o},this.getSetNames=function(e){return p(e)},this.getOwnSetNames=function(e){return h(e)},this.createSet=function(e,i){var s=r(e,i);n.setPointer(n.getChild(e,t.ALL_SETS_PROPERTY),i,null),n.setRegistry(s,"_","_"),o(e)},this.deleteSet=function(e,i){var o=n.getChild(e,t.ALL_SETS_PROPERTY),r=n.getChild(o,i);n.deletePointer(o,i),n.deleteNode(r,!0)},this.isMemberOf=function(e){for(var n=P.getCollectionPaths(e,t.MEMBER_RELATION),i={},o=0;o<n.length;o++){var r=n[o].split("/");if(-1===r.indexOf(t.META_NODE)){var s=r.indexOf(t.ALL_SETS_PROPERTY);if(s>0&&r.length>s+1){var a=r.slice(0,s).join("/");void 0===i[a]&&(i[a]=[]),i[a].push(r[s+1])}}}return i},this.isFullyOverriddenMember=function(e,t,i){var o,r,s=p(e);return-1===s.indexOf(t)?!1:null===n.getBase(e)?!1:(o=l(e,t,i),r=l(n.getBase(e),t,i),o&&r&&o!==r?!0:!1)},this.getMemberPaths=function(e,t){var n,i,o=f(e,t),r=[];for(n=0;n<o.length;n+=1)i=_(e,t,o[n]),void 0!==i&&-1===r.indexOf(i)&&r.push(i);return r},this.getOwnMemberPaths=function(e,t){var n,i=s(e,t),o=i?P.getRawKeys(i,P.isValidRelid):[],r=P.getMemberPaths(e,t),a=[];for(n=0;n<r.length;n+=1)-1!==o.indexOf(l(e,t,r[n]))&&a.push(r[n]);return a},this.delMember=function(e,t,i){var o;o=d(e,t,i),o&&n.deleteNode(o,!0)},this.addMember=function(e,i,s){var a,c=r(e,i),d=l(e,i,P.getPath(s));null===d?(D(e,i),a=n.createChild(c,t.MAXIMUM_STARTING_RELID_LENGTH+1)):P.isFullyOverriddenMember(e,i,P.getPath(s))||(a=n.copyNode(n.getChild(c,d),c,t.MAXIMUM_STARTING_RELID_LENGTH+1),n.deleteNode(n.getChild(c,d),!0)),a?(n.setPointer(a,t.MEMBER_RELATION,s),n.setRegistry(a,"_","_"),o(e)):T.warn("member already in set")},this.getMemberAttributeNames=function(n,i,o){return e("string"==typeof o),v(n,t.ATTRIBUTES_PROPERTY,i,o)},this.getMemberOwnAttributeNames=function(n,i,o){return e("string"==typeof o),y(n,t.ATTRIBUTES_PROPERTY,i,o)},this.getMemberAttribute=function(n,i,o,r){return e("string"==typeof o),E(n,t.ATTRIBUTES_PROPERTY,r,i,o)},this.getMemberOwnAttribute=function(n,i,o,r){return e("string"==typeof o),C(n,t.ATTRIBUTES_PROPERTY,r,i,o)},this.setMemberAttribute=function(t,i,r,s,a){e(void 0!==a);var l=c(t,i,r);l&&(n.setAttribute(l,s,a),o(t))},this.delMemberAttribute=function(e,t,i,o){var r=d(e,t,i);r&&n.delAttribute(r,o)},this.getMemberRegistryNames=function(n,i,o){return e("string"==typeof o),v(n,t.REGISTRY_PROPERTY,i,o)},this.getMemberOwnRegistryNames=function(n,i,o){return e("string"==typeof o),y(n,t.REGISTRY_PROPERTY,i,o)},this.getMemberRegistry=function(n,i,o,r){return e("string"==typeof o),E(n,t.REGISTRY_PROPERTY,r,i,o)},this.getMemberOwnRegistry=function(n,i,o,r){return e("string"==typeof o),C(n,t.REGISTRY_PROPERTY,r,i,o)},this.setMemberRegistry=function(t,i,r,s,a){e(void 0!==a);var l=c(t,i,r);l&&(n.setRegistry(l,s,a),o(t))},this.delMemberRegistry=function(e,t,i,o){var r=d(e,t,i);r&&n.delRegistry(r,o)},this.getSetAttributeNames=function(e,n){return v(e,t.ATTRIBUTES_PROPERTY,n)},this.getOwnSetAttributeNames=function(e,n){return y(e,t.ATTRIBUTES_PROPERTY,n)},this.getSetAttribute=function(e,n,i){return E(e,t.ATTRIBUTES_PROPERTY,i,n)},this.getOwnSetAttribute=function(e,n,i){return C(e,t.ATTRIBUTES_PROPERTY,i,n)},this.setSetAttribute=function(e,t,n,i){u(e,t)&&(P.setAttribute(r(e,t),n,i),o(e))},this.delSetAttribute=function(e,t,n){var i=s(e,t);i&&P.delAttribute(r(e,t),n)},this.getSetRegistryNames=function(e,n){return v(e,t.REGISTRY_PROPERTY,n)},this.getOwnSetRegistryNames=function(e,n){return y(e,t.REGISTRY_PROPERTY,n)},this.getSetRegistry=function(e,n,i){return E(e,t.REGISTRY_PROPERTY,i,n)},this.getOwnSetRegistry=function(e,n,i){return C(e,t.REGISTRY_PROPERTY,i,n)},this.setSetRegistry=function(e,t,n,i){u(e,t)&&(P.setRegistry(r(e,t),n,i),o(e))},this.delSetRegistry=function(e,t,n){var i=s(e,t);i&&P.delRegistry(r(e,t),n)}}return n}),define("common/core/guidcore",["common/util/assert","common/core/tasync","common/regexp","common/util/random","common/core/constants"],function(e,t,n,i,o){"use strict";function r(i,r){function l(e){return e.replace(/-/g,"")}function c(e){return e.substr(0,8)+"-"+e.substr(8,4)+"-"+e.substr(12,4)+"-"+e.substr(16,4)+"-"+e.substr(20)}function d(e){if(null===e||void 0===e)return[0,0,0,0,0,0,0,0];for(var t=new Array(8),n=0;n<e.length/4;n+=1)t[n]=parseInt(e.substr(4*n,4),16);return t}function h(e){var t=m.getRelid(e);if(t=s(t),"NaN"===t)return null;for(t=t.toString(16);t.length<32;)t+="0";return t}function p(t,n){var i=d(t),o=d(n);e(i.length===o.length);for(var r=[],s=0;s<i.length;s++)r.push(i[s]^o[s]);for(s=0;s<r.length;s++){r[s]=Number(r[s]).toString(16);for(var a=4-r[s].length;a>0;)r[s]="0"+r[s],a--}return r.join("")}function g(e,t){m.setAttribute(e,o.OWN_GUID,p(l(t),p(h(e),l(m.getGuid(m.getParent(e))))))}e("object"==typeof r),e("object"==typeof r.globConf),e("undefined"!=typeof r.logger);var u,f=r.logger,m=this;for(u in i)this[u]=i[u];f.debug("initialized GuidCore"),this.createNode=function(t){t=t||{};var o,r=t.guid||a();return e(n.GUID.test(r)),o=i.createNode(t),g(o,r),o},this.moveNode=function(e,t){var n=m.getGuid(e);return e=i.moveNode(e,t),g(e,n),e},this.getGuid=function(e){return e?m.getDeducedGuid(e,m.getGuid(m.getParent(e))):o.NULL_GUID},this.setGuid=function(i,o){return e(n.GUID.test(o)),t.call(function(e){var t,n=[];for(t=0;t<e.length;t+=1)n.push(m.getGuid(e[t]));for(g(i,o),t=0;t<e.length;t+=1)g(e[t],n[t])},m.loadChildren(i))},this.getDataGuid=function(e){return c(m.getAttribute(e,o.OWN_GUID))},this.getDeducedGuid=function(e,t){return e&&n.GUID.test(t)?c(p(h(e),p(m.getAttribute(e,o.OWN_GUID),l(t)))):o.NULL_GUID}}var s=i.relidToInteger,a=i.generateGuid;return r}),define("common/core/nullpointercore",["common/util/assert","common/core/constants"],function(e,t){"use strict";function n(n,i){e("object"==typeof i),e("object"==typeof i.globConf),e("undefined"!=typeof i.logger);var o,r=i.logger,s=this;for(o in n)this[o]=n[o];return r.debug("initialized NullPointerCore"),this.setPointer=function(e,i,o){if(null===o){var r=n.getChild(e,t.NULLPTR_RELID);n.setAttribute(r,"name",t.NULLPTR_NAME),n.setPointer(e,i,r)}else n.setPointer(e,i,o)},this.getPointerPath=function(e,i){var o=n.getPointerPath(e,i);return o&&-1!==o.indexOf(t.NULLPTR_RELID)?null:o},this.loadPointer=function(e,t){var i=s.getPointerPath(e,t);return null===i?null:n.loadPointer(e,t)},s}return n}),define("common/core/coreunwrap",["common/util/assert","common/core/tasync"],function(e,t){"use strict";var n=function(n,i){function o(e){if(null===e||n.isValidNode(e))return e;throw new Error("Invalid result node")}function r(t){e(t instanceof Array);var i;for(i=0;i<t.length;++i)if(!n.isValidNode(t[i]))throw new Error("Invalid result node array");return t}e("object"==typeof i),e("object"==typeof i.globConf),e("undefined"!=typeof i.logger);var s=i.logger.fork("coreunwrap"),a={};for(var l in n)a[l]=n[l];return s.debug("initialized"),a.loadRoot=t.unwrap(n.loadRoot),a.loadChild=t.unwrap(function(e,i){return t.call(o,n.loadChild(e,i))}),a.loadByPath=t.unwrap(function(e,i){return t.call(o,n.loadByPath(e,i))}),a.loadChildren=t.unwrap(function(e){return t.call(r,n.loadChildren(e))}),a.loadOwnChildren=t.unwrap(function(e){return t.call(r,n.loadOwnChildren(e))}),a.loadPointer=t.unwrap(n.loadPointer),a.loadCollection=t.unwrap(n.loadCollection),a.loadSubTree=t.unwrap(n.loadSubTree),a.loadOwnSubTree=t.unwrap(n.loadOwnSubTree),a.loadTree=t.unwrap(n.loadTree),a.traverse=t.unwrap(n.traverse),a.setGuid=t.unwrap(n.setGuid),"function"==typeof n.generateTreeDiff&&(a.generateTreeDiff=t.unwrap(n.generateTreeDiff)),"function"==typeof n.generateLightTreeDiff&&(a.generateLightTreeDiff=t.unwrap(n.generateLightTreeDiff)),"function"==typeof n.applyTreeDiff&&(a.applyTreeDiff=t.unwrap(n.applyTreeDiff)),a.addLibrary=t.unwrap(n.addLibrary),a.updateLibrary=t.unwrap(n.updateLibrary),a.loadInstances=t.unwrap(function(e){return t.call(r,n.loadInstances(e))}),a};return n}),define("common/core/coretype",["common/util/assert","common/core/tasync","common/core/constants"],function(e,t,n){"use strict";var i=function(i,o){function r(e,t){if(!t)throw new Error(e)}function s(e){return void 0===i.getPointerPath(e,n.BASE_POINTER)}function a(t){return e(void 0===t.base||null===t.base),t.base=null,t}function l(e,n){var o=null,r=S.getBase(e),s=null;return r&&S.getChildrenRelids(r,!0)[n]?(-1!==i.getChildrenRelids(e).indexOf(n)&&(o=i.loadChild(e,n)),s=S.loadChild(r,n),t.call(function(e,t,n,r){return t?(o=t,o.base=e,o):(o=i.getChild(n,r),S.setHashed(o,!0,!0),o.base=e,o)},s,o,e,n)):S.getChildrenRelids(e,!0)[n]!==!0?null:t.call(c,i.loadChild(e,n))}function c(o){var r=i.getPath(o);if(e(null===o||void 0===o.base||"object"==typeof o.base),void 0===o.base){if(S.isEmpty(o))return o.base=null,o;if(s(o))return i.deleteNode(o),O.warn("node ["+r+"] removed due to missing base"),null;var a=i.getPointerPath(o,n.BASE_POINTER);return e(void 0!==a),null===a?(o.base=null,o):S.isContainerPath(a,r)?(O.error("node ["+r+"] contains its own base!"),i.deleteNode(o),null):t.call(d,o,S.loadByPath(S.getRoot(o),a))}return o}function d(t,n){return null!==typeof t.base&&"object"==typeof t.base&&i.getPath(t.base)===i.getPath(n)?t:(e(void 0===t.base||null===t.base),null===n?(O.warn("node ["+i.getPath(t)+"] removed due to missing base in inheritance chain"),i.deleteNode(t),null):(t.base=n,t))}function h(e,n,i){if(null===e||i===n.length)return e;var o=S.loadChild(e,n[i]);return t.call(h,o,n,i+1)}function p(e){var t=S.getParent(e),n=S.getBase(e),i=t?S.getBase(t):null,o=n?S.getParent(n):null;return o&&i&&S.getPath(o)===S.getPath(i)?!0:!1}function g(e){for(;p(e);)e=S.getParent(e);return e}function u(e){for(var t,o,r,s,a=[],l=e,c=e;l;){if(c=S.getBase(l),t=S.getBase(g(l)),s="",c&&t)for(;c&&c!==S.getParent(t);){if(o=i.getInverseOverlayOfNode(c),o[s])for(r in o[s])-1===a.indexOf(r)&&a.push(r);s=n.PATH_SEP+S.getRelid(c)+s,c=S.getParent(c)}l=S.getBase(l)}return a}function f(e,t){for(var o,r,s,a,l,c=[],d=e,h=e;d;){if(h=S.getBase(d),o=S.getBase(g(d)),l="",h&&o)for(r=e;h&&h!==S.getParent(o);){if(a=i.getInverseOverlayOfNode(h),a[l]&&a[l][t])for(s=0;s<a[l][t].length;s+=1)c.push(S.joinPaths(S.getPath(r),a[l][t][s]));l=n.PATH_SEP+S.getRelid(h)+l,h=S.getParent(h),r=S.getParent(r)}d=S.getBase(d)}return c}function m(e){var t,n=S.getPointerNames(e),i=S.getOwnPointerNames(e),o=[];for(t=0;t<n.length;t++)-1===i.indexOf(n[t])&&o.push(n[t]);return o}function _(e){r("core",i.isValidNode(e)),r("base","object"==typeof e.base)}function b(e,t){for(var n;void 0===n&&null!==e;)n=i.getProperty(e,t),e=S.getBase(e);return n}function y(e,t,n){var o=i.getPointerPathFrom(e,t,n);return void 0===o?null!==e.base&&void 0!==e.base?y(e.base,t,n):void 0:o}function v(e){var t;return e.base?(t=S.getParent(e.base),t?S.getPath(t):void 0):void 0}function C(e){var t=S.getParent(e);return t&&t.base?S.getPath(t.base):void 0}function E(e,t,i){var o=S.getChild(e,n.OVERLAYS_PROPERTY),r=S.getChild(o,t);return b(r,i)}function D(e,t){for(;t;){if(t===e)return!0;t=S.getBase(t)}return!1}function I(e,t){for(;t;){if(t===e)return!0;t=S.getParent(t)}return!1}function T(e,t,n,i){var o=S.getPath(t);if(i){if(n.containment[o])return!1;n.containment[o]=!0,t=S.getParent(t)}else{if(n.inheritance[o])return!1;
n.inheritance[o]=!0,t=S.getBase(t)}for(;t;){if(e===t||T(e,t,n,!i))return!0;t=i?S.getParent(t):S.getBase(t)}return!1}function P(e,t){var n,i=[];for(n=e;n;)i.push(n),n=S.getBase(n);for(n=t;n;){if(i.indexOf(n)>-1)return n;n=S.getBase(n)}return null}function N(e,t,n){var i=P(e,t),o=!1;return i&&(o=S.getChildrenRelids(i,!0).hasOwnProperty(n)),o}function A(e,t){var o;if(t>n.MAXIMUM_STARTING_RELID_LENGTH+1)return void O.debug("Minimum relid length surpassed threshold, not propagating at all",t);for(t>n.MAXIMUM_STARTING_RELID_LENGTH&&(t=n.MAXIMUM_STARTING_RELID_LENGTH,O.debug("Minimum relid length reached threshold, only propagating threshold",t)),e=e.base;e;){if(o=i.getProperty(e,n.MINIMAL_RELID_LENGTH_PROPERTY)||0,o>=t)return;i.setProperty(e,n.MINIMAL_RELID_LENGTH_PROPERTY,t),e=e.base}}e("object"==typeof o),e("object"==typeof o.globConf),e("undefined"!=typeof o.logger);var w,O=o.logger,S=this;for(w in i)this[w]=i[w];O.debug("initialized CoreType"),this.isValidNode=function(e){try{return _(e),!0}catch(t){return O.error(t.message,{stack:t.stack,node:e}),!1}},this.loadRoot=function(e){return t.call(a,i.loadRoot(e))},this.loadChild=function(e,n){return t.call(function(e){return e&&S.isInheritanceContainmentCollision(e,S.getParent(e))?(O.error("node["+S.getPath(e)+"] was deleted due to inheritance-containment collision"),S.deleteNode(e),null):e},l(e,n))},this.loadByPath=function(t,n){return e(S.isValidNode(t)),e(""===n||"/"===n.charAt(0)),n=n.split("/"),h(t,n,1)},this.loadPointer=function(e,n){var i=S.getPointerPath(e,n),o=S.getRoot(e);return void 0===i?void 0:null===i?null:t.call(function(){return S.loadByPath(o,i)},S.loadPaths(S.getHash(o),[i]))},this.getChild=function(t,n){e(S.isValidNode(t)&&(void 0===t.base||"object"==typeof t.base));var o=i.getChild(t,n);return null!==t.base&&void 0!==t.base?(null===o.base||void 0===o.base)&&(o.base=S.getChild(t.base,n)):o.base=null,o},this.getChildrenRelids=function(t,n){function o(){for(var e=t,n=0,i=t.allChildrenRelids.bases.length;e;){if(n===i||e.childrenRelids!==t.allChildrenRelids.bases[n])return!1;e=e.base,n+=1}return!0}e(S.isValidNode(t));var r,s,a=t;if(!t.allChildrenRelids||o()===!1)for(t.allChildrenRelids={cached:{},bases:[]};a;){for(r=i.getChildrenRelids(a),t.allChildrenRelids.bases.push(r),s=0;s<r.length;s+=1)t.allChildrenRelids.cached[r[s]]=!0;a=a.base}return n?t.allChildrenRelids.cached:Object.keys(t.allChildrenRelids.cached)},this.loadChildren=function(n){e(S.isValidNode(n));for(var i=S.getChildrenRelids(n),o=[],r=0;r<i.length;r++)o[r]=S.loadChild(n,i[r]);return t.call(function(e){for(var t=[],n=0;n<e.length;n++)null!==e[n]&&t.push(e[n]);return t},t.lift(o))},this.setPointer=function(e,t,o){i.setPointer(e,t,o),p(e)&&(S.setProperty(e,n.INHERITED_CHILD_HAS_OWN_RELATION_PROPERTY,!0),S.processRelidReservation(S.getParent(e),S.getRelid(e))),p(o)&&(S.setProperty(o,n.INHERITED_CHILD_HAS_OWN_RELATION_PROPERTY,!0),S.processRelidReservation(S.getParent(o),S.getRelid(o)))},this.getCollectionNames=function(t){e(S.isValidNode(t));var n,o=i.getCollectionNames(t),r=u(t);for(n=0;n<o.length;n++)r.indexOf(o[n])<0&&r.push(o[n]);return r},this.getCollectionPaths=function(t,n){e(S.isValidNode(t)&&n);var o=i.getCollectionPaths(t,n),r=f(t,n);return r=r.concat(o)},this.loadCollection=function(e,n){var i,o=S.getRoot(e),r=S.getCollectionPaths(e,n),s=[],a=S.getHash(o);return t.call(function(){for(i=0;i<r.length;i+=1)s[i]=S.loadByPath(o,r[i]);return t.lift(s)},S.loadPaths(a,r))},this.createChild=function(e,t){var n=i.createChild(e,S.getChildrenRelids(e,!0),t);return this.processRelidReservation(e,this.getRelid(n)),S.getChild(e,this.getRelid(n))},this.createNode=function(t,o){t=t||{};var r,s,a=t.base||null,l=t.parent;return e(!l||S.isValidNode(l)),e(!a||S.isValidNode(a)),e(!a||S.getPath(a)!==S.getPath(l)),l&&(s=S.getChildrenRelids(l,!0),o=o||i.getProperty(l,n.MINIMAL_RELID_LENGTH_PROPERTY)),r=i.createNode(t,s,o),r.base=a,i.setPointer(r,n.BASE_POINTER,a),l&&(this.processRelidReservation(l,this.getRelid(r)),p(l)&&S.processRelidReservation(S.getParent(l),S.getRelid(l))),r},this.isValidNewParent=function(t,n){e(S.isValidNode(t)&&S.isValidNode(n));var i={containment:{},inheritance:{}},o=!0;return D(n,t)?o=!1:T(t,n,i,!0)?o=!1:T(t,n,i,!1)&&(o=!1),o},this.moveNode=function(t,o,r){e(S.isValidNewParent(t,o),"New parent would create loop in containment/inheritance tree.");var s,a=i.getProperty(o,n.MINIMAL_RELID_LENGTH_PROPERTY),l=S.getChildrenRelids(o,!0),c=this.getRelid(t),d=t.base;return"number"==typeof a&&c.length<a?l[c]=!0:"number"==typeof r&&c.length<r&&(l[c]=!0),s=i.moveNode(t,o,l,r||a),s.base=d,this.processRelidReservation(o,this.getRelid(s)),p(o)&&S.processRelidReservation(S.getParent(o),S.getRelid(o)),s},this.copyNode=function(t,o,r){e(!t.base||S.getPath(t.base)!==S.getPath(o));var s,a=t.base;return r=r||i.getProperty(o,n.MINIMAL_RELID_LENGTH_PROPERTY),s=i.copyNode(t,o,S.getChildrenRelids(o,!0),r),s.base=a,i.setPointer(s,n.BASE_POINTER,a),i.deleteProperty(s,n.MINIMAL_RELID_LENGTH_PROPERTY),this.processRelidReservation(o,this.getRelid(s)),p(o)&&S.processRelidReservation(S.getParent(o),S.getRelid(o)),s},this.copyNodes=function(e,t,o){var r,s,a,l,c,d,h,g=[],u="",f=[];for(s=0;s<e.length;s++)f.push(S.getPath(e[s]));for(s=0;s<e.length;s++){for(d=m(e[s]),h={},a=0;a<d.length;a++)l=f.indexOf(S.getPointerPath(e[s],d[a])),-1!==l&&(h[d[a]]=l);g.push(h)}for(o=o||i.getProperty(t,n.MINIMAL_RELID_LENGTH_PROPERTY),r=i.copyNodes(e,t,S.getChildrenRelids(t,!0),o),s=0;s<e.length;s++)for(d=Object.keys(g[s]),a=0;a<d.length;a++)S.setPointer(r[s],d[a],r[g[s][d[a]]]);for(s=0;s<e.length;s++)c=e[s].base,r[s].base=c,i.setPointer(r[s],n.BASE_POINTER,c),i.deleteProperty(r[s],n.MINIMAL_RELID_LENGTH_PROPERTY);for(s=0;s<r.length;s+=1)a=this.getRelid(r[s]),a.length>u&&(u=a);return this.processRelidReservation(t,u),p(t)&&S.processRelidReservation(S.getParent(t),S.getRelid(t)),r},this.deleteNode=function(e,t){if(e&&(null!==e.base||t===!0)){var n=S.getParent(e),o=n?S.getBase(e):null,r=S.getBase(e),s=r?S.getParent(e):null;n&&o&&r&&s?S.getPath(o)!==S.getPath(s)&&i.deleteNode(e):i.deleteNode(e)}},this.getAttributeNames=function(t){e(S.isValidNode(t));var n={};do{for(var o=i.getAttributeNames(t),r=0;r<o.length;++r)o[r]in n||(n[o[r]]=!0);t=t.base}while(t);return Object.keys(n)},this.getRegistryNames=function(t){e(S.isValidNode(t));var n={};do{for(var o=i.getRegistryNames(t),r=0;r<o.length;++r)o[r]in n||(n[o[r]]=!0);t=t.base}while(t);return Object.keys(n)},this.getAttribute=function(t,n){e(S.isValidNode(t));var o;do o=i.getAttribute(t,n),t=t.base;while(void 0===o&&null!==t);return o},this.getRegistry=function(t,n){e(S.isValidNode(t));var o;do o=i.getRegistry(t,n),t=t.base;while(void 0===o&&null!==t);return o},this.getPointerNames=function(t){return e(S.isValidNode(t)),S.getPointerNamesFrom(t,"")},this.getPointerNamesFrom=function(t,n){e(S.isValidNode(t));var o={};do{for(var r=i.getPointerNamesFrom(t,n),s=0;s<r.length;++s)r[s]in o||(o[r[s]]=!0);t=t.base}while(t);return Object.keys(o)},this.getPointerPathFrom=function(t,n,o){e(S.isValidNode(t)&&"string"==typeof o);var r=i.getPointerPathFrom(t,n,o);if(void 0!==r)return r;var s,a,l=!1;for(a=t.base?y(t.base,n,o):void 0;t;){if(s=E(t,n,o),void 0!==s){if(-1===s.indexOf("_nullptr"))break;l=!0,s=void 0}n="/"+S.getRelid(t)+n,t=v(t)===C(t)?S.getParent(t):null}return void 0!==s&&(e(t),s=i.joinPaths(i.getPath(t),s)),"string"==typeof s?s:"string"==typeof a?a:l===!0?null:void 0},this.getPointerPath=function(e,t){return S.getPointerPathFrom(e,"",t)},this.getChildrenPaths=function(e){for(var t=S.getPath(e),n=S.getChildrenRelids(e),i=0;i<n.length;++i)n[i]=t+"/"+n[i];return n},this.setAttribute=function(e,t,n){i.setAttribute(e,t,n),p(e)&&S.processRelidReservation(S.getParent(e),S.getRelid(e))},this.setRegistry=function(e,t,n){i.setRegistry(e,t,n),p(e)&&S.processRelidReservation(S.getParent(e),S.getRelid(e))},this.isInheritanceContainmentCollision=function(e,t){for(var n=[];e;)n.push(S.getPath(e)),e=S.getBase(e);for(;t;){if(-1!==n.indexOf(S.getPath(t)))return!0;t=S.getParent(t)}return!1},this.getBase=function(t){return e(S.isValidNode(t)),t.base},this.isValidNewBase=function(t,n){e(S.isValidNode(t)&&(void 0===n||null===n||S.isValidNode(n)));var i={containment:{},inheritance:{}},o=!0;return n?I(n,t)?o=!1:T(t,n,i,!0)?o=!1:T(t,n,i,!1)&&(o=!1):o=!0,o},this.setBase=function(t,o){if(e(S.isValidNewBase(t,o),"New base would create loop in containment/inheritance tree."),o){var r,s,a,l=S.getParent(t),c=S.getOwnChildrenRelids(t),d=i.getProperty(t,n.MINIMAL_RELID_LENGTH_PROPERTY)||0,h=S.getChildrenRelids(o,!0);if(l)if(r=S.getBase(l),s=S.getParent(o),S.getPath(r)!==S.getPath(s))for(i.setPointer(t,n.BASE_POINTER,o),a=0;a<c.length;a+=1)h[c[a]]&&N(t,o,c[a])||i.deleteChild(t,c[a]);else i.deletePointer(t,n.BASE_POINTER);else i.setPointer(t,n.BASE_POINTER,o);for(t.base=o,a=0;a<c.length;a+=1)c[a].length<=n.MAXIMUM_STARTING_RELID_LENGTH&&(d=c[a].length+1>d?c[a].length+1:d);d>=2&&A(t,d)}else i.setPointer(t,n.BASE_POINTER,null),t.base=null},this.getBaseRoot=function(t){for(e(S.isValidNode(t));null!==t.base;)t=t.base;return t},this.getTypeRoot=function(e){if(e.base){for(;null!==e.base;)e=S.getBase(e);return e}return null},this.getOwnChildrenRelids=function(e){return i.getChildrenRelids(e)},this.loadOwnChildren=function(n){e(S.isValidNode(n));for(var i=S.getOwnChildrenRelids(n),o=[],r=0;r<i.length;r++)o[r]=S.loadChild(n,i[r]);return t.call(function(e){for(var t=[],n=0;n<e.length;n++)null!==e[n]&&t.push(e[n]);return t},t.lift(o))},this.getOwnAttributeNames=function(e){return i.getAttributeNames(e)},this.getOwnRegistryNames=function(e){return i.getRegistryNames(e)},this.getOwnAttribute=function(e,t){return i.getAttribute(e,t)},this.getOwnRegistry=function(e,t){return i.getRegistry(e,t)},this.getOwnPointerNames=function(t){return e(S.isValidNode(t)),i.getPointerNames(t)},this.getOwnPointerNamesFrom=function(e,t){return i.getPointerNamesFrom(e,t)},this.getOwnPointerPath=function(e,t){i.getPointerPath(e,t)},this.getOwnPointerPathFrom=function(e,t,n){i.getPointerPathFrom(e,t,n)},this.getOwnChildrenPaths=function(e){return i.getChildrenPaths(e)},this.processRelidReservation=function(e,t){!n.DOES_NOT_HAVE_RELID_CHILDREN[S.getRelid(e)]&&i.isValidRelid(t)&&A(e,t.length+1)},this.getInstancePaths=function(e){for(var t,o,r=[],s="";e;){for(t=i.getCollectionPaths(e,n.BASE_POINTER),o=0;o<t.length;o+=1)r.push(t[o]+s);s=n.PATH_SEP+i.getRelid(e)+s,e=i.getParent(e)}return r},this.loadInstances=function(n){e(S.isValidNode(n));var i,o=S.getInstancePaths(n),r=[],s=S.getRoot(n);for(i=0;i<o.length;i+=1)r[i]=S.loadByPath(s,o[i]);return t.lift(r)}};return i}),define("common/core/constraintcore",["common/util/assert","common/core/constants"],function(e,t){"use strict";function n(n,i){function o(e,t){for(var i,o=n.getChildrenRelids(e),r=0;r<o.length;r++)if(t===n.getAttribute(n.getChild(e,o[r]),"name")){i=o[r];break}return i}function r(e){return t.CONSTRAINT_REGISTRY_PREFIX+e}function s(n,i){e(c.isValidNode(n));for(var o=c.getChild(n,t.CONSTRAINTS_RELID),r=i?c.getOwnChildrenRelids(o):c.getChildrenRelids(o),s=[],a=0;a<r.length;a+=1)s.push(c.getAttribute(c.getChild(o,r[a]),"name"));return s}e("object"==typeof i),e("object"==typeof i.globConf),e("undefined"!=typeof i.logger);var a,l=i.logger,c=this;for(a in n)this[a]=n[a];l.debug("initialized ConstraintCore"),this.getConstraint=function(i,r){e(n.isValidNode(i));var s=n.getChild(i,t.CONSTRAINTS_RELID),a=o(s,r);if(a){var l=n.getChild(s,a);return{script:n.getAttribute(l,"script"),priority:n.getAttribute(l,"priority"),info:n.getAttribute(l,"info")}}return null},this.setConstraint=function(i,s,a){e(n.isValidNode(i)),e("object"==typeof a&&"string"==typeof s);var l,c=n.getChild(i,t.CONSTRAINTS_RELID),d=o(c,s);l=d?n.getChild(c,d):n.createChild(c,t.MAXIMUM_STARTING_RELID_LENGTH+1),a.priority=a.priority||t.C_DEF_PRIORITY,a.script=a.script||'console.log("empty constraint");',a.info=a.info||"",n.setAttribute(l,"name",s),n.setAttribute(l,"script",a.script),n.setAttribute(l,"priority",a.priority),n.setAttribute(l,"info",a.info),n.setRegistry(i,r(s),(n.getRegistry(i,r(s))||0)+1)},this.delConstraint=function(i,s){e(n.isValidNode(i));var a=n.getChild(i,t.CONSTRAINTS_RELID),l=o(a,s);if(l){var c=n.getChild(a,l);n.deleteNode(c,!0)}n.delRegistry(i,r(s))},this.getConstraintNames=function(e){return s(e,!1)},this.getOwnConstraintNames=function(e){return s(e,!0)}}return n}),define("common/core/convertData",["common/core/constants","common/storage/constants"],function(e,t){"use strict";function n(t){return t.length>e.COLLECTION_NAME_SUFFIX.length&&e.COLLECTION_NAME_SUFFIX===t.slice(-e.COLLECTION_NAME_SUFFIX.length)?!0:!1}function i(e){var t,i;for(t in e){for(i in e[t])n(i)&&delete e[t][i];0===Object.keys(e[t]).length&&delete e[t]}}function o(t){return i(t[e.OVERLAYS_PROPERTY]||{}),t.__v="1.0.0",t}function r(t){var n,o,r;n=t[e.ALL_SETS_PROPERTY]||{},i(n[e.OVERLAYS_PROPERTY]||{}),o=t[e.META_NODE]||{},i(o[e.OVERLAYS_PROPERTY]||{});for(r in o)n=o[r],n=n[e.ALL_SETS_PROPERTY]||{},i(n[e.OVERLAYS_PROPERTY]||{});return t.__v="1.1.0",t}function s(e){var t=e.__v||"0.0.0",n=t.split(".")[0];if(n>c)throw new Error('Trying to load data of incompatible version. Current version "'+l+'", data version "'+t+'".');return t!==l&&a[t]&&"function"==typeof a[t][l]?a[t][l](JSON.parse(JSON.stringify(e))):e}var a,l=t.VERSION,c=l.split(".")[0];return a={"0.0.0":{"1.0.0":o,"1.1.0":function(e){return r(o(e))}},"1.0.0":{"1.1.0":r}},s}),define("common/core/coretree",["common/util/assert","common/util/key","common/core/tasync","common/util/random","common/regexp","common/core/constants","common/core/convertData"],function(e,t,n,i,o,r,s){"use strict";function a(a,c){function d(t){e(null!==t&&"object"==typeof t&&t instanceof Array==!1)}function h(t){d(t.children),e(t.age>=r.MAX_AGE-1);var n=t.children;t.children=null,t.age=r.MAX_AGE;for(var i in n)h(n[i])}function p(t){d(t);var n,i,o=Object.keys(t);for(i=0;i<o.length;i+=1)n=t[o[i]],e(n.age<r.MAX_AGE),++n.age>=r.MAX_AGE?(delete t[o[i]],h(n)):p(n.children)}function g(){var t,n;if(++x>=r.MAX_TICKS)for(x=0,n=S.length;--n>=0;)t=S[n],e(t.age<r.MAX_AGE),++t.age>=r.MAX_AGE?(S.splice(n,1),h(t)):p(t.children)}function u(t,n){return d(t),e("string"==typeof n),t.hasOwnProperty(n)?(t[n].age=0,t[n]):null}function f(t,n){return e("string"==typeof n),"object"==typeof t&&null!==t?(t=t[n],void 0===t?b():t):null}function m(e){return"object"==typeof e&&null!==e&&e[r.MUTABLE_PROPERTY]===!0}function _(e){return"string"==typeof e?!1:"object"==typeof e&&0===Object.keys(e).length?!0:!1}function b(){return{}}function y(e,t){return e===t||"string"==typeof e&&e===f(t,O)||_(e)&&_(t)}function v(e){var t,n;for(t in e.children){n=e.children[t];var i=f(e.data,n.relid);o.DB_HASH.test(i)&&i===f(n.data,O)||(n.data=i,v(n))}}function C(t){return e("string"==typeof t),"_"!==t.charAt(0)}function E(n,i,o){e(m(n));var s,l,c,d,h,p,g,u=b();for(delete n[r.MUTABLE_PROPERTY],l=Object.keys(n),d=0;d<l.length;d++)c=l[d],h=n[c],m(h)?(p=E(h,i,o+"/"+c),JSON.stringify(p)===JSON.stringify(b())?delete n[c]:(u=p,"string"==typeof h[O]&&(n[c]=h[O]))):u=void 0;return u!==b()&&(g=n[O],e(""===g||void 0===g),""===g&&(s=JSON.parse(JSON.stringify(n)),g="#"+t(s,A),n[O]=g,s[O]=g,u=s,a.insertObject(s,M),M[g]={newHash:g,newData:s,oldHash:i.initial[o]&&i.initial[o].hash,oldData:i.initial[o]&&i.initial[o].data},i.initial[o]={hash:g,data:s})),u}function D(e){var t={parent:null,relid:null,age:0,children:{},data:null,initial:{"":{hash:e[a.ID_NAME],data:e}},rootid:++l};return t.data=s(e),S.push(t),g(),t}function I(t,n){var i=R.getRoot(t),r=R.getPath(t);return t=R.normalize(t),o.DB_HASH.test(t.data)&&(e(t.data===n[O]),i.initial[r]={hash:t.data,data:n},t.data=s(n),v(t)),t}function T(e,t,i){if(null===e||i===t.length)return e;var o=R.loadChild(e,t[i]);return n.call(T,o,t,i+1)}function P(e,t){if(!t)throw new Error(e)}function N(e){P("object","object"==typeof e&&null!==e),P("object 2",e.hasOwnProperty("parent")&&e.hasOwnProperty("relid")),P("parent","object"==typeof e.parent),P("relid","string"==typeof e.relid||null===e.relid),P("parent 2",null===e.parent==(null===e.relid)),P("age",e.age>=0&&e.age<=r.MAX_AGE),P("children 2",e.age===r.MAX_AGE==(null===e.children)),P("data","object"==typeof e.data||"string"==typeof e.data||"number"==typeof e.data),null!==e.parent&&(P("age 2",e.age>=e.parent.age),P("mutable",!m(e.data)||m(e.parent.data)))}e("object"==typeof c),e("object"==typeof c.globConf),e("undefined"!=typeof c.logger);var A=c.globConf,w=c.logger.fork("core"),O=a.ID_NAME,S=[],x=0,M={},R=this;a.loadObject=n.wrap(a.loadObject),this.loadPaths=n.wrap(a.loadPaths),this.logger=w,this.getParent=function(t){return e("object"==typeof t.parent),t.parent},this.getRelid=function(t){return e(null===t.relid||"string"==typeof t.relid),t.relid},this.getLevel=function(e){for(var t=0;null!==e.parent;)++t,e=e.parent;return t},this.getRoot=function(e){for(;null!==e.parent;)e=e.parent;return e},this.getPath=function(e,t){if(null===e)return null;for(var n="";null!==e.relid&&e!==t;)n="/"+e.relid+n,e=e.parent;return n},this.isValidPath=function(e){return"string"==typeof e&&(""===e||"/"===e.charAt(0))},this.splitPath=function(t){return e(R.isValidPath(t)),t=t.split("/"),t.splice(0,1),t},this.buildPath=function(t){return e(t instanceof Array),0===t.length?"":"/"+t.join("/")},this.joinPaths=function(t,n){return e(R.isValidPath(t)&&R.isValidPath(n)),t+n},this.getCommonPathPrefixData=function(t,n){e("string"==typeof t&&"string"==typeof n),t=R.splitPath(t),n=R.splitPath(n);for(var i=[],o=0;t[o]===n[o]&&o<t.length;++o)i.push(t[o]);return{common:R.buildPath(i),first:R.buildPath(t.slice(o)),firstLength:t.length-o,second:R.buildPath(n.slice(o)),secondLength:n.length-o}},this.normalize=function(t){e(R.isValidNode(t));var n;if(null===t.children){if(e(t.age===r.MAX_AGE),null!==t.parent){n=R.normalize(t.parent);var i=u(n.children,t.relid);if(null!==i)return i;e(null===t.parent.children||null===u(t.parent.children,t.relid)),e(null===u(n.children,t.relid)),t.parent=n,n.children[t.relid]=t,i=f(n.data,t.relid),o.DB_HASH.test(i)&&i===f(t.data,O)||(t.data=i)}else S.push(t);t.age=0,t.children={}}else if(0!==t.age){n=t;do n.age=0,n=n.parent;while(null!==n&&0!==n.age)}return t},this.getAncestor=function(t,n){e(R.getRoot(t)===R.getRoot(n)),t=R.normalize(t),n=R.normalize(n);var i=[];do i.push(t),t=t.parent;while(null!==t);var o=[];do o.push(n),n=n.parent;while(null!==n);for(var r=i.length-1,s=o.length-1;0!==r&&0!==s&&i[r-1]===o[s-1];)--r,--s;return e(i[r]===o[s]),i[r]},this.isAncestor=function(t,n){e(R.getRoot(t)===R.getRoot(n)),t=R.normalize(t),n=R.normalize(n);do{if(t===n)return!0;t=t.parent}while(null!==t);return!1},this.createRoot=function(){var e={parent:null,relid:null,age:0,children:{},data:{_mutable:!0},initial:{"":null},rootid:++l};return e.data[O]="",S.push(e),g(),e},this.getChild=function(t,n){e("string"==typeof n&&n!==O),t=R.normalize(t);var i=u(t.children,n);return null!==i?i:(i={parent:t,relid:n,age:0,children:{},data:f(t.data,n)},t.children[n]=i,g(),i)},this.createChild=function(e,t,n){if(e=R.normalize(e),"object"!=typeof e.data||null===e.data)throw new Error("invalid node data");return R.getChild(e,i.generateRelid(t||e.data,n))},this.isMutable=function(e){return e=R.normalize(e),m(e.data)},this.isEmpty=function(e){return e=R.normalize(e),"object"!=typeof e.data||null===e.data?!1:e.data===b()?!0:_(e.data)},this.mutate=function(t){e(R.isValidNode(t)),t=R.normalize(t);var n=t.data;if("object"!=typeof n||null===n)return!1;if(n[r.MUTABLE_PROPERTY]===!0)return!0;if(null!==t.parent&&!R.mutate(t.parent))return!1;var i=b();for(var o in n)i[o]=n[o];return i[r.MUTABLE_PROPERTY]=!0,"string"==typeof n[O]&&(i[O]=""),null!==t.parent&&(e(void 0===t.parent.data[t.relid]||y(f(t.parent.data,t.relid),t.data)),t.parent.data[t.relid]=i),t.data=i,!0},this.getData=function(t){return t=R.normalize(t),e(!m(t.data)),t.data},this.setData=function(t,n){if(e(null!==n&&"undefined"!=typeof n),t=R.normalize(t),null!==t.parent){if(!R.mutate(t.parent))throw new Error("incorrect node data");t.parent.data[t.relid]=n}t.data=n,v(t)},this.deleteData=function(e){if(e=R.normalize(e),null!==e.parent){if(!R.mutate(e.parent))throw new Error("incorrect node data");delete e.parent.data[e.relid]}var t=e.data;return e.data=b(),v(e),t},this.copyData=function(e){return e=R.normalize(e),"object"!=typeof e.data||null===e.data?e.data:JSON.parse(JSON.stringify(e.data))},this.getProperty=function(t,n){e("string"==typeof n&&n!==O);var i;return t=R.normalize(t),"object"==typeof t.data&&null!==t.data&&(i=t.data[n]),i},this.setProperty=function(t,n,i){if(e("string"==typeof n&&n!==O),e(!m(i)&&void 0!==i),t=R.normalize(t),!R.mutate(t))throw new Error("incorrect node data");t.data[n]=i;var o=u(t.children,n);null!==o&&(o.data=i,v(o))},this.deleteProperty=function(t,n){if(e("string"==typeof n&&n!==O),t=R.normalize(t),!R.mutate(t))throw new Error("incorrect node data");delete t.data[n];var i=u(t.children,n);null!==i&&(i.data=b(),v(i))},this.getKeys=function(e,t){var n;return e=R.normalize(e),"object"!=typeof e.data||null===e.data?null:n=this.getRawKeys(e.data,t)},this.getRawKeys=function(e,t){t=t||C;for(var n=Object.keys(e),i=n.length;--i>=0&&!t(n[i]);)n.pop();for(;--i>=0;)t(n[i])||(n[i]=n.pop());return n},this.getHash=function(t){if(null===t)return null;var n;return t=R.normalize(t),"object"==typeof t.data&&null!==t.data&&(n=t.data[O]),e("string"==typeof n||void 0===n),n},this.isHashed=function(e){return e=R.normalize(e),"object"==typeof e.data&&null!==e.data&&"string"==typeof e.data[O]},this.setHashed=function(t,n,i){if(e("boolean"==typeof n),t=R.normalize(t),!i&&!R.mutate(t))throw new Error("incorrect node data");n?t.data[O]="":delete t.data[O],e(void 0===t.children[O])},this.persist=function(e){var t,n=!1;return e=R.normalize(e),e=R.getRoot(e),m(e.data)?(n=E(e.data,e,""),n!==b()?(t={},t.objects=M,M={},t.rootHash=e.data[O]):t={rootHash:e.data[O],objects:{}},t):{rootHash:e.data[O],objects:{}}},this.loadRoot=function(t){return e(o.DB_HASH.test(t)),n.call(D,a.loadObject(t))},this.loadChild=function(t,i){return e(R.isValidNode(t)),t=R.getChild(t,i),"object"==typeof t.data?null!==t.data?t:null:o.DB_HASH.test(t.data)?n.call(I,t,a.loadObject(t.data)):null},this.getChildHash=function(t,n){return e(R.isValidNode(t)),t=R.getChild(t,n),"object"==typeof t.data?null!==t.data?R.getHash(t):null:o.DB_HASH.test(t.data)?t.data:null},this.loadByPath=function(t,n){return e(R.isValidNode(t)),e(""===n||"/"===n.charAt(0)),n=n.split("/"),T(t,n,1)},this.isValidNode=function(e){try{return N(e),!0}catch(t){return w.error(t.message,{stack:t.stack,node:e}),!1}},this.removeChildFromCache=function(e,t){return delete e.children[t],e}}var l=0;return a}),define("common/core/metacore",["common/util/assert","common/core/tasync","common/util/canon","common/core/constants"],function(e,t,n,i){"use strict";var o=function(t,n){function o(e,t){return f.getPath(e)===f.getPath(t)?!0:!1}function r(e){return f.getChild(e,i.META_NODE)}function s(e){return f.getChild(r(e),i.META_CHILDREN)}function a(e,t){var n=r(e),o=f.getPointerNames(n)||[];return-1!==o.indexOf(t)?f.getChild(n,i.META_POINTER_PREFIX+t):null}function l(e,t){return f.setPointer(r(e),t,null),f.getChild(r(e),i.META_POINTER_PREFIX+t)}function c(e){return f.getChild(r(e),i.META_ASPECTS)}function d(e,t){var n=c(e),o=f.getPointerNames(n)||[];return-1!==o.indexOf(t)?f.getChild(n,i.META_ASPECT_PREFIX+t):null}function h(e,t){var n=f.getChild(r(e),i.META_ASPECTS);return f.setPointer(n,t,null),f.getChild(n,i.META_ASPECT_PREFIX+t)}function p(e){var t=f.isMemberOf(e);return t&&t[""]&&-1!==t[""].indexOf(i.META_SET_NAME)?!0:!1}e("object"==typeof n),e("object"==typeof n.globConf),e("undefined"!=typeof n.logger);var g,u=n.logger,f=this;for(g in t)this[g]=t[g];u.debug("initialized MetaCore"),this.isTypeOf=function(e,t){for(;e;){if(o(e,t))return!0;e=f.getBase(e)}return!1},this.isValidChildOf=function(e,t){for(var n=f.getMemberPaths(s(t),i.SET_ITEMS)||[];e;){if(-1!==n.indexOf(f.getPath(e)))return!0;e=f.getBase(e)}return!1},this.getValidPointerNames=function(e){var t,n,o,s=r(e),a=f.getPointerNames(s)||[],l=[];for(t=0;t<a.length;t++)n=f.getChild(s,i.META_POINTER_PREFIX+a[t]),o=f.getAttribute(n,i.SET_ITEMS_MAX),1===o&&l.push(a[t]);return l},this.getOwnValidPointerNames=function(e){var t,n,o,s=r(e),a=f.getOwnPointerNames(s)||[],l=[];for(t=0;t<a.length;t++)n=f.getChild(s,i.META_POINTER_PREFIX+a[t]),o=f.getOwnAttribute(n,i.SET_ITEMS_MAX),1===o&&l.push(a[t]);return l},this.getValidSetNames=function(e){var t,n,o,s=r(e),a=f.getPointerNames(s)||[],l=[];for(t=0;t<a.length;t++)n=f.getChild(s,i.META_POINTER_PREFIX+a[t]),o=f.getAttribute(n,i.SET_ITEMS_MAX),(void 0===o||-1===o||o>1)&&l.push(a[t]);return l},this.getOwnValidSetNames=function(e){var t,n,o,s=r(e),a=f.getOwnPointerNames(s)||[],l=[];for(t=0;t<a.length;t++)n=f.getChild(s,i.META_POINTER_PREFIX+a[t]),o=f.getOwnAttribute(n,i.SET_ITEMS_MAX),(void 0===o||-1===o||o>1)&&l.push(a[t]);return l},this.isValidTargetOf=function(e,t,n){var o=a(t,n);if(o)for(var r=f.getMemberPaths(o,i.SET_ITEMS)||[];e;){if(-1!==r.indexOf(f.getPath(e)))return!0;e=f.getBase(e)}return!1},this.getValidAttributeNames=function(e){return f.getAttributeNames(r(e))||[]},this.getOwnValidAttributeNames=function(e){return f.getOwnAttributeNames(r(e))||[]},this.isValidAttributeValueOf=function(e,t,n){var o;if(-1===f.getValidAttributeNames(e).indexOf(t))return!1;var s=f.getAttribute(r(e),t);if(s["enum"]&&s["enum"]instanceof Array)return-1!==s["enum"].indexOf(n);switch(s.type){case i.ATTRIBUTE_TYPES.BOOLEAN:if(n===!0||n===!1)return!0;break;case i.ATTRIBUTE_TYPES.STRING:if("string"==typeof n)return s.regexp?new RegExp(s.regexp).test(n):!0;break;case i.ATTRIBUTE_TYPES.ASSET:if("string"==typeof n)return!0;break;case i.ATTRIBUTE_TYPES.INTEGER:if(o=parseInt(n),!isNaN(o)&&parseFloat(n)===o)return("number"!=typeof s.min||o>=s.min)&&("number"!=typeof s.max||o<=s.max)?!0:!1;break;case i.ATTRIBUTE_TYPES.FLOAT:if(o=parseFloat(n),!isNaN(o))return("number"!=typeof s.min||o>=s.min)&&("number"!=typeof s.max||o<=s.max)?!0:!1}return!1},this.getValidAspectNames=function(e){return f.getPointerNames(c(e))||[]},this.getOwnValidAspectNames=function(e){return f.getOwnPointerNames(c(e))||[]},this.getAspectMeta=function(e,t){return f.getMemberPaths(d(e,t),i.SET_ITEMS)},this.getJsonMeta=function(e){var t,n,o,l,c,h={children:{},attributes:{},pointers:{},aspects:{},constraints:{}};for(t=s(e),h.children.minItems=[],h.children.maxItems=[],h.children.items=f.getMemberPaths(t,i.SET_ITEMS),l=0;l<h.children.items.length;l++)h.children.minItems.push(f.getMemberAttribute(t,i.SET_ITEMS,h.children.items[l],i.SET_ITEMS_MIN)||-1),h.children.maxItems.push(f.getMemberAttribute(t,i.SET_ITEMS,h.children.items[l],i.SET_ITEMS_MAX)||-1);for(h.children.min=f.getAttribute(t,i.SET_ITEMS_MIN),h.children.max=f.getAttribute(t,i.SET_ITEMS_MAX),n=f.getValidAttributeNames(e),l=0;l<n.length;l++)h.attributes[n[l]]=f.getAttribute(r(e),n[l]);for(n=f.getPointerNames(r(e)),l=0;l<n.length;l++){for(t=a(e,n[l]),o={},o.items=f.getMemberPaths(t,i.SET_ITEMS),o.min=f.getAttribute(t,i.SET_ITEMS_MIN),o.max=f.getAttribute(t,i.SET_ITEMS_MAX),o.minItems=[],o.maxItems=[],c=0;c<o.items.length;c++)o.minItems.push(f.getMemberAttribute(t,i.SET_ITEMS,o.items[c],i.SET_ITEMS_MIN)||-1),o.maxItems.push(f.getMemberAttribute(t,i.SET_ITEMS,o.items[c],i.SET_ITEMS_MAX)||-1);h.pointers[n[l]]=o}for(n=f.getValidAspectNames(e),l=0;l<n.length;l++)t=d(e,n[l]),h.aspects[n[l]]=f.getMemberPaths(t,i.SET_ITEMS)||[];for(n=f.getConstraintNames(e),l=0;l<n.length;l++)h.constraints[n[l]]=f.getConstraint(e,n[l]);return h},this.getOwnJsonMeta=function(e){var t,n,o,s,a,l={children:{},attributes:{},pointers:{},aspects:{},constraints:{}},c=r(e),d=f.getChild(c,i.META_CHILDREN),h=f.getChild(c,i.META_ASPECTS);if(l.children.minItems=[],l.children.maxItems=[],l.children.items=f.getOwnMemberPaths(d,i.SET_ITEMS),l.children.items.length>0){for(s=0;s<l.children.items.length;s++)l.children.minItems.push(f.getMemberAttribute(d,i.SET_ITEMS,l.children.items[s],i.SET_ITEMS_MIN)||-1),l.children.maxItems.push(f.getMemberAttribute(d,i.SET_ITEMS,l.children.items[s],i.SET_ITEMS_MAX)||-1);n=f.getOwnAttributeNames(d),-1!==n.indexOf("min")&&(l.children.min=f.getAttribute(d,i.SET_ITEMS_MIN)),-1!==n.indexOf("max")&&(l.children.max=f.getAttribute(d,i.SET_ITEMS_MAX))}else delete l.children;if(n=f.getOwnAttributeNames(c)||[],n.length>0)for(s=0;s<n.length;s++)l.attributes[n[s]]=f.getOwnAttribute(c,n[s]);else delete l.attributes;if(n=f.getOwnPointerNames(c),n.length>0)for(s=0;s<n.length;s++){for(t=f.getChild(c,i.META_POINTER_PREFIX+n[s]),o={},o.items=f.getOwnMemberPaths(t,i.SET_ITEMS),o.min=f.getAttribute(t,i.SET_ITEMS_MIN),o.max=f.getAttribute(t,i.SET_ITEMS_MAX),o.minItems=[],o.maxItems=[],a=0;a<o.items.length;a++)o.minItems.push(f.getMemberAttribute(t,i.SET_ITEMS,o.items[a],i.SET_ITEMS_MIN)||-1),o.maxItems.push(f.getMemberAttribute(t,i.SET_ITEMS,o.items[a],i.SET_ITEMS_MAX)||-1);l.pointers[n[s]]=o}else delete l.pointers;if(n=f.getOwnPointerNames(h)||[],n.length>0)for(s=0;s<n.length;s++)t=f.getChild(h,i.META_ASPECT_PREFIX+n[s]),l.aspects[n[s]]=f.getOwnMemberPaths(t,i.SET_ITEMS)||[];else delete l.aspects;if(n=f.getOwnConstraintNames(e),n.length>0)for(s=0;s<n.length;s++)l.constraints[n[s]]=f.getConstraint(e,n[s]);else delete l.constraints;return l},this.clearMetaRules=function(e){f.deleteNode(r(e),!0)},this.setAttributeMeta=function(t,n,i){e("object"==typeof i&&"string"==typeof n&&n);var o;i.hasOwnProperty("default")&&(o=i["default"],i=JSON.parse(JSON.stringify(i)),delete i["default"]),f.setAttribute(r(t),n,i),"undefined"!=typeof o&&f.setAttribute(t,n,o)},this.delAttributeMeta=function(e,t){f.delAttribute(r(e),t)},this.getAttributeMeta=function(e,t){return f.getAttribute(r(e),t)},this.getValidChildrenPaths=function(e){return f.getMemberPaths(s(e),i.SET_ITEMS)},this.getOwnValidChildrenPaths=function(e){return f.getOwnMemberPaths(s(e),i.SET_ITEMS)},this.getChildrenMeta=function(e){var t,n=s(e),o={min:f.getAttribute(n,i.SET_ITEMS_MIN),max:f.getAttribute(n,i.SET_ITEMS_MAX)},r=f.getMemberPaths(n,i.SET_ITEMS);for(t=0;t<r.length;t+=1)o[r[t]]={min:f.getMemberAttribute(n,i.SET_ITEMS,r[t],i.SET_ITEMS_MIN),max:f.getMemberAttribute(n,i.SET_ITEMS,r[t],i.SET_ITEMS_MAX)};return r.length>0?o:null},this.setChildMeta=function(e,t,n,o){f.addMember(s(e),i.SET_ITEMS,t),n=n||-1,o=o||-1,f.setMemberAttribute(s(e),i.SET_ITEMS,f.getPath(t),i.SET_ITEMS_MIN,n),f.setMemberAttribute(s(e),i.SET_ITEMS,f.getPath(t),i.SET_ITEMS_MAX,o)},this.delChildMeta=function(e,t){f.delMember(s(e),i.SET_ITEMS,t)},this.setChildrenMetaLimits=function(e,t,n){t&&f.setAttribute(s(e),i.SET_ITEMS_MIN,t),n&&f.setAttribute(s(e),i.SET_ITEMS_MAX,n)},this.setPointerMetaTarget=function(e,t,n,o,r){f.addMember(l(e,t),i.SET_ITEMS,n),o=o||-1,f.setMemberAttribute(l(e,t),i.SET_ITEMS,f.getPath(n),i.SET_ITEMS_MIN,o),r=r||-1,f.setMemberAttribute(l(e,t),i.SET_ITEMS,f.getPath(n),i.SET_ITEMS_MAX,r)},this.delPointerMetaTarget=function(e,t,n){var o=a(e,t);o&&f.delMember(o,i.SET_ITEMS,n)},this.setPointerMetaLimits=function(e,t,n,o){n&&f.setAttribute(l(e,t),i.SET_ITEMS_MIN,n),o&&f.setAttribute(l(e,t),i.SET_ITEMS_MAX,o)},this.delPointerMeta=function(e,t){f.deleteNode(l(e,t),!0),f.deletePointer(r(e),t)},this.getPointerMeta=function(e,t){var n,o,r,s={},l=a(e,t);if(null===l)return null;for(s.min=f.getAttribute(l,i.SET_ITEMS_MIN),void 0===s.min&&(s.min=-1),s.max=f.getAttribute(l,i.SET_ITEMS_MAX),void 0===s.max&&(s.max=-1),n=f.getMemberPaths(l,i.SET_ITEMS),r=0;r<n.length;r++)o={min:f.getMemberAttribute(l,i.SET_ITEMS,n[r],i.SET_ITEMS_MIN),max:f.getMemberAttribute(l,i.SET_ITEMS,n[r],i.SET_ITEMS_MAX)},void 0===o.min&&(o.min=-1),void 0===o.max&&(o.max=-1),s[n[r]]=o;return s},this.getValidTargetPaths=function(e,t){var n=a(e,t);return null===n?[]:f.getMemberPaths(n,i.SET_ITEMS)},this.getOwnValidTargetPaths=function(e,t){var n=a(e,t);return null===n?[]:f.getOwnMemberPaths(n,i.SET_ITEMS)},this.setAspectMetaTarget=function(e,t,n){f.addMember(h(e,t),i.SET_ITEMS,n)},this.delAspectMetaTarget=function(e,t,n){
var o=d(e,t);o&&f.delMember(o,i.SET_ITEMS,n)},this.delAspectMeta=function(e,t){f.deleteNode(h(e,t),!0),f.deletePointer(c(e),t)},this.getBaseType=function(e){for(;e;){if(p(e))return e;e=f.getBase(e)}return null},this.isInstanceOf=function(e,t){for(e=f.getBase(e);e;){if(f.getAttribute(e,"name")===t)return!0;e=f.getBase(e)}return!1}};return o}),define("common/core/coretreeloader",["common/util/assert","common/core/tasync"],function(e,t){"use strict";var n=function(n,i){function o(e,n){var i=function(e){for(var i=0;i<e.length;i++)e[i]=l.loadSubTree(e[i],n);return t.lift(e)},o=n===!0?l.loadOwnChildren:l.loadChildren;return t.call(function(n){return n.length<1?[e]:t.call(function(t){var n,i=[];for(n=0;n<t.length;n++)i=i.concat(t[n]);return i.unshift(e),i},i(n))},o(e))}function r(n,i,o,r){e(l.isValidNode(n)&&"function"==typeof o&&"function"==typeof r);var s,a,c=[],d=0,h=null,p=l.getRoot(n),g=t.unwrap(l.loadByPath),u=function(e){var t,i=l.getChildrenPaths(e);if(l.getPath(e)!==l.getPath(n))for(t=0;t<i.length;t+=1)a.call(c,i[t])},f=function(e,t){h=h||e,!e&&t&&u(t),o(t,m)},m=function(e){h=h||e,d-=1,h&&i.stopOnError&&(c=[])};i=i||{},i.maxParallelLoad=i.maxParallelLoad||100,i.excludeRoot=i.excludeRoot===!0||!1,i.stopOnError=i.stopOnError===!1?!1:!0,a="DFS"===i.order?c.unshift:c.push,(i.maxParallelLoad<1||"DFS"===i.order)&&(i.maxParallelLoad=1),c=l.getChildrenPaths(n),i.excludeRoot===!1&&c.unshift(l.getPath(n)),s=setInterval(function(){0===c.length&&0===d?(clearInterval(s),r(h)):c.length>0&&d<i.maxParallelLoad&&(!h||i.stopOnError===!1)&&(d+=1,g(p,c.shift(),f))},0)}e("object"==typeof i),e("object"==typeof i.globConf),e("undefined"!=typeof i.logger);var s,a=i.logger,l=this;for(s in n)this[s]=n[s];a.debug("initialized CoreTreeLoader"),this.loadTree=function(e){return t.call(l.loadSubTree,l.loadRoot(e))},this.loadSubTree=function(e){return o(e,!1)},this.loadOwnSubTree=function(e){return o(e,!0)},this.traverse=t.wrap(r)};return n}),define("common/core/corediff",["common/util/canon","common/core/tasync","common/util/assert","common/regexp","common/util/random","common/core/constants"],function(e,t,n,i,o,r){"use strict";function s(s,a){function l(e){if(!e)return e;var t,n=Object.keys(e);for(JSON.stringify(e.set)===JSON.stringify({})&&delete e.set,t=0;t<n.length;t++)Array.isArray(e[n[t]])||(void 0===e[n[t]]?delete e[n[t]]:"set"===n[t]||"object"==typeof e[n[t]]&&(l(e[n[t]]),e[n[t]]&&0===Object.keys(e[n[t]]).length&&delete e[n[t]]));n=Object.keys(e),1===n.length&&delete e.guid}function c(t,n){var i,o=Re.getOwnAttributeNames(t),s=Re.getOwnAttributeNames(n),a={};for(i=0;i<o.length;i++)-1===s.indexOf(o[i])&&(a[o[i]]=r.TO_DELETE_STRING);for(i=0;i<s.length;i++)void 0===Re.getAttribute(t,s[i])?a[s[i]]=Re.getAttribute(n,s[i]):e.stringify(Re.getAttribute(t,s[i]))!==e.stringify(Re.getAttribute(n,s[i]))&&(a[s[i]]=Re.getAttribute(n,s[i]));return a}function d(t,n){var i,o=Re.getOwnRegistryNames(t),s=Re.getOwnRegistryNames(n),a={};for(i=0;i<o.length;i++)-1===s.indexOf(o[i])&&(a[o[i]]=r.TO_DELETE_STRING);for(i=0;i<s.length;i++)void 0===Re.getRegistry(t,s[i])?a[s[i]]=Re.getRegistry(n,s[i]):e.stringify(Re.getRegistry(t,s[i]))!==e.stringify(Re.getRegistry(n,s[i]))&&(a[s[i]]=Re.getRegistry(n,s[i]));return a}function h(e,t){var n,i=Re.getChildrenRelids(e,!0),o=Re.getChildrenRelids(t,!0),r=Re.getChildrenHashes(t),s=Re.getChildrenHashes(e),a={added:[],removed:[]};for(n in i)o.hasOwnProperty(n)===!1&&a.removed.push({relid:n,hash:s[n]});for(n in o)i.hasOwnProperty(n)===!1&&a.added.push({relid:n,hash:r[n]});return a}function p(t,n){var i=function(e){var t,n={},i=Re.getPointerNames(e);for(t=0;t<i.length;t++)n[i[t]]=Re.getPointerPath(e,i[t]);return n},o=i(t),r=i(n);return e.stringify(o)!==e.stringify(r)?{source:o,target:r}:{}}function g(t,n){var i=function(e){var t,n,i,o,r,s,a={};for(t=Re.getSetNames(e),o=0;o<t.length;o++)for(a[t[o]]={},n=Re.getMemberPaths(e,t[o]),r=0;r<n.length;r++){for(a[t[o]][n[r]]={attr:{},reg:{}},i=Re.getMemberOwnAttributeNames(e,t[o],n[r]),s=0;s<i.length;s++)a[t[o]][n[r]].attr[i[s]]=Re.getMemberAttribute(e,t[o],n[r],i[s]);for(i=Re.getMemberRegistryNames(e,t[o],n[r]),s=0;s<i.length;s++)a[t[o]][n[r]].reg[i[s]]=Re.getMemberRegistry(e,t[o],n[r],i[s])}return a},o=i(t),r=i(n);return e.stringify(o)!==e.stringify(r)?{source:o,target:r}:{}}function u(t,n){var i=function(e){var t,n,i,o,s=Re.getProperty(e,r.OVERLAYS_PROPERTY)||{},a={},l=Re.getPath(e);for(t=Object.keys(s),i=0;i<t.length;i++)if(-1===t[i].indexOf("_"))for(a[t[i]]={},n=Object.keys(s[t[i]]),o=0;o<n.length;o++)"/_nullptr"===s[t[i]][n[o]]?a[t[i]][n[o]]=null:"-inv"!==n[o].slice(-4)&&-1===n[o].indexOf("_")&&-1===s[t[i]][n[o]].indexOf("_")&&(a[t[i]][n[o]]=Re.joinPaths(l,s[t[i]][n[o]]));return a},o=i(t),s=i(n);return e.stringify(o)!==e.stringify(s)?{source:o,target:s}:{}}function f(t,n){var i=function(e){var t,n,i,o;if(e.children){for(o=e.children,t=0;t<o.items.length;t+=1)o[o.items[t]]={min:o.minItems[t],max:o.maxItems[t]};delete o.items,delete o.minItems,delete o.maxItems}if(e.pointers)for(i=Object.keys(e.pointers),n=0;n<i.length;n+=1){for(o=e.pointers[i[n]],t=0;t<o.items.length;t+=1)o[o.items[t]]={min:o.minItems[t],max:o.maxItems[t]};delete o.items,delete o.minItems,delete o.maxItems}return e},o=i(Re.getOwnJsonMeta(t)),r=i(Re.getOwnJsonMeta(n));return e.stringify(o)!==e.stringify(r)?{source:o,target:r}:{}}function m(e){var t,n=Object.keys(e);for(t=0;t<n.length;t++)Be[n[t]]?(e[Be[n[t]]]=e[n[t]],delete e[n[t]]):"object"==typeof e[n[t]]&&m(e[n[t]])}function _(e){var t,n=Object.keys(e);for(t=0;t<n.length;t++)Be[e[n[t]]]&&(e[n[t]]=Be[e[n[t]]])}function b(){y(ke),v(ke),C(ke),l(ke)}function y(e){var t,n,i,o=k(e);for(e.meta&&(n=e.meta.source||{},i=e.meta.target||{},m(n),e.meta=O(n,i)),t=0;t<o.length;t++)y(e[o[t]])}function v(e){var t,n,i,o=k(e);for(e.pointer&&(n=e.pointer.source||{},i=e.pointer.target||{},_(n),e.pointer=O(n,i)),t=0;t<o.length;t++)v(e[o[t]])}function C(e){var t,n,i,o=k(e);for(e.set&&(n=e.set.source||{},i=e.set.target||{},m(n),e.set=O(n,i)),t=0;t<o.length;t++)C(e[o[t]])}function E(e){return Object.keys(e.children||{}).length>0||Object.keys(e.attr||{}).length>0||Object.keys(e.reg||{}).length>0||Object.keys(e.pointer||{}).length>0||Object.keys(e.set||{}).length>0||e.meta?!1:!0}function D(e,t){var n,i=t.split("/");for(i.shift(),n=0;n<i.length;n++)e[i[n]]=e[i[n]]||{},e=e[i[n]];return e}function I(t,n){var i,o,r,s,a,l=function(t){var i=JSON.parse(JSON.stringify(n.source[t]||{})),o=JSON.parse(JSON.stringify(n.target[t]||{}));return o.base?!1:(delete i.base,e.stringify(i)===e.stringify(o))};for(o=Object.keys(n.source||{}),i=0;i<o.length;i++)if(a=D(t,o[i]),a.removed!==!0&&!l(o[i]))for(a.pointer=a.pointer||{source:{},target:{}},a.pointer.source=a.pointer.source||{},a.pointer.target=a.pointer.target||{},r=Object.keys(n.source[o[i]]),s=0;s<r.length;s++)a.pointer.source[r[s]]=n.source[o[i]][r[s]];for(o=Object.keys(n.target||{}),i=0;i<o.length;i++)if(a=D(t,o[i]),a.removed!==!0&&!l(o[i]))for(a.pointer=a.pointer||{source:{},target:{}},r=Object.keys(n.target[o[i]]),s=0;s<r.length;s++)a.pointer.target[r[s]]=n.target[o[i]][r[s]]}function T(e,i){var o=Re.nodeDiff(e,i)||{},r=u(e,i),s=function(e,t){for(var n=0;n<e.length;n++)if(Re.getRelid(e[n])===t)return e[n];return null};return t.call(function(a,c){function d(e,t){var n=Re.getRelid(e),i=Re.getRelid(t);return i>n?-1:n>i?1:0}n(a.length>=0&&c.length>=0),a.sort(d),c.sort(d);var h,p,g,u,f,m,_=function(e,t){return o[t]=e,null};for(u=o.children?o.children.removed||[]:[],h=0;h<u.length;h++)o.childrenListChanged=!0,p=s(a,u[h].relid),p&&(f=Re.getGuid(p),o[u[h].relid]={guid:f,removed:!0,hash:Re.getHash(p)},Le[f]=Le[f]||{},Le[f].from=p,Le[f].fromExpanded=!1);for(u=o.children?o.children.added||[]:[],h=0;h<u.length;h++)o.childrenListChanged=!0,p=s(c,u[h].relid),p&&(f=Re.getGuid(p),m=Re.getBase(p),o[u[h].relid]={guid:f,removed:!1,hash:Re.getHash(p),pointer:{source:{},target:{base:null===m?null:Re.getPath(m)}}},Le[f]=Le[f]||{},Le[f].to=p,Le[f].toExpanded=!1);for(h=0;h<c.length;h++)p=s(a,Re.getRelid(c[h])),p&&Re.getHash(c[h])!==Re.getHash(p)&&(g=t.call(_,T(p,c[h]),Re.getRelid(p),g));return t.call(function(){return delete o.children,I(o,r),l(o),Object.keys(o).length>0?(o.guid=Re.getGuid(i),o.hash=Re.getHash(i),o.oGuids=P(i),t.call(function(e){return e},N(i,e,"",o))):o},g)},Re.loadChildren(e),Re.loadChildren(i))}function P(e){for(var t={},n=function(e){for(;e;)t[Re.getGuid(e)]=!0,e=Re.getParent(e)};e;)n(e),e=Re.getBase(e);return t}function N(e,n,i,o){var r,s,a=k(o),l=function(e,t){return o[t]=e,null};for(r=0;r<a.length;r++)s=t.call(l,N(e,n,i+"/"+a[r],o[a[r]]),a[r]);return t.call(function(){return t.call(function(e,t){return e||(e=t),o.guid=Re.getGuid(e),o.hash=Re.getHash(e),o.oGuids=P(e),o},Re.loadByPath(e,i),Re.loadByPath(n,i))},s)}function A(e,n){var i={guid:Re.getGuid(e),hash:Re.getHash(e),removed:n===!0};return t.call(function(e){for(var t,o=0;o<e.length;o++)t=Re.getGuid(e[o]),i[Re.getRelid(e[o])]={guid:t,hash:Re.getHash(e[o]),removed:n===!0},n?(Le[t]=Le[t]||{},Le[t].from=e[o],Le[t].fromExpanded=!1):(Le[t]=Le[t]||{},Le[t].to=e[o],Le[t].toExpanded=!1);return i},Re.loadChildren(e))}function w(e,t){var n,i=e.split("/"),o=i.pop(),r=ke;for(i.shift(),n=0;n<i.length;n++)r=r[i[n]];r[o]=S(r[o],t)}function O(e,t){var n,i,o={},s=Object.keys(e),a=Object.keys(t);for(i=0;i<s.length;i++)-1===a.indexOf(s[i])&&(o[s[i]]=r.TO_DELETE_STRING);for(i=0;i<a.length;i++)-1===s.indexOf(a[i])?o[a[i]]=t[a[i]]:typeof t[a[i]]==typeof e[a[i]]&&"object"==typeof t[a[i]]&&null!==t[a[i]]&&null!==e[a[i]]?(n=O(e[a[i]],t[a[i]]),Object.keys(n).length>0&&(o[a[i]]=n)):e[a[i]]!==t[a[i]]&&(o[a[i]]=t[a[i]]);return o}function S(e,t){var n,i={},o=Object.keys(e),r=Object.keys(t);for(n=0;n<o.length;n++)i[o[n]]=e[o[n]];for(n=0;n<r.length;n++)-1===o.indexOf(r[n])?i[r[n]]=t[r[n]]:typeof t[r[n]]!=typeof e[r[n]]||"object"!=typeof t[r[n]]||t instanceof Array?i[r[n]]=t[r[n]]:i[r[n]]=S(e[r[n]],t[r[n]]);return i}function x(e,t){var n,i,o;if(""===t)e=null;else{for(o=t.split("/"),o.shift(),n=o.pop(),i=0;i<o.length;i++)e=e[o[i]];delete e[n]}}function M(e){var t=function(n){if(n){var i,o=k(n);if("string"==typeof n.movedFrom&&x(e,n.movedFrom),(n.removed!==!1||"string"==typeof n.movedFrom)&&delete n.hash,n.removed===!0)for(i=0;i<o.length;i++)delete n[o[i]];else for(i=0;i<o.length;i++)t(n[o[i]])}};t(e)}function R(){var e,n,i,o=Object.keys(Le),r=function(e,t){return e.guid=Re.getGuid(t.from),e.movedFrom=Re.getPath(t.from),e.ooGuids=P(t.from),Be[Re.getPath(t.from)]=Re.getPath(t.to),re(ke,Re.getPath(t.to),e),null},s=function(e,t){return e.hash=Re.getHash(t.from),e.removed=!0,w(Re.getPath(t.from),e),null},a=function(e,t){return e.hash||(e.hash=Re.getHash(t.to)),e.removed=!1,w(Re.getPath(t.to),e),null};if(je!==!0||o.length<1)return M(ke),b(),JSON.parse(JSON.stringify(ke));for(je=!1,i=0;i<o.length;i++)n=Le[o[i]],n.from&&n.to?(je=!0,delete Le[o[i]],e=t.call(r,T(n.from,n.to),n)):n.from&&n.fromExpanded===!1?(n.fromExpanded=!0,je=!0,e=t.call(s,A(n.from,!0),n)):n.to&&n.toExpanded===!1&&(n.toExpanded=!0,je=!0,e=t.call(a,A(n.to,!1),n));return t.call(R,e)}function L(e){var t,n=Object.keys(e||{}),i={hash:!0,attr:!0,reg:!0,pointer:!0,set:!0,meta:!0,movedFrom:!0,removed:!0};for(t=0;t<n.length;t+=1)if(i[n[t]])return!0;return!1}function k(e){var t,n=Object.keys(e||{}),i=[],o={guid:!0,hash:!0,attr:!0,reg:!0,pointer:!0,set:!0,meta:!0,removed:!0,movedFrom:!0,childrenListChanged:!0,oGuids:!0,ooGuids:!0,min:!0,max:!0};for(t=0;t<n.length;t++)o[n[t]]||i.push(n[t]);return i}function j(e,t,n,i){var o,r=k(e);for(o=0;o<r.length;o++)j(e[r[o]],t+"/"+r[o],n,i);"string"==typeof e.movedFrom&&(n[t]=e.movedFrom,i[e.movedFrom]=t)}function G(e){return e=e.split("/"),e.splice(-1,1),e.join("/")}function B(e,t,n,i){var r,s,a,l,c,d,h,p,g,u=k(n),f={};if(n.guid!==i.guid&&"string"==typeof n.guid&&"string"==typeof i.guid){if(n.movedFrom&&i.movedFrom)s=Oe,c=i,h=xe.getExtensionSourceFromDestination,p=xe.getExtensionDestinationFromSource;else if(n.movedFrom&&i.removed===!1)s=we,c=n,h=xe.getBaseSourceFromDestination,p=xe.getBaseDestinationFromSource;else{if(!i.movedFrom||n.removed!==!1)throw new Error("there is a guid mismatch among the two diffs: "+n.guid+" vs "+i.guid);s=Oe,c=i,h=xe.getExtensionSourceFromDestination,p=xe.getExtensionDestinationFromSource}for(d=k(D(we,G(e))).concat(k(D(Oe,G(e)))),f={},r=0;r<d.length;r+=1)f[d[r]]={};a=o.generateRelid(f),l=G(e)+"/"+a,g=D(s,G(e)),g[a]=c,delete g[t],h[l]=h[e],delete h[e],p[h[l]]=l}for(r=0;r<u.length;r+=1)i[u[r]]&&B(e+"/"+u[r],u[r],n[u[r]],i[u[r]])}function W(e,t){var n="",i=e.split("/"),o=t.split("/"),r=0;if(i.shift(),o.shift(),i.length>0&&o.length>0)for(;r<i.length&&i[r]===o[r];)n+="/"+i[r],r+=1;return n}function $(e,n,i){var o=W(n,i);return t.call(function(e){var t=n.substr(o.length),r=i.substr(o.length);s.overlayInsert(e,t,"base",r)},Re.loadByPath(e,o))}function F(e){var t,n,i=k(e),o=[];for(t=0;t<i.length;t+=1)e[i[t]].movedFrom?(n=e[i[t]].movedFrom,n=n.split("/"),n=n[n.length-1],n!==i[t]?o.push(i[t]):o.unshift(i[t])):o.unshift(i[t]);return o}function z(e,n){var i,o,r,s,a=F(n),l=function(e,t,i,o,r,s){var a;return r===!0&&(e=Re.moveNode(e,o),a=Re.getRelid(e),i!==a&&(n[a]=JSON.parse(JSON.stringify(n[i])),delete n[i])),z(e,t,s)};for(i=0;i<a.length;i++)s=!1,n[a[i]].movedFrom?(s=!0,r=Re.loadByPath(Re.getRoot(e),n[a[i]].movedFrom),o=t.call(l,r,n[a[i]],a[i],e,s,o)):n[a[i]].removed===!1?n[a[i]].hash&&(Re.setProperty(e,a[i],n[a[i]].hash),e.childrenRelids=null):(r=Re.loadChild(e,a[i]),o=t.call(l,r,n[a[i]],a[i],e,s,o));return t.call(function(){return null},o)}function V(e,n,i,o){var r,s=F(i),a=[],l=!1;for(r=0;r<s.length;r+=1)(i[s[r]].removed===!1||o)&&i[s[r]].pointer&&i[s[r]].pointer.base?(l=!0,a[r]=t.join($(e,n+"/"+s[r],i[s[r]].pointer.base),V(e,n+"/"+s[r],i[s[r]],o||l))):a[r]=t.call(V,e,n+"/"+s[r],i[s[r]],o);return t.lift(a)}function H(e,n,i){var o;return o=Re.loadByPath(e,n),t.call(function(o){var r,s,a=k(i);if(null===o)return void Me.warn("Missing node ["+n+"] during patch application. Could be a conflicting conflict resolution.");if(i.removed===!0)return void Re.deleteNode(o);for(U(o,i.attr||{}),Y(o,i.reg||{}),r=X(o,i),r=t.call(Z,o,i.set||{},r),i.meta&&(delete i.meta.empty,r=t.call(ie,o,i.meta,r)),s=0;s<a.length;s++)r=t.call(function(){return null},H(e,n+"/"+a[s],i[a[s]]),r);return Re.getGuid(o)!==i.guid&&i.guid&&(r=t.call(function(){return null},Re.setGuid(o,i.guid),r)),r},o)}function U(e,t){var n,i;for(i=Object.keys(t),n=0;n<i.length;n++)t[i[n]]===r.TO_DELETE_STRING?Re.delAttribute(e,i[n]):Re.setAttribute(e,i[n],t[i[n]])}function Y(e,t){var n,i;for(i=Object.keys(t),n=0;n<i.length;n++)t[i[n]]===r.TO_DELETE_STRING?Re.delRegistry(e,i[n]):Re.setRegistry(e,i[n],t[i[n]])}function J(e,n,i){var o;return o=null===i?null:Re.loadByPath(Re.getRoot(e),i),t.call(function(t){Re.setPointer(e,n,t)},o)}function X(e,n){var i,o,s=n.pointer||{},a=Object.keys(s);for(o=0;o<a.length;o++)s[a[o]]===r.TO_DELETE_STRING?Re.deletePointer(e,a[o]):(n.removed!==!1||"base"!==a[o])&&(i=J(e,a[o],s[a[o]]));return t.call(function(){return null},i)}function K(e,n,i,o){var r=function(t){var o,r=Re.getMemberOwnAttributeNames(e,n,i);for(o=0;o<r.length;o++)Re.delMemberAttribute(e,n,i,r[o]);for(r=Object.keys(t),o=0;o<r.length;o++)Re.setMemberAttribute(e,n,i,r[o],t[r[o]])},s=function(t){var o,r=Re.getMemberOwnRegistryNames(e,n,i);for(o=0;o<r.length;o++)Re.delMemberRegistry(e,n,i,r[o]);for(r=Object.keys(t),o=0;o<r.length;o++)Re.setMemberRegistry(e,n,i,r[o],t[r[o]])};return t.call(function(t){Re.addMember(e,n,t),r(o.attr||{}),s(o.reg||{})},Re.loadByPath(Re.getRoot(e),i))}function Z(e,n){var i,o,s,a,l=Object.keys(n);for(s=0;s<l.length;s++)if(n[l[s]]===r.TO_DELETE_STRING)Re.deleteSet(e,l[s]);else for(Re.createSet(e,l[s]),o=Object.keys(n[l[s]]),a=0;a<o.length;a++)n[l[s]][o[a]]===r.TO_DELETE_STRING?Re.delMember(e,l[s],o[a]):i=K(e,l[s],o[a],n[l[s]][o[a]]);return t.call(function(){return null},i)}function q(e,t){var n,i,o;if(t===r.TO_DELETE_STRING)for(i=Re.getValidAttributeNames(e),n=0;n<i.length;n++)Re.delAttributeMeta(e,i[n]);else for(i=Object.keys(t),n=0;n<i.length;n++)t[i[n]]===r.TO_DELETE_STRING?Re.delAttributeMeta(e,i[n]):(o=ae(Re.getAttributeMeta(e,i[n])||{},t[i[n]]),Re.setAttributeMeta(e,i[n],o))}function Q(e,t){var n,i;if(t===r.TO_DELETE_STRING)for(n=Re.getConstraintNames(e),i=0;i<n.length;i++)Re.delConstraint(e,n[i]);else for(n=Object.keys(t),i=0;i<n.length;i++)t[n[i]]===r.TO_DELETE_STRING?Re.delConstraint(e,n[i]):Re.setConstraint(e,n[i],ae(Re.getConstraint(e,n[i])||{},t[n[i]]))}function ee(e,n){var i,o,s,a=function(t,n){Re.setChildMeta(e,t,n.min,n.max)};if(n===r.TO_DELETE_STRING)for(i=Re.getValidChildrenPaths(e),o=0;o<i.length;o++)Re.delChildMeta(e,i[o]);else for(Re.setChildrenMetaLimits(e,n.min,n.max),delete n.max,delete n.min,i=Object.keys(n),o=0;o<i.length;o++)n[i[o]]===r.TO_DELETE_STRING?Re.delChildMeta(e,i[o]):s=t.call(a,Re.loadByPath(Re.getRoot(e),i[o]),n[i[o]],s);t.call(function(){return null},s)}function te(e,n){var i,o,s,a,l,c=function(t,n,i){Re.setPointerMetaTarget(e,t,n,i.min,i.max)};if(n!==r.TO_DELETE_STRING){for(i=Object.keys(n),s=0;s<i.length;s++)if(n[i[s]]===r.TO_DELETE_STRING)Re.delPointerMeta(e,i[s]);else for(Re.setPointerMetaLimits(e,i[s],n[i[s]].min,n[i[s]].max),delete n[i[s]].max,delete n[i[s]].min,o=Object.keys(n[i[s]]),a=0;a<o.length;a++)n[i[s]][o[a]]===r.TO_DELETE_STRING?Re.delPointerMetaTarget(e,i[s],o[a]):l=t.call(c,i[s],Re.loadByPath(Re.getRoot(e),o[a]),n[i[s]][o[a]],l);t.call(function(){return null},l)}else{for(i=Re.getValidPointerNames(e),s=0;s<i.length;s++)Re.delPointerMeta(e,i[s]);for(i=Re.getValidSetNames(e),s=0;s<i.length;s++)Re.delPointerMeta(e,i[s])}}function ne(e,n){var i,o,s,a,l,c=function(t,n){Re.setAspectMetaTarget(e,t,n)};if(n!==r.TO_DELETE_STRING){for(i=Object.keys(n),s=0;s<i.length;s++)if(n[i[s]]===r.TO_DELETE_STRING)Re.delAspectMeta(e,i[s]);else for(o=n[i[s]],a=0;a<o.length;a++)n[i[s]][o[a]]===r.TO_DELETE_STRING?Re.delAspectMetaTarget(e,i[s],o[a]):l=t.call(c,i[s],Re.loadByPath(Re.getRoot(e),o[a]),l);t.call(function(){return null},l)}else for(i=Re.getValidAspectNames(e),s=0;s<i.length;s++)Re.delAspectMeta(e,i[s])}function ie(e,n){var i;q(e,n.attributes||r.TO_DELETE_STRING),Q(e,n.constraints||r.TO_DELETE_STRING),i=ee(e,n.children||r.TO_DELETE_STRING),i=t.call(te,e,n.pointers||r.TO_DELETE_STRING,i),i=t.call(ne,e,n.aspects||r.TO_DELETE_STRING,i),t.call(function(){return null},i)}function oe(e,t){var n,o,r;if(i.GUID.test(t)!==!0)return null;if(e.guid===t)return e;for(n=k(e),o=0;o<n.length;o++)if(r=oe(e[n[o]],t))return r;return null}function re(e,t,i){n("string"==typeof t);var o,r,s,a;if(""===t)return void(Pe=JSON.parse(JSON.stringify(i)));for(a=t.match(/\/\/.*\/\//)||[],a=a[0]||"there is no nodepath in the path",t=t.replace(a,"/*nodepath*/"),a=a.replace(/\/\//g,"/"),a=a.slice(0,-1),t=t.split("/"),t.shift(),-1!==t.indexOf("*nodepath*")&&(t[t.indexOf("*nodepath*")]=a),s=t.pop(),r=e,o=0;o<t.length;o++)r[t[o]]=r[t[o]]||{},r=r[t[o]];r[s]=JSON.parse(JSON.stringify(i))}function se(e){var t,n=JSON.parse(JSON.stringify(e)),i=k(n);for(t=0;t<i.length;t++)delete n[i[t]];return n}function ae(e,t){var n,i=Object.keys(e),o=Object.keys(t),r=JSON.parse(JSON.stringify(e));for(n=0;n<o.length;n++)-1===i.indexOf(o[n])?r[o[n]]=JSON.parse(JSON.stringify(t[o[n]])):"object"==typeof e[o[n]]&&"object"==typeof t[o[n]]?r[o[n]]=ae(e[o[n]],t[o[n]]):r[o[n]]=JSON.parse(JSON.stringify(t[o[n]]));return r}function le(e,t,n){var o,r,s;if(i.GUID.test(t)!==!0)return null;if(e.guid===t)return n;for(o=k(e),r=0;r<o.length;r++)if(s=le(e[o[r]],t,n+"/"+o[r]))return s;return null}function ce(e){return xe.getExtensionSourceFromDestination[e]&&(e=xe.getExtensionSourceFromDestination[e]),xe.getBaseDestinationFromSource[e]&&(e=xe.getBaseDestinationFromSource[e]),e}function de(e){var t,n=k(e);if(e.removed!==!0)for(e.movedFrom&&(void 0!==Se[e.guid]?delete Se[e.guid]:Se[e.guid]=!1),t=0;t<n.length;t++)de(e[n[t]]);else Se[e.guid]===!1?delete Se[e.guid]:Se[e.guid]=!0}function he(e,t){var n=function(e,t,i){var o,r;for(i===!0&&(t.guid&&(e.guid=t.guid),t.oGuids&&(e.oGuids=t.oGuids),t.ooGuids&&(e.ooGuids=t.ooGuids),"boolean"!=typeof t.removed||t.removed||(e.removed=t.removed),t.hash&&(e.hash=t.hash),t.childrenListChanged&&(e.childrenListChanged=!0)),r=k(t),o=0;o<r.length;o+=1)void 0===e[r[o]]?"string"!=typeof t[r[o]].movedFrom&&(e[r[o]]={},n(e[r[o]],t[r[o]],!0)):n(e[r[o]],t[r[o]],!1)};n(e,t,0===Object.keys(e).length)}function pe(e){var t,n,i=[];for(t=Object.keys(e.oGuids||{}),n=0;n<t.length;n++)Se[t[n]]&&i.push(t[n]);for(t=Object.keys(e.ooGuids||{}),n=0;n<t.length;n++)Se[t[n]]&&i.push(t[n]);return i}function ge(e){var t=[],n=function(i){var o,r;for((i.oGuids&&i.oGuids[e]||i.ooGuids&&i.ooGuids[e])&&t.push(i.guid),o=k(i),r=0;r<o.length;r++)n(i[o[r]])};return n(we),t}function ue(e,t,i,o){var s,a,l,c,d=function(e,t){var n,i;for(n=Object.keys(t),i=0;i<n.length;i++)s[e+"/"+n[i]]=s[e+"/"+n[i]]||{value:t[n[i]],conflictingPaths:{}},s[e+"/"+n[i]].conflictingPaths[o]=!0,a.conflictingPaths[e+"/"+n[i]]=!0};if(t===!0?(s=Ne,a=Ae[o]):(s=Ae,a=Ne[o]),n(a),e.movedFrom&&(s[i]=s[i]||{value:i,conflictingPaths:{}},s[i].conflictingPaths[o]=!0,a.conflictingPaths[i]=!0),d(i+"/attr",e.attr||{}),d(i+"/reg",e.reg||{}),d(i+"/pointer",e.pointer||{}),e.set)if(e.set===r.TO_DELETE_STRING)s[i+"/set"]=s[i+"/set"]||{value:r.TO_DELETE_STRING,conflictingPaths:{}},s[i+"/set"].conflictingPaths[o]=!0,a.conflictingPaths[i+"/set"]=!0;else for(l=Object.keys(e.set),c=0;c<l.length;c++)e.set[l[c]]===r.TO_DELETE_STRING?(s[i+"/set/"+l[c]]=s[i+"/set/"+l[c]]||{value:r.TO_DELETE_STRING,conflictingPaths:{}},s[i+"/set/"+l[c]].conflictingPaths[o]=!0,a.conflictingPaths[i+"/set/"+l[c]]=!0):fe(e.set[l[c]],t,i+"/set/"+l[c],o);if(e.meta&&be(e.meta,t,i+"/meta",o),t)for(l=k(e),c=0;c<l.length;c++)ue(e[l[c]],!0,i+"/"+l[c],o)}function fe(e,t,n,i){var o,s,a,l,c,d=k(e);for(t===!0?(l=Ne,c=Ae[i]):(l=Ae,c=Ne[i]),o=0;o<d.length;o++)if(e[d[o]]===r.TO_DELETE_STRING)l[n+"/"+d[o]+"/"]=l[n+"/"+d[o]+"/"]||{value:r.TO_DELETE_STRING,conflictingPaths:{}},l[n+"/"+d[o]+"/"].conflictingPaths[i]=!0,c.conflictingPaths[n+"/"+d[o]+"/"]=!0;else{for(s=Object.keys(e[d[o]].attr||{}),a=0;a<s.length;a++)l[n+"/"+d[o]+"//attr/"+s[a]]=l[n+"/"+d[o]+"//attr/"+s[a]]||{value:e[d[o]].attr[s[a]],conflictingPaths:{}},l[n+"/"+d[o]+"//attr/"+s[a]].conflictingPaths[i]=!0,c.conflictingPaths[n+"/"+d[o]+"//attr/"+s[a]]=!0;for(s=Object.keys(e[d[o]].reg||{}),a=0;a<s.length;a++)l[n+"/"+d[o]+"//reg/"+s[a]]=l[n+"/"+d[o]+"//reg/"+s[a]]||{value:e[d[o]].reg[s[a]],conflictingPaths:{}},l[n+"/"+d[o]+"//reg/"+s[a]].conflictingPaths[i]=!0,c.conflictingPaths[n+"/"+d[o]+"//reg/"+s[a]]=!0}}function me(t,n,i){var o,s,a;for(o=Object.keys(i),s=0;s<o.length;s++)a=i[o[s]],"string"==typeof a&&a!==r.TO_DELETE_STRING&&(a=ce(a)),void 0!==n[o[s]]&&e.stringify(n[o[s]])!==e.stringify(a)?(Ne[t+"/"+o[s]]={value:n[o[s]],conflictingPaths:{}},Ae[t+"/"+o[s]]={value:i[o[s]],conflictingPaths:{}},Ne[t+"/"+o[s]].conflictingPaths[t+"/"+o[s]]=!0,Ae[t+"/"+o[s]].conflictingPaths[t+"/"+o[s]]=!0):n[o[s]]=i[o[s]]}function _e(e,t,n){var i,o,s,a,l=Object.keys(n);for(o=0;o<l.length;o++)if(t[l[o]])if(t[l[o]]===r.TO_DELETE_STRING)n[l[o]]!==r.TO_DELETE_STRING&&(Ne[e+"/"+l[o]]={value:r.TO_DELETE_STRING,conflictingPaths:{}},fe(n[l[o]],!1,e+"/"+l[o],e+"/"+l[o]));else if(n[l[o]]===r.TO_DELETE_STRING)Ae[e+"/"+l[o]]={value:r.TO_DELETE_STRING,conflictingPaths:{}},fe(t[l[o]],!0,e+"/"+l[o],e+"/"+l[o]);else for(i=k(n[l[o]]),s=0;s<i.length;s++)a=ce(i[s]),t[l[o]][a]?t[l[o]][a]===r.TO_DELETE_STRING?n[l[o]][i[s]]!==r.TO_DELETE_STRING&&(Ne[e+"/"+l[o]+"/"+a+"//"]={value:r.TO_DELETE_STRING,conflictingPaths:{}},ue(n[l[o]][i[s]],!1,e+"/"+l[o]+"/"+a+"//",e+"/"+l[o]+"/"+a+"//")):n[l[o]][i[s]]===r.TO_DELETE_STRING?(Ae[e+"/"+l[o]+"/"+a+"//"]={value:r.TO_DELETE_STRING,conflictingPaths:{}},ue(t[l[o]][a],!0,e+"/"+l[o]+"/"+a+"//",e+"/"+l[o]+"/"+a+"//")):(n[l[o]][i[s]].attr&&(t[l[o]][a].attr?me(e+"/"+l[o]+"/"+a+"//attr",t[l[o]][a].attr,n[l[o]][i[s]].attr):t[l[o]][a].attr=n[l[o]][i[s]].attr),n[l[o]][i[s]].reg&&(t[l[o]][a].reg?me(e+"/"+l[o]+"/"+a+"//reg",t[l[o]][a].reg,n[l[o]][i[s]].reg):t[l[o]][a].reg=n[l[o]][i[s]].reg)):t[l[o]][a]=n[l[o]][i[s]];else t[l[o]]=n[l[o]]}function be(e,t,n,i){var o,s,a,l,c,d,h,p;if(t?(o=Ne,s=Ae[i]):(o=Ae,s=Ne[i]),e===r.TO_DELETE_STRING)return o[n]=o[n]||{value:r.TO_DELETE_STRING,conflictingPaths:{}},o[n].conflictingPaths[i]=!0,void(s.conflictingPaths[n]=!0);if(e.children)if(e.children===r.TO_DELETE_STRING)o[n+"/children"]=o[n+"/children"]||{value:r.TO_DELETE_STRING,conflictingPaths:{}},o[n+"/children"].conflictingPaths[i]=!0,s.conflictingPaths[n+"/children"]=!0;else for(e.children.max&&(o[n+"/children/max"]=o[n+"/children/max"]||{value:e.children.max,conflictingPaths:{}},o[n+"/children/max"].conflictingPaths[i]=!0,s.conflictingPaths[n+"/children/max"]=!0),e.children.min&&(o[n+"/children/min"]=o[n+"/children/min"]||{value:e.children.min,conflictingPaths:{}},o[n+"/children/min"].conflictingPaths[i]=!0,s.conflictingPaths[n+"/children/min"]=!0),a=k(e.children),l=0;l<a.length;l++)o[n+"/children/"+a[l]]=o[n+"/children/"+a[l]]||{value:e.children[a[l]],conflictingPaths:{}},o[n+"/children/"+a[l]].conflictingPaths[i]=!0,s.conflictingPaths[n+"/children/"+a[l]]=!0;if(e.attributes)if(e.attributes===r.TO_DELETE_STRING)o[n+"/attributes"]=o[n+"/attributes"]||{value:r.TO_DELETE_STRING,conflictingPaths:{}},o[n+"/attributes"].conflictingPaths[i]=!0,s.conflictingPaths[n+"/attributes"]=!0;else for(d=Object.keys(e.attributes),l=0;l<d.length;l++)p=n+"/attributes/"+d[l],o[p]=o[p]||{value:e.attributes[d[l]],conflictingPaths:{}},o[p].conflictingPaths[i]=!0,s.conflictingPaths[p]=!0;if(e.pointers)if(e.pointers===r.TO_DELETE_STRING)o[n+"/pointers"]=o[n+"/pointers"]||{value:r.TO_DELETE_STRING,conflictingPaths:{}},o[n+"/pointers"].conflictingPaths[i]=!0,s.conflictingPaths[n+"/pointers"]=!0;else for(d=Object.keys(e.pointers),l=0;l<d.length;l++)if(e.pointers[d[l]]===r.TO_DELETE_STRING)o[n+"/pointers/"+d[l]]=o[n+"/pointers/"+d[l]]||{value:r.TO_DELETE_STRING,conflictingPaths:{}},o[n+"/pointers/"+d[l]].conflictingPaths[i]=!0,s.conflictingPaths[n+"/pointers/"+d[l]]=!0;else for(e.pointers[d[l]].max&&(o[n+"/pointers/"+d[l]+"/max"]=o[n+"/pointers/"+d[l]+"/max"]||{value:e.pointers[d[l]].max,conflictingPaths:{}},o[n+"/pointers/"+d[l]+"/max"].conflictingPaths[i]=!0,s.conflictingPaths[n+"/pointers/"+d[l]+"/max"]=!0),e.pointers[d[l]].min&&(o[n+"/pointers/"+d[l]+"/min"]=o[n+"/pointers/"+d[l]+"/min"]||{value:e.pointers[d[l]].min,conflictingPaths:{}},o[n+"/pointers/"+d[l]+"/min"].conflictingPaths[i]=!0,s.conflictingPaths[n+"/pointers/"+d[l]+"/min"]=!0),a=k(e.pointers[d[l]]),c=0;c<a.length;c++)h=ce(a[c]),o[n+"/pointers/"+d[l]+"/"+h+"//"]=o[n+"/pointers/"+d[l]+"/"+h+"//"]||{value:e.pointers[d[l]][a[c]],conflictingPaths:{}},o[n+"/pointers/"+d[l]+"/"+h+"//"].conflictingPaths[i]=!0,s.conflictingPaths[n+"/pointers/"+d[l]+"/"+h+"//"]=!0}function ye(t,n,i){var o,s,a,l,c,d,h=function(t,n,i){var o,s,a,l,c;if(n===r.TO_DELETE_STRING||i===r.TO_DELETE_STRING)e.stringify(n)!==e.stringify(i)&&(Ne[t]=Ne[t]||{value:n,conflictingPaths:{}},Ne[t].conflictingPaths[t]=!0,Ae[t]=Ae[t]||{value:i,conflictingPaths:{}},Ae[t].conflictingPaths[t]=!0);else for(i.max&&(n.max&&n.max!==i.max?(l=t+"/max",Ne[l]=Ne[l]||{value:n.max,conflictingPaths:{}},Ne[l].conflictingPaths[l]=!0,Ae[l]=Ae[l]||{value:i.max,conflictingPaths:{}},Ae[l].conflictingPaths[l]=!0):n.max=i.max),i.min&&(n.min&&n.min!==i.min?(l=t+"/min",Ne[l]=Ne[l]||{value:n.min,conflictingPaths:{}},Ne[l].conflictingPaths[l]=!0,Ae[l]=Ae[l]||{value:i.min,conflictingPaths:{}},Ae[l].conflictingPaths[l]=!0):n.min=i.min),o=k(n),s=k(i),a=0;a<s.length;a++)l=ce(s[a]),-1!==o.indexOf(l)&&e.stringify(n[l])!==e.stringify(i[s[a]])?(c=l,l=t+"/"+l+"//",Ne[l]=Ne[l]||{value:n[c],conflictingPaths:{}},Ne[l].conflictingPaths[l]=!0,Ae[l]=Ae[l]||{value:i[s[a]],conflictingPaths:{}},Ae[l].conflictingPaths[l]=!0):n[l]=i[s[a]]};if(e.stringify(n)!==e.stringify(i))if(n===r.TO_DELETE_STRING)Ne[t]=Ne[t]||{value:r.TO_DELETE_STRING,conflictingPaths:{}},be(i,!1,t,t);else if(i===r.TO_DELETE_STRING)Ae[t]=Ae[t]||{value:r.TO_DELETE_STRING,conflictingPaths:{}},be(n,!0,t,t);else{if(i.children&&(n.children?h(t+"/children",n.children,i.children):n.children=i.children),i.pointers)if(n.pointers)if(n.pointers===r.TO_DELETE_STRING||i.pointers===r.TO_DELETE_STRING)e.stringify(n.pointers)!==e.stringify(i.pointers)&&(a=t+"/pointers",Ne[a]=Ne[a]||{value:n.pointers,conflictingPaths:{}},Ne[a].conflictingPaths[a]=!0,Ae[a]=Ae[a]||{value:i.pointers,conflictingPaths:{}},Ae[a].conflictingPaths[a]=!0);else for(o=Object.keys(i.pointers),s=0;s<o.length;s++)n.pointers[o[s]]?h(t+"/pointers/"+o[s],n.pointers[o[s]],i.pointers[o[s]]):n.pointers[o[s]]=i.pointers[o[s]];else n.pointers=i.pointers;if(i.attributes)if(n.attributes)if(i.attributes===r.TO_DELETE_STRING||n.attributes===r.TO_DELETE_STRING)e.stringify(n.attributes)!==e.stringify(i.attributes)&&(a=t+"/attributes",Ne[a]=Ne[a]||{value:n.attributes,conflictingPaths:{}},Ne[a].conflictingPaths[a]=!0,Ae[a]=Ae[a]||{value:i.attributes,conflictingPaths:{}},Ae[a].conflictingPaths[a]=!0);else for(o=Object.keys(i.attributes),s=0;s<o.length;s++)n.attributes[o[s]]?i.attributes[o[s]]===r.TO_DELETE_STRING||n.attributes[o[s]]===r.TO_DELETE_STRING?e.stringify(n.attributes[o[s]])!==e.stringify(i.attributes[o[s]])&&(a=t+"/attributes/"+[o[s]],Ne[a]=Ne[a]||{value:n.attributes[o[s]],conflictingPaths:{}},Ne[a].conflictingPaths[a]=!0,Ae[a]=Ae[a]||{value:i.attributes[o[s]],conflictingPaths:{}},Ae[a].conflictingPaths[a]=!0):me(t+"/attributes/"+o[s],n.attributes[o[s]],i.attributes[o[s]]):n.attributes[o[s]]=i.attributes[o[s]];else n.attributes=i.attributes;if(i.aspects)if(n.aspects)if(i.aspects===r.TO_DELETE_STRING||n.aspects===r.TO_DELETE_STRING)e.stringify(n.aspects)!==e.stringify(i.aspects)&&(a=t+"/aspects",Ne[a]=Ne[a]||{value:n.aspects,conflictingPaths:{}},Ne[a].conflictingPaths[a]=!0,Ae[a]=Ae[a]||{value:i.aspects,conflictingPaths:{}},Ae[a].conflictingPaths[a]=!0);else for(o=Object.keys(i.aspects),s=0;s<o.length;s++)if(n.aspects[o[s]])if(i.aspects[o[s]]===r.TO_DELETE_STRING||n.aspects[o[s]]===r.TO_DELETE_STRING)e.stringify(n.aspects[o[s]])!==e.stringify(i.aspects[o[s]])&&(a=t+"/aspects/"+o[s],Ne[a]=Ne[a]||{value:n.aspects[o[s]],conflictingPaths:{}},Ne[a].conflictingPaths[a]=!0,Ae[a]=Ae[a]||{value:i.aspects[o[s]],conflictingPaths:{}},Ae[a].conflictingPaths[a]=!0);else for(c=Object.keys(i.aspects[o[s]]),l=0;l<c.length;l++)a=ce(c[l]),n.aspects[o[s]][a]?e.stringify(n.aspects[o[s]][a])!==e.stringify(i.aspects[o[s]][c[l]])&&(d=a,a=t+"/aspects/"+o[s]+"/"+a+"//",Ne[a]=Ne[a]||{value:n.aspects[o[s]][d],conflictingPaths:{}},Ne[a].conflictingPaths[a]=!0,Ae[a]=Ae[a]||{value:i.aspects[o[s]][c[l]],conflictingPaths:{}},Ae[a].conflictingPaths[a]=!0):n.aspects[o[s]][a]=i.aspects[o[s]][c[l]];else n.aspects[o[s]]=i.aspects[o[s]];else n.aspects=i.aspects}}function ve(e,t){var i,o,r=e.guid,s=pe(e),a=oe(we,r),l=le(we,r,""),c=a,d=k(e);if(e.removed===!0)if(a&&a.removed!==!0&&L(a))for(o=l+"/removed",Ae[o]=Ae[o]||{value:!0,conflictingPaths:{}},s=ge(r),n(s.length>0),i=0;i<s.length;i++)a=oe(we,s[i]),l=le(we,s[i],""),ue(a,!0,l,o);else re(we,t,e);else if(s.length>0)for(i=0;i<s.length;i++)a=oe(we,s[i]),l=le(we,s[i],""),L(e)?(Ne[l+"/removed"]=Ne[l+"/removed"]||{value:!0,conflictingPaths:{}},ue(e,!1,t,l+"/removed")):(Ae[l+"/removed"]=Ae[l+"/removed"]||{value:!0,conflictingPaths:{}},ue(c,!0,t,l+"/removed"));else a?(e.movedFrom&&(a.movedFrom&&t!==l?(Ne[l]=Ne[l]||{value:"move",conflictingPaths:{}},Ae[t]=Ae[t]||{value:"move",conflictingPaths:{}},Ne[l].conflictingPaths[t]=!0,Ae[t].conflictingPaths[l]=!0,t=l):t!==l&&(a.movedFrom=e.movedFrom,re(we,t,a),x(we,l),a=oe(we,r),l=le(we,r,""),n(t===l))),n(l===t||a.movedFrom===t),t=l,e.attr&&(a.attr?me(t+"/attr",a.attr,e.attr):re(we,t+"/attr",e.attr)),e.reg&&(a.reg?me(t+"/reg",a.reg,e.reg):re(we,t+"/reg",e.reg)),e.pointer&&(a.pointer?me(t+"/pointer",a.pointer,e.pointer):re(we,t+"/pointer",e.pointer)),e.set&&(a.set?_e(t+"/set",a.set,e.set):re(we,t+"/set",e.set)),e.meta&&(a.meta?ye(t+"/meta",a.meta,e.meta):re(we,t+"/meta",e.meta))):re(we,t,se(e));for(i=0;i<d.length;i++)ve(e[d[i]],t+"/"+d[i]);
}function Ce(){var e,t,i,o,r=[];for(e=Object.keys(Ne),t=0;t<e.length;t++)for(o=Object.keys(Ne[e[t]].conflictingPaths||{}),n(o.length>0),i=0;i<o.length;i++)r.push({selected:"mine",mine:{path:e[t],info:e[t].replace(/\//g," / "),value:Ne[e[t]].value},theirs:{path:o[i],info:o[i].replace(/\//g," / "),value:Ae[o[i]].value}});return r}function Ee(e){var t,n,i,o,r=k(e);for(t=Object.keys(e.pointer||{}),n=0;n<t.length;n++)e.pointer[t[n]]=ce(e.pointer[t[n]]);for(t=Object.keys(e.set||{}),n=0;n<t.length;n++)for(i=Object.keys(e.set[t[n]]||{}),o=0;o<i.length;o++)i[o]!==ce(i[o])&&(e.set[t[n]][ce(i[o])]=e.set[t[n]][i[o]],delete e.set[t[n]][i[o]]);for(n=0;n<r.length;n++)Ee(e[r[n]])}function De(e){return n("string"==typeof e),e.split("/").length}function Ie(e){var t,n,i={},o=[],r=function(e){var t,n=Object.keys(i),o=-1,r=null;for(t=0;t<n.length;t++)1===e.indexOf(n[t])&&De(n[t])>o&&(r=n[t],o=De(n[t]));return r};for(t=0;t<e.items.length;t++)"theirs"===e.items[t].selected&&"move"===e.items[t].theirs.value?(i[e.items[t].mine.path]=e.items[t].theirs.path,re(e.merge,e.items[t].theirs.path,D(e.merge,e.items[t].mine.path)),x(e.merge,e.items[t].mine.path)):o.push(e.items[t]);for(e.items=o,t=0;t<e.items.length;t++)"theirs"===e.items[t].selected&&(n=r(e.items[t].theirs.path),n&&(e.items[t].theirs.path=e.items[t].theirs.path.replace(n,i[n])),n=r(e.items[t].mine.path),n&&(e.items[t].mine.path=e.items[t].mine.path.replace(n,i[n])))}n("object"==typeof a),n("object"==typeof a.globConf),n("undefined"!=typeof a.logger);var Te,Pe,Ne,Ae,we,Oe,Se,xe,Me=a.logger,Re=this,Le={},ke={},je=!0,Ge=0,Be={},We=[];for(Te in s)this[Te]=s[Te];Me.debug("initialized DiffCore"),this.nodeDiff=function(e,t){var n={children:h(e,t),attr:c(e,t),reg:d(e,t),pointer:p(e,t),set:g(e,t),meta:f(e,t)};return l(n),E(n)?null:n},this.generateTreeDiff=function(e,n){return Le={},ke={},Be={},je=!0,Ge=0,t.call(function(e){return ke=e,R()},T(e,n))},this.generateLightTreeDiff=function(e,t){return T(e,t)},this.applyTreeDiff=function(e,n){var i=z(e,n);return i=t.call(V,e,"",n,i),t.call(function(){return H(e,"",n)},i)},this.tryToConcatChanges=function(e,t){var n={};return We=[],Ne={},Ae={},we=e,Oe=t,Se={},xe={getBaseSourceFromDestination:{},getBaseDestinationFromSource:{},getExtensionSourceFromDestination:{},getExtensionDestinationFromSource:{}},he(e,t),j(e,"",xe.getBaseSourceFromDestination,xe.getBaseDestinationFromSource),j(t,"",xe.getExtensionSourceFromDestination,xe.getExtensionDestinationFromSource),de(e),de(t),B("",null,we,Oe),ve(Oe,""),n.items=Ce(),n.mine=Ne,n.theirs=Ae,n.merge=we,Ee(n.merge),n},this.applyResolution=function(e){var t;for(Ie(e),t=0;t<e.items.length;t++)"mine"!==e.items[t].selected&&(x(e.merge,e.items[t].mine.path),re(e.merge,e.items[t].theirs.path,e.items[t].theirs.value));return e.merge}}return s}),define("common/core/metacachecore",["common/util/assert","common/core/tasync","common/core/constants"],function(e,t,n){"use strict";var i=function(i,o){function r(e){var o,r=i.getMemberPaths(e,n.META_SET_NAME),s=[];return t.call(function(){for(o=0;o<r.length;o+=1)s.push(i.loadByPath(e,r[o]));return t.lift(s)},l.loadPaths(l.getHash(e),JSON.parse(JSON.stringify(r))))}e("object"==typeof o),e("object"==typeof o.globConf),e("undefined"!=typeof o.logger);var s,a=o.logger,l=this;for(s in i)this[s]=i[s];a.debug("initialized MetaCacheCore"),this.loadRoot=function(e){return t.call(function(e){return t.call(function(t){var n=0;for(e.metaNodes={},n=0;n<t.length;n+=1)t[n]&&(e.metaNodes[i.getPath(t[n])]=t[n]);return e},r(e))},i.loadRoot(e))},this.loadByPath=function(e,n){return t.call(function(){return i.loadByPath(e,n)},l.loadPaths(l.getHash(e),[n]))},this.createNode=function(e){var t=i.createNode(e);return e&&e.parent||(t.metaNodes={}),t},this.addMember=function(e,t,o){var r=l.getRoot(e);i.addMember(e,t,o),t===n.META_SET_NAME&&l.getPath(e)===l.getPath(r)&&(r.metaNodes[l.getPath(o)]=o)},this.delMember=function(e,t,o){var r=l.getRoot(e);i.delMember(e,t,o),t===n.META_SET_NAME&&l.getPath(e)===l.getPath(r)&&delete r.metaNodes[o]},this.deleteNode=function(e,t){var n=l.getRoot(e);n.metaNodes[l.getPath(e)]&&delete n.metaNodes[l.getPath(e)],i.deleteNode(e,t)},this.moveNode=function(e,t){var n=l.getRoot(e),o=l.getPath(e),r=i.moveNode(e,t);return n.metaNodes[o]&&(delete n.metaNodes[o],n.metaNodes[l.getPath(r)]=r),r},this.isMetaNode=function(e){var t=l.getRoot(e);return t.metaNodes&&t.metaNodes[l.getPath(e)]?!0:!1},this.getAllMetaNodes=function(e){var t=l.getRoot(e);return t.metaNodes?t.metaNodes:{}},this.getFCO=function(e){var t,n=l.getRoot(e);for(t in n.metaNodes)return l.getBaseRoot(n.metaNodes[t]);return null}};return i}),define("common/core/mixincore",["common/util/assert","common/core/tasync","common/util/canon","common/core/constants"],function(e,t,n,i){"use strict";var o=function(t,n){function o(e){return-1!==y.getPath(e).indexOf("_")?!1:!0}function r(e){var t,n,i,o=y.getMixinPaths(e),r={},s=[];if(0===o.length)return s;for(t=y.getAllMetaNodes(e),i=0;i<o.length;i+=1)t[o[i]]&&(n=y.getGuid(t[o[i]]),r[n]=o[i],s.push(n));for(s.sort(),i=0;i<s.length;i+=1)s[i]=t[r[s[i]]];return s}function s(e,t){var n,i=y.getAllMetaNodes(e),o={};for(n=0;n<t.length;n+=1)i[t[n]]&&(o[t[n]]=i[t[n]]);return o}function a(e,t){var n;for(n=0;n<t.length;n+=1)-1===e.indexOf(t[n])&&e.push(t[n])}function l(e,t){var n,i={};for(n in e)i[n]=e[n];for(n in t)e[n]||(i[n]=t[n]);return i}function c(e,t,n){var i,o,s=y.getBase(e),l=y.getPath(e),d=r(e);if(n[l])return[];for(i=s?c(s,t,n):[],a(i,t(e)),n[l]=!0,o=0;o<d.length;o+=1)a(i,c(d[o],t,n));return i}function d(e,t,n,i){var o,s=y.getBase(e),a=y.getPath(e),l=r(e),c=null;if(i[a])return null;if(i[a]=!0,-1!==n(e).indexOf(t))return e;if(s&&(c=d(s,t,n,i)))return c;for(o=0;o<l.length;o+=1)if(c=d(l[o],t,n,i))return c;return null}function h(e,t,n,i){var o,s=y.getBase(e),a=y.getPath(e),l=r(e),c=[];if(i[a])return[];for(i[a]=!0,-1!==n(e).indexOf(t)&&c.push(e),s&&(c=c.concat(h(s,t,n,i))),o=0;o<l.length;o+=1)c=c.concat(h(l[o],t,n,i));return c}function p(e,t,n,i){var o=d(e,t,n,{});return o?i(o,t):void 0}function g(e){return t.getOwnValidPointerNames(e).concat(t.getOwnValidSetNames(e))}function u(e){return["containment"]}function f(e,n,i){var o,s,a,l=y.getPath(e);if(i[l])return!1;if(i[l]=!0,t.isTypeOf(e,n))return!0;if(o=y.getBase(e),o&&f(o,n,i))return!0;for(s=r(e),a=0;a<s.length;a+=1)if(f(s[a],n,i))return!0;return!1}function m(e){var t,n=[],i=[],o=[];for(t in e)"min"!==t&&"max"!==t&&(n.push(t),i.push(e[t].min||-1),o.push(e[t].max||-1),delete e[t]);e.items=n,e.minItems=i,e.maxItems=o}e("object"==typeof n),e("object"==typeof n.globConf),e("undefined"!=typeof n.logger);var _,b=n.logger,y=this;for(_ in t)this[_]=t[_];b.debug("initialized MixinCore"),this.isTypeOf=function(e,t){return o(e)?f(e,t,{}):!1},this.isValidChildOf=function(e,n){if(!o(e))return!0;var i,r,s;if(t.isValidChildOf(e,n))return!0;for(i=y.getValidChildrenPaths(n),r=y.getAllMetaNodes(e),s=0;s<i.length;s+=1)if(r[i[s]]&&y.isTypeOf(e,r[i[s]]))return!0;return!1},this.isValidTargetOf=function(e,n,i){if(!o(n)||null===e)return!0;var r,s,a;if(t.isValidTargetOf(e,n,i))return!0;for(r=y.getValidTargetPaths(n,i),s=y.getAllMetaNodes(e),a=0;a<r.length;a+=1)if(s[r[a]]&&y.isTypeOf(e,s[r[a]]))return!0;return!1},this.isValidAttributeValueOf=function(e,n,i){if(!o(e))return!0;var r=d(e,n,t.getOwnValidAttributeNames,{});return r?t.isValidAttributeValueOf(r,n,i):!1},this.getValidPointerNames=function(e){return c(e,t.getOwnValidPointerNames,{})},this.getValidSetNames=function(e){return c(e,t.getOwnValidSetNames,{})},this.getValidAttributeNames=function(e){return o(e)?c(e,t.getOwnValidAttributeNames,{}):[]},this.getValidAspectNames=function(e){return c(e,t.getOwnValidAspectNames,{})},this.getConstraintNames=function(e){return c(e,t.getConstraintNames,{})},this.getJsonMeta=function(e){var t,n,i={children:{},attributes:{},pointers:{},aspects:{},constraints:{}},o={items:[],minItems:[],maxItems:[]};for(i.children=y.getChildrenMeta(e),i.children?m(i.children):i.children=o,t=y.getValidAttributeNames(e),n=0;n<t.length;n+=1)i.attributes[t[n]]=y.getAttributeMeta(e,t[n]);for(t=y.getValidPointerNames(e),n=0;n<t.length;n+=1)i.pointers[t[n]]=y.getPointerMeta(e,t[n]),m(i.pointers[t[n]]);for(t=y.getValidSetNames(e),n=0;n<t.length;n+=1)i.pointers[t[n]]=y.getPointerMeta(e,t[n]),m(i.pointers[t[n]]);for(t=y.getValidAspectNames(e),n=0;n<t.length;n+=1)i.aspects[t[n]]=y.getAspectMeta(e,t[n]);for(t=y.getConstraintNames(e),n=0;n<t.length;n+=1)i.constraints[t[n]]=y.getConstraint(e,t[n]);return i},this.getOwnJsonMeta=function(e){var n=t.getOwnJsonMeta(e),i=this.getMixinPaths(e);return i.length>0&&(n.mixins=i),n},this.getValidChildrenPaths=function(e){return c(e,t.getValidChildrenPaths,{})},this.getChildrenMeta=function(e){var n,i=h(e,"containment",u,{}),o={};for(n=0;n<i.length;n+=1)o=l(o,t.getChildrenMeta(i[n]));return 0===Object.keys(o).length?null:o},this.getPointerMeta=function(e,n){var i,o=h(e,n,g,{}),r={};if(0===o.length)return void 0;for(i=0;i<o.length;i+=1)r=l(r,t.getPointerMeta(o[i],n));return r},this.getValidTargetPaths=function(e,n){var i=function(e){return t.getValidTargetPaths(e,n)};return c(e,i,{})},this.getAttributeMeta=function(e,n){return p(e,n,t.getOwnValidAttributeNames,t.getAttributeMeta)},this.getAspectMeta=function(e,n){return p(e,n,t.getOwnValidAspectNames,t.getAspectMeta)},this.getSetNames=function(e){var n=t.getSetNames(e),o=n.indexOf(i.MIXINS_SET);return-1!==o&&n.splice(o,1),n},this.getMixinErrors=function(e){var t,n,o,s,l,c,d,h,p,g,u,f=[],m=y.getMixinPaths(e),_=y.getAllMetaNodes(e),v=r(e),C=y.getAttribute(e,"name"),E=y.getBase(e);for(b.debug("getMixinErrors("+C+")"),p=0;p<m.length;p+=1)_[m[p]]||(b.error("mixin node is missing from Meta ["+m[p]+"]"),f.push({severity:"error",nodeName:C,type:i.MIXIN_ERROR_TYPE.MISSING,targetInfo:m[p],message:"["+C+"]: mixin node '"+m[p]+"' is missing from the Meta",hint:"Remove mixin or add to the Meta"}));for(o={},l=[],E&&(l=y.getValidAttributeNames(E)),a(l,y.getOwnValidAttributeNames(e)),p=0;p<v.length;p+=1)for(d=y.getAttribute(v[p],"name"),h=y.getPath(v[p]),c=y.getValidAttributeNames(v[p]),g=0;g<c.length;g+=1)-1===l.indexOf(c[g])&&(o[c[g]]?(b.warn("colliding attribute ("+c[g]+") definition ["+o[c[g]].name+"]vs["+d+"]"),f.push({severity:"warning",type:i.MIXIN_ERROR_TYPE.ATTRIBUTE_COLLISION,nodeName:C,ruleName:c[g],collisionPaths:[o[c[g]].path,h],collisionNodes:[v[o[c[g]].index],v[p]],message:"["+C+"]: inherits attribute definition '"+c[g]+"' from ["+o[c[g]].name+"] and ["+d+"]",hint:"Remove one of the mixin relations"})):o[c[g]]={name:d,path:h,index:p});for(o={},l=[],E&&(l=y.getValidChildrenPaths(E)),a(l,y.getOwnValidChildrenPaths(e)),p=0;p<v.length;p+=1)for(d=y.getAttribute(v[p],"name"),c=y.getValidChildrenPaths(v[p]),h=y.getPath(v[p]),g=0;g<c.length;g+=1)-1===l.indexOf(c[g])&&(o[c[g]]?(t=_[c[g]],n=t?"["+y.getAttribute(t,"name")+"]":"'"+c[g]+"'",b.warn("colliding child ("+c[g]+") definition ["+o[c[g]].name+"]vs["+d+"]"),f.push({severity:"warning",type:i.MIXIN_ERROR_TYPE.CONTAINMENT_COLLISION,nodeName:C,targetInfo:c[g],targetNode:t,collisionPaths:[o[c[g]].path,h],collisionNodes:[v[o[c[g]].index],v[p]],message:"["+C+"]: inherits child definition for "+n+" from ["+o[c[g]].name+"] and ["+d+"]",hint:"Remove one of the mixin relations"})):o[c[g]]={name:d,path:h,index:p});for(s=this.getValidPointerNames(e),p=0;p<s.length;p+=1)for(o={},l=[],E&&(l=y.getValidTargetPaths(E,s[p])),a(l,y.getOwnValidTargetPaths(e,s[p])),g=0;g<v.length;g+=1)for(c=y.getValidTargetPaths(v[g],s[p]),d=y.getAttribute(v[g],"name"),h=y.getPath(v[g]),u=0;u<c.length;u+=1)-1===l.indexOf(c[u])&&"min"!==c[u]&&"max"!==c[u]&&(o[c[u]]?(t=_[c[u]],n=t?"["+y.getAttribute(t,"name")+"]":"'"+c[u]+"'",b.warn("colliding pointer ("+s[p]+") target ("+c[u]+") definition ["+o[c[u]].name+"]vs["+d+"]"),f.push({severity:"warning",type:i.MIXIN_ERROR_TYPE.POINTER_COLLISION,nodeName:C,ruleName:s[p],targetInfo:c[u],targetNode:t,collisionPaths:[o[c[u]].path,h],collisionNodes:[v[o[c[u]].index],v[g]],message:"["+C+"]: inherits pointer ("+s[p]+") target definition of "+n+" from ["+o[c[u]].name+"] and ["+d+"]",hint:"Remove one of the mixin relations"})):o[c[u]]={name:d,path:h,index:p});for(s=this.getValidSetNames(e),p=0;p<s.length;p+=1)for(o={},l=[],E&&(l=y.getValidTargetPaths(E,s[p])),a(l,y.getOwnValidTargetPaths(e,s[p])),g=0;g<v.length;g+=1)for(c=y.getValidTargetPaths(v[g],s[p]),d=y.getAttribute(v[g],"name"),h=y.getPath(v[g]),u=0;u<c.length;u+=1)-1===l.indexOf(c[u])&&"min"!==c[u]&&"max"!==c[u]&&(o[c[u]]?(t=_[c[u]],n=t?"["+y.getAttribute(t,"name")+"]":"'"+c[u]+"'",b.warn("colliding set ("+s[p]+") member ("+c[u]+") definition ["+o[c[u]].name+"]vs["+d+"]"),f.push({severity:"warning",type:i.MIXIN_ERROR_TYPE.SET_COLLISION,nodeName:C,ruleName:s[p],targetInfo:c[u],targetNode:t,collisionPaths:[o[c[u]].path,h],collisionNodes:[v[o[c[u]].index],v[g]],message:"["+C+"]: inherits set ("+s[p]+") member definition of "+n+" from ["+o[c[u]].name+"] and ["+d+"]",hint:"Remove one of the mixin relations"})):o[c[u]]={name:d,path:h,index:p});for(o={},l=[],E&&(l=y.getValidAspectNames(E)),a(l,y.getOwnValidAspectNames(e)),p=0;p<v.length;p+=1)for(c=y.getValidAspectNames(v[p]),d=y.getAttribute(v[p],"name"),h=y.getPath(v[p]),g=0;g<c.length;g+=1)-1===l.indexOf(c[g])&&(o[c[g]]?(b.warn("colliding aspect ("+c[g]+") definition ["+o[c[g]].name+"]vs["+d+"]"),f.push({severity:"warning",type:i.MIXIN_ERROR_TYPE.ASPECT_COLLISION,nodeName:C,ruleName:c[g],collisionPaths:[o[c[g]].path,h],collisionNodes:[v[o[c[g]].index],v[p]],message:"["+C+"]: inherits aspect definition '"+c[g]+"' from ["+o[c[g]].name+"] and ["+d+"]",hint:"Remove one of the mixin relations"})):o[c[g]]={name:d,path:h,index:p});for(o={},l=[],E&&(l=y.getConstraintNames(E)),a(l,y.getOwnConstraintNames(e)),p=0;p<v.length;p+=1)for(c=y.getConstraintNames(v[p]),d=y.getAttribute(v[p],"name"),g=0;g<c.length;g+=1)-1===l.indexOf(c[g])&&(o[c[g]]?(b.warn("colliding constraint ("+c[g]+") definition ["+o[c[g]].name+"]vs["+d+"]"),f.push({severity:"warning",type:i.MIXIN_ERROR_TYPE.CONSTRAINT_COLLISION,nodeName:C,ruleName:c[g],collisionPaths:[o[c[g]].path,h],collisionNodes:[v[o[c[g]].index],v[p]],message:"["+C+"]: inherits constraint definition '"+c[g]+"' from ["+o[c[g]].name+"] and ["+d+"]",hint:"Remove one of the mixin relations"})):o[c[g]]={name:d,path:h,index:p});return b.debug("getMixinErrors("+C+") finished"),f},this.getMixinPaths=function(e){return t.getOwnMemberPaths(e,i.MIXINS_SET)},this.getMixinNodes=function(e){var t=y.getMixinPaths(e);return s(e,t)},this.delMixin=function(e,n){t.getAllMetaNodes(e);t.delMember(e,i.MIXINS_SET,n)},this.addMixin=function(e,n){var o=t.getAllMetaNodes(e);o[n]&&t.addMember(e,i.MIXINS_SET,o[n])},this.clearMixins=function(e){y.deleteSet(e,i.MIXINS_SET)},this.getBaseTypes=function(e){var n=t.getBaseType(e),i=[];return n&&(i=r(n),i.unshift(n)),i},this.canSetAsMixin=function(e,n){var i={isOk:!0,reason:""},o=y.getAllMetaNodes(e)[n];return y.getPath(e)===n?(i.isOk=!1,i.reason="Node cannot be mixin of itself!"):o?t.isTypeOf(e,o)&&(i.isOk=!1,i.reason="Base of node cannot be its mixin as well!"):(i.isOk=!1,i.reason="Mixin must be on the Meta!"),i}};return o}),define("common/core/metaquerycore",["common/util/assert"],function(e){"use strict";var t=function(t,n){function i(e){var t;for(t=e.length;t--;)(s.isConnection(e[t])||s.isAbstract(e[t]))&&e.splice(t,1)}e("object"==typeof n),e("object"==typeof n.globConf),e("undefined"!=typeof n.logger);var o,r=n.logger,s=this;for(o in t)this[o]=t[o];r.debug("initialized MetaQueryCore"),this.isAbstract=function(e){return s.getRegistry(e,"isAbstract")===!0},this.isConnection=function(e){var n=t.getValidPointerNames(e);return-1!==n.indexOf("dst")&&-1!==n.indexOf("src")},this.getValidChildrenMetaNodes=function(e){var n,o,r,a,l=[],c=e.node,d=s.getAllMetaNodes(c),h=Object.keys(d||{}),p={},g=e.children||[];for(r=t.getChildrenMeta(c)||{},n=0;n<h.length;n+=1)s.isValidChildOf(d[h[n]],c)&&l.push(d[h[n]]);if(0===l.length)return l;if(e.sensitive===!0&&i(l),0===l.length)return l;if(e.multiplicity===!0){if(r.max&&r.max>-1&&t.getChildrenRelids(c).length>=r.max)return l=[];if(0===g.length)return l;for(delete r.max,delete r.min,h=Object.keys(r),n=0;n<h.length;n+=1)d[h[n]]?p[h[n]]=0:delete r[h[n]];for(h=Object.keys(r),n=0;n<g.length;n+=1)for(o=0;o<h.length;o+=1)t.isTypeOf(g[n],d[h[o]])&&(p[h[o]]+=1);for(n=l.length,h=Object.keys(p);n--;)for(o=0;o<h.length;o+=1)if(r[h[o]].max&&r[h[o]].max>-1&&r[h[o]].max<=p[h[o]]&&t.isTypeOf(l[n],d[h[o]])){l.splice(n,1);break}}if(0===l.length)return l;if(e.aspect)for(h=t.getAspectMeta(c,e.aspect),n=l.length;n--;){for(a=!1,o=0;o<h.length;o+=1)if(t.isTypeOf(l[n],d[h[o]])){a=!0;break}a||l.splice(n,1)}return l},this.getValidSetElementsMetaNodes=function(e){var n,o,r=[],a=e.node,l=e.name,c=s.getAllMetaNodes(a),d=Object.keys(c||{}),h={},p=e.members||[],g=s.getPointerMeta(a,l)||{};for(n=0;n<d.length;n+=1)c[d[n]]&&s.isValidTargetOf(c[d[n]],a,l)&&r.push(c[d[n]]);if(0===r.length)return r;if(e.sensitive===!0&&i(r),0===r.length)return r;if(e.multiplicity===!0){if(g.max&&g.max>-1&&t.getMemberPaths(a).length>=g.max)return r=[];if(0===p.length)return r;for(delete g.max,delete g.min,d=Object.keys(g),n=0;n<d.length;n+=1)c[d[n]]?h[d[n]]=0:delete g[d[n]];for(d=Object.keys(g),n=0;n<p.length;n+=1)for(o=0;o<d.length;o+=1)t.isTypeOf(p[n],c[d[o]])&&(h[d[o]]+=1);for(n=r.length,d=Object.keys(h);n--;)for(o=0;o<d.length;o+=1)if(g[d[o]].max&&g[d[o]].max>-1&&g[d[o]].max<=h[d[o]]&&t.isTypeOf(r[n],c[d[o]])){r.splice(n,1);break}}return r}};return t}),define("common/core/librarycore",["common/util/assert","common/core/tasync","common/core/constants","common/util/random"],function(e,t,n,i){"use strict";var o=function(o,r){function s(e){for(var t=[];e;)w.isLibraryRoot(e)&&t.push(e),e=w.getParent(e);return t}function a(t){e(w.isValidNode(t));var i="";for(t=w.getParent(t);t;)w.isLibraryRoot(t)&&null!==w.getParent(t)&&(i=w.getAttribute(t,"name")+n.NAMESPACE_SEPARATOR+i),t=w.getParent(t);return i}function l(e){var t,n,i,o,r=w.getAllMetaNodes(e),l={};for(t in r)for(n=s(r[t]),i=0;i<n.length;i+=1)o=a(n[i])+w.getAttribute(n[i],"name"),l[o]||(l[o]=n[i]);return l}function c(e,t){return w.getRoot(e).libraryRoots[t]}function d(e){for(;e;){if(w.isLibraryRoot(e)&&!w.isLibraryElement(e))return e;e=w.getParent(e)}return null}function h(e){var n="object"==typeof e,i="",o="",r=function(t){return n?w.getPath(t,e):w.getPath(t)},s=function(e){return w.getFullyQualifiedName(e).substr(o.length)},a=function(e){return n?w.getLibraryGuid(e,i):w.getGuid(e)},l=function(){return n?w.loadSubTree(e):w.loadTree(e)};return n&&(i=w.getAttribute(e,"name"),o=i+"."),t.call(function(e){var t,n,i={};for(n=1;n<e.length;n+=1)t={path:r(e[n]),hash:w.getHash(e[n]),fcn:s(e[n])},i[a(e[n])]=t;return i},l())}function p(e,t){var n,i=w.overlayQuery(e,t);for(n=0;n<i.length;n+=1)(i[n].s===t||i.t===t)&&w.overlayRemove(e,i[n].s,i[n].n,i[n].t)}function g(e,t,n){var i,o=w.overlayQuery(e,t);for(i=0;i<o.length;i+=1)o[i].s===t?(w.overlayRemove(e,o[i].s,o[i].n,o[i].t),w.overlayInsert(e,n,o[i].n,o[i].t)):o[i].t===t&&(w.overlayRemove(e,o[i].s,o[i].n,o[i].t),w.overlayInsert(e,o[i].s,o[i].n,n))}function u(e,t){return e===t?!0:0===e.indexOf(t+n.PATH_SEP)?!0:!1}function f(e,t){var n;for(n in t.selection)if(u(e,n))return!0;return!1}function m(e,t){var n,i,o=s(e),r={};for(n=0;n<o.length;n+=1)i=w.getFullyQualifiedName(o[n]),r[i]={info:w.getLibraryInfo(o[n],i),guid:w.getLibraryGuid(e,i)},r[i].info&&r[i].info.hash&&(r[i].hash=r[i].info.hash);t.bases[w.getGuid(e)]={originGuid:o.length>0?w.getLibraryGuid(e):w.getGuid(e),name:w.getAttribute(e,"name"),fullName:w.getFullyQualifiedName(e),namsespaces:r}}function _(e,t,i){var o,r,s,a,l=w.getPath(e),c=w.getProperty(e,n.OVERLAYS_PROPERTY);for(o in c)if(s=l+o,f(s,i))for(r in c[o])w.isPointerName(r)&&(a=l+c[o][r],r===n.BASE_POINTER?t[a]?(m(t[a],i),i.relations.preserved[s]=i.relations.preserved[s]||{},i.relations.preserved[s][n.BASE_POINTER]=w.getGuid(t[a])):f(a,i)?(i.relations.preserved[s]=i.relations.preserved[s]||{},i.relations.preserved[s][n.BASE_POINTER]=a):(i.relations.lost[s]=i.relations.lost[s]||{},i.relations.lost[s][n.BASE_POINTER]=a):f(a,i)?(i.relations.preserved[s]=i.relations.preserved[s]||{},i.relations.preserved[s][r]=a):(i.relations.lost[s]=i.relations.lost[s]||{},i.relations.lost[s][r]=a))}function b(e){var t,n,i=[],o=[],r={};for(t=0;t<e.length;t+=1)i.push(w.getPath(e[t]));for(t=0;t<i.length;t+=1)for(n=0;n<i.length;n+=1)t!==n&&u(i[n],i[t])&&(r[i[n]]=!0);for(t=0;t<i.length;t+=1)r[i[t]]!==!0&&o.push(e[t]);return o}function y(e,t){var n;for(n in t.hashes)if(u(e,n))return n;return""}function v(e){var t,n,i,o;for(t in e.relations.preserved){n=e.relations.preserved[t];for(i in n)e.bases[n[i]]||(o=y(n[i],e),o?n[i]=n[i].replace(o,e.hashes[o]):(A.error("during closure generation unknown based target ["+n[i]+"] remained."),delete n[i]));o=y(t,e),o?(e.relations.preserved[t.replace(o,e.hashes[o])]=e.relations.preserved[t],delete e.relations.preserved[t]):(A.error("during closure generation unknown based source ["+t+"] remained."),delete e.relations.preserved[t])}}function C(e,t,n){var i,o=Object.keys(n),r=[];for(i=0;i<o.length;i+=1)(t.bases[e].originGuid===w.getLibraryGuid(n[o[i]])||t.bases[e].originGuid===w.getGuid(n[o[i]]))&&r.push(n[o[i]]);return r}function E(e,t){var n,i,o,r,s=Object.keys(e);for(t.destinationBases={},i=0;i<s.length;i+=1)t.destinationBases[w.getGuid(e[s[i]])]=s[i];for(s=Object.keys(t.bases||{}),i=0;i<s.length;i+=1)if(!t.destinationBases[s[i]]){if(n=C(s[i],t,e),0===n.length)return new Error("Cannot find necessary base ["+t.bases[s[i]].fullName+" : "+s[i]+"]");if(1!==n.length){for(r="Ambiguous occurrences of base ["+t.bases[s[i]].fullName+" : "+s[i]+"] ( ",o=0;o<n.length;o+=1)r+="["+w.getFullyQualifiedName(n[o])+" : "+w.getPath(n[o])+"] ";return r+=")",new Error(r)}t.destinationBases[s[i]]=w.getPath(n[0])}return null}function D(e,t,i){var o,r=t.split(n.PATH_SEP),s=i.split(n.PATH_SEP),a="";for(r.shift(),s.shift(),o=0;o<r.length&&o<s.length&&r[o]===s[o];o+=1)a+=n.PATH_SEP+r[o];for(;w.getPath(e)!==a&&null!==e;)e=w.getParent(e);return e}function I(e,t,n,i){var o,r,s=D(e,t,n);s?(o=t.substr(w.getPath(s).length),r=n.substr(w.getPath(s).length),w.overlayInsert(s,o,i,r)):A.error("unable to add relation: "+i+"("+t+"->"+n+")")}function T(e,t){var i=e.substr(0,41),o="";return t.relids[i]&&(o=t.parent+n.PATH_SEP+t.relids[i],o+=e.substr(41)),o}function P(e){var t,n,i;for(t in e.relations.preserved){i=e.relations.preserved[t];for(n in i)e.destinationBases[i[n]]?i[n]=e.destinationBases[i[n]]:i[n]=T(i[n],e)}for(t in e.relations.preserved)e.relations.preserved[T(t,e)]=e.relations.preserved[t],delete e.relations.preserved[t]}e("object"==typeof r),e("object"==typeof r.globConf),e("undefined"!=typeof r.logger);var N,A=r.logger,w=this;for(N in o)this[N]=o[N];A.debug("initialized LibraryCore"),this.loadRoot=function(e){return t.call(function(e){return e.libraryRoots=l(e),e},o.loadRoot(e))},this.createNode=function(e){var t;return e&&e.parent&&(w.isLibraryRoot(e.parent)||w.isLibraryElement(e.parent))?new Error("Not allowed to create new node inside library."):e&&e.base&&w.isLibraryRoot(e.base)?new Error("Not allowed to instantiate library root."):(t=o.createNode(e),null===t.parent&&(t.libraryRoots={}),t)},this.deleteNode=function(e,t){return w.isLibraryRoot(e)||w.isLibraryElement(e)?new Error("Not allowed to remove library node by simply deleting them."):o.deleteNode(e,t)},this.copyNode=function(e,t){return w.isLibraryRoot(t)||w.isLibraryElement(t)?new Error("Not allowed to add nodes inside a library."):w.isLibraryRoot(e)?new Error("Not allowed to copy library root."):o.copyNode(e,t)},this.copyNodes=function(e,t){var n;if(w.isLibraryRoot(t)||w.isLibraryElement(t))return new Error("Not allowed to add nodes inside a library.");for(n=0;n<e.length;n+=1)if(w.isLibraryRoot(e[n]))return new Error("Not allowed to copy library root.");return o.copyNodes(e,t)},this.moveNode=function(e,t){return w.isLibraryRoot(t)||w.isLibraryElement(t)?new Error("Not allowed to add nodes inside a library."):w.isLibraryRoot(e)||w.isLibraryElement(e)?new Error("Not allowed to move library elements."):o.moveNode(e,t)},this.setAttribute=function(e,t,n){return w.isLibraryElement(e)||w.isLibraryRoot(e)?new Error("Not allowed to modify library elements."):o.setAttribute(e,t,n)},this.delAttribute=function(e,t){return w.isLibraryElement(e)||w.isLibraryRoot(e)?new Error("Not allowed to modify library elements."):o.delAttribute(e,t)},this.setRegistry=function(e,t,n){return w.isLibraryElement(e)||w.isLibraryRoot(e)?new Error("Not allowed to modify library elements."):o.setRegistry(e,t,n)},this.delRegistry=function(e,t){return w.isLibraryElement(e)||w.isLibraryRoot(e)?new Error("Not allowed to modify library elements."):o.delRegistry(e,t)},this.setPointer=function(e,t,n){return w.isLibraryElement(e)||w.isLibraryRoot(e)?new Error("Not allowed to modify library elements."):o.setPointer(e,t,n)},this.deletePointer=function(e,t){return w.isLibraryElement(e)||w.isLibraryRoot(e)?new Error("Not allowed to modify library elements."):o.deletePointer(e,t)},this.setBase=function(e,t){return w.isLibraryElement(e)||w.isLibraryRoot(e)?new Error("Not allowed to modify library elements."):t&&w.isLibraryRoot(t)?new Error("Not allowed to instantiate library root."):o.setBase(e,t)},this.addMember=function(e,t,n){return w.isLibraryElement(e)||w.isLibraryRoot(e)?new Error("Not allowed to modify library elements."):o.addMember(e,t,n)},this.delMember=function(e,t,n){return w.isLibraryElement(e)||w.isLibraryRoot(e)?new Error("Not allowed to modify library elements."):o.delMember(e,t,n)},this.setMemberAttribute=function(e,t,n,i,r){return w.isLibraryRoot(e)||w.isLibraryElement(e)?new Error("Not allowed to modify library elements."):o.setMemberAttribute(e,t,n,i,r)},this.delMemberAttribute=function(e,t,n,i){return w.isLibraryRoot(e)||w.isLibraryElement(e)?new Error("Not allowed to modify library elements."):o.delMemberAttribute(e,t,n,i)},this.setMemberRegistry=function(e,t,n,i,r){return w.isLibraryRoot(e)||w.isLibraryElement(e)?new Error("Not allowed to modify library elements."):o.setMemberRegistry(e,t,n,i,r)},this.delMemberRegistry=function(e,t,n,i){return w.isLibraryRoot(e)||w.isLibraryElement(e)?new Error("Not allowed to modify library elements."):o.delMemberRegistry(e,t,n,i)},this.createSet=function(e,t){return w.isLibraryRoot(e)||w.isLibraryElement(e)?new Error("Not allowed to modify library elements."):o.createSet(e,t)},this.deleteSet=function(e,t){return w.isLibraryRoot(e)||w.isLibraryElement(e)?new Error("Not allowed to modify library elements."):o.deleteSet(e,t)},this.setSetAttribute=function(e,t,n,i){return w.isLibraryRoot(e)||w.isLibraryElement(e)?new Error("Not allowed to modify library elements."):o.setSetAttribute(e,t,n,i)},this.delSetAttribute=function(e,t,n){return w.isLibraryRoot(e)||w.isLibraryElement(e)?new Error("Not allowed to modify library elements."):o.delSetAttribute(e,t,n)},this.setSetRegistry=function(e,t,n,i){return w.isLibraryRoot(e)||w.isLibraryElement(e)?new Error("Not allowed to modify library elements."):o.setSetRegistry(e,t,n,i)},this.delSetRegistry=function(e,t,n){return w.isLibraryRoot(e)||w.isLibraryElement(e)?new Error("Not allowed to modify library elements."):o.delSetRegistry(e,t,n)},this.setGuid=function(e,t){return w.isLibraryRoot(e)||w.isLibraryElement(e)?void 0:o.setGuid(e,t)},this.setConstraint=function(e,t,n){return w.isLibraryRoot(e)||w.isLibraryElement(e)?new Error("Not allowed to modify library elements."):o.setConstraint(e,t,n)},this.delConstraint=function(e,t){return w.isLibraryRoot(e)||w.isLibraryElement(e)?new Error("Not allowed to modify library elements."):o.delConstraint(e,t)},this.clearMetaRules=function(e){return w.isLibraryRoot(e)||w.isLibraryElement(e)?new Error("Not allowed to modify library elements."):o.clearMetaRules(e)},this.setAttributeMeta=function(e,t,n){return w.isLibraryRoot(e)||w.isLibraryElement(e)?new Error("Not allowed to modify library elements."):o.setAttributeMeta(e,t,n)},this.delAttributeMeta=function(e,t){return w.isLibraryRoot(e)||w.isLibraryElement(e)?new Error("Not allowed to modify library elements."):o.delAttributeMeta(e,t)},this.setChildMeta=function(e,t,n,i){return w.isLibraryRoot(e)||w.isLibraryElement(e)?new Error("Not allowed to modify library elements."):w.isLibraryRoot(t)?new Error("Not allowed to use library root as valid child."):o.setChildMeta(e,t,n,i)},this.delChildMeta=function(e,t){return w.isLibraryRoot(e)||w.isLibraryElement(e)?new Error("Not allowed to modify library elements."):o.delChildMeta(e,t)},this.setChildrenMetaLimits=function(e,t,n){return w.isLibraryRoot(e)||w.isLibraryElement(e)?new Error("Not allowed to modify library elements."):o.setChildrenMetaLimits(e,t,n)},this.setPointerMetaTarget=function(e,t,n,i,r){return w.isLibraryRoot(e)||w.isLibraryElement(e)?new Error("Not allowed to modify library elements."):o.setPointerMetaTarget(e,t,n,i,r)},this.delPointerMetaTarget=function(e,t,n){return w.isLibraryRoot(e)||w.isLibraryElement(e)?new Error("Not allowed to modify library elements."):o.delPointerMetaTarget(e,t,n)},this.setPointerMetaLimits=function(e,t,n,i){return w.isLibraryRoot(e)||w.isLibraryElement(e)?new Error("Not allowed to modify library elements."):o.setPointerMetaLimits(e,t,n,i)},this.delPointerMeta=function(e,t){return w.isLibraryRoot(e)||w.isLibraryElement(e)?new Error("Not allowed to modify library elements."):o.delPointerMeta(e,t)},this.setAspectMetaTarget=function(e,t,n){return w.isLibraryRoot(e)||w.isLibraryElement(e)?new Error("Not allowed to modify library elements."):o.setAspectMetaTarget(e,t,n)},this.delAspectMetaTarget=function(e,t,n){return w.isLibraryRoot(e)||w.isLibraryElement(e)?new Error("Not allowed to modify library elements."):o.delAspectMetaTarget(e,t,n)},this.delAspectMeta=function(e,t){return w.isLibraryRoot(e)||w.isLibraryElement(e)?new Error("Not allowed to modify library elements."):o.delAspectMeta(e,t)},this.delMixin=function(e,t){return w.isLibraryRoot(e)||w.isLibraryElement(e)?new Error("Not allowed to modify library elements."):o.delMixin(e,t)},this.addMixin=function(e,t){var n,i=w.getRoot(e);if(w.isLibraryRoot(e)||w.isLibraryElement(e))return new Error("Not allowed to modify library elements.");for(n in i.libraryRoots)if(w.getPath(i.libraryRoots[n])===t)return new Error("Not allowed to use library root as mixin.");return o.addMixin(e,t)},this.clearMixins=function(e){return w.isLibraryRoot(e)||w.isLibraryElement(e)?new Error("Not allowed to modify library elements."):o.clearMixins(e)},this.getLibraryRoot=function(e,t){var n=w.getRoot(e);return n.libraryRoots[t]||null},this.isLibraryElement=function(e){for(var t=w.getParent(e);t;){if(w.isLibraryRoot(t))return!0;t=w.getParent(t)}return!1},this.isLibraryRoot=function(e){return o.getAttribute(e,"_libraryInfo")?!0:!1},this.getNamespace=function(e){var t=a(e);return t&&(t=t.substring(0,t.length-1)),t},this.getFullyQualifiedName=function(t){return e(w.isValidNode(t)),a(t)+w.getAttribute(t,"name")},this.getLibraryGuid=function(t,n){e(w.isValidNode(t));var i;return w.isLibraryElement(t)||w.isLibraryRoot(t)?(i=n?c(t,n):d(t),i?0!==w.getFullyQualifiedName(t).indexOf(w.getFullyQualifiedName(i))?new Error("Node is not a member of the library"):w.isLibraryRoot(t)&&w.getPath(t)===w.getPath(i)?o.getDataGuid(t):o.getDeducedGuid(t,w.getLibraryGuid(w.getParent(t),n)):new Error("Unknown library was given")):new Error("Node is not a library member")},this.addLibrary=function(e,r,s,a){var l=w.getRoot(e),c=i.generateRelid(l.data);return o.setProperty(l,c,s),l.childrenRelids=null,t.call(function(e){return t.call(function(t){var i=w.getMemberPaths(e,n.META_SET_NAME),c=a;if(t.shift(),o.setAttribute(e,"name",r),c.hash=s,o.setAttribute(e,"_libraryInfo",c),t.length>0){o.setBase(w.getBaseRoot(t[0]),w.getFCO(l));var d;for(d=0;d<t.length;d+=1)-1!==i.indexOf(w.getPath(t[d]))&&o.addMember(l,n.META_SET_NAME,t[d])}l.libraryRoots[r]=e},w.loadSubTree(e))},w.loadChild(l,c))},this.updateLibrary=function(e,i,r,s){var a,l={added:{},updated:{},moved:{},removed:{}
},d=w.getRoot(e),u=c(d,i),f=w.getFCO(d);return u?(a=w.getRelid(u),t.call(function(e,c){var h,u,m=[],_=[],b=[];for(u in c)e[u]?e[u].path!==c[u].path&&b.push({from:"/"+a+e[u].path,to:"/"+a+c[u].path}):m.push("/"+a+c[u].path);for(u in e)c[u]||_.push("/"+a+e[u].path);for(h=0;h<_.length;h+=1)p(d,_[h]);for(h=0;h<b.length;h+=1)g(d,b[h].from,b[h].to);return o.setProperty(d,a,r),d=w.removeChildFromCache(d,a),t.call(function(e){return t.call(function(t){var a,c,h=w.getMemberPaths(e,n.META_SET_NAME),p=s;if(t.shift(),o.setAttribute(e,"name",i),p.hash=r,o.setAttribute(e,"_libraryInfo",p),t.length>0)for(c=w.getBaseRoot(t[0]),o.deletePointer(c,"base"),o.setBase(c,f),a=0;a<t.length;a+=1)-1!==m.indexOf(w.getPath(t[a]))&&-1!==h.indexOf(w.getPath(t[a]))&&o.addMember(d,n.META_SET_NAME,t[a]);return d.libraryRoots[i]=e,l},w.loadSubTree(e))},w.loadChild(d,a))},h(u),h(r))):l},this.removeLibrary=function(t,n){e(w.isValidNode(t));var i=w.getRoot(t),r=i.libraryRoots[n];r&&!w.isLibraryElement(r)&&(o.deleteNode(i.libraryRoots[n],!0),delete i.libraryRoots[n])},this.renameLibrary=function(t,i,r){e(w.isValidNode(t));var s=w.getRoot(t);e("string"==typeof i&&"string"==typeof r&&-1===i.indexOf(n.NAMESPACE_SEPARATOR)&&-1===r.indexOf(n.NAMESPACE_SEPARATOR)&&s.libraryRoots[i]),i!==r&&(e(!s.libraryRoots[r],"Library already exists ["+r+"]"),o.setAttribute(s.libraryRoots[i],"name",r),s.libraryRoots[r]=s.libraryRoots[i],delete s.libraryRoots[i])},this.getLibraryNames=function(t){return e(w.isValidNode(t)),Object.keys(w.getRoot(t).libraryRoots)},this.getLibraryMetaNodes=function(e,t,n){var i,o=w.getAllMetaNodes(e),r={};for(i in o)n?w.getNamespace(o[i])===t&&(r[i]=o[i]):0===w.getNamespace(o[i]).indexOf(t)&&(r[i]=o[i]);return r},this.getLibraryInfo=function(e,t){var n=c(e,t);return w.getAttribute(n,"_libraryInfo")},this.getClosureInformation=function(t){e(t.length>0);var i,o,r,s,a,l={hashes:{},selection:{},bases:{},relations:{preserved:{},lost:{}}};for(t=b(t),i=this.getAllMetaNodes(t[0]),a=0;a<t.length;a+=1){if(this.isLibraryElement(t[a])||this.isLibraryRoot(t[a]))return new Error("Cannot select node["+this.getPath(t[a])+"] because it is library content!");if(null===this.getParent(t[a]))return new Error("Cannot select the project root!");l.selection[this.getPath(t[a])]=this.getGuid(t[a]),l.hashes[this.getPath(t[a])]=this.getHash(t[a])}for(a=0;a<t.length;a+=1)for(r=this.getParent(t[a]);this.getPath(r);)_(r,i,l),r=this.getParent(r);for(_(this.getRoot(t[0]),i,l),s=Object.keys(l.selection),a=0;a<s.length;a+=1)l.selection[l.selection[s[a]]]=l.hashes[s[a]],delete l.selection[s[a]];v(l),delete l.hashes,A.debug("Closure creation finished!",l);for(o in l.relations.lost)if(l.relations.lost[o][n.BASE_POINTER])return new Error("Closure cannot be created due to ["+o+"] misses its base ["+l.relations.lost[o][n.BASE_POINTER]+"].");return l},this.importClosure=function(e,t){var r,s,a,l,c=this.getAllMetaNodes(e),d="",h=this.getChildrenRelids(e,!0);if(r=E(c,t))return r;t.relids={},t.parent=this.getPath(e);for(s in t.selection)l=i.generateRelid(h,o.getProperty(e,n.MINIMAL_RELID_LENGTH_PROPERTY)),h[l]=!0,o.setProperty(e,l,t.selection[s]),t.relids[t.selection[s]]=l,l.length>d.length&&(d=l);e.childrenRelids=null,o.processRelidReservation(e,d),P(t);for(s in t.relations.preserved)for(a in t.relations.preserved[s])I(e,s,t.relations.preserved[s][a],a);return A.debug("Closure import finished!",t),t}};return o}),define("common/core/core",["common/core/corerel","common/core/setcore","common/core/guidcore","common/core/nullpointercore","common/core/coreunwrap","common/core/coretype","common/core/constraintcore","common/core/coretree","common/core/metacore","common/core/coretreeloader","common/core/corediff","common/core/metacachecore","common/core/mixincore","common/core/metaquerycore","common/core/librarycore"],function(e,t,n,i,o,r,s,a,l,c,d,h,p,g,u){"use strict";function f(f,m){var _,b=[];b.push(e),b.push(i),b.push(r),b.push(i),b.push(t),b.push(n),b.push(s),b.push(l),b.push(h),b.push(p),b.push(g),b.push(d),b.push(c),b.push(u),"tasync"!==m.usertype&&b.push(o),_=b.reduce(function(e,t){return new t(e,m)},new a(f,m)),this.getParent=_.getParent,this.getRelid=_.getRelid,this.getRoot=_.getRoot,this.getPath=_.getPath,this.getChild=_.getChild,this.isEmpty=_.isEmpty,this.getHash=_.getHash,this.persist=_.persist,this.loadRoot=_.loadRoot,this.loadChild=_.loadChild,this.loadByPath=_.loadByPath,this.loadChildren=_.loadChildren,this.loadOwnChildren=_.loadOwnChildren,this.loadPointer=_.loadPointer,this.loadCollection=_.loadCollection,this.loadSubTree=_.loadSubTree,this.loadOwnSubTree=_.loadOwnSubTree,this.loadTree=_.loadTree,this.getChildrenRelids=_.getChildrenRelids,this.getOwnChildrenRelids=_.getOwnChildrenRelids,this.getChildrenPaths=_.getChildrenPaths,this.getOwnChildrenPaths=_.getOwnChildrenPaths,this.createNode=_.createNode,this.deleteNode=_.deleteNode,this.copyNode=_.copyNode,this.copyNodes=_.copyNodes,this.isValidNewParent=_.isValidNewParent,this.moveNode=_.moveNode,this.getAttributeNames=_.getAttributeNames,this.getAttribute=_.getAttribute,this.setAttribute=_.setAttribute,this.delAttribute=_.delAttribute,this.getRegistryNames=_.getRegistryNames,this.getRegistry=_.getRegistry,this.setRegistry=_.setRegistry,this.delRegistry=_.delRegistry,this.getPointerNames=_.getPointerNames,this.getPointerPath=_.getPointerPath,this.deletePointer=this.delPointer=_.deletePointer,this.setPointer=_.setPointer,this.getCollectionNames=_.getCollectionNames,this.getCollectionPaths=_.getCollectionPaths,this.getChildrenHashes=_.getChildrenHashes,this.getBase=_.getBase,this.getBaseRoot=_.getBaseRoot,this.getOwnAttributeNames=_.getOwnAttributeNames,this.getOwnRegistryNames=_.getOwnRegistryNames,this.getOwnAttribute=_.getOwnAttribute,this.getOwnRegistry=_.getOwnRegistry,this.getOwnPointerNames=_.getOwnPointerNames,this.getOwnPointerPath=_.getOwnPointerPath,this.isValidNewBase=_.isValidNewBase,this.setBase=_.setBase,this.getTypeRoot=_.getTypeRoot,this.getSetNames=_.getSetNames,this.getOwnSetNames=_.getOwnSetNames,this.createSet=_.createSet,this.deleteSet=this.delSet=_.deleteSet,this.getSetAttributeNames=_.getSetAttributeNames,this.getOwnSetAttributeNames=_.getOwnSetAttributeNames,this.getSetAttribute=_.getSetAttribute,this.getOwnSetAttribute=_.getOwnSetAttribute,this.setSetAttribute=_.setSetAttribute,this.delSetAttribute=_.delSetAttribute,this.getSetRegistryNames=_.getSetRegistryNames,this.getOwnSetRegistryNames=_.getOwnSetRegistryNames,this.getSetRegistry=_.getSetRegistry,this.getOwnSetRegistry=_.getOwnSetRegistry,this.setSetRegistry=_.setSetRegistry,this.delSetRegistry=_.delSetRegistry,this.getMemberPaths=_.getMemberPaths,this.getOwnMemberPaths=_.getOwnMemberPaths,this.delMember=_.delMember,this.addMember=_.addMember,this.getMemberAttributeNames=_.getMemberAttributeNames,this.getMemberOwnAttributeNames=_.getMemberOwnAttributeNames,this.getMemberAttribute=_.getMemberAttribute,this.getMemberOwnAttribute=_.getMemberOwnAttribute,this.setMemberAttribute=_.setMemberAttribute,this.delMemberAttribute=_.delMemberAttribute,this.getMemberRegistryNames=_.getMemberRegistryNames,this.getMemberOwnRegistryNames=_.getMemberOwnRegistryNames,this.getMemberRegistry=_.getMemberRegistry,this.getMemberOwnRegistry=_.getMemberOwnRegistry,this.setMemberRegistry=_.setMemberRegistry,this.delMemberRegistry=_.delMemberRegistry,this.isMemberOf=_.isMemberOf,this.getGuid=_.getGuid,this.setGuid=_.setGuid,this.getConstraint=_.getConstraint,this.setConstraint=_.setConstraint,this.delConstraint=_.delConstraint,this.getConstraintNames=_.getConstraintNames,this.getOwnConstraintNames=_.getOwnConstraintNames,this.isTypeOf=_.isTypeOf,this.isValidChildOf=_.isValidChildOf,this.getValidPointerNames=_.getValidPointerNames,this.getValidSetNames=_.getValidSetNames,this.isValidTargetOf=_.isValidTargetOf,this.getValidAttributeNames=_.getValidAttributeNames,this.getOwnValidAttributeNames=_.getOwnValidAttributeNames,this.isValidAttributeValueOf=_.isValidAttributeValueOf,this.getValidAspectNames=_.getValidAspectNames,this.getOwnValidAspectNames=_.getOwnValidAspectNames,this.getAspectMeta=_.getAspectMeta,this.getJsonMeta=_.getJsonMeta,this.getOwnJsonMeta=_.getOwnJsonMeta,this.clearMetaRules=_.clearMetaRules,this.setAttributeMeta=_.setAttributeMeta,this.delAttributeMeta=_.delAttributeMeta,this.getAttributeMeta=_.getAttributeMeta,this.getValidChildrenPaths=_.getValidChildrenPaths,this.getChildrenMeta=_.getChildrenMeta,this.setChildMeta=_.setChildMeta,this.delChildMeta=_.delChildMeta,this.setChildrenMetaLimits=_.setChildrenMetaLimits,this.setPointerMetaTarget=_.setPointerMetaTarget,this.delPointerMetaTarget=_.delPointerMetaTarget,this.setPointerMetaLimits=_.setPointerMetaLimits,this.delPointerMeta=_.delPointerMeta,this.getPointerMeta=_.getPointerMeta,this.setAspectMetaTarget=_.setAspectMetaTarget,this.delAspectMetaTarget=_.delAspectMetaTarget,this.delAspectMeta=_.delAspectMeta,this.getBaseType=this.getMetaType=_.getBaseType,this.isInstanceOf=_.isInstanceOf,this.generateTreeDiff=_.generateTreeDiff,this.applyTreeDiff=_.applyTreeDiff,this.tryToConcatChanges=_.tryToConcatChanges,this.applyResolution=_.applyResolution,this.isAbstract=_.isAbstract,this.isConnection=_.isConnection,this.getValidChildrenMetaNodes=_.getValidChildrenMetaNodes,this.getValidSetElementsMetaNodes=_.getValidSetElementsMetaNodes,this.getAllMetaNodes=_.getAllMetaNodes,this.isMetaNode=_.isMetaNode,this.isFullyOverriddenMember=_.isFullyOverriddenMember,this.getMixinErrors=_.getMixinErrors,this.getMixinPaths=_.getMixinPaths,this.getOwnMixinPaths=_.getOwnMixinPaths,this.getMixinNodes=_.getMixinNodes,this.getOwnMixinNodes=_.getOwnMixinNodes,this.delMixin=_.delMixin,this.addMixin=_.addMixin,this.clearMixins=_.clearMixins,this.getBaseTypes=_.getBaseTypes,this.canSetAsMixin=_.canSetAsMixin,this.addLibrary=_.addLibrary,this.updateLibrary=_.updateLibrary,this.getLibraryNames=_.getLibraryNames,this.getFCO=_.getFCO,this.isLibraryRoot=_.isLibraryRoot,this.isLibraryElement=_.isLibraryElement,this.getNamespace=_.getNamespace,this.getFullyQualifiedName=_.getFullyQualifiedName,this.removeLibrary=_.removeLibrary,this.getLibraryGuid=_.getLibraryGuid,this.renameLibrary=_.renameLibrary,this.getLibraryInfo=_.getLibraryInfo,this.getLibraryRoot=_.getLibraryRoot,this.getLibraryMetaNodes=_.getLibraryMetaNodes,this.traverse=_.traverse,this.getClosureInformation=_.getClosureInformation,this.importClosure=_.importClosure,this.getInstancePaths=_.getInstancePaths,this.loadInstances=_.loadInstances}return f}),define("common/core/coreQ",["common/core/core","q"],function(e,t){"use strict";function n(n,i){var o=this;e.call(o,n,i);var r=this.loadChild;this.loadChild=function(e,n,i){var o=t.defer();return r(e,n,function(e,t){e?o.reject(e instanceof Error?e:new Error(e)):o.resolve(t)}),o.promise.nodeify(i)};var s=this.loadRoot;this.loadRoot=function(e,n){var i=t.defer();return s(e,function(e,t){e?i.reject(e instanceof Error?e:new Error(e)):i.resolve(t)}),i.promise.nodeify(n)};var a=this.loadByPath;this.loadByPath=function(e,n,i){var o=t.defer();return a(e,n,function(e,t){e?o.reject(e instanceof Error?e:new Error(e)):o.resolve(t)}),o.promise.nodeify(i)};var l=this.loadChildren;this.loadChildren=function(e,n){var i=t.defer();return l(e,function(e,t){e?i.reject(e instanceof Error?e:new Error(e)):i.resolve(t)}),i.promise.nodeify(n)};var c=this.loadOwnChildren;this.loadOwnChildren=function(e,n){var i=t.defer();return c(e,function(e,t){e?i.reject(e instanceof Error?e:new Error(e)):i.resolve(t)}),i.promise.nodeify(n)};var d=this.loadPointer;this.loadPointer=function(e,n,i){var o=t.defer();return d(e,n,function(e,t){e?o.reject(e instanceof Error?e:new Error(e)):o.resolve(t)}),o.promise.nodeify(i)};var h=this.loadCollection;this.loadCollection=function(e,n,i){var o=t.defer();return h(e,n,function(e,t){e?o.reject(e instanceof Error?e:new Error(e)):o.resolve(t)}),o.promise.nodeify(i)};var p=this.loadSubTree;this.loadSubTree=function(e,n){var i=t.defer();return p(e,function(e,t){e?i.reject(e instanceof Error?e:new Error(e)):i.resolve(t)}),i.promise.nodeify(n)};var g=this.loadOwnSubTree;this.loadOwnSubTree=function(e,n){var i=t.defer();return g(e,function(e,t){e?i.reject(e instanceof Error?e:new Error(e)):i.resolve(t)}),i.promise.nodeify(n)};var u=this.loadTree;this.loadTree=function(e,n){var i=t.defer();return u(e,function(e,t){e?i.reject(e instanceof Error?e:new Error(e)):i.resolve(t)}),i.promise.nodeify(n)};var f=this.applyTreeDiff;this.applyTreeDiff=function(e,n,i){var o=t.defer();return f(e,n,function(e,t){e?o.reject(e instanceof Error?e:new Error(e)):o.resolve(t)}),o.promise.nodeify(i)};var m=this.generateTreeDiff;this.generateTreeDiff=function(e,n,i){var o=t.defer();return m(e,n,function(e,t){e?o.reject(e instanceof Error?e:new Error(e)):o.resolve(t)}),o.promise.nodeify(i)};var _=this.setGuid;this.setGuid=function(e,n,i){var o=t.defer();return _(e,n,o.resolve),o.promise.nodeify(i)};var b=this.addLibrary;this.addLibrary=function(e,n,i,o,r){var s=t.defer();return b(e,n,i,o,s.resolve),s.promise.nodeify(r)};var y=this.updateLibrary;this.updateLibrary=function(e,n,i,o,r,s){var a=t.defer();return y(e,n,i,o,r,function(e,t){e?a.reject(e):a.resolve(t)}),a.promise.nodeify(s)};var v=this.traverse;this.traverse=function(e,n,i,o){var r=t.defer();return v(e,n,i,function(e,t){e?r.reject(e):r.resolve(t)}),r.promise.nodeify(o)};var C=this.loadInstances;this.loadInstances=function(e,n){var i=t.defer();return C(e,function(e,t){e?i.reject(e instanceof Error?e:new Error(e)):i.resolve(t)}),i.promise.nodeify(n)}}return n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n}),define("js/client/constants",["common/storage/constants","common/core/constants"],function(e,t){"use strict";return{STORAGE:e,CORE:t,BRANCH_STATUS:e.BRANCH_STATUS,UNCAUGHT_EXCEPTION:"UNCAUGHT_EXCEPTION",NETWORK_STATUS_CHANGED:"NETWORK_STATUS_CHANGED",BRANCH_STATUS_CHANGED:"BRANCH_STATUS_CHANGED",BRANCH_CHANGED:"BRANCH_CHANGED",PROJECT_CLOSED:"PROJECT_CLOSED",PROJECT_OPENED:"PROJECT_OPENED",UNDO_AVAILABLE:"UNDO_AVAILABLE",REDO_AVAILABLE:"REDO_AVAILABLE",NOTIFICATION:"NOTIFICATION",CONNECTED_USERS_CHANGED:"CONNECTED_USERS_CHANGED",META_RULES_RESULT:"META_RULES_RESULT",CONSTRAINT_RESULT:"CONSTRAINT_RESULT"}}),define("common/util/guid",[],function(){"use strict";var e=function(){var e=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()};return e}),define("js/RegistryKeys",[],function(){"use strict";return{COLOR:"color",TEXT_COLOR:"textColor",BORDER_COLOR:"borderColor",POSITION:"position",ROTATION:"rotation",DECORATOR:"decorator",IS_PORT:"isPort",IS_ABSTRACT:"isAbstract",REPLACEABLE:"replaceable",LINE_STYLE:"lineStyle",LINE_TYPE:"lineType",LINE_WIDTH:"lineWidth",LINE_START_ARROW:"lineStartArrow",LINE_END_ARROW:"lineEndArrow",LINE_CUSTOM_POINTS:"lineCustomPoints",LINE_LABEL_PLACEMENT:"lineLabel",VALID_PLUGINS:"validPlugins",USED_ADDONS:"usedAddOns",VALID_VISUALIZERS:"validVisualizers",VALID_DECORATORS:"validDecorators",PROJECT_REGISTRY:"ProjectRegistry",DISPLAY_FORMAT:"DisplayFormat",SVG_ICON:"SVGIcon",PORT_SVG_ICON:"PortSVGIcon",TREE_ITEM_COLLAPSED_ICON:"TreeItemCollapsedIcon",TREE_ITEM_EXPANDED_ICON:"TreeItemExpandedIcon",META_SHEETS:"MetaSheets",CROSSCUTS:"CrossCuts",DIAGRAM_DESIGNER_WIDGET_DECORATOR_DISABLED_CONNECTION_AREAS:"diagramDesignerWidgetDecoratorDisabledConnectionAreas_"}}),define("js/client/gmeNodeGetter",["js/RegistryKeys"],function(e){"use strict";function t(e,t,n){var i=n?n:"";console.warn('"gmeNode.'+e+'" is deprecated and will eventually be removed, use "gmeNode.'+t+'" instead.'+i)}function n(e,t){return e[t]&&e[t].node}function i(e,t,n,i){this._id=e,this._logger=t,this._state=n,this._storeNode=i}function o(e,t,n,o){return n.nodes[e]?new i(e,t,n,o):null}return i.prototype.getParentId=function(){return this._storeNode(this._state.core.getParent(this._state.nodes[this._id].node))},i.prototype.getId=function(){return this._id},i.prototype.getRelid=function(){return this._state.core.getRelid(this._state.nodes[this._id].node)},i.prototype.getGuid=function(){return this._state.core.getGuid(this._state.nodes[this._id].node)},i.prototype.getChildrenIds=function(){return this._state.core.getChildrenPaths(this._state.nodes[this._id].node)},i.prototype.getChildrenRelids=function(){return this._state.core.getChildrenRelids(this._state.nodes[this._id].node)},i.prototype.getBaseId=function(){var e=this._state.core.getBase(this._state.nodes[this._id].node);return e?this._storeNode(e):null},i.prototype.isValidNewBase=function(e){var t;return"string"==typeof e?(t=n(this._state.nodes,e),t?this._state.core.isValidNewBase(this._state.nodes[this._id].node,t):!1):void 0===e||null===e?!0:!1},i.prototype.isValidNewParent=function(e){var t;return"string"==typeof e?(t=n(this._state.nodes,e),t?this._state.core.isValidNewParent(this._state.nodes[this._id].node,t):!1):!1},i.prototype.getInheritorIds=function(){return[]},i.prototype.getAttribute=function(e){return this._state.core.getAttribute(this._state.nodes[this._id].node,e)},i.prototype.getOwnAttribute=function(e){return this._state.core.getOwnAttribute(this._state.nodes[this._id].node,e)},i.prototype.getEditableAttribute=function(e){var t=this._state.core.getAttribute(this._state.nodes[this._id].node,e);return"object"==typeof t?JSON.parse(JSON.stringify(t)):t},i.prototype.getOwnEditableAttribute=function(e){var t=this._state.core.getOwnAttribute(this._state.nodes[this._id].node,e);return"object"==typeof t?JSON.parse(JSON.stringify(t)):t},i.prototype.getRegistry=function(e){return this._state.core.getRegistry(this._state.nodes[this._id].node,e)},i.prototype.getOwnRegistry=function(e){return this._state.core.getOwnRegistry(this._state.nodes[this._id].node,e)},i.prototype.getEditableRegistry=function(e){var t=this._state.core.getRegistry(this._state.nodes[this._id].node,e);return"object"==typeof t?JSON.parse(JSON.stringify(t)):t},i.prototype.getOwnEditableRegistry=function(e){var t=this._state.core.getOwnRegistry(this._state.nodes[this._id].node,e);return"object"==typeof t?JSON.parse(JSON.stringify(t)):t},i.prototype.getPointer=function(e){return"base"===e?{to:this._state.core.getPath(this._state.core.getBase(this._state.nodes[this._id].node)),from:[]}:{to:this._state.core.getPointerPath(this._state.nodes[this._id].node,e),from:[]}},i.prototype.getPointerId=function(e){return this.getPointer(e).to},i.prototype.getOwnPointer=function(e){return{to:this._state.core.getOwnPointerPath(this._state.nodes[this._id].node,e),from:[]}},i.prototype.getOwnPointerId=function(e){return this.getOwnPointer(e).to},i.prototype.getPointerNames=function(){return this._state.core.getPointerNames(this._state.nodes[this._id].node)},i.prototype.getOwnPointerNames=function(){return this._state.core.getOwnPointerNames(this._state.nodes[this._id].node)},i.prototype.getAttributeNames=function(){return this._state.core.getAttributeNames(this._state.nodes[this._id].node)},i.prototype.getValidAttributeNames=function(){return this._state.core.getValidAttributeNames(this._state.nodes[this._id].node)},i.prototype.getOwnAttributeNames=function(){return this._state.core.getOwnAttributeNames(this._state.nodes[this._id].node)},i.prototype.getOwnValidAttributeNames=function(){return this._state.core.getOwnValidAttributeNames(this._state.nodes[this._id].node)},i.prototype.getAttributeMeta=function(e){return this._state.core.getAttributeMeta(this._state.nodes[this._id].node,e)},i.prototype.getRegistryNames=function(){return this._state.core.getRegistryNames(this._state.nodes[this._id].node)},i.prototype.getOwnRegistryNames=function(){return this._state.core.getOwnRegistryNames(this._state.nodes[this._id].node)},i.prototype.getMemberIds=function(e){return this._state.core.getMemberPaths(this._state.nodes[this._id].node,e)},i.prototype.getSetNames=function(){return this._state.core.getSetNames(this._state.nodes[this._id].node)},i.prototype.getMemberAttributeNames=function(e,t){return this._state.core.getMemberAttributeNames(this._state.nodes[this._id].node,e,t)},i.prototype.getMemberAttribute=function(e,t,n){return this._state.core.getMemberAttribute(this._state.nodes[this._id].node,e,t,n)},i.prototype.getEditableMemberAttribute=function(e,t,n){var i=this._state.core.getMemberAttribute(this._state.nodes[this._id].node,e,t,n);return null!==i&&void 0!==i?JSON.parse(JSON.stringify(i)):null},i.prototype.getMemberRegistryNames=function(e,t){return this._state.core.getMemberRegistryNames(this._state.nodes[this._id].node,e,t)},i.prototype.getMemberRegistry=function(e,t,n){return this._state.core.getMemberRegistry(this._state.nodes[this._id].node,e,t,n)},i.prototype.getEditableMemberRegistry=function(e,t,n){var i=this._state.core.getMemberRegistry(this._state.nodes[this._id].node,e,t,n);return null!==i&&void 0!==i?JSON.parse(JSON.stringify(i)):null},i.prototype.getSetRegistry=function(e,t){return this._state.core.getSetRegistry(this._state.nodes[this._id].node,e,t)},i.prototype.getSetRegistryNames=function(e){return this._state.core.getSetRegistryNames(this._state.nodes[this._id].node,e)},i.prototype.getSetAttribute=function(e,t){return this._state.core.getSetAttribute(this._state.nodes[this._id].node,e,t)},i.prototype.getSetAttributeNames=function(e){return this._state.core.getSetAttributeNames(this._state.nodes[this._id].node,e)},i.prototype.getValidChildrenTypes=function(){return t("getValidChildrenTypes()","getValidChildrenIds()"),this.getValidChildrenIds()},i.prototype.getValidAttributeNames=function(){return this._state.core.getValidAttributeNames(this._state.nodes[this._id].node)},i.prototype.isValidAttributeValueOf=function(e,t){return this._state.core.isValidAttributeValueOf(this._state.nodes[this._id].node,e,t)},i.prototype.getValidPointerNames=function(){return this._state.core.getValidPointerNames(this._state.nodes[this._id].node)},i.prototype.getValidSetNames=function(){return this._state.core.getValidSetNames(this._state.nodes[this._id].node)},i.prototype.getConstraintNames=function(){return this._state.core.getConstraintNames(this._state.nodes[this._id].node)},i.prototype.getOwnConstraintNames=function(){return this._state.core.getOwnConstraintNames(this._state.nodes[this._id].node)},i.prototype.getConstraint=function(e){return this._state.core.getConstraint(this._state.nodes[this._id].node,e)},i.prototype.toString=function(){return this._state.core.getAttribute(this._state.nodes[this._id].node,"name")+" ("+this._id+")"},i.prototype.getCollectionPaths=function(e){return this._state.core.getCollectionPaths(this._state.nodes[this._id].node,e)},i.prototype.getInstancePaths=function(){return this._state.core.getInstancePaths(this._state.nodes[this._id].node)},i.prototype.getJsonMeta=function(){return this._state.core.getJsonMeta(this._state.nodes[this._id].node)},i.prototype.isConnection=function(){return this._state.core.isConnection(this._state.nodes[this._id].node)},i.prototype.isAbstract=function(){return this._state.core.isAbstract(this._state.nodes[this._id].node)},i.prototype.isLibraryRoot=function(){return this._state.core.isLibraryRoot(this._state.nodes[this._id].node)},i.prototype.isLibraryElement=function(){return this._state.core.isLibraryElement(this._state.nodes[this._id].node)},i.prototype.getFullyQualifiedName=function(){return this._state.core.getFullyQualifiedName(this._state.nodes[this._id].node)},i.prototype.getNamespace=function(){return this._state.core.getNamespace(this._state.nodes[this._id].node)},i.prototype.getLibraryGuid=function(){return this._state.core.getLibraryGuid(this._state.nodes[this._id].node)},i.prototype.getCrosscutsInfo=function(){return this._state.core.getRegistry(this._state.nodes[this._id].node,e.CROSSCUTS)||[]},i.prototype.getValidChildrenTypesDetailed=function(e,t){var n,i,o,r={node:this._state.nodes[this._id].node,children:[],sensitive:!t,multiplicity:!1,aspect:e},s={},a=this.getChildrenIds();for(o=0;o<a.length;o++)this._state.nodes[a[o]]&&r.children.push(this._state.nodes[a[o]].node);for(n=this._state.core.getValidChildrenMetaNodes(r),r.multiplicity=!0,i=this._state.core.getValidChildrenMetaNodes(r),o=0;o<n.length;o+=1)s[this._state.core.getPath(n[o])]=!1;for(o=0;o<i.length;o+=1)s[this._state.core.getPath(i[o])]=!0;return s},i.prototype.getValidSetMemberTypesDetailed=function(e){var t,n,i,o={node:this._state.nodes[this._id].node,children:[],sensitive:!0,multiplicity:!1,name:e},r={},s=this.getChildrenIds();for(i=0;i<s.length;i++)this._state.nodes[s[i]]&&o.children.push(this._state.nodes[s[i]].node);for(t=this._state.core.getValidSetElementsMetaNodes(o),o.multiplicity=!0,n=this._state.core.getValidSetElementsMetaNodes(o),i=0;i<t.length;i+=1)r[this._state.core.getPath(t[i])]=!1;for(i=0;i<n.length;i+=1)r[this._state.core.getPath(n[i])]=!0;return r},i.prototype.getMetaTypeId=i.prototype.getBaseTypeId=function(){var e=this._state.core.getMetaType(this._state.nodes[this._id].node);return e?this._storeNode(e):null},i.prototype.isMetaNode=function(){return this._state.core.isMetaNode(this._state.nodes[this._id].node)},i.prototype.isTypeOf=function(e){var t=n(this._state.nodes,e);return t?this._state.core.isTypeOf(this._state.nodes[this._id].node,t):!1},i.prototype.isValidChildOf=function(e){var t=this._state.nodes[e].node;return t?this._state.core.isValidChildOf(this._state.nodes[this._id].node,t):!1},i.prototype.getValidChildrenIds=function(){return this._state.core.getValidChildrenPaths(this._state.nodes[this._id].node)},i.prototype.isValidTargetOf=function(e,t){var i=n(this._state.nodes,e);return i?this._state.core.isValidTargetOf(this._state.nodes[this._id].node,i,t):!1},i.prototype.getValidAspectNames=function(){return this._state.core.getValidAspectNames(this._state.nodes[this._id].node)},i.prototype.getOwnValidAspectNames=function(){return this._state.core.getOwnValidAspectNames(this._state.nodes[this._id].node)},i.prototype.getAspectMeta=function(e){return this._state.core.getAspectMeta(this._state.nodes[this._id].node,e)},i.prototype.getMixinPaths=function(){return this._state.core.getMixinPaths(this._state.nodes[this._id].node)},i.prototype.canSetAsMixin=function(e){return this._state.core.canSetAsMixin(this._state.nodes[this._id].node,e)},i.prototype.isReadOnly=function(){return this._state.readOnlyProject||this._state.viewer||this.isLibraryRoot()||this.isLibraryElement()},o}),define("js/client/gmeNodeSetter",[],function(){"use strict";function e(e,t,n,i,o){function r(e,t,n,i){var o=n?"gmeNode.":"gmeClient.",r=i?i:"";console.warn('"gmeClient.'+e+'" is deprecated and will eventually be removed, use "'+o+t+'" instead.'+r)}function s(e){return t.core&&t.nodes[e]&&"object"==typeof t.nodes[e].node?t.nodes[e].node:void 0}function a(e,n){var i;if(n=n||{},n.attributes)for(i in n.attributes)n.attributes.hasOwnProperty(i)&&t.core.setAttribute(e,i,n.attributes[i]);if(n.registry)for(i in n.registry)n.registry.hasOwnProperty(i)&&t.core.setRegistry(e,i,n.registry[i])}function l(e,n){var o,r,s,a,l,c,d,h,p,g={},u=function(){var n,i=!0;for(n=0;n<e.length;n+=1)i=i&&t.nodes[e[n]]&&"object"==typeof t.nodes[e[n]].node;return i};if(n&&u()){for(l={},c={},r=t.core.createNode({parent:t.core.getRoot(n),base:t.core.getTypeRoot(t.nodes[e[0]].node)}),s=t.core.createNode({parent:r}),o=0;o<e.length;o+=1)l[e[o]]={},l[e[o]].origparent=t.core.getParent(t.nodes[e[o]].node),l[e[o]].tempnode=t.core.moveNode(t.nodes[e[o]].node,s),c[t.core.getRelid(l[e[o]].tempnode)]=e[o],delete t.nodes[e[o]];for(a=t.core.copyNode(s,r),o=0;o<e.length;o+=1)l[e[o]].node=t.core.moveNode(l[e[o]].tempnode,l[e[o]].origparent),i(l[e[o]].node);for(d=t.core.getChildrenRelids(a),o=0;o<d.length;o+=1)c[d[o]]?(h=t.core.getChild(a,d[o]),p=t.core.moveNode(h,n),i(p),g[c[t.core.getRelid(h)]]=p):t.logger.error(new Error("Unexpected error when copying nodes!"));t.core.deleteNode(r)}return g}function c(e,i,r,a){var l,c=s(e);if(c){if(l=t.core.setAttribute(c,i,r),l instanceof Error)return void o(l);n(a||"setAttribute("+e+","+i+","+JSON.stringify(r)+")")}}function d(e,i,r){var a,l=s(e);if(l){if(a=t.core.delAttribute(l,i),a instanceof Error)return void o(a);n(r||"delAttribute("+e+","+i+")")}}function h(e,i,r,a){var l,c=s(e);if(c){if(l=t.core.setRegistry(c,i,r),l instanceof Error)return void o(l);n(a||"setRegistry("+e+","+i+","+JSON.stringify(r)+")")}}function p(e,i,r){var a,l=s(e);if(l){if(a=t.core.delRegistry(l,i),a instanceof Error)return void o(a);n(r||"delRegistry("+e+","+i+")")}}function g(e,r,l,c){var d,h=s(e),p=s(r);return h&&p?(d=t.core.copyNode(h,p),d instanceof Error?void o(d):(a(d,l),i(d),n(c||"copyNode("+e+", "+r+", "+JSON.stringify(l)+")"),t.core.getPath(d))):void 0}function u(e,i){var r,c,d=[],h=s(e.parentId);if(h){for(r in e)e.hasOwnProperty(r)&&"parentId"!==r&&d.push(r);if(i=i||"copyMoreNodes("+JSON.stringify(d)+","+e.parentId+")",d.length<1);else if(1===d.length)g(d[0],e.parentId,e[d[0]],i);else{if(c=l(d,h),c instanceof Error)return void o(c);for(r in c)c.hasOwnProperty(r)&&e[r]&&a(c[r],e[r]);n(i)}}else t.logger.error("wrong parameters for copy operation - denied -")}function f(e,o){var r,s,l=[],c={};for(r in e)e.hasOwnProperty(r)&&"parentId"!==r&&l.push(r);if(l.length>0&&"string"==typeof e.parentId&&t.nodes[e.parentId]&&"object"==typeof t.nodes[e.parentId].node)for(r=0;r<l.length;r+=1)t.nodes[l[r]]&&"object"==typeof t.nodes[l[r]].node&&(s=t.core.moveNode(t.nodes[l[r]].node,t.nodes[e.parentId].node),c[l[r]]=t.core.getPath(s),a(s,e[l[r]]),delete t.nodes[l[r]],i(s,!0));return n(o||"moveMoreNodes("+JSON.stringify(c)+")"),c}function m(e,o){var r,s,l,c,d,h,p={},g=[],u=[],f=t.nodes[e.parentId].node,m=[],_=[];for(g=Object.keys(e),g.splice(g.indexOf("parentId"),1),l=0;l<g.length;l++){for(r=t.nodes[g[l]].node,u.push(r),h={},s=t.core.getPointerNames(r),d=s.indexOf("base"),-1!==d&&s.splice(d,1),c=0;c<s.length;c++)d=g.indexOf(t.core.getPointerPath(r,s[c])),-1!==d&&(h[s[c]]=d);_.push(h)}for(l=0;l<u.length;l++)m.push(t.core.createNode({parent:f,base:u[l]}));for(l=0;l<g.length;l++){for(a(m[l],e[g[l]]),s=Object.keys(_[l]),c=0;c<s.length;c++)t.core.setPointer(m[l],s[c],m[_[l][s[c]]]);p[g[l]]=i(m[l])}return o=o||"createChildren("+JSON.stringify(p)+")",n(o),p}function _(e,i){var o=s(e);o&&(t.core.deleteNode(o),n(i||"deleteNode("+e+")"))}function b(e,i){var o,r,a=!1;for(o=0;o<e.length;o++)r=s(e[o]),r&&(t.core.deleteNode(r),a=!0);a&&n(i||"deleteNodes("+e+")")}function y(e,r,l){var c,d,h=s(e.parentId),p=s(e.baseId);if(h){if(c=t.core.createNode({parent:h,base:p,guid:e.guid,relid:e.relid}),c instanceof Error)return void o(c);r=r||{},r.registry=r.registry||{},r.registry.position=r.registry.position||{},r.registry.position.x=r.registry.position.x||100,r.registry.position.y=r.registry.position.y||100,a(c,r),i(c),d=t.core.getPath(c),n(l||"createNode("+e.parentId+","+e.baseId+","+d+")")}return d}function v(e,i,o,r){var a,l=s(e);l&&(null===o?t.core.setPointer(l,i,o):(a=s(o),t.core.setPointer(l,i,a)),n(r||"setPointer("+e+","+i+","+o+")"))}function C(e,i,o){var r=s(e);r&&(t.core.delPointer(r,i),n(o||"delPointer("+e+","+i+")"))}function E(e,i,o,r){var a=s(e),l=s(i);a&&l&&(t.core.addMember(a,o,l),n(r||"addMember("+e+","+i+","+o+")"))}function D(e,i,o,r){var a=s(e);a&&(t.core.delMember(a,o,i),n(r||"removeMember("+e+","+i+","+o+")"))}function I(e,i,o,r,a,l){var c=s(e);c&&(t.core.setMemberAttribute(c,o,i,r,a),n(l||"setMemberAttribute("+e+","+i+","+o+","+r+","+a+")"))}function T(e,i,o,r,a){var l=s(e);l&&(t.core.delMemberAttribute(l,o,i,r),n(a||"delMemberAttribute("+e+","+i+","+o+","+r+")"))}function P(e,i,o,r,a,l){var c=s(e);c&&(t.core.setMemberRegistry(c,o,i,r,a),n(l||"setMemberRegistry("+e+","+i+","+o+","+r+","+JSON.stringify(a)+")"))}function N(e,i,o,r,a){var l=s(e);l&&(t.core.delMemberRegistry(l,o,i,r),n(a||"delMemberRegistry("+e+","+i+","+o+","+r+")"))}function A(e,i,o,r,a){var l=s(e);l&&(t.core.setSetAttribute(l,i,o,r),n(a||"setSetAttribute("+e+","+i+","+o+","+JSON.stringify(r)+")"))}function w(e,i,o,r){var a=s(e);a&&(t.core.delSetAttribute(a,i,o),n(r||"delSetAttribute("+e+","+i+","+o+")"))}function O(e,i,o,r,a){var l=s(e);l&&(t.core.setSetRegistry(l,i,o,r),
n(a||"setSetRegistry("+e+","+i+","+o+","+JSON.stringify(r)+")"))}function S(e,i,o,r){var a=s(e);a&&(t.core.delSetRegistry(a,i,o),n(r||"delSetRegistry("+e+","+i+","+o+")"))}function x(e,i,o){var r=s(e);r&&(t.core.createSet(r,i),n(o||"createSet("+e+","+i+")"))}function M(e,i,r){var a,l=s(e);if(l){if(a=t.core.delSet(l,i),a instanceof Error)return void o(a);n(r||"delSet("+e+","+i+")")}}function R(e,i,r){var a,l=s(e),c=s(i);if(l&&c){if(a=t.core.setBase(l,c),a instanceof Error)return void o(a);n(r||"setBase("+e+","+i+")")}}function L(e,i,r){var a,l=s(e),c=s(i);if(l&&c){if(a=t.core.moveNode(l,c),a instanceof Error)return void o(a);n(r||"moveNode("+e+","+i+")")}}function k(e,i){var r,a=s(e);if(a){if(r=t.core.setBase(a,null),r instanceof Error)return void o(r);n(i||"delBase("+e+")")}}function j(e){var n=s(e),i={children:{},attributes:{},pointers:{},aspects:{}};return n?i=t.core.getJsonMeta(n):null}function G(e,i,r){var a,l,c,d,h=s(e);if(h){if(t.core.clearMetaRules(h),i.children&&i.children.items&&i.children.items.length>0){if(d=t.core.setChildrenMetaLimits(h,i.children.min,i.children.max),d instanceof Error)return void o(d);for(c=0;c<i.children.items.length;c+=1)if(a=s(i.children.items[c]),a&&(d=t.core.setChildMeta(h,a,i.children.minItems[c],i.children.maxItems[c]),d instanceof Error))return void o(d)}if(i.attributes)for(c in i.attributes)if(d=t.core.setAttributeMeta(h,c,i.attributes[c]),d instanceof Error)return void o(d);if(i.pointers)for(l in i.pointers)if(i.pointers[l].items&&i.pointers[l].items.length>0){if(d=t.core.setPointerMetaLimits(h,l,i.pointers[l].min,i.pointers[l].max),d instanceof Error)return void o(d);for(c=0;c<i.pointers[l].items.length;c+=1)if(a=s(i.pointers[l].items[c]),a&&(d=t.core.setPointerMetaTarget(h,l,a,i.pointers[l].minItems[c],i.pointers[l].maxItems[c]),d instanceof Error))return void o(d)}if(i.aspects)for(l in i.aspects)for(c=0;c<i.aspects[l].length;c+=1)if(a=s(i.aspects[l][c]),a&&(d=t.core.setAspectMetaTarget(h,l,a),d instanceof Error))return void o(d);if(i.constraints)for(l in i.constraints)if("object"==typeof i.constraints[l]&&(d=t.core.setConstraint(h,l,i.constraints[l]),d instanceof Error))return void o(d);n(r||"setMeta("+e+")")}}function B(e,i,r){var a,l=s(e);if(l){if(a=t.core.addMixin(l,i),a instanceof Error)return void o(a);n(r||"addMixin("+e+","+i+")")}}function W(e,i,r){var a,l=s(e);if(l){if(a=t.core.delMixin(l,i),a instanceof Error)return void o(a);n(r,"delMixin("+e+","+i+")")}}function $(e,t,n,i){if("items"!==t){var o=j(e);o.children[t]=n,G(e,o,i)}}function F(e,i,r,a,l){var c,d=s(e),h=s(i);if(h&&d){if(c=t.core.setChildMeta(d,h,r,a),c instanceof Error)return void o(c);n(l||"setChildMeta("+e+", "+i+","+r||"-1,"+a||"-1)")}}function z(e,i,r){var a,l,c,d=s(e);if(i&&i.items&&d){for(c=0;c<i.items.length;c+=1)if(a=s(i.items[c].id),a&&(l=t.core.setChildMeta(d,a,i.items[c].min,i.items[c].max),l instanceof Error))return void o(l);if(l=t.core.setChildrenMetaLimits(d,i.min,i.max),l instanceof Error)return void o(l);n(r||"Meta.setChildrenMeta("+e+")")}}function V(e,i,r){var a,l=s(e);if(l){if(a=t.core.delChildMeta(l,i),a instanceof Error)return void o(a);n(r||"delChildMeta("+e+", "+i+")")}}function H(e,i,r,a){var l,c=s(e);if(c){if(l=t.core.setAttributeMeta(c,i,r),l instanceof Error)return void o(l);n(a||"setAttributeMeta("+e+", "+i+")")}}function U(e,i,r){var a,l=s(e);if(l){if(a=t.core.delAttributeMeta(l,i),a instanceof Error)return void o(a);n(r||"delAttributeMeta("+e+", "+i+")")}}function Y(e,i,r,a,l,c){var d,h=s(e),p=s(r);if(h&&p){if(d=t.core.setPointerMetaTarget(h,i,p,a,l),d instanceof Error)return void o(d);n(c||"setPointerMetaTarget("+e+", "+i+", "+r+","+a||"-1,"+l||"-1)")}}function J(e,i,r,a){var l,c=s(e);if(c){if(l=t.core.delPointerMetaTarget(c,i,r),l instanceof Error)return void o(l);n(a||"delPointerMetaTarget("+e+", "+i+", "+r+")")}}function X(e,i,r){var a,l=s(e);if(l){if(a=t.core.delPointerMeta(l,i),a instanceof Error)return void o(a);n(r||"delPointerMeta("+e+", "+i+")")}}function K(e,i,r,a){var l,c,d,h=s(e);if(r&&r.items&&h){for(d=0;d<r.items.length;d+=1)if(l=s(r.items[d].id),l&&(c=t.core.setPointerMetaTarget(h,i,l,r.items[d].min,r.items[d].max),c instanceof Error))return void o(c);if(c=t.core.setPointerMetaLimits(h,i,r.min,r.max),c instanceof Error)return void o(c);n(a||"setPointerMeta("+e+", "+i+")")}}function Z(e,i,r,a){var l,c=s(e),d=s(r);if(c&&d){if(l=t.core.setAspectMetaTarget(c,i,d),l instanceof Error)return void o(l);n(a||"setAspectMetaTarget("+e+", "+i+","+r+")")}}function q(e,i,r,a){var l,c=s(e);if(c){if(l=t.core.delAspectMetaTarget(c,i,r),l instanceof Error)return void o(l);n(a||"delAspectMeta("+e+", "+i+")")}}function Q(e,i,r,a){var l,c,d,h=s(e);if(h){if(d=t.core.delAspectMeta(h,i),d instanceof Error)return void o(d);for(l=0;l<r.length;l+=1)if(c=s(r[l]),c&&(d=t.core.setAspectMetaTarget(h,i,c),d instanceof Error))return void o(d);n(a||"setAspectMetaTargets("+e+", "+i+","+JSON.stringify(r)+")")}}function ee(e,i,r){var a,l=s(e);if(l){if(a=t.core.delAspectMeta(l,i),a instanceof Error)return void o(a);n(r||"delAspectMeta("+e+", "+i+")")}}function te(e,n){var i=s(e),o=s(n);return i&&o?t.core.isTypeOf(i,o):!1}function ne(e,n,i){var o=s(e),r=s(i);return o&&r?t.core.isValidTargetOf(r,o,n):!1}function ie(e,t,n){for(var i=[],o=0;o<n.length;o++)ne(e,t,n[o])&&i.push(n[o]);return i}function oe(e,n){var i,o,r=s(e),a=[];if(r){i=t.core.getPointerMeta(r,n);for(o in i)"min"!==o&&"max"!==o&&a.push(o)}return a}function re(e,n){var i,o=s(e);return o?(i=t.core.getOwnJsonMeta(o),i.pointers=i.pointers||{},i.pointers[n]=i.pointers[n]||{},i.pointers[n].items||[]):[]}function se(e,n,i){var o,r,a,l=s(e),c=[];if(l&&(o=t.core.getPointerMeta(l,n),r=i?t.core.getOwnJsonMeta(l):t.core.getJsonMeta(l),r=r&&r.pointers&&r.pointers[n]?r.pointers[n].items||[]:[],o&&r.length>0)){delete o.min,delete o.max;for(a in o)-1!==r.indexOf(a)&&c.push({id:a,min:-1===o[a].min?void 0:o[a].min,max:-1===o[a].max?void 0:o[a].max});return c}return null}function ae(e,t){return se(e,t,!1)}function le(e,t){return se(e,t,!0)}function ce(e,n){var i=s(n),o=s(e);return i&&o?t.core.isValidChildOf(i,o):!1}function de(e){var n=s(e);return n?t.core.getValidChildrenPaths(n):[]}function he(e){var n=s(e);return n?t.core.getValidAttributeNames(n):[]}function pe(e){var n=s(e);return n?t.core.getOwnValidAttributeNames(n):[]}function ge(e,n){var i,o,r,a=s(e);if(a&&(i=t.core.getPointerMeta(a,n))){r={min:i.min,max:i.max,items:[]};for(o in i)"min"!==o&&"max"!==o&&r.items.push({id:o,min:-1===i[o].min?void 0:i[o].min,max:-1===i[o].max?void 0:i[o].max});return r}return null}function ue(e,n){var i=s(e);return i?t.core.getAttributeMeta(i,n):void 0}function fe(e){var n=s(e);return n?t.core.getValidAspectNames(n):[]}function me(e){var n=s(e);return n?t.core.getOwnValidAspectNames(n):[]}function _e(e,n){var i,o=s(e);return o&&(i=t.core.getAspectMeta(o,n))?{items:i}:null}function be(e){var n,i,o=s(e);if(o){if(n=t.core.getOwnJsonMeta(o),n.children&&n.children.items&&n.children.items.length>0)return!0;for(i in n.pointers||{})return!0;for(i in n.attributes||{})return!0;for(i in n.aspects||{})return!0;if(n.mixins&&n.mixins.length>0)return!0}return!1}function ye(e){var n,i,o=s(e),r={items:[]};if(o){if(n=t.core.getChildrenMeta(o)){r={min:n.min,max:n.max,items:[]};for(i in n)"min"!==i&&"max"!==i&&r.items.push({id:i,min:-1===n[i].min?void 0:n[i].min,max:-1===n[i].max?void 0:n[i].max})}return r}return null}function ve(e){var t=ye(e);return t?t.attrName:null}function Ce(e){var t=ye(e);return t?t.items:null}function Ee(e){var n,i=s(e);return i&&(n=t.core.getOwnJsonMeta(i),n&&n.children&&n.children.items)?n.children.items:[]}function De(e,t){var n=_e(e,t);return null!==n?(n.children=1,n):null}return{setAttribute:c,setAttributes:function(){r("setAttributes","setAttribute"),c.apply(null,arguments)},delAttribute:d,delAttributes:function(){r("delAttributes","delAttribute"),d.apply(null,arguments)},setRegistry:h,delRegistry:p,copyNode:g,copyMoreNodes:u,moveNode:L,moveMoreNodes:f,deleteNode:_,deleteNodes:b,delMoreNodes:function(){r("delMoreNodes","deleteNodes"),b.apply(null,arguments)},createNode:y,createChild:function(e,t){return y(e,{registry:{position:e.position}},t)},createChildren:m,setPointer:v,makePointer:function(){r("makePointer","setPointer"),v.apply(null,arguments)},delPointer:C,deletePointer:C,addMember:E,removeMember:D,setMemberAttribute:I,delMemberAttribute:T,setMemberRegistry:P,delMemberRegistry:N,setSetAttribute:A,delSetAttribute:w,setSetRegistry:O,delSetRegistry:S,createSet:x,delSet:M,deleteSet:M,setBase:R,delBase:k,setMeta:G,setChildrenMeta:z,setChildrenMetaAttribute:$,setChildMeta:F,updateValidChildrenItem:function(e,t,n){r("updateValidChildrenItem(path, newTypeObj, msg)","setChildMeta(path, childPath, min, max, msg)"),t=t||{},F(e,t.id,t.min,t.max,n)},delChildMeta:V,removeValidChildrenItem:function(){r("removeValidChildrenItem","delChildMeta"),V.apply(null,arguments)},setAttributeMeta:H,setAttributeSchema:function(){r("setAttributeSchema","setAttributeMeta"),H.apply(null,arguments)},delAttributeMeta:U,removeAttributeSchema:function(){r("removeAttributeSchema","delAttributeMeta"),U.apply(null,arguments)},setPointerMeta:K,setPointerMetaTarget:Y,updateValidTargetItem:function(e,t,n,i){r("updateValidTargetItem(path, name, targetObj, msg)","setPointerMetaTarget(path, name, targetPath, childPath, min, max, msg)"),n=n||{},Y(e,t,n.id,n.min,n.max,i)},delPointerMetaTarget:J,removeValidTargetItem:function(){r("removeValidTargetItem","delPointerMetaTarget"),J.apply(null,arguments)},delPointerMeta:X,deleteMetaPointer:function(){r("deleteMetaPointer","delPointerMeta"),X.apply(null,arguments)},setAspectMetaTarget:Z,setAspectMetaTargets:Q,setMetaAspect:function(){r("setMetaAspect","setAspectMetaTargets"),Q.apply(null,arguments)},delAspectMetaTarget:q,delAspectMeta:ee,deleteMetaAspect:function(){r("deleteMetaAspect","delAspectMeta"),ee.apply(null,arguments)},addMixin:B,delMixin:W,getMeta:function(){return r("getMeta(path)","getJsonMeta()",!0),j.apply(null,arguments)},isTypeOf:function(){return te.apply(null,arguments)},isValidTarget:function(){return r("isValidTarget(path, name, targetPath)","isValidTargetOf(sourcePath, name)",!0),ne.apply(null,arguments)},filterValidTarget:function(){return ie.apply(null,arguments)},getValidTargetTypes:function(){return oe.apply(null,arguments)},getOwnValidTargetTypes:function(){return re.apply(null,arguments)},getValidTargetItems:function(){return ae.apply(null,arguments)},getOwnValidTargetItems:function(){return le.apply(null,arguments)},getPointerMeta:function(){return ge.apply(null,arguments)},isValidChild:function(){return r("isValidChild(path, childPath)","isValidChildOf(parentPath)",!0),ce.apply(null,arguments)},getValidChildrenTypes:function(){return r("getValidChildrenTypes(path)","getValidChildrenIds()",!0),de.apply(null,arguments)},getValidAttributeNames:function(){return r("getValidAttributeNames(path)","getValidAttributeNames()",!0),he.apply(null,arguments)},getOwnValidAttributeNames:function(){return r("getOwnValidAttributeNames(path)","getOwnValidAttributeNames()",!0),pe.apply(null,arguments)},getAttributeSchema:function(){return r("getAttributeSchema(path, name)","getAttributeMeta(name)",!0),ue.apply(null,arguments)},getMetaAspectNames:function(){return r("getMetaAspectNames(path)","getValidAspectNames()",!0),fe.apply(null,arguments)},getOwnMetaAspectNames:function(){return r("getOwnMetaAspectNames(path)","getOwnValidAspectNames()",!0),me.apply(null,arguments)},getMetaAspect:function(){return r("getMetaAspect(path, name)","getAspectMeta(name)",!0," Returned value is of different structure! {items: meta} vs meta"),_e.apply(null,arguments)},hasOwnMetaRules:function(){return be.apply(null,arguments)},getChildrenMeta:function(){return ye.apply(null,arguments)},getChildrenMetaAttribute:function(){return ve.apply(null,arguments)},getValidChildrenItems:function(){return Ce.apply(null,arguments)},getOwnValidChildrenTypes:function(){return Ee.apply(null,arguments)},getAspectTerritoryPattern:function(){return De.apply(null,arguments)}}}return e}),define("common/Constants",["common/core/constants"],function(e){"use strict";return{TERRITORY_EVENT_LOAD:"load",TERRITORY_EVENT_UPDATE:"update",TERRITORY_EVENT_UNLOAD:"unload",TERRITORY_EVENT_COMPLETE:"complete",TERRITORY_EVENT_INCOMPLETE:"incomplete",GME_ID:"GME_ID",PROJECT_ROOT_ID:"",PROJECT_FCO_ID:"FCO_ID",PROJECT_FCO_GUID:"cd891e7b-e2ea-e929-f6cd-9faf4f1fc045",PROJECT_FCO_RELID:"1",PROJECT_ROOT_NAME:"ROOT",POINTER_SOURCE:"src",POINTER_TARGET:"dst",POINTER_BASE:"base",POINTER_CONSTRAINED_BY:"constrainedby",RELATION_CONTAINMENT:"containment",CORE:e}}),define("js/Constants",["underscore","common/Constants","js/client/constants"],function(e,t,n){"use strict";var i={};return _.extend(i,t,{ALL_OVER_THE_SCREEN_DRAGGABLE_PARENT_ID:"body",META_INFO:"metaInfo",DRAG_SOURCE:"dragSource",LINE_STYLE:{WIDTH:"width",COLOR:"color",PATTERN:"pattern",PATTERNS:{SOLID:"",DASH:"-",LONGDASH:"- ",DOT:".",DASH_DOT:"-.",DASH_DOT_DOT:"-.."},TYPE:"type",TYPES:{NONE:"",BEZIER:"bezier"},START_ARROW:"start-arrow",END_ARROW:"end-arrow",CUSTOM_POINTS:"custom-points",LABEL_PLACEMENT:"label-placement",LABEL_PLACEMENTS:{SRC:"src",MIDDLE:"mid",DST:"dst"},LINE_ARROWS:{NONE:"none",DIAMOND:"diamond",BLOCK:"block",CLASSIC:"classic",OPEN:"open",OVAL:"oval",DIAMOND2:"diamond2",INHERITANCE:"inheritance"}},DISPLAY_FORMAT_ATTRIBUTE_MARKER:"$",ASSETS_DECORATOR_SVG_FOLDER:"assets/DecoratorSVG/",STATE_ACTIVE_OBJECT:"activeObject",STATE_ACTIVE_SELECTION:"activeSelection",STATE_ACTIVE_ASPECT:"activeAspect",STATE_ACTIVE_VISUALIZER:"activeVisualizer",STATE_ACTIVE_PROJECT_NAME:"activeProjectName",STATE_ACTIVE_COMMIT:"activeCommit",STATE_ACTIVE_BRANCH_NAME:"activeBranchName",STATE_ACTIVE_CROSSCUT:"activeCrosscut",STATE_ACTIVE_TAB:"activeTab",STATE_SUPPRESS_VISUALIZER_FROM_NODE:"suppressVisualizerFromNode",STATE_LAYOUT:"layout",ASPECT_ALL:"All",PROPERTY_GROUP_META:"META",PROPERTY_GROUP_PREFERENCES:"Preferences",PROPERTY_GROUP_ATTRIBUTES:"Attributes",PROPERTY_GROUP_POINTERS:"Pointers",DEFAULT_VISUALIZER:"ModelEditor",VISUALIZER_PANEL_IDENTIFIER:"VISUALIZER_PANEL_IDENTIFIER"}),i.CLIENT=n,i}),define("js/client/libraries",["js/Constants"],function(e){"use strict";function t(t,n,i,o){function r(){return n.core&&n.nodes[e.PROJECT_ROOT_ID]&&"object"==typeof n.nodes[e.PROJECT_ROOT_ID].node?n.core.getLibraryNames(n.nodes[e.PROJECT_ROOT_ID].node):[]}function s(t){return n.core&&n.nodes[e.PROJECT_ROOT_ID]&&"object"==typeof n.nodes[e.PROJECT_ROOT_ID].node?n.core.getLibraryInfo(n.nodes[e.PROJECT_ROOT_ID].node,t)||null:null}function a(e,o,r){var s={command:"addLibrary",projectId:n.project.projectId,libraryName:e,branchName:n.branchName};"string"==typeof o?s.blobHash=o:s.libraryInfo=o,i.simpleRequest(s,function(e,n){e&&t.error(e),r(e,n)})}function l(e,o,r){var s={command:"updateLibrary",projectId:n.project.projectId,libraryName:e,branchName:n.branchName};"string"==typeof o?s.blobHash=o:o&&(s.libraryInfo=o),i.simpleRequest(s,function(e,n){e&&t.error(e),r(e,n)})}function c(t){n.core.removeLibrary(n.nodes[e.PROJECT_ROOT_ID].node,t),o("removeLibrary("+t+")")}function d(t,i){n.core.renameLibrary(n.nodes[e.PROJECT_ROOT_ID].node,t,i),o("renameLibrary("+t+","+i+")")}function h(e,i){var o,r;return n.nodes[e]?(r=s(n.core.getFullyQualifiedName(n.nodes[e].node)))?r.projectId?(o=window.location.origin+"/?project="+encodeURIComponent(r.projectId),r.branchName&&i?o+="&branch="+encodeURIComponent(r.branchName):r.commitHash&&(o+="&commit="+encodeURIComponent(r.commitHash)),window.open(o,"_blank"),void window.focus()):void t.warn("the library has only partial info"):void t.warn("the library has no valid info"):void t.warn("only cached libraries can be followed!")}return{getLibraryNames:r,addLibrary:a,updateLibrary:l,removeLibrary:c,renameLibrary:d,getLibraryInfo:s,openLibraryOriginInNewWindow:h}}return t}),define("blob/BlobConfig",[],function(){"use strict";var e={hashMethod:"sha1",hashRegex:new RegExp("^[0-9a-f]{40}$")};return e}),define("blob/BlobMetadata",["blob/BlobConfig"],function(e){"use strict";var t=function(n){var i;if(!n)throw new Error("metadata parameter is not defined");if(this.name=n.name,this.size=n.size||0,this.mime=n.mime||"",this.isPublic=n.isPublic||!1,this.tags=n.tags||[],this.content=n.content,this.contentType=n.contentType||t.CONTENT_TYPES.OBJECT,this.contentType===t.CONTENT_TYPES.COMPLEX)for(i in this.content)if(this.content.hasOwnProperty(i)&&e.hashRegex.test(this.content[i].content)===!1)throw new Error("BlobMetadata is malformed: hash '"+this.content[i].content+"'is invalid")};return t.CONTENT_TYPES={OBJECT:"object",COMPLEX:"complex",SOFT_LINK:"softLink"},t.prototype.serialize=function(){var e={name:this.name,size:this.size,mime:this.mime,isPublic:this.isPublic,tags:this.tags,content:this.content,contentType:this.contentType};if(e.tags.sort(),this.contentType===t.CONTENT_TYPES.COMPLEX){e.content={};var n=Object.keys(this.content);n.sort();for(var i=0;i<n.length;i+=1)e.content[n[i]]=this.content[n[i]]}return e},t}),define("blob/Artifact",["blob/BlobMetadata","blob/BlobConfig","common/core/tasync","q"],function(e,t,n,i){"use strict";var o=function(e,t,i){this.name=e,this.blobClient=t,this.blobClientPutFile=n.unwrap(n.throttle(n.wrap(t.putFile),5)),this.blobClientGetMetadata=n.unwrap(n.throttle(n.wrap(t.getMetadata),5)),this.descriptor=i||{name:e+".zip",size:0,mime:"application/zip",content:{},contentType:"complex"}};return o.prototype.addFile=function(e,t,n){var o=this,r=e.substring(e.lastIndexOf("/")+1),s=i.defer();return o.blobClientPutFile.call(o.blobClient,r,t,function(t,n){return t?void s.reject(t):void o.addObjectHash(e,n,function(e,t){return e?void s.reject(e):void s.resolve(t)})}),s.promise.nodeify(n)},o.prototype.addFileAsSoftLink=function(e,t,n){var o=i.defer(),r=this,s=e.substring(e.lastIndexOf("/")+1);return r.blobClientPutFile.call(r.blobClient,s,t,function(n,i){if(n)return void o.reject(n);var s;void 0!==t.size&&(s=t.size),void 0!==t.length&&(s=t.length),r.addMetadataHash(e,i,s).then(o.resolve)["catch"](o.reject)}),o.promise.nodeify(n)},o.prototype.addObjectHash=function(n,o,r){var s=this,a=i.defer();return t.hashRegex.test(o)===!1?a.reject("Blob hash is invalid"):s.blobClientGetMetadata.call(s.blobClient,o,function(t,i){return t?void a.reject(t):void(s.descriptor.content.hasOwnProperty(n)?a.reject(new Error("Another content with the same name was already added. "+JSON.stringify(s.descriptor.content[n]))):(s.descriptor.size+=i.size,s.descriptor.content[n]={content:i.content,contentType:e.CONTENT_TYPES.OBJECT},a.resolve(o)))}),a.promise.nodeify(r)},o.prototype.addMetadataHash=function(n,o,r,s){var a=this,l=i.defer(),c=function(t){a.descriptor.content.hasOwnProperty(n)?l.reject(new Error("Another content with the same name was already added. "+JSON.stringify(a.descriptor.content[n]))):(a.descriptor.size+=t,a.descriptor.content[n]={content:o,contentType:e.CONTENT_TYPES.SOFT_LINK},l.resolve(o))};return"function"==typeof r&&(s=r,r=void 0),t.hashRegex.test(o)===!1?l.reject(new Error("Blob hash is invalid")):void 0===r?a.blobClientGetMetadata.call(a.blobClient,o,function(e,t){return e?void l.reject(e):void c(t.size)}):c(r),l.promise.nodeify(s)},o.prototype.addFiles=function(e,t){var n=this,o=Object.keys(e);return i.all(o.map(function(t){return n.addFile(t,e[t])})).nodeify(t)},o.prototype.addFilesAsSoftLinks=function(e,t){var n=this,o=Object.keys(e);return i.all(o.map(function(t){return n.addFileAsSoftLink(t,e[t])})).nodeify(t)},o.prototype.addObjectHashes=function(e,t){var n=this,o=Object.keys(e);return i.all(o.map(function(t){return n.addObjectHash(t,e[t])})).nodeify(t)},o.prototype.addMetadataHashes=function(e,t){var n=this,o=Object.keys(e);return i.all(o.map(function(t){return n.addMetadataHash(t,e[t])})).nodeify(t)},o.prototype.save=function(e){var t=i.defer();return this.blobClient.putMetadata(this.descriptor,function(e,n){e?t.reject(e):t.resolve(n)}),t.promise.nodeify(e)},o}),define("common/util/uint",[],function(){"use strict";function e(e){var t,n="";for(t=0;t<e.byteLength;t++)n+=String.fromCharCode(e[t]);return decodeURIComponent(escape(n))}return{uint8ArrayToString:e}}),define("blob/BlobClient",["blob/Artifact","blob/BlobMetadata","superagent","q","common/util/uint"],function(e,t,n,i,o){"use strict";var r=function(e){var t=this;if(this.artifacts=[],e&&e.logger)this.logger=e.logger;else{var n=function(){console.log.apply(console,arguments)};this.logger={debug:n,log:n,info:n,warn:n,error:n},console.warn("Since v1.3.0 BlobClient requires a logger, falling back on console.log.")}e&&e.uploadProgressHandler?this.uploadProgressHandler=e.uploadProgressHandler:this.uploadProgressHandler=function(e,n){t.logger.debug("File upload of",e,n.percent,"%")},this.logger.debug("ctor",{metadata:e}),e?(this.server=e.server||this.server,this.serverPort=e.serverPort||this.serverPort,this.httpsecure=void 0!==e.httpsecure?e.httpsecure:this.httpsecure,this.webgmeToken=e.webgmeToken,this.keepaliveAgentOptions=e.keepaliveAgentOptions||{}):this.keepaliveAgentOptions={},this.origin="",void 0!==this.httpsecure&&this.server&&this.serverPort&&(this.origin=(this.httpsecure?"https://":"http://")+this.server+":"+this.serverPort),this.relativeUrl="/rest/blob/",this.blobUrl=this.origin+this.relativeUrl,this.isNodeOrNodeWebKit="undefined"!=typeof process,this.isNodeOrNodeWebKit&&(this.logger.debug("Running under node or node-web-kit"),this.httpsecure?this.Agent=require("agentkeepalive").HttpsAgent:this.Agent=require("agentkeepalive"),this.keepaliveAgentOptions.hasOwnProperty("ca")===!1&&(this.keepaliveAgentOptions.ca=require("https").globalAgent.options.ca),this.keepaliveAgent=new this.Agent(this.keepaliveAgentOptions)),this.logger.debug("origin",this.origin),this.logger.debug("blobUrl",this.blobUrl)};return r.prototype.getMetadataURL=function(e){return this.origin+this.getRelativeMetadataURL(e)},r.prototype.getRelativeMetadataURL=function(e){var t=this.relativeUrl+"metadata";return e?t+"/"+e:t},r.prototype._getURL=function(e,t,n){var i="";return n&&(i=n),this.relativeUrl+e+"/"+t+"/"+encodeURIComponent(i)},r.prototype.getViewURL=function(e,t){return this.origin+this.getRelativeViewURL(e,t)},r.prototype.getRelativeViewURL=function(e,t){return this._getURL("view",e,t)},r.prototype.getDownloadURL=function(e,t){return this.origin+this.getRelativeDownloadURL(e,t)},r.prototype.getRelativeDownloadURL=function(e,t){return this._getURL("download",e,t)},r.prototype.getCreateURL=function(e,t){return this.origin+this.getRelativeCreateURL(e,t)},r.prototype.getRelativeCreateURL=function(e,t){return t?this.relativeUrl+"createMetadata/":this.relativeUrl+"createFile/"+encodeURIComponent(e)},r.prototype.putFile=function(e,t,o){function r(e){for(var t=new ArrayBuffer(e.length),n=new Uint8Array(t),i=0;i<e.length;++i)n[i]=e[i];return t}var s,a,l=i.defer(),c=this;return this.logger.debug("putFile",e),"undefined"!=typeof window&&"undefined"!=typeof Buffer&&t instanceof Buffer&&(t=r(t)),"undefined"==typeof window&&"undefined"!=typeof Buffer&&t instanceof Buffer&&0===t.length&&(t=""),s=t.hasOwnProperty("length")?t.length:t.byteLength,a=n.post(this.getCreateURL(e)),"undefined"==typeof window&&a.agent(this.keepaliveAgent),this.webgmeToken&&a.set("Authorization","Bearer "+this.webgmeToken),"string"==typeof t||t instanceof String||"undefined"!=typeof window||a.set("Content-Length",s),a.set("Content-Type","application/octet-stream").send(t).on("progress",function(t){c.uploadProgressHandler(e,t)}).end(function(e,t){if(e||t.status>399)return void l.reject(e||new Error(t.status));var n=t.body,i=Object.keys(n)[0];c.logger.debug("putFile - result",i),l.resolve(i)}),l.promise.nodeify(o)},r.prototype.putMetadata=function(e,o){var r,s,a,l=new t(e),c=i.defer(),d=this;return this.logger.debug("putMetadata",{metadata:e}),"undefined"!=typeof Blob?(r=new Blob([JSON.stringify(l.serialize(),null,4)],{type:"text/plain"}),s=r.size):(r=new Buffer(JSON.stringify(l.serialize(),null,4),"utf8"),s=r.length),a=n.post(this.getCreateURL(e.name,!0)),this.webgmeToken&&a.set("Authorization","Bearer "+this.webgmeToken),"undefined"==typeof window&&(a.agent(this.keepaliveAgent),a.set("Content-Length",s)),a.set("Content-Type","application/octet-stream").send(r).end(function(e,t){if(e||t.status>399)return void c.reject(e||new Error(t.status));var n=JSON.parse(t.text),i=Object.keys(n)[0];d.logger.debug("putMetadata - result",i),c.resolve(i)}),c.promise.nodeify(o)},r.prototype.putFiles=function(e,t){var n,o,r=this,s=i.defer(),a=Object.keys(e),l=a.length,c={};0===l&&s.resolve(c),o=function(e,t){r.putFile(e,t,function(t,i){l-=1,c[e]=i,t&&(n=t,r.logger.error("putFile failed with error",{metadata:t})),0===l&&(n?s.reject(n):s.resolve(c))})};for(var d=0;d<a.length;d+=1)o(a[d],e[a[d]]);return s.promise.nodeify(t)},r.prototype.getSubObject=function(e,t,n){return this.getObject(e,n,t)},r.prototype.getObject=function(e,t,r){var s=i.defer(),a=this;this.logger.debug("getObject",e,r),n.parse["application/zip"]=function(e,t){return t?void 0:e};var l=n.get(this.getViewURL(e,r));if(this.webgmeToken&&l.set("Authorization","Bearer "+this.webgmeToken),"undefined"==typeof window&&l.agent(this.keepaliveAgent),l.pipe){var c=require("stream").Writable,d=function(e){c.call(this,e);var t=this;t.buffers=[]};require("util").inherits(d,c),d.prototype._write=function(e,t,n){this.buffers.push(e),n()};var h=new d;h.on("finish",function(){l.req.res.statusCode>399?s.reject(new Error(l.req.res.statusCode)):s.resolve(Buffer.concat(h.buffers))}),h.on("error",function(e){s.reject(e)}),l.pipe(h)}else l.removeAllListeners("end"),l.on("request",function(){"undefined"!=typeof this.xhr&&(this.xhr.responseType="arraybuffer")}),l.on("end",function(){if(l.xhr.status>399)s.reject(new Error(l.xhr.status));else{var e=l.xhr.getResponseHeader("content-type"),t=l.xhr.response;"application/json"===e&&(t=JSON.parse(o.uint8ArrayToString(new Uint8Array(t)))),a.logger.debug("getObject - result",{metadata:t}),s.resolve(t)}}),l.end(function(e,t){e?s.reject(e):(a.logger.debug("getObject - result",{metadata:t}),s.resolve(t))});return s.promise.nodeify(t)},r.prototype.getObjectAsString=function(e,t){var n=this;return n.getObject(e).then(function(e){if("string"==typeof e)return e;if("undefined"!=typeof Buffer&&e instanceof Buffer)return o.uint8ArrayToString(new Uint8Array(e));if(e instanceof ArrayBuffer)return o.uint8ArrayToString(new Uint8Array(e));if(null!==e&&"object"==typeof e)return JSON.stringify(e);throw new Error("Unknown content encountered: "+e)}).nodeify(t)},r.prototype.getObjectAsJSON=function(e,t){var n=this;return n.getObject(e).then(function(e){if("string"==typeof e)return JSON.parse(e);if("undefined"!=typeof Buffer&&e instanceof Buffer)return JSON.parse(o.uint8ArrayToString(new Uint8Array(e)));if(e instanceof ArrayBuffer)return JSON.parse(o.uint8ArrayToString(new Uint8Array(e)));if(null!==e&&"object"==typeof e)return e;throw new Error("Unknown content encountered: "+e)}).nodeify(t)},r.prototype.getMetadata=function(e,t){var o=n.get(this.getMetadataURL(e)),r=i.defer(),s=this;return this.logger.debug("getMetadata",e),this.webgmeToken&&o.set("Authorization","Bearer "+this.webgmeToken),"undefined"==typeof window&&o.agent(this.keepaliveAgent),o.end(function(e,t){e||t.status>399?r.reject(e||new Error(t.status)):(s.logger.debug("getMetadata",t.text),r.resolve(JSON.parse(t.text)))}),r.promise.nodeify(t)},r.prototype.createArtifact=function(t){var n=new e(t,this);return this.artifacts.push(n),n},r.prototype.getArtifact=function(n,o){var r=this,s=i.defer();return this.logger.debug("getArtifact",n),this.getMetadata(n,function(n,i){if(n)return void s.reject(n);if(r.logger.debug("getArtifact - return",{metadata:i}),i.contentType===t.CONTENT_TYPES.COMPLEX){var o=new e(i.name,r,i);r.artifacts.push(o),s.resolve(o)}else s.reject(new Error("not supported contentType "+JSON.stringify(i,null,4)))}),s.promise.nodeify(o)},r.prototype.saveAllArtifacts=function(e){for(var t=[],n=0;n<this.artifacts.length;n+=1)t.push(this.artifacts[n].save());return i.all(t).nodeify(e)},r.prototype.getHumanSize=function(e,t){var n=t?1e3:1024,i=t?["kB","MB","GB","TB","PB","EB","ZB","YB"]:["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],o=-1;if(n>e)return e+" B";do e/=n,o+=1;while(e>=n);return e.toFixed(1)+" "+i[o]},r}),define("js/Utils/SaveToDisk",["blob/BlobClient"],function(e){"use strict";function t(e,t){if(window.ActiveXObject){if(window.ActiveXObject&&document.execCommand){var n=window.open(e,"_self");n.document.close(),n.document.execCommand("SaveAs",!0,t||e),n.close()}}else{var i=document.createElement("a"),o=document.createEvent("Event");i.href=e,i.target="_self",t&&(i.download=t),o.initEvent("click",!0,!0),i.dispatchEvent(o),(window.URL||window.webkitURL).revokeObjectURL(i.href)}}function n(e,t){var n=document.createElement("a");n.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(t)),n.setAttribute("download",e),n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)}function i(t,n,i,o){var r=new e({logger:i}),s=r.createArtifact("uploaded");s.addFile(t,JSON.stringify(n,null,4),function(e,t){o(e,r.getDownloadURL(t))})}function o(e,n,o,r){i(e,n,o,function(n,i){return n?r(n):(t(i,e),void r(null,i))})}return{saveToBlobStorage:i,saveUrlToDisk:t,saveJsonToDisk:o,downloadTextAsFile:n}}),define("js/client/stateloghelpers",["js/Utils/SaveToDisk"],function(e){"use strict";function t(e,t){var n,i,o,r;if("project"===e)return t?t.name:null;if("core"===e)return t?"instantiated":"notInstantiated";if("metaNodes"===e)return Object.keys(t);if("nodes"===e)return Object.keys(t);if("loadNodes"===e)return Object.keys(t);if("users"===e)return Object.keys(t);if("rootObject"!==e){if("undoRedoChain"===e&&t){for(r={previous:null,next:null},t.previous&&(i={},r.previous=i),n=t;n.previous;)i.previous={commitHash:n.commitHash,previous:null},i=i.previous,n=n.previous;for(t.next&&(o={},r.next=o),n=t;n.next;)o.next={commitHash:n.commitHash,next:null},o=o.next,n=n.next;return r}return t}}function n(e,n,i,o){return o=o||0,i===!0?JSON.stringify(n,t,o):JSON.stringify({connection:e.getNetworkStatus(),projectId:e.getActiveProjectId(),branchName:e.getActiveBranchName(),branchStatus:e.getBranchStatus(),commitHash:e.getActiveCommitHash(),rootHash:e.getActiveRootHash(),projectReadOnly:e.isProjectReadOnly(),commitReadOnly:e.isCommitReadOnly()},null,o)}function i(t,i){var o={timestamp:(new Date).toISOString(),webgme:{NpmVersion:"n/a",version:"n/a",GitHubVersion:"n/a"},gmeConfig:t.gmeConfig,uiState:null,branchErrors:[],browserInfo:{appCodeName:window.navigator.appCodeName,appName:window.navigator.appName,appVersion:window.navigator.appVersion,onLine:window.navigator.onLine,cookieEnabled:window.navigator.cookieEnabled,platform:window.navigator.platform,product:window.navigator.product,userAgent:window.navigator.userAgent},clientState:JSON.parse(n(t,i,!0))};"undefined"!=typeof WebGMEGlobal&&(o.webgme.NpmVersion=WebGMEGlobal.NpmVersion,o.webgme.GitHubVersion=WebGMEGlobal.GitHubVersion,o.webgme.version=WebGMEGlobal.version),"function"==typeof t.uiStateGetter?o.uiState=t.uiStateGetter():o.uiState="Client did not have an attached uiStateGetter.",i.project&&i.branchName&&i.project.branches[i.branchName]&&i.project.branches[i.branchName].errorList.forEach(function(e){o.branchErrors.push({message:e.message,stack:e.stack})}),e.downloadTextAsFile("webgme-client-dump.json",JSON.stringify(o,null,2))}function o(t,n){var i={webgmeVersion:t.getConnectedStorageVersion(),projectId:t.getActiveProjectId(),branchName:t.getActiveBranchName(),branchStatus:t.getBranchStatus(),commitQueue:n};e.downloadTextAsFile("commit-queue-dump.json",JSON.stringify(i,null,2))}return{downloadStateDump:i,getStateLogString:n,downloadCommitQueue:o}}),define("plugin/PluginNodeDescription",[],function(){"use strict";var e=function(e){var t,n;if(this.name="",this.id="",e)for(t=Object.keys(e),n=0;n<t.length;n+=1)this[t[n]]=e[t[n]]};return e.prototype.serialize=function(){var e,t=Object.keys(this),n={};for(e=0;e<t.length;e+=1)n[t[e]]=this[t[e]];
return n},e}),define("plugin/PluginMessage",["plugin/PluginNodeDescription"],function(e){"use strict";var t=function(t){t?(this.commitHash=t.commitHash,t.activeNode instanceof e?this.activeNode=t.activeNode:this.activeNode=new e(t.activeNode),this.message=t.message,t.severity?this.severity=t.severity:this.severity="info"):(this.commitHash="",this.activeNode=new e,this.message="",this.severity="info")};return t.prototype.serialize=function(){var e={commitHash:this.commitHash,activeNode:this.activeNode.serialize(),message:this.message,severity:this.severity};return e},t}),define("plugin/PluginResult",["plugin/PluginMessage"],function(e){"use strict";var t=function(t){var n,i;if(t)for(this.success=t.success,this.pluginName=t.pluginName,this.startTime=t.startTime,this.finishTime=t.finishTime,this.messages=[],this.artifacts=t.artifacts,this.error=t.error,this.commits=t.commits,this.projectId=t.projectId,i=0;i<t.messages.length;i+=1)n=t.messages[i]instanceof e?t.messages[i]:new e(t.messages[i]),this.messages.push(n);else this.success=!1,this.messages=[],this.artifacts=[],this.pluginName="PluginName N/A",this.startTime=null,this.finishTime=null,this.error=null,this.projectId=null,this.commits=[]};return t.prototype.getSuccess=function(){return this.success},t.prototype.setSuccess=function(e){this.success=e},t.prototype.getMessages=function(){return this.messages},t.prototype.addMessage=function(e){this.messages.push(e)},t.prototype.getArtifacts=function(){return this.artifacts},t.prototype.addArtifact=function(e){this.artifacts.push(e)},t.prototype.addCommit=function(e){this.commits.push(e)},t.prototype.getPluginName=function(){return this.pluginName},t.prototype.setPluginName=function(e){this.pluginName=e},t.prototype.setProjectId=function(e){this.projectId=e},t.prototype.getStartTime=function(){return this.startTime},t.prototype.setStartTime=function(e){this.startTime=e},t.prototype.getFinishTime=function(){return this.finishTime},t.prototype.setFinishTime=function(e){this.finishTime=e},t.prototype.getError=function(){return this.error},t.prototype.setError=function(e){e instanceof Error?this.error=e.message:this.error=e},t.prototype.serialize=function(){var e,t={success:this.success,projectId:this.projectId,messages:[],commits:this.commits,artifacts:this.artifacts,pluginName:this.pluginName,startTime:this.startTime,finishTime:this.finishTime,error:this.error};for(e=0;e<this.messages.length;e+=1)t.messages.push(this.messages[e].serialize());return t},t}),define("plugin/util",["q"],function(e){"use strict";function t(t,n,i,o,r,s){var a={commitHash:i,rootHash:null,rootNode:null,activeNode:null,activeSelection:null,META:{}};return e.ninvoke(t,"loadObject",i).then(function(e){return a.rootHash=e.root,o.debug("commitObject loaded"),n.loadRoot(a.rootHash)}).then(function(e){return a.rootNode=e,o.debug("rootNode loaded"),n.loadByPath(a.rootNode,r.activeNode||"")}).then(function(t){return a.activeNode=t,o.debug("activeNode loaded"),r.activeSelection=r.activeSelection||[],e.all(r.activeSelection.map(function(e){return n.loadByPath(a.rootNode,e)}))}).then(function(e){function t(e,t){return 0===e.indexOf(t)}var i,s,l,c,d=n.getAllMetaNodes(a.rootNode),h=n.getLibraryNames(a.rootNode);if(a.activeSelection=e,o.debug("activeSelection loaded"),r.namespace){if(-1===h.indexOf(r.namespace))throw new Error('Given namespace does not exist among the available: "'+h+'".');for(c in d)s=n.getNamespace(d[c]),i=n.getAttribute(d[c],"name"),t(s,r.namespace)&&(s=s.substring(r.namespace.length+1),s?a.META[s+"."+i]=d[c]:a.META[i]=d[c])}else for(c in d)l=n.getFullyQualifiedName(d[c]),a.META[l]&&o.error("Meta-nodes share the same full name. Will still proceed..",l),a.META[l]=d[c];return a}).nodeify(s)}return{loadNodesAtCommitHash:t}}),define("plugin/managerbase",["common/core/coreQ","plugin/PluginResult","plugin/PluginMessage","plugin/util","common/storage/project/interface","common/storage/util","q"],function(e,t,n,i,o,r,s){"use strict";function a(a,l,c,d){function h(e,t){var n=s.defer(),i=!1,o="plugin/"+e+"/"+e+"/"+e;return g.serverSide&&!d.plugin.allowServerExecution?(n.reject(new Error("Plugin execution on server side is disabled from gmeConfig.")),i=!0):g.browserSide&&!d.plugin.allowBrowserExecution?(n.reject(new Error("Plugin execution in browser is disabled from gmeConfig.")),i=!0):g.logger.debug("Running as CLI - does not respect gmeConfig.plugin.allowServerExecution.."),i===!1&&requirejs([o],function(e){g.logger.debug("requirejs plugin from path: "+o),n.resolve(e)},function(e){n.reject(e)}),n.promise.nodeify(t)}function p(e,t){return t?e.getBranchHash(t):s(null)}var g=this;this.logger=c.fork("PluginManagerBase"),this.notificationHandlers=[],this.projectAccess={read:!0,write:!0,"delete":!0},this.blobClient=a,this.executePlugin=function(e,t,n,i){var o;g.initializePlugin(e).then(function(e){return o=e,g.configurePlugin(o,t,n)}).then(function(){g.runPluginMain(o,i)})["catch"](function(t){var n=g.getPluginErrorResult(e,"Exception was raised, err: "+t.stack,o&&o.projectId);g.logger.error(t.stack),i(t.message,n)})},this.initializePlugin=function(e,t){return h(e).then(function(t){var n,i=g.logger.fork("plugin:"+e);return n=new t,n.initialize(i,g.blobClient,d),n}).nodeify(t)},this.configurePlugin=function(e,t,n,i){var r,a=s.defer(),c=this,d=e.getDefaultConfig(),h={},p={},g=[];if(n.project=n.project||l,n.project instanceof o==!1)a.reject(new Error("project is not an instance of ProjectInterface, pass it via context or set it in the constructor of PluginManagerBase."));else if(e.pluginMetadata.writeAccessRequired===!0&&c.projectAccess.write===!1)a.reject(new Error("Plugin requires write access to the project for execution!"));else{e.pluginMetadata.configStructure.forEach(function(e){e.writeAccessRequired===!0&&c.projectAccess.write===!1&&(h[e.name]=!0),e.readOnly===!0&&(p[e.name]=!0)}),t=t||{};for(r in t)(p[r]||h[r])&&t.hasOwnProperty(r)&&t[r]!==d[r]&&g.push(r),d[r]=t[r];g.length>0?a.reject(new Error('User not allowed to modify configuration parameter(s): "'+g+'".')):(e.setCurrentConfig(d),c.loadContext(n).then(function(t){e.configure(t),a.resolve()})["catch"](a.reject))}return a.promise.nodeify(i)},this.runPluginMain=function(e,t){var n=(new Date).toISOString(),i=0,o=!1;return g.logger.debug("plugin configured, invoking main"),e.isConfigured===!1?void t("Plugin is not configured.",g.getPluginErrorResult(e.getName(),"Plugin is not configured.",l&&l.projectId)):(e.notificationHandlers=g.notificationHandlers,void e.main(function(r,s){var a;if(s&&g.logger.debug("plugin main callback called",{result:s.serialize()}),i+=1,s.setFinishTime((new Date).toISOString()),s.setStartTime(n),s.setPluginName(e.getName()),i>1){if(a=(new Error).stack,g.logger.error("The main callback is being called more than once!",{metadata:a}),s.setError("The main callback is being called more than once!"),o===!0)return void e.createMessage(null,a);o=!0,s.setSuccess(!1),e.createMessage(null,"The main callback is being called more than once."),e.createMessage(null,a),t("The main callback is being called more than once!",s)}else s.setError(r),e.notificationHandlers=[],t(r,s)}))},this.getPluginErrorResult=function(e,i,o){var r=new t,s=new n;return s.severity="error",s.message=i,r.setSuccess(!1),r.setPluginName(e),r.setProjectId(o||"N/A"),r.addMessage(s),r.setStartTime((new Date).toISOString()),r.setFinishTime((new Date).toISOString()),r.setError(s.message),r},this.loadContext=function(t){var n=s.defer(),o={branchName:t.branchName,commitHash:t.commitHash||t.commit,rootNode:null,activeNode:null,activeSelection:null,META:{},namespace:t.namespace||"",project:t.project,projectId:t.project.projectId,projectName:r.getProjectNameFromProjectId(t.project.projectId),core:new e(t.project,{globConf:d,logger:g.logger.fork("core")})};return g.logger.debug("loading context"),p(o.project,o.branchName).then(function(e){if(o.commitHash=t.commitHash||e,!o.commitHash)throw new Error("Neither commitHash nor branchHash from branch was obtained, branchName: ["+t.branchName+"]");return i.loadNodesAtCommitHash(o.project,o.core,o.commitHash,g.logger,t)}).then(function(e){o.rootNode=e.rootNode,o.activeNode=e.activeNode,o.activeSelection=e.activeSelection,o.META=e.META,n.resolve(o)})["catch"](function(e){n.reject(e)}),n.promise}}return a}),define("js/client/pluginmanager",["plugin/managerbase","blob/BlobClient","common/storage/project/project","js/RegistryKeys"],function(e,t,n,i){"use strict";function o(o,s,a,l,c){var d=this,h=l.fork("PluginManager");this.getCurrentPluginContext=function(e,t){var n,s,a={managerConfig:{project:o.getProjectObject(),branchName:o.getActiveBranchName(),commitHash:o.getActiveCommitHash(),activeNode:r,activeSelection:[],namespace:""},pluginConfig:null};if("undefined"!=typeof WebGMEGlobal&&(t="string"==typeof t?t:WebGMEGlobal.State.getActiveObject(),a.managerConfig.activeSelection=WebGMEGlobal.State.getActiveSelection(),a.managerConfig.activeNode=t),t&&e){n=o.getNode(t);do{if(s=n.getOwnRegistry(i.VALID_PLUGINS),s&&s.indexOf(e)>-1){a.managerConfig.namespace=n.getNamespace();break}n=n.getBaseId()?o.getNode(n.getBaseId()):null}while(n)}return a},this.runBrowserPlugin=function(n,i,r){var s=new t({logger:h.fork("BlobClient")}),a=new e(s,null,l,c);a.browserSide=!0,a.notificationHandlers=[function(e,t){d.dispatchPluginNotification(e),t(null)}],a.projectAccess=o.getProjectAccess(),a.executePlugin(n,i.pluginConfig,i.managerConfig,r)},this.runServerPlugin=function(e,t,i){t.managerConfig.project instanceof n&&(t.managerConfig.project=t.managerConfig.project.projectId),s.simpleRequest({command:"executePlugin",name:e,context:t},i)},this.filterPlugins=function(e,t){var n,i,o,s=[];if(h.debug("filterPluginsBasedOnNode allPlugins, given nodePath",e,t),t||(h.debug("filterPluginsBasedOnNode nodePath not given - will fall back on root-node."),t=r),o=a.nodes[t],o||(h.warn("filterPluginsBasedOnNode node not loaded - will fall back on root-node.",t),t=r,o=a.nodes[t]),!o)return h.warn("filterPluginsBasedOnNode root node not loaded - will return full list."),e;for(n=(a.core.getRegistry(o.node,"validPlugins")||"").split(" "),i=0;i<n.length;i+=1)e.indexOf(n[i])>-1?s.push(n[i]):""===n[i]||h.warn('Registered plugin for node at path "'+t+'" is not amongst available plugins',e);return s},this.dispatchPluginNotification=function(e){var t={severity:e.notification.severity||"info",message:"[Plugin] "+e.pluginName+" - "+e.notification.message};"number"==typeof e.notification.progress&&(t.message+=" ["+e.notification.progress+"%]"),h.debug("plugin notification",e),o.dispatchEvent(o.CONSTANTS.NOTIFICATION,t),o.dispatchEvent(o.CONSTANTS.PLUGIN_NOTIFICATION,e)}}var r="";return o}),define("js/client",["js/logger","common/storage/browserstorage","common/EventDispatcher","common/core/coreQ","js/client/constants","common/util/assert","common/core/tasync","common/util/guid","common/util/url","js/client/gmeNodeGetter","js/client/gmeNodeSetter","js/client/libraries","blob/BlobClient","js/client/stateloghelpers","js/client/pluginmanager","superagent"],function(e,t,n,i,o,r,s,a,l,c,d,h,p,g,u,f){"use strict";function m(l){function m(e,t){var n=l.debug?2:0;"console"===e?console.log("state at "+t,g.getStateLogString(K,Q,l.debug,n)):Z[e]("state at "+t,g.getStateLogString(K,Q,l.debug,n))}function _(e){e=e||function(e,t){Q.renewingToken=!1,e?Z.error("Failed to renew token cookie",e):Z.debug("Token cookie renewed")},Q.renewingToken===!1?(Q.renewingToken=!0,new f.Request("GET","api/user/token").end(e)):Z.debug("Awaiting token renewal..")}function b(e,t){var n,i,o,s;if(Z.debug("saveRoot msg",e),o=t?function(e,n){e?Z.error("saveRoot failure",e):Z.debug("saveRoot",n),t(e,n)}:function(e,t){e?Z.error("saveRoot failure",e):Z.debug("saveRoot",t)},Q.viewer||Q.readOnlyProject)Q.msg="",o(null);else if(Q.msg?Q.msg+="\n"+e:Q.msg+=e,Q.inTransaction)Z.debug("is in transaction - will NOT persist.");else{if(r(Q.project&&Q.core&&Q.branchName),Z.debug("is NOT in transaction - will persist."),n=Q.core.persist(Q.nodes[ee].node),Z.debug("persisted",n),i=Object.keys(n.objects).length,0===i)return Z.warn("No changes after persist will return from saveRoot."),void o(null);i>200&&Z.warn("Lots of persisted objects",i),s=q.makeCommit(Q.project.projectId,Q.branchName,[Q.commitHash],n.rootHash,n.objects,Q.msg,o),Q.msg=""}}function y(e){var t;return e?(t=Q.core.getPath(e),Q.nodes[t]||(Q.nodes[t]={node:e}),t):null}function v(e,t){var n,i,r=[],s=e.getAllMetaNodes(t),a=Object.keys(s||{});for(n=0;n<a.length;n+=1)i=e.getFullyQualifiedName(s[a[n]]),-1===r.indexOf(i)?r.push(i):K.dispatchEvent(o.NOTIFICATION,{type:"META",severity:"error",message:"Duplicate name on META level: '"+i+"'",hint:"Rename one of the objects"})}function C(e,t){var n,i,r,s=e.getAllMetaNodes(t),a={},l=[];for(i in s)for(r=e.getMixinErrors(s[i]),n=0;n<r.length;n+=1)a[r[n].message]={type:"META",severity:r[n].severity,message:r[n].message,hint:r[n].hint},l.push(r[n].message);for(l.sort(),n=0;n<l.length;n+=1)K.dispatchEvent(o.NOTIFICATION,a[l[n]])}function E(e){Z.error("Faulty core usage raised an error",e),K.dispatchEvent(o.NOTIFICATION,{type:"CORE",severity:"error",message:e.message})}function D(e,t){Q.project=null,q.closeProject(e,function(n){return n?void t(n):(Q.core=null,Q.branchName=null,Q.patterns={},Q.nodes={},Q.loadNodes={},Q.loadError=0,Q.rootHash=null,Q.inTransaction=!1,Q.msg="",V(),K.dispatchEvent(o.PROJECT_CLOSED,e),void t(null))})}function I(){return function(e,t,n){Z.debug("branchStatus changed",e,t,n),m("debug","branchStatus"),Q.branchStatus=e,K.dispatchEvent(o.BRANCH_STATUS_CHANGED,{status:e,commitQueue:t,updateQueue:n})}}function T(){return function(e,t,n,i){var r=e.commitData,s=e.local!==!0,a=r.commitObject[o.STORAGE.MONGO_ID];return Z.debug("hashUpdateHandler invoked. project, branch, commitHash",r.projectId,r.branchName,a),Q.inTransaction?(Z.warn("Is in transaction, will not load in changes"),void i(null,!1)):(P(r.commitObject,s),K.dispatchEvent(o.UNDO_AVAILABLE,N()),K.dispatchEvent(o.REDO_AVAILABLE,A()),Z.debug("loading commitHash, local?",a,e.local),void F(r.commitObject.root,a,r.changedNodes,function(e,t){e?(Z.error("hashUpdateHandler invoked loading and it returned error",r.commitObject.root,e),m("error","hashUpdateHandler"),i(e,!1)):t===!0?(m("warn","hashUpdateHandler"),i(null,!1)):(Z.debug("loading complete for incoming rootHash",r.commitObject.root),m("debug","hashUpdateHandler"),i(null,!0))}))}}function P(e,t){var n,i,r=e[o.STORAGE.MONGO_ID];if(t)return Z.debug("foreign modification clearing undo-redo chain"),void(Q.undoRedoChain={commitHash:r,rootHash:e.root,previous:null,next:null});for(i=Q.undoRedoChain;i;){if(i.commitHash===r)return;i=i.previous}for(i=Q.undoRedoChain;i;){if(i.commitHash===r)return;i=i.next}n={commitHash:r,rootHash:e.root,previous:Q.undoRedoChain,next:null},Q.undoRedoChain.next=n,Q.undoRedoChain=n}function N(){var e=!1;return Q.undoRedoChain&&Q.undoRedoChain.previous&&Q.undoRedoChain.previous.commitHash&&(e=!0),e}function A(){var e=!1;return Q.undoRedoChain&&Q.undoRedoChain.next&&(e=!0),e}function w(e){return e?JSON.parse(JSON.stringify(e)):null}function O(e){var t,n;for(t=0;t<e.length;t+=1)for(n=e[t].split(o.CORE.PATH_SEP);n.length>1;)Q.loading.changedNodes.update[n.join(o.CORE.PATH_SEP)]=!0,n.pop()}function S(e){var t,n,i,o,r,s=[],a=[];if(Q.loading.changedNodes){t=Q.core.getAllMetaNodes(e[ee].node);for(i in Q.loading.changedNodes.update)t.hasOwnProperty(i)&&a.push(i);if(a.length>0)for(n in t)if(t.hasOwnProperty(n))for(r=0;r<a.length;r+=1)Q.core.isTypeOf(t[n],t[a[r]])===!0&&(Q.loading.changedNodes.update[n]=!0);Q.loading.changedNodes.update[ee]=!0,O(Object.keys(Q.loading.changedNodes.load)),O(Object.keys(Q.loading.changedNodes.unload))}for(o in Q.nodes)Q.nodes.hasOwnProperty(o)&&e.hasOwnProperty(o)&&z(Q.loading.changedNodes,e[o].node)&&s.push(o);return s}function x(e,t){var n;if(t.items&&t.items.length>0){for(n=0;n<t.items.length;n+=1)if(K.isTypeOf(e,t.items[n]))return!0;return!1}return!0}function M(e,t,n){var i,o,r;if(Q.nodes[e]){if(n[e]=!0,t.children&&t.children>0)for(i=Q.core.getChildrenPaths(Q.nodes[e].node),o=w(t),o.children-=1,r=0;r<i.length;r+=1)x(i[r],t)&&M(i[r],o,n)}else Q.loadError++}function R(e,t){var n,i={},o=Q.loadError,r={},s=[];for(n in Q.users[e].PATTERNS)Q.users[e].PATTERNS.hasOwnProperty(n)&&Q.nodes[n]&&M(n,Q.users[e].PATTERNS[n],i);if(o===Q.loadError){for(n in Q.users[e].PATHS)i[n]||(s.push({etype:"unload",eid:n}),r[n]=!0);for(n in i)Q.users[e].PATHS[n]||(s.push({etype:"load",eid:n}),r[n]=!0);for(n=0;n<t.length;n++)i[t[n]]&&!r[t[n]]&&s.push({etype:"update",eid:t[n]});Q.users[e].PATHS=i,s.length>0&&Q.loadError>o?s.unshift({etype:"incomplete",eid:null}):s.unshift({etype:"complete",eid:null}),Q.users[e].FN(s)}}function L(e,t,n,i,o){var r,s=e.getPath(n),a=e.getChildrenPaths(n),l=e.getChildrenRelids(n),c=a.length,d=null,h=function(n,r){n||null===r?(d=d||n,c-=1,0===c&&o(d)):L(e,t,r,i-1,p)},p=function(e){d=d||e,c-=1,0===c&&o(d)};if(t[s]||(t[s]={node:n}),i>0)if(c>0)for(r=0;r<a.length;r++)t[a[r]]?L(e,t,t[a[r]].node,i-1,p):e.loadChild(n,l[r],h);else o(d);else o(d)}function k(e,t,n,i,o){var r=null,s=function(){if(n.children&&n.children>0){var t=n.children;L(e,i,r,t,o)}else o(null)};i[t]?(r=i[t].node,s()):(i[ee]||Z.error("pattern cannot be loaded if there is no root!!!"),r=i[ee].node,e.loadByPath(r,t,function(t,n){var a;t||!n||e.isEmpty(n)?o(t):(a=e.getPath(n),i[a]||(i[a]={node:n}),r=n,s())}))}function j(){var e;for(e in Q.users)Q.users.hasOwnProperty(e)&&Q.users[e].UI.reLaunch&&Q.users[e].UI.reLaunch()}function G(e,t,n){Z.debug("updateTerritory related loads finished",{metadata:{userId:e,patterns:t,error:n}}),Q.users[e]&&(Q.users[e].PATTERNS=w(t),n||R(e,[]))}function B(){return Q.inLoading&&0===Q.ongoingTerritoryUpdateCounter&&0===Q.ongoingLoadPatternsCounter?!0:!1}function W(e){Q.loadingStatus=Q.loadingStatus||e,Q.ongoingLoadPatternsCounter-=1,B()&&$()}function $(){var e,t;Z.debug("switching project state [C#"+Q.commitHash+"]->[C#"+Q.loading.commitHash+"] : [R#"+Q.rootHash+"]->[R#"+Q.loading.rootHash+"]"),e=S(Q.loadNodes),Q.nodes=Q.loadNodes,Q.loadNodes={},K.getAllMetaNodes(),Q.inLoading=!1,Q.rootHash=Q.loading.rootHash,Q.loading.rootHash=null,Q.commitHash=Q.loading.commitHash,Q.loading.commitHash=null,v(Q.core,Q.nodes[ee].node),C(Q.core,Q.nodes[ee].node);for(t in Q.users)Q.users.hasOwnProperty(t)&&R(t,e);Q.loadingStatus?Q.loading.next(Q.loadingStatus):Q.loading.next(null)}function F(e,t,n,i){var o,r,s,a,l=[];return 0!==Q.ongoingLoadPatternsCounter?void i(new Error("at the start of loading counter should bee zero!!! ["+Q.ongoingLoadPatternsCounter+"]")):(Q.loadingStatus=null,Q.loadNodes={},Q.loading.rootHash=e,Q.loading.commitHash=t,Q.loading.next=i,Q.loading.changedNodes=n,void Q.core.loadRoot(Q.loading.rootHash,function(e,t){if(e)return void Q.loading.next(e);for(Q.inLoading=!0,Q.loadNodes[Q.core.getPath(t)]={node:t},s=Object.keys(Q.users),o=0;o<s.length;o+=1)for(Q.ongoingLoadPatternsCounter+=Object.keys(Q.users[s[o]].PATTERNS||{}).length,a=Object.keys(Q.users[s[o]].PATTERNS||{}),r=0;r<a.length;r+=1)l.push({id:a[r],pattern:w(Q.users[s[o]].PATTERNS[a[r]])});for(s=Object.keys(Q.pendingTerritoryUpdatePatterns),o=0;o<s.length;o+=1)for(Q.ongoingLoadPatternsCounter+=Object.keys(Q.pendingTerritoryUpdatePatterns[s[o]]||{}).length,a=Object.keys(Q.pendingTerritoryUpdatePatterns[s[o]]||{}),r=0;r<a.length;r+=1)l.push({id:a[r],pattern:w(Q.pendingTerritoryUpdatePatterns[s[o]][a[r]])});if(0===Q.ongoingLoadPatternsCounter)return void(B()&&($(),j()));for(o=0;o<l.length;o+=1)te(Q.core,l[o].id,l[o].pattern,Q.loadNodes,W)}))}function z(e,t){if(!e)return!0;if(e.partialUpdate[Q.core.getPath(t)]===!0)return!0;for(;t;){if(e.update[Q.core.getPath(t)]===!0)return!0;t=Q.core.getBase(t)}return!1}function V(){var e,t,n,i=Object.keys(Q.users);for(e=0;e<i.length;e++)if(Q.users[i[e]]){n=[{eid:null,etype:"complete"}];for(t in Q.users[i[e]].PATHS)n.push({etype:"unload",eid:t});Q.users[i[e]].PATTERNS={},Q.users[i[e]].PATHS={},Q.users[i[e]].SENDEVENTS=!0,Q.users[i[e]].FN(n)}}var H,U,Y,J,X,K=this,Z=e.create("gme:client",l.client.log),q=t.getStorage(Z,l,!0),Q={connection:null,renewingToken:!1,exception:null,project:null,projectAccess:null,core:null,branchName:null,branchStatus:null,readOnlyProject:!1,viewer:!1,users:{},nodes:{},loadNodes:{},rootHash:null,rootObject:null,commitHash:null,undoRedoChain:null,inTransaction:!1,msg:"",gHash:0,loadError:null,ongoingTerritoryUpdateCounter:0,ongoingLoadPatternsCounter:0,pendingTerritoryUpdatePatterns:{},loadingStatus:null,inLoading:!1,loading:{rootHash:null,commitHash:null,changedNodes:null,next:null}},ee="",te=s.throttle(k,1);H=new p({logger:Z.fork("BlobClient")}),n.call(this),this.CONSTANTS=o,Y=new u(K,q,Q,Z,l),this.getCurrentPluginContext=Y.getCurrentPluginContext,this.runBrowserPlugin=Y.runBrowserPlugin,this.runServerPlugin=Y.runServerPlugin,this.filterPlugins=Y.filterPlugins,this.dispatchPluginNotification=Y.dispatchPluginNotification,J=d(Z,Q,b,y,E);for(U in J)J.hasOwnProperty(U)&&(K[U]=J[U]);X=h(Z,Q,q,b);for(U in X)X.hasOwnProperty(U)&&(K[U]=X[U]);this.connectToDatabase=function(e){return K.isConnected()?(Z.warn("connectToDatabase - already connected"),void e(null)):void q.open(function(t){Q.connection=t,t===o.STORAGE.CONNECTED?(K.dispatchEvent(o.NETWORK_STATUS_CHANGED,t),q.webSocket.addEventListener(o.STORAGE.NOTIFICATION,function(e,t){Z.info("recieved notification",t),t.type===o.STORAGE.BRANCH_ROOM_SOCKETS?(K.dispatchConnectedUsersChanged(t),K.emitStateNotification()):t.type===o.STORAGE.PLUGIN_NOTIFICATION?K.dispatchPluginNotification(t):t.type===o.STORAGE.ADD_ON_NOTIFICATION?K.dispatchAddOnNotification(t):t.type===o.STORAGE.CLIENT_STATE_NOTIFICATION?K.dispatchConnectedUsersChanged(t):Z.error("Unknown notification type",t.type,t)}),j(),e(null)):t===o.STORAGE.DISCONNECTED?Q.connection!==o.STORAGE.INCOMPATIBLE_CONNECTION&&K.dispatchEvent(o.NETWORK_STATUS_CHANGED,t):t===o.STORAGE.RECONNECTED?K.dispatchEvent(o.NETWORK_STATUS_CHANGED,t):t===o.STORAGE.INCOMPATIBLE_CONNECTION?K.disconnectFromDatabase(function(e){e&&Z.error(e),K.dispatchEvent(o.NETWORK_STATUS_CHANGED,t)}):t===o.STORAGE.JWT_ABOUT_TO_EXPIRE?(Z.warn("Token about is about to expire"),_()):t===o.STORAGE.JWT_EXPIRED?K.disconnectFromDatabase(function(e){e&&Z.error(e),K.dispatchEvent(o.NETWORK_STATUS_CHANGED,o.STORAGE.JWT_EXPIRED)}):(Z.error(new Error("Connection failed error "+t)),K.disconnectFromDatabase(function(n){n&&Z.error(n),K.dispatchEvent(o.NETWORK_STATUS_CHANGED,o.STORAGE.CONNECTION_ERROR),e(new Error("Connection failed! "+t))}))})},this.disconnectFromDatabase=function(e){function t(t){q.close(function(n){Q.connection!==o.STORAGE.INCOMPATIBLE_CONNECTION&&Q.connection!==o.STORAGE.CONNECTION_ERROR&&(Q.connection=o.STORAGE.DISCONNECTED),e(t||n)})}Q.project?D(Q.project.projectId,t):t(null)},this.selectProject=function(e,t,n){function r(r,s,c,d){if(r)return void n(new Error(r));if(Q.project=s,Q.readOnlyProject=d.write===!1,Q.core=new i(s,{globConf:l,logger:Z.fork("core")}),Q.projectAccess=d,m("info","projectOpened"),Z.debug("projectOpened, branches: ",c),K.dispatchEvent(o.PROJECT_OPENED,e),c.hasOwnProperty(a)===!1){if(t)return Z.error('Given branch does not exist "'+t+'"'),void D(e,function(e){e&&Z.error("closeProject after missing branch failed with err",e),n(new Error('Given branch does not exist "'+t+'"'))});Z.warn('Project "'+e+'" did not have branch',a),a=Object.keys(c)[0]||null,Z.debug('Picked "'+a+'".')}a?K.selectBranch(a,null,function(e){return e?void n(e):(m("info","selectBranch"),j(),void n(null))}):(Z.warn("No branches available in project, will attempt to select latest commit."),K.getCommits(e,(new Date).getTime(),1,function(t,i){return t||0===i.length?(Z.error(t),void D(e,function(e){e&&Z.error("closeProject after missing any commits failed with err",e),n(new Error("Project does not have any commits."))})):void K.selectCommit(i[0]._id,function(t){return t?(Z.error(t),void D(e,function(e){e&&Z.error("closeProject after missing any commits failed with err",e),n(new Error("Failed selecting commit when opening project."))})):(j(),void n(null))})}))}void 0===n&&"function"==typeof t&&(n=t,t=void 0),K.isConnected()===!1&&n(new Error("There is no open database connection!"));var s,a=t||"master";if(Z.debug("selectProject",e,a),Q.project){if(s=Q.project.projectId,Z.debug("A project was open, closing it",s),s===e)return Z.warn("projectId is already opened",e),void n(null);D(s,function(t){return t?(Z.error("problems closing previous project",t),void n(t)):void q.openProject(e,r)})}else q.openProject(e,r)},this.selectBranch=function(e,t,n){function i(t){return t?(Z.error("Problems closing existing branch",t),void n(t)):(Q.branchName=e,Z.debug("openBranch, calling storage openBranch",Q.project.projectId,e),void q.openBranch(Q.project.projectId,e,T(),I(),function(t){return t?(Z.error("storage.openBranch returned with error",t),K.dispatchEvent(o.BRANCH_CHANGED,null),void n(t)):(Q.viewer=!1,Q.branchName=e,K.dispatchEvent(o.BRANCH_CHANGED,e),m("info","openBranch"),void n(null))}))}var r=Q.branchName;return Z.debug("selectBranch",e),K.isConnected()===!1?void n(new Error("There is no open database connection!")):Q.project?(t&&Z.warn("passing branchStatusHandler is deprecated, use addHashUpdateHandler or addBranchStatusHandler on the branch object instead (getProjectObject().branches[branchName])."),void(null!==r?(Z.debug("Branch was open, closing it first",r),q.closeBranch(Q.project.projectId,r,i)):i(null))):void n(new Error("selectBranch invoked without an opened project"))},this.selectCommit=function(e,t){function n(n){return n?(Z.error("Problems closing existing branch",n),void t(n)):(Q.viewer=!0,void Q.project.loadObject(e,function(n,i){!n&&i?(m("info","selectCommit loaded commit"),K.dispatchEvent(o.BRANCH_CHANGED,null),F(i.root,e,null,function(e,n){e?(Z.error("loading returned error",i.root,e),m("error","selectCommit loading"),t(e)):n===!0?(m("warn","selectCommit loading"),t(new Error("Loading selected commit was aborted"))):(Z.debug("loading complete for selectCommit rootHash",i.root),m("info","selectCommit loading"),K.dispatchEvent(o.BRANCH_CHANGED,null),t(null))})):(Z.error("Cannot view given "+e+" commit as it's root cannot be loaded! ["+JSON.stringify(n)+"]"),t(n||new Error("commit object cannot be found!")))}))}if(Z.debug("selectCommit",e),K.isConnected()===!1)return void t(new Error("There is no open database connection!"));if(!Q.project)return void t(new Error("selectCommit invoked without open project"));var i;null!==Q.branchName?(Z.debug("Branch was open, closing it first",Q.branchName),i=Q.branchName,Q.branchName=null,q.closeBranch(Q.project.projectId,i,n)):n(null)},this.forkCurrentBranch=function(e,t,n){var i,o=this,r=o.getActiveBranchName(),s=o.getActiveProjectId();return Z.debug("forkCurrentBranch",e,t),Q.project?null===r?void n("Cannot fork without an open branch!"):(i=e||r+"_"+(new Date).getTime(),void q.forkBranch(s,r,i,t,function(t,o){return t?(Z.error("Could not fork branch:",e,t),void n(t)):void n(null,i,o)})):void n("Cannot fork without an open project!")},this.isConnected=function(){return Q.connection===o.STORAGE.CONNECTED||Q.connection===o.STORAGE.RECONNECTED},this.getNetworkStatus=function(){return Q.connection},this.getConnectedStorageVersion=function(){return q.serverVersion},this.getBranchStatus=function(){return Q.branchStatus},this.getActiveProjectId=function(){return Q.project&&Q.project.projectId},this.getActiveProjectName=function(){return Q.project&&Q.project.projectName},this.getActiveBranchName=function(){return Q.branchName},this.getActiveCommitHash=function(){return Q.commitHash},this.getActiveRootHash=function(){return Q.rootHash},this.isProjectReadOnly=function(){return Q.readOnlyProject},this.isCommitReadOnly=function(){return Q.viewer},this.isReadOnly=function(){return Q.viewer||Q.readOnlyProject},this.getProjectObject=function(){return Q.project},this.getCommitQueue=function(){return Q.project&&Q.branchName&&Q.project.branches.hasOwnProperty(Q.branchName)?Q.project.branches[Q.branchName].getCommitQueue():[]},this.downloadCommitQueue=function(){var e=K.getCommitQueue();return e.length>0?(g.downloadCommitQueue(K,e),!0):!1},this.getProjectAccess=function(){return Q.projectAccess},this.downloadError=function(){g.downloadStateDump(K,Q)},this.undo=function(e,t){return N()===!1?void t(new Error("unable to make undo")):(Q.undoRedoChain=Q.undoRedoChain.previous,m("info","undo [before setBranchHash]"),void q.setBranchHash(Q.project.projectId,e,Q.undoRedoChain.commitHash,Q.commitHash,function(e){return e?void t(e):(m("info","undo [after setBranchHash]"),void t(null))}))},this.redo=function(e,t){return A()===!1?void t(new Error("unable to make redo")):(Q.undoRedoChain=Q.undoRedoChain.next,m("info","redo [before setBranchHash]"),void q.setBranchHash(Q.project.projectId,e,Q.undoRedoChain.commitHash,Q.commitHash,function(e){return e?void t(e):(m("info","redo [after setBranchHash]"),void t(null))}))},this.applyCommitQueue=function(e,t,n){function i(){q.createBranch(s,t.newBranchName,l,n)}var r=K.getActiveBranchName(),s=e[0].projectId,a=e[0].commitObject.parents,l=e[e.length-1].commitObject._id;t=t||{},t.newBranchName=t.newBranchName||K.getActiveBranchName()+"_"+Date.now(),q.persistCommits(e,function(e){return e?void n(e):void(t.fastForward&&a.indexOf(K.getActiveCommitHash())>-1?q.setBranchHash(s,r,l,K.getActiveCommitHash(),function(e,t){e?n(e):t.status!==o.STORAGE.SYNCED?i():n()}):i())})},this.getProjects=function(e,t){var n;K.isConnected()?(e.asObject&&(n=!0,delete e.asObject),q.getProjects(e,function(e,i){var o,r={};if(e)return void t(e);if(n===!0){for(o=0;o<i.length;o+=1)r[i[o]._id]=i[o];t(null,r)}else t(null,i)})):t(new Error("There is no open database connection!"))},this.getProjectsAndBranches=function(e,t){K.getProjects({rights:!0,branches:!0,asObject:e},t)},this.getBranches=function(e,t){K.isConnected()?q.getBranches(e,t):t(new Error("There is no open database connection!"))},this.getTags=function(e,t){K.isConnected()?q.getTags(e,t):t(new Error("There is no open database connection!"))},this.getCommits=function(e,t,n,i){K.isConnected()?q.getCommits(e,t,n,i):i(new Error("There is no open database connection!"))},this.getHistory=function(e,t,n,i){K.isConnected()?q.getHistory(e,t,n,i):i(new Error("There is no open database connection!"))},this.getLatestCommitData=function(e,t,n){K.isConnected()?q.getLatestCommitData(e,t,n):n(new Error("There is no open database connection!"))},this.createProject=function(e,t,n){K.isConnected()?q.createProject(e,t,n):n(new Error("There is no open database connection!"))},this.deleteProject=function(e,t){K.isConnected()?q.deleteProject(e,t):t(new Error("There is no open database connection!"))},this.transferProject=function(e,t,n){K.isConnected()?q.transferProject(e,t,n):n(new Error("There is no open database connection!"))},this.duplicateProject=function(e,t,n,i){K.isConnected()?q.duplicateProject(e,t,n,i):i(new Error("There is no open database connection!"))},this.createBranch=function(e,t,n,i){K.isConnected()?q.createBranch(e,t,n,i):i(new Error("There is no open database connection!"))},this.deleteBranch=function(e,t,n,i){K.isConnected()?q.deleteBranch(e,t,n,i):i(new Error("There is no open database connection!"))},this.createTag=function(e,t,n,i){K.isConnected()?q.createTag(e,t,n,i):i(new Error("There is no open database connection!"))},this.deleteTag=function(e,t,n){K.isConnected()?q.deleteTag(e,t,n):n(new Error("There is no open database connection!"))},this.squashCommits=function(e,t,n,i,o){q.squashCommits(e,t,n,i,o)},this.watchDatabase=function(e,t){t=t||function(e){e&&Z.error("Problems watching database room")},q.watchDatabase(e,t)},this.unwatchDatabase=function(e,t){t=t||function(e){e&&Z.error("Problems unwatching database room")},q.unwatchDatabase(e,t)},this.watchProject=function(e,t,n){n=n||function(t){t&&Z.error("Problems watching project room",e)},q.watchProject(e,t,n)},this.unwatchProject=function(e,t,n){n=n||function(t){t&&Z.error("Problems unwatching project room",e)},q.unwatchProject(e,t,n);
},this.getNode=function(e){return c(e,Z,Q,y)},this.getAllMetaNodes=function(){if(Q&&Q.core&&Q.nodes&&Q.nodes[ee]){var e,t=Q.core.getAllMetaNodes(Q.nodes[ee].node),n=[],i=Object.keys(t||{});for(e=0;e<i.length;e+=1)n.push(K.getNode(y(t[i[e]]),Z,Q,y));return n}return[]},this.startTransaction=function(e){Q.inTransaction&&Z.error("Already in transaction, will proceed though.."),Q.core?(Q.inTransaction=!0,e=e||"[",b(e)):Z.error("Can not start transaction with no core avaliable.")},this.completeTransaction=function(e,t){Q.inTransaction=!1,Q.core&&(e=e||"]",b(e,t))},this.addUI=function(e,t,n){return r(t),r("function"==typeof t),n=n||a(),Q.users[n]={type:"notused",UI:e,PATTERNS:{},PATHS:{},SENDEVENTS:!0,FN:t},n},this.removeUI=function(e){Z.debug("removeUI",e),delete Q.users[e]},this._removeAllUIs=function(){Z.debug("_removeAllUIs called"),Q.users={}},this.updateTerritory=function(e,t){var n,i=0,o=a(),r=null,s=Object.keys(t||{}),l=function(n){r=r||n,0===--i&&(delete Q.pendingTerritoryUpdatePatterns[o],G(e,t,r),Q.ongoingTerritoryUpdateCounter-=1,Q.ongoingTerritoryUpdateCounter<0&&(Z.error("patternLoaded callback have been called multiple times!!"),Q.ongoingTerritoryUpdateCounter=0),B()&&$())};if(Z.debug("updatingTerritory",{metadata:{userId:e,patterns:t}}),!Q.nodes[ee])return void(Q.users[e]&&(Z.debug("early updateTerritory for user["+e+"]. No loaded project state yet."),Q.users[e].PATTERNS=w(t)));if(0===s.length)return void G(e,t,null);for(Q.ongoingTerritoryUpdateCounter+=1,i=s.length,n=0;n<s.length;n+=1)Q.inLoading?(Q.ongoingLoadPatternsCounter+=1,te(Q.core,s[n],t[s[n]],Q.loadNodes,W)):Q.pendingTerritoryUpdatePatterns[o]=t,te(Q.core,s[n],t[s[n]],Q.nodes,l)},this.getUserId=function(){throw new Error("Deprecated! Username is not stored in a cookie anymore. If available, use WebGMEGlobal.userInfo, if not the user info is available at GET /api/user")},this.importProjectFromFile=function(e,t,n,i,o,r){var s={command:"importProjectFromFile",projectName:e,blobHash:n,branchName:t,ownerId:i,url:o};Z.debug("creating project from package",s),q.simpleRequest(s,function(e,t){e&&Z.error(e),r(e,t)})},this.updateProjectFromFile=function(e,t,n,i){var o={command:"updateProjectFromFile",blobHash:n,projectId:e,branchName:t};Z.debug("updating project from package",o),q.simpleRequest(o,function(e,t){e&&Z.error(e),i(e,t)})},this.checkMetaRules=function(e,t,n){var i={command:"checkConstraints",checkType:"META",includeChildren:t,nodePaths:e,commitHash:Q.commitHash,projectId:Q.project.projectId};q.simpleRequest(i,function(e,t){e&&Z.error(e),K.dispatchEvent(o.META_RULES_RESULT,t),n&&n(e,t)})},this.checkCustomConstraints=function(e,t,n){var i={command:"checkConstraints",checkType:"CUSTOM",includeChildren:t,nodePaths:e,commitHash:Q.commitHash,projectId:Q.project.projectId};q.simpleRequest(i,function(e,t){e&&Z.error(e),K.dispatchEvent(o.CONSTRAINT_RESULT,t),n&&n(e,t)})},this.seedProject=function(e,t){Z.debug("seeding project",e),e.command="seedProject",q.simpleRequest(e,function(e,n){e&&Z.error(e),t(e,n)})},this.dispatchAddOnNotification=function(e){var t={severity:e.notification.severity||"info",message:"[AddOn] "+e.addOnName+" - "+e.notification.message};Z.debug("addOn notification",e),K.dispatchEvent(K.CONSTANTS.NOTIFICATION,t),K.dispatchEvent(K.CONSTANTS.ADD_ON_NOTIFICATION,e)},this.setConstraint=function(e,t,n){Q.core&&Q.nodes[e]&&"object"==typeof Q.nodes[e].node&&(Q.core.setConstraint(Q.nodes[e].node,t,n),b("setConstraint("+e+","+t+")"))},this.delConstraint=function(e,t){Q.core&&Q.nodes[e]&&"object"==typeof Q.nodes[e].node&&(Q.core.delConstraint(Q.nodes[e].node,t),b("delConstraint("+e+"name)"))},this.autoMerge=function(e,t,n,i){var o={command:"autoMerge",projectId:e,mine:t,theirs:n};q.simpleRequest(o,function(e,t){e?(Z.error("autoMerge failed with error",e),i(e)):i(null,t)})},this.resolve=function(e,t){var n={command:"resolve",partial:e};q.simpleRequest(n,function(e,n){e?(Z.error("resolve failed with error",e),t(e)):t(null,n)})},this.exportProjectToFile=function(e,t,n,i,o){var r={};r.command="exportProjectToFile",r.projectId=e,r.branchName=t,r.commitHash=n,r.withAssets=i,Z.debug("exportProjectToFile, command",r),r.projectId&&(r.branchName||n)?q.simpleRequest(r,function(e,t){e&&!t?(Z.error("exportProjectToFile failed with error",e),o(e)):o(e,t)}):o(new Error("invalid parameters!"))},this.exportSelectionToFile=function(e,t,n,i,o){var r={};r.command="exportSelectionToFile",r.projectId=e,r.commitHash=t,r.withAssets=i,r.paths=n,Z.debug("exportSelectionToFile, command",r),r.projectId&&t&&n&&n.length>0?q.simpleRequest(r,function(e,t){e&&!t?(Z.error("exportSelectionToFile failed with error",e),o(e)):o(e,t)}):o(new Error("invalid parameters!"))},this.importSelectionFromFile=function(e,t,n,i,o){var r={command:"importSelectionFromFile",projectId:e,blobHash:i,parentPath:n,branchName:t};Z.debug("import selection from package",r),q.simpleRequest(r,function(e,t){e&&Z.error(e),o(e,t)})},this.emitStateNotification=function(){var e={type:o.STORAGE.CLIENT_STATE_NOTIFICATION,state:null,projectId:K.getActiveProjectId(),branchName:K.getActiveBranchName()};e.projectId&&e.branchName&&("function"==typeof K.uiStateGetter&&(e.state=K.uiStateGetter()),Z.info("Sending state notification..."),q.sendNotification(e,function(t){t&&Z.error("Sending state notification failed",e,t),Z.info("Sending state notification succeeded")}))},this.dispatchConnectedUsersChanged=function(e){K.dispatchEvent(o.CONNECTED_USERS_CHANGED,e)},this.registerUIStateGetter=function(e){K.uiStateGetter=e},this.notifyUser=function(e){e.severity=e.severity||"info",e.message?(Z.debug("generic notification",e),K.dispatchEvent(K.CONSTANTS.NOTIFICATION,e)):Z.debug("cannot set empty notification")},this.gmeConfig=l,window.addEventListener("error",function(e){Q.exception={},e.error?(Q.exception.message=e.error.message,Q.exception.stack=e.error.stack):Q.exception="No error on event - check browser",K.dispatchEvent(o.NETWORK_STATUS_CHANGED,o.UNCAUGHT_EXCEPTION)})}return m.prototype=Object.create(n.prototype),m.prototype.constructor=m,m}),define("js/Panels/MetaEditor/MetaEditorConstants",["js/Constants"],function(e){"use strict";return{META_ASPECT_SET_NAME:"MetaAspectSet",RESERVED_POINTER_NAMES:[e.POINTER_BASE],META_ASPECT_CONTAINER_ID:e.PROJECT_ROOT_ID,META_ASPECT_SHEET_NAME_PREFIX:"MetaAspectSet_",META_DOC_REGISTRY_PREFIX:"meta_doc_",CREATE_META_DOC:"CREATE_META_DOC"}}),define("js/NodePropertyNames",[],function(){"use strict";var e={name:"name"};return{Attributes:e}}),define("js/Utils/GMEConcepts.FCO",["js/Constants","js/NodePropertyNames","js/RegistryKeys"],function(e,t,n){"use strict";var i={},o={};return o[t.Attributes.name]="FCO",i[n.DECORATOR]="",i[n.IS_PORT]=!1,i[n.IS_ABSTRACT]=!1,i[n.SVG_ICON]="",i[n.PORT_SVG_ICON]="",i[n.DISPLAY_FORMAT]=e.DISPLAY_FORMAT_ATTRIBUTE_MARKER+t.Attributes.name,i[n.VALID_VISUALIZERS]="ModelEditor SetEditor Crosscut GraphViz",{FCO_ATTRIBUTES:o,FCO_REGISTRY:i}}),define("js/util",["urlparse","jquery"],function(e){"use strict";var t=$("<span></span>");return Array.prototype.pushUnique=function(e){return-1===this.indexOf(e)&&this.push(e),this},{overlap:function(e,t){var n=!1;return e.x<t.x2&&e.x2>t.x&&e.y<t.y2&&e.y2>t.y&&(n=!0),n},flattenObject:function(e){var t,n={};return t=function(e,i){var o;for(o in e)e.hasOwnProperty(o)&&(_.isObject(e[o])&&!_.isArray(e[o])?t(e[o],""===i?o+".":i+o+"."):n[i+o]=e[o])},t(e,""),n},formattedDate:function(e,t){var n,i="",o=new Date;return t=t||"UTC",_.isDate(e)&&("UTC"===t?i=e.toUTCString():"elapsed"===t&&(n=(o-e)/1e3,i=45>n?"just now":90>n?"a minute ago":2700>n?Math.round(n/60)+" minutes ago":5400>n?"an hour ago":79200>n?Math.round(n/3600)+" hours ago":129600>n?"a day ago":216e4>n?Math.round(n/86400)+" days ago":3888e3>n?"a month ago":29808e3>n?Math.round(n/2592e3)+" months ago":47260800>n?"a year ago":Math.round(n/31536e3)+" years ago")),i},getURLParameterByName:function(t){var n=e(location,!0).param();return void 0!==n[t]?n[t]:""},getURLParameterByNameFromString:function(t,n){var i=e(t,!0).param();return void 0!==i[n]?i[n]:""},getObjectFromUrlQuery:function(e){var t={};return e.replace(new RegExp("([^?=&]+)(=([^&]*))?","g"),function(e,n,i,o){t[n]=o}),t},toSafeString:function(e){return t.text(e).html()},caseInsensitiveSort:function(e,t){return e.toLowerCase()<t.toLowerCase()?-1:1},escapeHTML:function(e){var t=document.createElement("div");return t.appendChild(document.createTextNode(e)),t.innerHTML}}}),define("js/Utils/GMEConcepts",["jquery","common/util/guid","js/Constants","js/NodePropertyNames","js/RegistryKeys","./GMEConcepts.FCO","js/Panels/MetaEditor/MetaEditorConstants","js/util"],function(e,t,n,i,o,r,s,a){"use strict";function l(e){z||(z=e)}function c(e){var t,i=!1,o=z.getNode(e);return o&&(t=o.getPointerNames(),-1!==t.indexOf(n.POINTER_SOURCE)&&-1!==t.indexOf(n.POINTER_TARGET)&&o.getPointer(n.POINTER_SOURCE).to&&o.getPointer(n.POINTER_TARGET).to&&(i=!0)),i}function d(e){var t,i=!1,o=z.getNode(e);return o&&(t=o.getPointerNames(),-1!==t.indexOf(n.POINTER_SOURCE)&&-1!==t.indexOf(n.POINTER_TARGET)&&(i=!0)),i}function h(e,t,i){for(var o=[],r=p(e,i),s=z.getNode(t),a=r.length;a--&&s;)s.isValidTargetOf(r[a],n.POINTER_TARGET)&&o.push(r[a]);return o}function p(e,t){var i,o,r,s=[],a=z.getNode(e);for(i=C(t)||[],o=i.length;o--&&a;)r=i[o],a&&d(r)&&a.isValidTargetOf(r,n.POINTER_SOURCE)&&s.push(r);return s}function g(e,t,i){var o=!1,r=z.getNode(e),s=z.getNode(t);return r&&s&&i&&r.isValidTargetOf(i,n.POINTER_SOURCE)&&s.isValidTargetOf(i,n.POINTER_TARGET)&&(o=!0),o}function u(e,t){return y(e,[t])}function f(e,t){var i=z.getNode(n.PROJECT_ROOT_ID),r=i.getRegistry(o.PROJECT_REGISTRY),s=r?r[e]:null;return t===s}function m(e){return f(n.PROJECT_FCO_ID,e)}function b(e){for(var t=[],n=z.getNode(e);null!==n;)t.push(n.getId()),n=z.getNode(n.getParentId());return t}function y(e,t){var n,i,r,s,a,l,c,d,h,p,g,u,f,m=!1,_=b(e);if("string"==typeof e&&t&&t.length>0){for(m=!0,i=t.length;i--&&m===!0;)for(a=_.length;a--&&m===!0;)z.isTypeOf(t[i],_[a])&&(m=!1);if(m===!0){for(i=t.length;i--;)g=z.getNode(t[i]),g&&g.getRegistry(o.IS_ABSTRACT)===!0&&t.splice(i,1);0===t.length&&(m=!1)}for(r=z.getNode(e),m===!0&&(s=r.getChildrenIds(),c=z.getChildrenMeta(e),void 0!==c.max&&c.max>-1&&s.length+t.length>c.max&&(m=!1)),u=r.getValidChildrenIds(),a=u.length,f={};a--;)f[u[a]]=0;if(m===!0)for(a=t.length;a--;){if(d=t[a],h=z.getNode(d),!h||!h.isValidChildOf(e)){m=!1;break}for(p=u.length;p--;)z.isTypeOf(d,u[p])&&(f[u[p]]+=1)}if(m===!0)for(r=z.getNode(e),s=r.getChildrenIds(),n=z.getValidChildrenItems(e),i=n.length;i--;)if(z.isTypeOf(d,n[i].id)){for(l=0,a=0;a<s.length;a+=1)z.isTypeOf(s[a],n[i].id)&&(l+=1);if(void 0!==n[i].max&&n[i].max>-1&&l+f[n[i].id]>n[i].max){m=!1;break}}}return m}function v(e){var t=!1;return e===n.PROJECT_ROOT_ID||m(e)||(t=!0),t}function C(e){for(var t,n,i=z.getAllMetaNodes()||[],o=z.getNode(e),r=o?o.getValidChildrenIds():[],s=i.length;s--;)n=i[s],t=n.getId(),-1===r.indexOf(t)&&n.isValidChildOf(e)&&r.push(t);return r}function E(e,t,n){var i,o,r,s,a=z.getNode(e),l=z.getPointerMeta(e,t),c=a.getMemberIds(t)||[],d=!0;if(!l)return!1;if(void 0!==l.max&&l.max>-1&&c.length+n.length>l.max&&(d=!1),d===!0)for(i=0;i<n.length;i+=1)if(o=z.getNode(n[i]),!o||!o.isValidTargetOf(e,t)){d=!1;break}if(d===!0){for(s={},i=0;i<l.items.length;i+=1)void 0!==l.items[i].max&&l.items[i].max>-1&&(s[l.items[i].id]=l.items[i].max);for(r in s)if(s.hasOwnProperty(r)){for(i=0;i<c.length;i+=1)z.isTypeOf(c[i],r)&&(s[r]-=1);for(i=0;i<n.length;i+=1)z.isTypeOf(n[i],r)&&(s[r]-=1);if(s[r]<0){d=!1;break}}}return d}function D(e){var t=!1,n=z.getNode(e);return n&&(t=n.getRegistry(o.IS_ABSTRACT)),t===!0}function I(e){var t=!1,n=z.getNode(e);return n&&(t=n.getRegistry(o.IS_PORT)),t===!0}function T(e,t){var n,i,o,r,s=C(e),a=z.getNode(t),l=[];for(n=s.length;n--&&a;)if(u(e,s[n])&&(i=z.getNode(s[n])))for(o=_.difference(i.getPointerNames().slice(0),V),r=o.length;r--;)a.isValidTargetOf(s[n],o[r])&&l.push({baseId:s[n],pointer:o[r]});return l}function P(e,t,i){var o,r,s,a=!0,l=z.getNode(e);if(i&&l){if(i!==n.ASPECT_ALL)if(s=l.getAspectMeta(e,i))if(s.length>0){for(o=t.length;o--&&a;)for(r=s.length,a=!1;r--;)if(z.isTypeOf(t[o],s[r])){a=!0;break}}else a=!1;else a=!1}else a=!1;return a&&(a=y(e,t)),a}function N(e,t,i){var o,r,s,a,l=[],c=z.getNode(t);if(i&&c)if(i!==n.ASPECT_ALL){if(a=c.getAspectMeta(i),a&&a.length>0)for(l=p(e,t),o=l.length;o--;){for(r=a.length,s=!1;r--;)if(z.isTypeOf(l[o],a[r])){s=!0;break}s||l.splice(o,1)}}else l=p(e,t);return l}function A(e,t,i,o){var r,s,a,l,c=[],d=z.getNode(i);if(o&&d)if(o!==n.ASPECT_ALL){if(l=d.getAspectMeta(o),l&&l.length>0)for(c=h(e,t,i),s=c.length;s--;){for(a=l.length,r=!1;a--;)if(z.isTypeOf(c[s],l[a])){r=!0;break}r||c.splice(s,1)}}else c=h(e,t,i);return c}function w(e,t,n){var i,o=!1,r=z.getAspectTerritoryPattern(t,n),s=r.items;if(s)for(i=s.length;i--;)if(z.isTypeOf(e,s[i])){o=!0;break}return o}function O(e,t){var n,i,o,r=!0;for(n=t.length;n--;)if(o=t[n],i=z.getNode(o),!i||!i.isValidChildOf(e)){r=!1;break}return r}function S(e,t){for(var i,o,r=[],s=[n.POINTER_BASE],a=[],l=z.getNode(e),c=t?_.difference(l.getSetNames(),a):_.difference(l.getPointerNames(),s),d=c.length;d--;)if(i=z.getValidTargetItems(e,c[d]),i&&i.length>0)for(o=i.length;o--;)-1===r.indexOf(i[o].id)&&r.push(i[o].id);return r}function x(e,t){for(var i=[],o=[n.POINTER_BASE],r=z.getNode(e),s=z.getNode(t),l=_.difference(r.getPointerNames(),o),c=l.length;c--&&s;)s.isValidTargetOf(e,l[c])&&i.push(l[c]);return i.sort(a.caseInsensitiveSort),i}function M(e,t){for(var n=[],i=[],o=z.getNode(e),r=_.difference(o.getValidSetNames(),i),s=r.length;s--;)E(e,r[s],[t])&&n.push(r[s]);return n.sort(a.caseInsensitiveSort),n}function R(e){var t=z.getNode(e),n=[];return t&&(n=t.getRegistry(o.CROSSCUTS)||[]),n}function L(e){var t=z.getNode(e),n=t.getSetNames()||[],i=t.getValidAspectNames()||[],o=R(e),r=[];return _.each(o,function(e){r.push(e.SetID)}),n=_.difference(n,r,i)}function k(){var e,t=z.getNode(n.PROJECT_ROOT_ID);return t&&-1!==t.getRegistryNames().indexOf(o.PROJECT_REGISTRY)&&(e=t.getRegistry(o.PROJECT_REGISTRY)[n.PROJECT_FCO_ID]),e}function j(e,t){var n,i;for(i=0;i<t.length;i+=1)if(n=z.getNode(t[i]),!n||!n.isValidNewParent(e))return!1;return!0}function G(e){var t,n,i="string"==typeof e?z.getNode(e):e,o=!0;return i&&i.getBaseId()&&i.getMetaTypeId()!==i.getId()?(t=z.getNode(i.getParentId()),n=z.getNode(t.getBaseId()),n&&n.getChildrenRelids().indexOf(i.getRelid())>-1&&(o=!1)):o=!1,o}function B(e){var t="string"==typeof e?z.getNode(e):e;return G(t)&&!!t.getRegistry(o.REPLACEABLE)}function W(e){var t="string"==typeof e?z.getNode(e):e,i=t.getPointerId(n.POINTER_CONSTRAINED_BY);return"string"==typeof i?i:t.getMetaTypeId(t)}function $(e,t){for(var n="string"==typeof e?z.getNode(e):e,i=n.getId(),o="string"==typeof t?t:t.getId();n;){if(i===o)return!0;if(i=n.getBaseId(),!i)return!1;n=z.getNode(i)}}function F(e,t){var n="string"==typeof e?z.getNode(e):e,i="string"==typeof t?t:t.getId(),o=!0;return o=B(n),o&&(o=$(t,W(n))),o&&(o=n.isValidNewBase(i)),o}var z,V=[n.POINTER_BASE,n.POINTER_SOURCE,n.POINTER_TARGET];return{initialize:l,isConnection:c,isConnectionType:d,canCreateChild:u,isValidConnection:g,isProjectFCO:m,canCreateChildren:y,canDeleteNode:v,getMETAAspectMergedValidChildrenTypes:C,canAddToSet:E,isAbstract:D,isPort:I,getValidPointerTypes:T,canCreateChildrenInAspect:P,getValidConnectionTypesFromSourceInAspect:N,getValidConnectionTypesInAspect:A,isValidTypeInAspect:w,isValidChildrenTypeInCrossCut:O,getValidPointerTargetTypesFromSource:S,getValidPointerTypesFromSourceToTarget:x,getValidSetTypesFromContainerToMember:M,getCrosscuts:R,getSets:L,getFCOId:k,canMoveNodeHere:j,canBeReplaceable:G,isReplaceable:B,getConstrainedById:W,isValidReplaceableTarget:F}}),define("js/Utils/DisplayFormat",["js/Constants","js/NodePropertyNames","js/RegistryKeys"],function(e,t,n){"use strict";function i(e){var t,n,i,s,a="",l=new RegExp((o+"\\w+").replace("$","\\$"),"g"),c={};if(e){t=e.getRegistry(r);do n=l.exec(t),n&&(c[n[0]]=void 0);while(n);a=t;for(i in c)c.hasOwnProperty(i)&&(s=new RegExp(i.replace("$","\\$"),"g"),"name"===i.replace(o,"")?c[i]=e.getFullyQualifiedName():c[i]=e.getAttribute(i.replace(o,"")),void 0!==c[i]&&null!==c[i]&&(a=a.replace(s,c[i])))}return a}var o=e.DISPLAY_FORMAT_ATTRIBUTE_MARKER,r=n.DISPLAY_FORMAT;return{resolve:i}}),define("js/Utils/GMEVisualConcepts",["jquery","js/Constants","js/NodePropertyNames","js/RegistryKeys","js/Panels/MetaEditor/MetaEditorConstants","js/Utils/DisplayFormat"],function(e,t,n,i,o,r){"use strict";var s,a={};a[t.LINE_STYLE.WIDTH]=1,a[t.LINE_STYLE.COLOR]="#000000",a[t.LINE_STYLE.PATTERN]=t.LINE_STYLE.PATTERNS.SOLID,a[t.LINE_STYLE.TYPE]=t.LINE_STYLE.TYPES.NONE,a[t.LINE_STYLE.START_ARROW]=t.LINE_STYLE.LINE_ARROWS.NONE,a[t.LINE_STYLE.END_ARROW]=t.LINE_STYLE.LINE_ARROWS.NONE,a[t.LINE_STYLE.CUSTOM_POINTS]=[];var l=function(e){s||(s=e)},c=function(e){var n,o,l=s.getNode(e),c={};if(n=function(e,t,n){var i,o;if(e&&(o=e.getRegistry(t)))switch(n){case"int":try{i=parseInt(o,10)}catch(r){i=void 0}break;case"array":try{i=_.isArray(o)?o.slice(0):JSON.parse(o),_.isArray(i)||(i=void 0)}catch(r){i=void 0}break;default:i=o}return i},l){switch(_.extend(c,a),o=n(l,i.LINE_LABEL_PLACEMENT)){case"src":c.srcText=r.resolve(l);break;case"dst":c.dstText=r.resolve(l);break;default:c.name=r.resolve(l)}o=n(l,i.LINE_WIDTH,"int"),o&&(c[t.LINE_STYLE.WIDTH]=o),o=n(l,i.COLOR),o&&""!==o&&(c[t.LINE_STYLE.COLOR]=o),o=n(l,i.LINE_STYLE),void 0!==o&&null!==o&&(c[t.LINE_STYLE.PATTERN]=o),o=n(l,i.LINE_TYPE),void 0!==o&&null!==o&&(c[t.LINE_STYLE.TYPE]=o),o=n(l,i.LINE_START_ARROW),o&&(c[t.LINE_STYLE.START_ARROW]=o),o=n(l,i.LINE_END_ARROW),o&&(c[t.LINE_STYLE.END_ARROW]=o)}return c};return{initialize:l,getConnectionVisualProperties:c}}),define("js/Utils/StateManager",["jquery","backbone","js/Constants","js/logger","common/util/assert"],function(e,t,n,i,o){"use strict";var r,s,a=Backbone.Model.extend({registerActiveObject:function(e){e="root"===e?"":e,s.debug("registerActiveObject, objId: ",e),this.set(n.STATE_ACTIVE_OBJECT,e)},getActiveObject:function(){return this.get(n.STATE_ACTIVE_OBJECT)},registerActiveSelection:function(e){o(_.isArray(e)),this.set(n.STATE_ACTIVE_SELECTION,e)},getActiveSelection:function(){return this.get(n.STATE_ACTIVE_SELECTION)},registerActiveAspect:function(e){this.set(n.STATE_ACTIVE_ASPECT,e,{silent:!0})},getActiveAspect:function(){return this.get(n.STATE_ACTIVE_ASPECT)},registerActiveVisualizer:function(e){this.set(n.STATE_ACTIVE_VISUALIZER,e)},getActiveVisualizer:function(){return this.get(n.STATE_ACTIVE_VISUALIZER)},registerActiveProjectName:function(e){this.set(n.STATE_ACTIVE_PROJECT_NAME,e)},getActiveProjectName:function(){return this.get(n.STATE_ACTIVE_PROJECT_NAME)},registerActiveBranchName:function(e){var t={};t[n.STATE_ACTIVE_BRANCH_NAME]=e,t[n.STATE_ACTIVE_COMMIT]=null,this.set(t)},getActiveBranch:function(){return this.get(n.STATE_ACTIVE_BRANCH_NAME)},registerActiveCommit:function(e){var t={};t[n.STATE_ACTIVE_BRANCH_NAME]=null,t[n.STATE_ACTIVE_COMMIT]=e,this.set(t)},getActiveCommit:function(){return this.get(n.STATE_ACTIVE_COMMIT)},registerActiveTab:function(e){this.set(n.STATE_ACTIVE_TAB,parseInt(e,10))},getActiveTab:function(){return this.get(n.STATE_ACTIVE_TAB)},registerSuppressVisualizerFromNode:function(e){this.set(n.STATE_SUPPRESS_VISUALIZER_FROM_NODE,e)},getSuppressVisualizerFromNode:function(){return this.get(n.STATE_SUPPRESS_VISUALIZER_FROM_NODE)},registerLayout:function(e){this.set(n.STATE_LAYOUT,e)},getLayout:function(){return this.get(n.STATE_LAYOUT)}}),l=function(){return r||(s=i.create("gme:Utils:StateManager",WebGMEGlobal.gmeConfig.client.log),r=new a,r.registerActiveAspect(n.ASPECT_ALL),r.registerSuppressVisualizerFromNode(!0),r.on("change",function(e,t){s.debug("",e,t)})),r};return{initialize:l}}),define("js/Utils/WebGMEUrlManager",["js/util","js/Constants"],function(e,t){"use strict";function n(e){var n="project="+encodeURIComponent(e.projectId);return e.branchName?n+="&branch="+e.branchName:e.commitId&&(n+="&commit="+e.commitId),e.nodeId?n+="&node="+e.nodeId:e.nodeId===t.PROJECT_ROOT_ID&&(n+="&node=root"),e.visualizer&&(n+="&visualizer="+e.visualizer),e.tab&&(n+="&tab="+e.tab),e.layout&&(n+="&layout="+e.layout),e.selection&&(n+="&selection="+e.selection.join(",")),n}function i(){var e={},t="";return WebGMEGlobal.State.getActiveProjectName()&&(e.projectId=WebGMEGlobal.State.getActiveProjectName(),WebGMEGlobal.State.getActiveBranch()?e.branchName=WebGMEGlobal.State.getActiveBranch():WebGMEGlobal.State.getActiveCommit()&&(e.commitId=WebGMEGlobal.State.getActiveCommit()),"string"==typeof WebGMEGlobal.State.getActiveObject()&&(e.nodeId=WebGMEGlobal.State.getActiveObject()),WebGMEGlobal.State.getActiveVisualizer()&&(e.visualizer=WebGMEGlobal.State.getActiveVisualizer()),null!==WebGMEGlobal.State.getActiveTab()&&void 0!==WebGMEGlobal.State.getActiveTab()&&(e.tab=WebGMEGlobal.State.getActiveTab()),null!==WebGMEGlobal.State.getLayout()&&void 0!==WebGMEGlobal.State.getLayout()&&(e.layout=WebGMEGlobal.State.getLayout()),WebGMEGlobal.State.getActiveSelection()&&(e.selection=WebGMEGlobal.State.getActiveSelection()),t=n(e)),t}function o(){return{layoutToLoad:e.getURLParameterByName("layout")||WebGMEGlobal.gmeConfig.visualization.layout["default"],commitToLoad:e.getURLParameterByName("commit").toLowerCase(),projectToLoad:e.getURLParameterByName("project"),objectToLoad:e.getURLParameterByName("node")||t.PROJECT_ROOT_ID,createNewProject:"true"===e.getURLParameterByName("create"),branchToLoad:e.getURLParameterByName("branch"),tabToSelect:e.getURLParameterByName("tab")||0,visualizerToLoad:e.getURLParameterByName("visualizer")||"ModelEditor",activeSelectionToLoad:e.getURLParameterByName("selection")?e.getURLParameterByName("selection").split(","):[]}}return{parseInitialThingsToDoFromUrl:o,serializeStateToUrl:i,getSearchQuery:n}}),define("css",[],function(){if("undefined"==typeof window)return{load:function(e,t,n){n()}};var e=document.getElementsByTagName("head")[0],t=window.navigator.userAgent.match(/Trident\/([^ ;]*)|AppleWebKit\/([^ ;]*)|Opera\/([^ ;]*)|rv\:([^ ;]*)(.*?)Gecko\/([^ ;]*)|MSIE\s([^ ;]*)|AndroidWebKit\/([^ ;]*)/)||0,n=!1,i=!0;t[1]||t[7]?n=parseInt(t[1])<6||parseInt(t[7])<=9:t[2]||t[8]?i=!1:t[4]&&(n=parseInt(t[4])<18);var o={};o.pluginBuilder="./css-builder";var r,s,a,l=function(){r=document.createElement("style"),e.appendChild(r),s=r.styleSheet||r.sheet},c=0,d=[],h=function(e){s.addImport(e),r.onload=function(){p()},c++,31==c&&(l(),c=0)},p=function(){a();var e=d.shift();return e?(a=e[1],void h(e[0])):void(a=null)},g=function(e,t){if(s&&s.addImport||l(),s&&s.addImport)a?d.push([e,t]):(h(e),a=t);else{r.textContent='@import "'+e+'";';var n=setInterval(function(){try{r.sheet.cssRules,clearInterval(n),t()}catch(e){}},10)}},u=function(t,n){var o=document.createElement("link");if(o.type="text/css",o.rel="stylesheet",i)o.onload=function(){o.onload=function(){},setTimeout(n,7)};else var r=setInterval(function(){for(var e=0;e<document.styleSheets.length;e++){var t=document.styleSheets[e];if(t.href==o.href)return clearInterval(r),n()}},10);o.href=t,e.appendChild(o)};return o.normalize=function(e,t){return".css"==e.substr(e.length-4,4)&&(e=e.substr(0,e.length-4)),t(e)},o.load=function(e,t,i,o){(n?g:u)(t.toUrl(e+".css"),i)},o}),define("css!js/Loader/styles/LoaderCircles",[],function(){}),define("js/Loader/LoaderCircles",["css!js/Loader/styles/LoaderCircles.css"],function(){"use strict";var e,t=36,n=5,i=14,o=30,r=200,s=20;return e=function(e){if(this._el=e.containerElement,0===this._el.length)throw new Error("LoaderCircles's container control with id:\""+e.containerElement+'" could not be found');this._loaderBackgroundCssProps={},this._loaderContentCssProps={}},e.prototype._initialize=function(){this._createElements()},e.prototype._removeElements=function(){this._loaderContainer&&this._loaderContainer.remove(),this._loaderContainer=null,this._loaderBackground&&this._loaderBackground.remove(),this._loaderBackground=null},e.prototype._createElements=function(){this._loaderContainer||(this._loaderContainer=$("<div/>",{"class":"loader-container"}).css(this._loaderContentCssProps),this._loaderBackground=$("<div/>",{"class":"loader-bg"}).css(this._loaderBackgroundCssProps),this._circleOuter=$("<div/>",{"class":"circle-o"}),this._circleInner=$("<div/>",{"class":"circle-i"}),this._size&&(this._circleOuter.css({width:this._size,height:this._size,"border-radius":this._size}),this._circleInner.css({width:this._size-s,height:this._size-s,"border-radius":this._size-s,top:0-t/3-this._size/2-(this._size-s)/2-2*n}),this._loaderContainer.css({width:this._size+t,height:this._size+t,"margin-top":(this._size+t)/-2,"margin-left":(this._size+t)/-2})),this._loaderContainer.append(this._circleOuter).append(this._circleInner),this._size&&this._size<o&&this._circleInner.remove(),this._el.append(this._loaderBackground).append(this._loaderContainer),this._el.width())},e.prototype.destroy=function(){this._removeElements()},e.prototype.stop=function(){this._removeElements()},e.prototype.start=function(){this._createElements()},e.prototype.foreGroundColor=function(e){this._loaderContentCssProps["background-color"]=e},e.prototype.setSize=function(e){var t=parseInt(e,10);i>t?this._size=i:t>r?this._size=r:this._size=t},e}),define("js/LayoutManager/LayoutManager",["js/logger","js/Loader/LoaderCircles"],function(e,t){"use strict";var n;return n=function(){this._currentLayout=void 0,this._currentLayoutName=void 0,this._logger=e.create("gme:LayoutManager:LayoutManager",WebGMEGlobal.gmeConfig.client.log),this._logger.debug("LayoutManager created."),this._startProgressBar(),this._panels={}},n.prototype.loadLayout=function(e,t){var n=this,i=["layout",e,e,e].join("/");this._logger.debug("LayoutManager loadLayout..."),this._currentLayout&&(this._logger.debug("Destroying layout: "+this._currentLayoutName),this._currentLayout.destroy(),this._currentLayout=void 0,this._currentLayoutName=void 0,$("body").empty()),this._startProgressBar(),this._logger.debug('Downloading layout "'+e+'"...'),require([i],function(i){i?(n._logger.debug('Layout "'+e+'" has been downloaded...'),n._currentLayoutName=e,n._currentLayout=new i,n._currentLayout.init(),t&&t.call(n)):n._logger.error('Layout "'+e+'" has been downloaded...BUT UNDEFINED!!!')},function(e){n._logger.error('Failed to load layout because of "'+e.requireType+'" with module "'+e.requireModules[0]+'"...')})},n.prototype.loadPanel=function(e,t){var n,i,o=this,r=e.panel,s=e.container,a=["panel",r].join("/");this._logger.debug('LayoutManager loadPanel with name: "'+name+'", container: "'+s+'"'),i=function(){t&&t.call(o)},this._panels[r]?this._logger.error("A Panel with the same name already exist!!!"):require([a],function(t){t?(o._logger.debug('Panel "'+r+'" has been downloaded...'),o._panels[r]=new t(o,e.params),n=o._currentLayout.addToContainer(o._panels[r],s),o._panels[r].afterAppend(),o._panels[r].setContainerUpdateFn(o._currentLayout,n)):o._logger.error('Panel "'+r+'" has been downloaded...BUT UNDEFINED!!!'),i(o._panels[r])},function(e){o._logger.error('Failed to load Panel "'+a+'" because of "'+e.requireType+'" with module "'+e.requireModules[0]+'"...'),i()})},n.prototype.addPanel=function(e,t,n){this._panels[e]=t,this._currentLayout.addToContainer(t,n),t.afterAppend()},n.prototype.removePanel=function(e){this._panels[e]&&(this._currentLayout.remove(this._panels[e]),delete this._panels[e])},n.prototype._startProgressBar=function(){var e;e=new t({containerElement:$("body")}),e.start()},n.prototype.setPanelReadOnly=function(e){var t;for(t in this._panels)this._panels.hasOwnProperty(t)&&this._panels[t].setReadOnly(e)},n}),define("js/Decorators/DecoratorManager",["js/logger"],function(e){"use strict";var t,n="decorators/",i="___N/A___";return t=function(){this._logger=e.create("gme:Decorators:DecoratorManager",WebGMEGlobal.gmeConfig.client.log),this._decorators={},this._widgetDecoratorCache={},this._logger.debug("Created")},t.prototype.downloadAll=function(e,t){function n(){s-=1,0===s&&(Object.keys(o._decorators).length===r?t():t("Failed to download all requested decorators "+e.toString()+" only got "+Object.keys(o._decorators).toString()))}var i,o=this,r=e.length,s=r;for(i=0;r>i;i+=1)o._downloadOne(e[i],n)},t.prototype.download=function(e,t,n){var i,o=e.slice(0),r=this;i=function(){var e,s,a,l=o.length;l>0?(r._logger.debug('Remaining decorators for widget "'+t+'": '+l+', "'+o+'"'),s=o.splice(0,1)[0],r._downloadOne(s,function(){if(r._decorators[s]&&(e=r._decorators[s].getDecoratorForWidget(t),e&&_.isArray(e)))for(a=e.len;a--;)-1===o.indexOf(e[a])&&o.push(e[a]);i(o)})):(r._logger.debug('No more decorators to download for widget "'+t+'"'),n.call(r))},this._logger.debug('Downloading decorators "'+e+'" for widget "'+t+'"'),i()},t.prototype.getDecoratorForWidget=function(e,t){var n;return this._widgetDecoratorCache[t]&&this._widgetDecoratorCache[t][e]?n=this._widgetDecoratorCache[t][e]:(this._lookupDecoratorForWidget(e,t),n=this._widgetDecoratorCache[t][e]),n===i&&(n=void 0),n},t.prototype._lookupDecoratorForWidget=function(e,t){var n,o,r,s=this;return this._logger.debug('_lookupDecoratorForWidget decorator: "'+e+'" for widget "'+t+'"'),this._widgetDecoratorCache[t]=this._widgetDecoratorCache[t]||{},r=function(e){var n,i,o=e.length;for(s._logger.debug("processDecoratorChain: "+e);o--;)if(i=e[o],s._decorators[i])if(n=s._decorators[i].getDecoratorForWidget(t),_.isArray(n))s._logger.debug("recursive processDecoratorChain at: "+i+" for: "+n),n=r(n);else if(n){s._logger.debug("processDecoratorChain return at: "+i);break}return n},this._decorators[e]&&(o=this._decorators[e].getDecoratorForWidget(t),_.isArray(o)?(this._logger.debug('fallback decorator list for decorator "'+e+'" for widget "'+t+'" is: '+o),n=r(o)):(this._logger.debug('found decorator: "'+e+'" for widget "'+t+'"'),n=o)),n?this._widgetDecoratorCache[t][e]=n:(this._logger.debug('There is no decorator with name "'+e+'" that supports widget "'+t+'"'),this._widgetDecoratorCache[t][e]=i),n},t.prototype._getDecoratorFullPath=function(e){return n+e+"/"+e},t.prototype._downloadOne=function(e,t){var n=this,i=this._getDecoratorFullPath(e);this._logger.debug('Initiating decorator download for "'+e+'"'),this._decorators[e]?(this._logger.debug('Decorator "'+e+'" has already been downloaded...'),t()):require([i],function(i){n._logger.debug('Decorator "'+e+'" has been successfully downloaded');try{n._decorators[e]=new i}catch(o){delete n._decorators[e],n._logger.error('Error while trying to instantiate decorator "'+e+'"...')}t.call(n)},function(i){n._logger.error('Failed to download decorator "'+e+'" because of "'+i.requireType+'" with module "'+i.requireModules[0]+'"...'),t.call(n)})},t}),define("js/KeyboardManager/KeyboardManager",["js/logger"],function(e){"use strict";function t(){h=h||e.create("gme:KeyboardManager:KeyboardManager",WebGMEGlobal.gmeConfig.client.log),WebGMEGlobal.SUPPORTS_TOUCH!==!0&&(d||i(),d.val(f).select().focus())}function n(n){h=h||e.create("gme:KeyboardManager:KeyboardManager",WebGMEGlobal.gmeConfig.client.log),y!==n&&(y=n,y&&(_.isFunction(y.onKeyDown)||h.warn('Listener is missing "onKeyDown"...'),_.isFunction(y.onKeyUp)||h.warn('Listener is missing "onKeyUp"...'))),t()}function i(){d||(d=$("<textarea/>",{"class":u}),d.css({position:"absolute",top:"-10000px",left:"-10000px"}),$("body").append(d))}function o(t){h=h||e.create("gme:KeyboardManager:KeyboardManager",WebGMEGlobal.gmeConfig.client.log),WebGMEGlobal.SUPPORTS_TOUCH!==!0&&b!==t&&(b=t,b===!0?(i(),d.on("keydown.KeyboardManager keyup.KeyboardManager",s),$("body").on("mousedown.KeyboardManager",r),d.on("copy.KeyboardManager",a),d.on("paste.KeyboardManager",l)):(d.off("keydown.KeyboardManager"),d.off("keyup.KeyboardManager"),$("body").off("mousedown.KeyboardManager"),d.off("copy.KeyboardManager"),d.off("paste.KeyboardManager")))}function r(e){var n=e&&e.target&&e.target.tagName,i=document.activeElement&&document.activeElement.nodeName,o=["INPUT","TEXTAREA","SELECT"];-1===o.indexOf(n)&&-1===o.indexOf(i)&&t();
}function s(e){var n,i={type:e.type,character:void 0,altKey:e.altKey,ctrlKey:e.ctrlKey,metaKey:e.metaKey,shiftKey:e.shiftKey,combo:"",oEvent:void 0};(!/textarea|select/i.test(e.target.nodeName)&&"text"!==e.target.type||e.target===d[0])&&y&&(i.character=p[e.which]||String.fromCharCode(e.which).toLowerCase(),e.altKey&&(i.combo+="alt+"),e.ctrlKey&&(i.combo+="ctrl+"),e.metaKey&&(i.combo+="meta+"),e.shiftKey&&(i.combo+="shift+"),i.combo+=i.character,h.debug(JSON.stringify(i)),-1===g.indexOf(i.combo)&&("keydown"===e.type?n=y.onKeyDown&&y.onKeyDown(i):"keyup"===e.type&&(n=y.onKeyUp&&y.onKeyUp(i))),void 0!==n&&(e.result=n)===!1&&(e.preventDefault(),e.stopPropagation()),t())}function a(e){var t,n=c(e);n?(y&&_.isFunction(y.onCopy)&&(t=y.onCopy(),"string"!=typeof t&&(t=JSON.stringify(t)),n.setData("text",t)),e.preventDefault(),e.stopPropagation()):alert(m)}function l(e){var t,n=c(e);n?(y&&_.isFunction(y.onPaste)&&(t=n.getData("text"),y.onPaste(t)),e.preventDefault(),e.stopPropagation()):alert(m)}function c(e){return e.originalEvent.clipboardData||window.clipboardData}var d,h,p={8:"backspace",9:"tab",13:"return",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"insert",46:"del",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",106:"*",107:"+",109:"-",110:".",111:"/",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",144:"numlock",145:"scroll",191:"/",224:"meta"},g=["ctrl+c","ctrl+x","ctrl+v"],u="webgme-clipboard-helper",f="webgme-clipboard",m="Your browser seems to be out of date :(.Please update your browser to the latest and greatest version!",b=!1,y=null;return{captureFocus:t,setListener:n,setEnabled:o}}),define("js/PanelManager/PanelManager",["js/logger","js/Constants"],function(e,t){"use strict";var n;return n=function(){this._logger=e.create("gme:PanelManager:PanelManager",WebGMEGlobal.gmeConfig.client.log),this._activePanel=void 0},n.prototype.setActivePanel=function(e){this._activePanel===e?this._activePanel.setActive(!0):(this._activePanel&&this._activePanel.setActive(!1),this._activePanel=void 0,e&&_.isFunction(e.setActive)&&(this._activePanel=e,this._activePanel.setActive(!0)),WebGMEGlobal.State.registerActiveVisualizer(this._activePanel[t.VISUALIZER_PANEL_IDENTIFIER])),WebGMEGlobal.KeyboardManager.captureFocus()},n.prototype.getActivePanel=function(){return this._activePanel},n}),define("js/WebGME.History",["jquery","js/logger"],function(e,t){"use strict";function n(){}function i(e){e=e||window.history.state,s=!0,WebGMEGlobal.State.clear({silent:!0}),r.debug("loading state:"+JSON.stringify(e)),WebGMEGlobal.State.set(e),s=!1}function o(){a||(r=t.create("gme:WebGME.History",WebGMEGlobal.gmeConfig.client.log),a=!0,WebGMEGlobal.State.on("change",function(){n(WebGMEGlobal.State.toJSON())}))}var r,s=!1,a=!1;return WebGMEGlobal.history!==!0&&(Object.defineProperty(WebGMEGlobal,"history",{value:!0,writable:!1,enumerable:!0,configurable:!1}),$(window).on("popstate",function(e){i(e.originalEvent.state)})),{initialize:o}}),define("js/Utils/PreferencesHelper",["underscore","common/util/assert"],function(e,t){"use strict";var n,i;n=function(e){this._registryList=e?JSON.parse(JSON.stringify(e)):[]},n.prototype.getRegistry=function(e,t,n){var o,r,s,a,l=this._registryList.length;for(o=0;l>o&&(s=this._registryList[o],a=i.getNode(s.containerID),!a||(r=a.getMemberRegistry(s.setID,e,t),void 0===r||null===r));o+=1);return void 0!==r&&null!==r||n!==!0||(a=i.getNode(e),a&&(r=a.getRegistry(t))),r},n.prototype.setRegistry=function(e,t,n){var o;0===this._registryList.length?i.setRegistry(e,t,n):(o=this._registryList[0],i.setMemberRegistry(o.containerID,e,o.setID,t,n))},n.prototype.delRegistry=function(e,t){var n;0===this._registryList.length?i.delRegistry(e,t):(n=this._registryList[0],i.delMemberRegistry(n.containerID,e,n.setID,t))};var o=function(e){i||(i=e)},r=function(e){return e&&(t(e),t(_.isArray(e)),t(e.length>0)),new n(e)};return{initialize:o,getPreferences:r}}),define("js/Controls/PropertyGrid/Widgets/WidgetBase",["jquery"],function(){"use strict";var e,t=$("<div/>",{"class":"widget"});return e=function(e){this.el=t.clone(),this.propertyValue=e.value,this.originalValue=e.value,this.propertyName=e.name,this.propertyID=e.id,this.propertyText=e.text,this.valueItems=e.valueItems,this.valueType=e.valueType||typeof e.value,this._isReadOnly=!1,this._alwaysReadOnly=e.alwaysReadOnly,this.__onChange=void 0,this.__onFinishChange=void 0},e.prototype.onChange=function(e){return this.__onChange=e,this},e.prototype.onFinishChange=function(e){return this.__onFinishChange=e,this},e.prototype.setValue=function(e){var t=this.propertyValue;return this._isReadOnly!==!0&&e!==t&&(this.propertyValue=e,this.__onChange&&this.__onChange.call(this,{id:this.propertyID,oldValue:t,newValue:e}),this.updateDisplay()),this},e.prototype.fireFinishChange=function(){this.originalValue!==this.propertyValue&&(this.__onFinishChange&&this.__onFinishChange.call(this,{id:this.propertyID,oldValue:this.originalValue,newValue:this.propertyValue}),this.originalValue=this.propertyValue)},e.prototype.getValue=function(){return this.propertyValue},e.prototype.updateDisplay=function(){return this},e.prototype.remove=function(){this.destroy(),this.__onChange=void 0,this.__onFinishChange=void 0,this.el.remove()},e.prototype.setReadOnly=function(e){this._alwaysReadOnly?this._isReadOnly=!0:this._isReadOnly=e},e.prototype.destroy=function(){},e}),define("css!js/Controls/PropertyGrid/Widgets/styles/AssetWidget",[],function(){}),define("js/Controls/PropertyGrid/Widgets/AssetWidget",["js/Controls/PropertyGrid/Widgets/WidgetBase","blob/BlobClient","js/logger","css!./styles/AssetWidget.css"],function(e,t,n){"use strict";var i,o=$('<a class="btn btn-mini btn-dialog-open"><i class="glyphicon glyphicon-file"/></a>'),r=$('<input type="file" />'),s=$('<div class="asset-widget" />'),a=$('<div class="upload-progress-bar" />'),l=$('<a class="blob-download-link" href="" target="_self"/>');return i=function(t){e.call(this,t),this._logger=n.create("gme:js:Controls:PropertyGrid:Widgets:AssetWidget",WebGMEGlobal.gmeConfig.client.log),this.__el=s.clone(),this.el.append(this.__el),this.__progressBar=a.clone(),this.__el.append(this.__progressBar),this.__progressBar.hide(),this.__assetLink=l.clone(),this.__el.append(this.__assetLink),this.__fileDropTarget=this.__el,this.__btnAttach=o.clone(),this.__el.append(this.__btnAttach),this.__fileUploadInput=r.clone(),this.__files=[],this.__timeoutId=null,this._attachFileDropHandlers(),this.updateDisplay()},i.prototype=Object.create(e.prototype),i.prototype.constructor=i,i.prototype._attachFileDropHandlers=function(){var e=this;this.__btnAttach.on("click",function(t){t.stopPropagation(),t.preventDefault(),e.__fileUploadInput.click()}),this.__fileUploadInput.on("change",function(t){t.stopPropagation(),t.preventDefault(),e._fileSelectHandler(t.originalEvent)}),this.__fileDropTarget.on("dragover",function(e){e.stopPropagation(),e.preventDefault()}),this.__fileDropTarget.on("dragenter",function(t){t.stopPropagation(),t.preventDefault(),e.__fileDropTarget.addClass("hover")}),this.__fileDropTarget.on("dragleave",function(t){t.stopPropagation(),t.preventDefault(),e.__fileDropTarget.removeClass("hover")}),this.__fileDropTarget.on("drop",function(t){t.stopPropagation(),t.preventDefault(),e.__fileDropTarget.removeClass("hover"),e._fileSelectHandler(t.originalEvent)})},i.prototype._detachFileDropHandlers=function(){this.__fileUploadInput.off("change"),this.__fileDropTarget.off("dragover"),this.__fileDropTarget.off("dragenter"),this.__fileDropTarget.off("dragleave"),this.__fileDropTarget.off("drop"),this.__btnAttach.off("click")},i.prototype.updateDisplay=function(){var n=new t({logger:this._logger.fork("BlobClient")}),i=this.propertyValue?n.getDownloadURL(this.propertyValue):"",o=this.propertyValue,r=this;return this.__assetLink.text(o),this.__assetLink.attr("title",o),this.__assetLink.attr("href",i),this.propertyValue&&n.getMetadata(this.propertyValue,function(e,t){o=e?"ERROR...":t.name+" ("+r._humanFileSize(t.size)+")",r.__assetLink.text(o),r.__assetLink.attr("title",o)}),e.prototype.updateDisplay.call(this)},i.prototype.setReadOnly=function(t){e.prototype.setReadOnly.call(this,t),this.__btnAttach&&(this._isReadOnly===!0?this.__btnAttach.disable(!0):this.__btnAttach.disable(!1)),this._detachFileDropHandlers(),this._isReadOnly!==!0&&this._attachFileDropHandlers()},i.prototype._fileSelectHandler=function(e){function n(e,t){var n=p.__progressBar.text();p.__timeoutId||(""===n||n===e?"number"==typeof t.percent&&100!==t.percent?(p.__progressBar.width(t.percent+"%"),p.__progressBar.text(e)):p.__progressBar.text(""):100===t.percent&&(p.__progressBar.width(t.percent+"%"),p.__progressBar.text(e),p.__timeoutId=setTimeout(function(){p.__progressBar&&(p.__progressBar.text(""),p.__progressBar.width(0)),p.__timeoutId=null},500)))}function i(e,t){p.__assetLink.show(),p.__progressBar.width(0),p.__progressBar.text(""),p.__progressBar.hide(),p.__timeoutId=null,e?p._logger.error(e):(p.setValue(t),p.fireFinishChange(),p._attachFileDropHandlers(!1))}var o,r,s,a,l,c,d,h,p=this;if(o=new t({logger:this._logger.fork("BlobClient"),uploadProgressHandler:n}),e.stopPropagation(),e.preventDefault(),a=e.target.files||e.dataTransfer.files,a&&a.length>0)for(this.__files=a,this._detachFileDropHandlers(!0),this.__assetLink.hide(),this.__progressBar.show(),l=p.propertyName,c=o.createArtifact(l),d=a.length,h=function(e,t){d-=1,0===d&&(a.length>1?c.save(function(e,t){i(e,t)}):i(e,t))},r=0;r<a.length;r+=1)s=a[r],c.addFileAsSoftLink(s.name,s,h)},i.prototype._humanFileSize=function(e,t){var n=t?1e3:1024,i=t?["kB","MB","GB","TB","PB","EB","ZB","YB"]:["KiB","MiB","GiB","TiB","PiB","EiB","ZiB","YiB"],o=-1;if(n>e)return e+" B";do e/=n,o+=1;while(e>=n);return e.toFixed(1)+" "+i[o]},i.prototype.getTargetAsJson=function(e){var t,n,i=this,o=null;this.__files&&this.__files.length>0?(t=this.__files[0],n=new FileReader,n.onload=function(t){if(t.target&&t.target.result)try{o=JSON.parse(t.target.result)}catch(n){i._logger.error("failed to read asset on the client side",n),o=null}e(o)},n.readAsText(t)):e(null)},i.prototype.destroy=function(){this._detachFileDropHandlers(),clearTimeout(this.__timeoutId),e.prototype.destroy.call(this)},i}),define("text",["module"],function(e){"use strict";var t,n,i,o,r,s=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],a=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,l=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,c="undefined"!=typeof location&&location.href,d=c&&location.protocol&&location.protocol.replace(/\:/,""),h=c&&location.hostname,p=c&&(location.port||void 0),g={},u=e.config&&e.config()||{};return t={version:"2.0.12",strip:function(e){if(e){e=e.replace(a,"");var t=e.match(l);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:u.createXhr||function(){var e,t,n;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(t=0;3>t;t+=1){n=s[t];try{e=new ActiveXObject(n)}catch(i){}if(e){s=[n];break}}return e},parseName:function(e){var t,n,i,o=!1,r=e.indexOf("."),s=0===e.indexOf("./")||0===e.indexOf("../");return-1!==r&&(!s||r>1)?(t=e.substring(0,r),n=e.substring(r+1,e.length)):t=e,i=n||t,r=i.indexOf("!"),-1!==r&&(o="strip"===i.substring(r+1),i=i.substring(0,r),n?n=i:t=i),{moduleName:t,ext:n,strip:o}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,i,o){var r,s,a,l=t.xdRegExp.exec(e);return l?(r=l[2],s=l[3],s=s.split(":"),a=s[1],s=s[0],!(r&&r!==n||s&&s.toLowerCase()!==i.toLowerCase()||(a||s)&&a!==o)):!0},finishLoad:function(e,n,i,o){i=n?t.strip(i):i,u.isBuild&&(g[e]=i),o(i)},load:function(e,n,i,o){if(o&&o.isBuild&&!o.inlineText)return void i();u.isBuild=o&&o.isBuild;var r=t.parseName(e),s=r.moduleName+(r.ext?"."+r.ext:""),a=n.toUrl(s),l=u.useXhr||t.useXhr;return 0===a.indexOf("empty:")?void i():void(!c||l(a,d,h,p)?t.get(a,function(n){t.finishLoad(e,r.strip,n,i)},function(e){i.error&&i.error(e)}):n([s],function(e){t.finishLoad(r.moduleName+"."+r.ext,r.strip,e,i)}))},write:function(e,n,i,o){if(g.hasOwnProperty(n)){var r=t.jsEscape(g[n]);i.asModule(e+"!"+n,"define(function () { return '"+r+"';});\n")}},writeFile:function(e,n,i,o,r){var s=t.parseName(n),a=s.ext?"."+s.ext:"",l=s.moduleName+a,c=i.toUrl(s.moduleName+a)+".js";t.load(l,i,function(n){var i=function(e){return o(c,e)};i.asModule=function(e,t){return o.asModule(e,c,t)},t.write(e,l,i,r)},r)}},"node"===u.env||!u.env&&"undefined"!=typeof process&&process.versions&&process.versions.node&&!process.versions["node-webkit"]?(n=require.nodeRequire("fs"),t.get=function(e,t,i){try{var o=n.readFileSync(e,"utf8");0===o.indexOf("\ufeff")&&(o=o.substring(1)),t(o)}catch(r){i&&i(r)}}):"xhr"===u.env||!u.env&&t.createXhr()?t.get=function(e,n,i,o){var r,s=t.createXhr();if(s.open("GET",e,!0),o)for(r in o)o.hasOwnProperty(r)&&s.setRequestHeader(r.toLowerCase(),o[r]);u.onXhr&&u.onXhr(s,e),s.onreadystatechange=function(t){var o,r;4===s.readyState&&(o=s.status||0,o>399&&600>o?(r=new Error(e+" HTTP status: "+o),r.xhr=s,i&&i(r)):n(s.responseText),u.onXhrComplete&&u.onXhrComplete(s,e))},s.send(null)}:"rhino"===u.env||!u.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java?t.get=function(e,t){var n,i,o="utf-8",r=new java.io.File(e),s=java.lang.System.getProperty("line.separator"),a=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(r),o)),l="";try{for(n=new java.lang.StringBuffer,i=a.readLine(),i&&i.length()&&65279===i.charAt(0)&&(i=i.substring(1)),null!==i&&n.append(i);null!==(i=a.readLine());)n.append(s),n.append(i);l=String(n.toString())}finally{a.close()}t(l)}:("xpconnect"===u.env||!u.env&&"undefined"!=typeof Components&&Components.classes&&Components.interfaces)&&(i=Components.classes,o=Components.interfaces,Components.utils["import"]("resource://gre/modules/FileUtils.jsm"),r="@mozilla.org/windows-registry-key;1"in i,t.get=function(e,t){var n,s,a,l={};r&&(e=e.replace(/\//g,"\\")),a=new FileUtils.File(e);try{n=i["@mozilla.org/network/file-input-stream;1"].createInstance(o.nsIFileInputStream),n.init(a,1,0,!1),s=i["@mozilla.org/intl/converter-input-stream;1"].createInstance(o.nsIConverterInputStream),s.init(n,"utf-8",n.available(),o.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),s.readString(n.available(),l),s.close(),n.close(),t(l.value)}catch(c){throw new Error((a&&a.path||"")+": "+c)}}),t}),define("text!js/Dialogs/CreateProject/templates/CreateProjectDialog.html",[],function(){return'<div class="create-new-project-dialog modal fade" tabindex="-1" role="dialog">\r\n    <div class="modal-dialog">\r\n        <div class="modal-content">\r\n            <div class="modal-header">\r\n                <button type="button" class="close" data-dismiss="modal">×</button>\r\n                <i class="header-icon gme-icon"></i><span>Create new project</span>\r\n            </div>\r\n            <div class="pre-body">\r\n                <div class="tabContainer">\r\n                    <ul class="nav nav-tabs">\r\n                        <li class="tab snap-shot"><a href="#" data-toggle="tab">Seed</a></li>\r\n                        <li class="tab duplicate"><a href="#" data-toggle="tab">Duplicate</a></li>\r\n                        <li class="tab blob"><a href="#" data-toggle="tab">Import</a></li>\r\n                    </ul>\r\n                </div>\r\n            </div>\r\n            <div class="modal-body">\r\n                <form class="form-horizontal snap-shot activated" role="form">\r\n                    <h5>Choose an existing seed\r\n                        <i class="glyphicon glyphicon-info-sign toggle-info-btn snap-shot-info"/>\r\n                    </h5>\r\n                    <span class="type-description snap-shot-info hidden">Creates a new project from an existing snapshot.\r\n                        It can either be a template file-seed available on the server or a branch from one of the existing projects.\r\n                        The new project will have a single commit and a branch (master) pointing to the commit.\r\n                     </span>\r\n                    <span class="selection">\r\n                        <select class="form-control selector snap-shot pull-left">\r\n                            <optgroup class="file" label="Template File"/>\r\n                            <optgroup class="db" label="Existing Projects with a single branch"/>\r\n                        </select>\r\n                    </span>\r\n                </form>\r\n                <form class="form-horizontal duplicate" role="form">\r\n                    <h5>Duplicate project\r\n                        <i class="glyphicon glyphicon-info-sign toggle-info-btn duplicate-info"/>\r\n                    </h5>\r\n                    <span class="type-description duplicate-info hidden">This will make a full copy of an existing project\r\n                        with its entire history. This includes all commits, branches and data-objects.\r\n                     </span>\r\n                    <span class="selection">\r\n                        <select class="form-control selector duplicate-project pull-left">\r\n                            <optgroup class="project-id" label="Available Projects"/>\r\n                        </select>\r\n                    </span>\r\n                </form>\r\n                <form class="form-horizontal blob">\r\n                    <h5>Import from file\r\n                        <i class="glyphicon glyphicon-info-sign toggle-info-btn blob-info"/>\r\n                    </h5>\r\n                    <span class="type-description blob-info hidden"> Creates a new project from the uploaded snapshot.\r\n                       The new project will have a single commit and a branch (master) pointing to the commit.\r\n                     </span>\r\n                    <span class="selection selection-blob">\r\n\r\n                    </span>\r\n                </form>\r\n                <!--<div class="alert alert-error"-->\r\n                     <!--style="margin-top:5px; text-align: center;font-weight: bold; overflow: hidden; text-overflow: ellipsis">-->\r\n                <!--</div>-->\r\n            </div>\r\n            <div class="modal-footer">\r\n                <button class="btn btn-primary btn-create btn-create-snap-shot activated">Create</button>\r\n                <button class="btn btn-primary btn-create btn-duplicate">Create</button>\r\n                <button class="btn btn-primary btn-create btn-create-blob">Create</button>\r\n                <button class="btn btn-default" data-dismiss="modal">Cancel</button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>'}),define("css!js/Dialogs/CreateProject/styles/CreateProjectDialog",[],function(){}),define("js/Dialogs/CreateProject/CreateProjectDialog",["js/Loader/LoaderCircles","common/storage/util","common/core/constants","js/Controls/PropertyGrid/Widgets/AssetWidget","blob/BlobClient","text!./templates/CreateProjectDialog.html","css!./styles/CreateProjectDialog.css"],function(e,t,n,i,o,r){"use strict";var s;return s=function(e,t,n,r){this._client=e,this._logger=r.fork("CreateProjectDialog"),this.blobClient=new o({logger:this._logger.fork("BlobClient")}),this.newProjectId=t,this.seedProjectName=WebGMEGlobal.gmeConfig.seedProjects.defaultProject,this.seedProjectType="file",this.seedProjectBranch="master",this.seedCommitHash=null,this.assetWidget=new i({propertyName:"ImportFile",propertyValue:""}),this.assetWidget.el.addClass("form-control selector pull-left"),this.initialTab=n||"seed",this._blobIsPackage=!1,this._logger.debug("Create form seed ctor")},s.prototype.show=function(e){var t=this;this._fnCallback=e,this._initDialog(),this._dialog.on("hide.bs.modal",function(){t._dialog.find("li.tab").off("click"),t._dialog.find(".toggle-info-btn").off("click"),t._btnCreateSnapShot.off("click"),t._btnCreateBlob.off("click"),t._btnDuplicate.off("click"),t._dialog.remove(),t._dialog.empty(),t._dialog=void 0}),this._dialog.modal("show")},s.prototype._initDialog=function(){function n(e){if(i._formSnapShot.removeClass("activated"),i._formDuplicate.removeClass("activated"),i._formBlob.removeClass("activated"),i._btnCreateSnapShot.removeClass("activated"),i._btnDuplicate.removeClass("activated"),i._btnCreateBlob.removeClass("activated"),e.hasClass("snap-shot"))i._formSnapShot.addClass("activated"),i._btnCreateSnapShot.addClass("activated");else if(e.hasClass("duplicate"))i._formDuplicate.addClass("activated"),i._btnDuplicate.addClass("activated");else{if(!e.hasClass("blob"))return;i._formBlob.addClass("activated"),i._btnCreateBlob.addClass("activated")}}var i=this;this._dialog=$(r),this._dialog.find(".selection-blob").append(this.assetWidget.el),this._formSnapShot=this._dialog.find("form.snap-shot"),this._formDuplicate=this._dialog.find("form.duplicate"),this._formBlob=this._dialog.find("form.blob"),this._btnCreateSnapShot=this._dialog.find(".btn-create-snap-shot"),this._btnDuplicate=this._dialog.find(".btn-duplicate"),this._btnCreateBlob=this._dialog.find(".btn-create-blob"),this._selectSnapShot=this._formSnapShot.find("select.snap-shot"),this._optGroupFile=this._selectSnapShot.find("optgroup.file"),this._optGroupDb=this._selectSnapShot.find("optgroup.db"),this._selectSnapShot.children().remove(),this._optGroupFile.children().remove(),this._selectSnapShot.append(this._optGroupFile),this._optGroupDb.children().remove(),this._selectSnapShot.append(this._optGroupDb),this._selectDuplicate=this._formDuplicate.find("select.duplicate-project"),this._optGroupDuplicate=this._selectDuplicate.find("optgroup.project-id"),this._optGroupDuplicate.children().remove(),this._selectDuplicate.append(this._optGroupDuplicate),this._loader=new e({containerElement:this._dialog}),this._btnCancel=this._dialog.find(".btn-cancel"),WebGMEGlobal.gmeConfig.seedProjects.allowDuplication===!1&&this._dialog.find("li.duplicate").addClass("disabled-from-config"),n("import"===i.initialTab?this._dialog.find("li.blob").addClass("active"):this._dialog.find("li.snap-shot").addClass("active")),this._dialog.find("li.tab").on("click",function(){n($(this))}),this._dialog.find(".toggle-info-btn").on("click",function(e){var t,n=$(this);if(e.preventDefault(),e.stopPropagation(),n.hasClass("snap-shot-info"))t=i._dialog.find("span.snap-shot-info");else if(n.hasClass("duplicate-info"))t=i._dialog.find("span.duplicate-info");else{if(!n.hasClass("blob-info"))return;t=i._dialog.find("span.blob-info")}t.hasClass("hidden")?t.removeClass("hidden"):t.addClass("hidden")}),this._btnCreateSnapShot.on("click",function(e){e.preventDefault(),e.stopPropagation(),i._dialog.modal("hide"),i._fnCallback&&(i._logger.debug(i._selectSnapShot.val()),i.seedProjectType=i._selectSnapShot.val().slice(0,i._selectSnapShot.val().indexOf(":")),i.seedProjectName=i._selectSnapShot.val().slice(i._selectSnapShot.val().indexOf(":")+1),"db"===i.seedProjectType&&(i.seedProjectName=i._selectSnapShot.val().slice(i._selectSnapShot.val().indexOf(":")+1,i._selectSnapShot.val().indexOf("#")),i.seedCommitHash=i._selectSnapShot.val().slice(i._selectSnapShot.val().indexOf("#"))),i._fnCallback(i.seedProjectType,i.seedProjectName,i.seedProjectBranch,i.seedCommitHash))}),this._btnCreateBlob.on("click",function(e){e.preventDefault(),e.stopPropagation(),i._dialog.modal("hide"),i._fnCallback&&i.assetWidget.propertyValue&&i._fnCallback(i._blobIsPackage?"package":"blob",i.assetWidget.propertyValue,null,null)}),this._btnCreateBlob.disable(!0),this.assetWidget.onFinishChange(function(e){return i._btnCreateBlob.disable(!0),e.newValue?void i.blobClient.getMetadata(e.newValue).then(function(e){if(e.name.toLowerCase().lastIndexOf(".webgmex")!==e.name.length-".webgmex".length)throw new Error("Not .webgmex extension");i._blobIsPackage=!0,i._btnCreateBlob.disable(!1)})["catch"](function(e){i._logger.error("Error in uploaded file",e)}):void i._logger.error(new Error("New data does not have a value, "+e))}),this._btnDuplicate.on("click",function(e){e.preventDefault(),e.stopPropagation(),i._logger.debug("Duplicating with value",i._selectDuplicate.val()),i._dialog.modal("hide"),i._fnCallback&&i._fnCallback("duplicate",i._selectDuplicate.val(),null,null)}),i._loader.start(),i._client.getProjects({branches:!0},function(e,n){var o,r,s,a,l,c,d=WebGMEGlobal.allSeeds||[];for(l=0;l<d.length;l+=1)i._optGroupFile.append($("<option>",{text:d[l],value:"file:"+d[l]})),i.seedProjectName===d[l]&&(c="file:"+d[l]);if(e)return i.logger.error(e),void i._loader.stop();for(l=0;l<n.length;l+=1)if(o=n[l]._id,r=t.getProjectDisplayedNameFromProjectId(o),i._optGroupDuplicate.append($("<option>",{text:r,value:o})),1===Object.keys(n[l].branches).length)s=Object.keys(n[l].branches)[0],i._optGroupDb.append($("<option>",{text:r+" ("+s+" "+n[l].branches[s].slice(0,8)+")",value:"db:"+o+n[l].branches[s]})),c||i.seedProjectName!==o||(c="db:"+o+n[l].branches[s]);else{a=$("<optgroup>",{label:r}),i._selectSnapShot.append(a);for(s in n[l].branches)n[l].branches.hasOwnProperty(s)&&a.append($("<option>",{text:r+" ("+s+" "+n[l].branches[s].slice(0,8)+")",value:"db:"+o+n[l].branches[s]}));s=n[l].branches.hasOwnProperty("master")?"master":Object.keys(n[l].branches)[0],c||i.seedProjectName!==o||(c="db:"+o+s)}c&&i._selectSnapShot.val(c),i._loader.stop()})},s.prototype._displayMessage=function(e,t){this._importErrorLabel.removeClass("alert-success").removeClass("alert-danger"),t===!0?this._importErrorLabel.addClass("alert-danger"):this._importErrorLabel.addClass("alert-success"),this._importErrorLabel.html(e),this._importErrorLabel.hide(),this._importErrorLabel.fadeIn()},s}),define("text!js/Dialogs/Confirm/templates/ConfirmDialog.html",[],function(){return'<div class="confirm-dialog modal fade" tabindex="-1" role="dialog">\r\n    <div class="modal-dialog">\r\n        <div class="modal-content">\r\n            <div class="modal-header">\r\n                <button type="button" class="close" data-dismiss="modal">×</button>\r\n                <i class="header-icon"></i><span class="title-text">Confirm delete</span>\r\n            </div>\r\n            <div class="modal-body">\r\n                <div class="question-text">Are you sure you want to delete?</div>\r\n                <div class="delete-item"></div>\r\n                <form class="form-horizontal" role="form">\r\n                    <div class="input-group">\r\n                        <span class="input-group-addon">Input</span>\r\n                        <input type="text" class="form-control">\r\n                    </div>\r\n                </form>\r\n            </div>\r\n            <div class="modal-footer">\r\n                <form>\r\n                    <label class="do-not-ask-again pull-left">\r\n                        <input type="checkbox"> Don\'t ask me again\r\n                    </label>\r\n                </form>\r\n                <button class="btn btn-ok">OK</button>\r\n                <button class="btn btn-default btn-cancel">Cancel</button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>'}),define("css!js/Dialogs/Confirm/styles/ConfirmDialog",[],function(){}),define("js/Dialogs/Confirm/ConfirmDialog",["text!./templates/ConfirmDialog.html","css!./styles/ConfirmDialog.css"],function(e){"use strict";function t(){this._dialog=null,this._okBtn=null,this._cancelBtn=null,this._dontAsk=null}return t.prototype.show=function(t,n){var i,o,r=this;this._dialog=$(e),this._contentDiv=this._dialog.find(".modal-content"),this._dontAsk=this._contentDiv.find(".do-not-ask-again"),this._icon=this._contentDiv.find(".header-icon"),this._okBtn=this._contentDiv.find(".btn-ok"),this._cancelBtn=this._contentDiv.find(".btn-cancel"),this._inputForm=this._contentDiv.find(".form-horizontal"),t.input?(this._inputForm.find(".input-group-addon").text(t.input.label),this._formControl=this._inputForm.find(".form-control"),t.input.placeHolder&&r._formControl.attr("placeholder",t.input.placeHolder),t.input.required&&r._okBtn.disable(!0),i="function"==typeof t.input.checkFn?t.input.checkFn:function(){return!0},r._formControl.on("keyup",function(){var e=$(this);i(e.val())?(e.parent().removeClass("has-error"),r._okBtn.disable(!1)):(e.parent().addClass("has-error"),r._okBtn.disable(!0)),o=e.val()}),r._formControl.on("keydown",function(e){var t=13===e.which;t&&(e.preventDefault(),e.stopPropagation(),i(o)&&(r._dialog.modal("hide"),n(r._dontAsk.find("input").is(":checked"),o)))})):this._inputForm.hide(),t.severity?(this._contentDiv.addClass(t.severity),"info"===t.severity?this._okBtn.addClass("btn-primary"):this._okBtn.addClass("btn-"+t.severity)):this._okBtn.addClass("btn-danger"),t.enableDontAskAgain!==!0&&this._dontAsk.addClass("do-not-show"),t.iconClass?this._icon.addClass(t.iconClass):this._icon.addClass("glyphicon glyphicon-trash"),t.title&&this._contentDiv.find(".title-text").text(t.title),t.question&&this._contentDiv.find(".question-text").text(t.question),t.deleteItem&&this._contentDiv.find(".delete-item").text(t.deleteItem),this._okBtn.on("click",function(e){e.preventDefault(),e.stopPropagation(),r._dialog.modal("hide"),n(r._dontAsk.find("input").is(":checked"),o)}),this._cancelBtn.on("click",function(e){e.preventDefault(),e.stopPropagation(),r._dialog.modal("hide")}),this._dialog.on("hide.bs.modal",function(){r._dialog.remove(),r._dialog.empty(),r._dialog=void 0,"function"==typeof t.onHideFn&&t.onHideFn()}),this._dialog.modal("show")},t}),define("text!js/Dialogs/Projects/templates/ProjectsDialog.html",[],function(){return'<div class="projects-dialog modal fade" tabindex="-1" role="dialog">\r\n    <div class="modal-dialog modal-lg">\r\n        <div class="modal-content">\r\n            <div class="modal-header">\r\n                <button type="button" class="close" data-dismiss="modal">×</button>\r\n                <i class="header-icon gme-icon"></i><span>Projects</span>\r\n            </div>\r\n            <div class="pre-body">\r\n                <div class="tabContainer"></div>\r\n            </div>\r\n            <div class="modal-body">\r\n                <table class="table table-projects">\r\n                    <thead>\r\n                        <tr class="with-children">\r\n                            <th class="title-owner">Owner\r\n                                <i class="glyphicon glyphicon-sort-by-attributes-alt sorted in-order"/>\r\n                                <i class="glyphicon glyphicon-sort-by-attributes sorted rev-order"/>\r\n                            </th>\r\n                            <th class="title-name">Name\r\n                                <i class="glyphicon glyphicon-sort-by-attributes-alt sorted in-order"/>\r\n                                <i class="glyphicon glyphicon-sort-by-attributes sorted rev-order"/>\r\n                            </th>\r\n                            <th class="title-modified">Last Modified\r\n                                <i class="glyphicon glyphicon-sort-by-attributes-alt sorted in-order"/>\r\n                                <i class="glyphicon glyphicon-sort-by-attributes sorted rev-order"/>\r\n                            </th>\r\n                            <th class="title-viewed extra-info info-hidden">Last Viewed\r\n                                <i class="glyphicon glyphicon-sort-by-attributes-alt sorted in-order"/>\r\n                                <i class="glyphicon glyphicon-sort-by-attributes sorted rev-order"/>\r\n                            </th>\r\n                            <th class="title-created extra-info info-hidden">Created\r\n                                <i class="glyphicon glyphicon-sort-by-attributes-alt sorted in-order"/>\r\n                                <i class="glyphicon glyphicon-sort-by-attributes sorted rev-order"/>\r\n                            </th>\r\n                            <th class="title-icons">\r\n                                <i class="btn btn-micro btn-default btn-info-toggle glyphicon glyphicon-plus" title="Show/Hide Info"/>\r\n                            </th>\r\n                        </tr>\r\n                        <tr class="with-no-children">\r\n                            <th>No projects in this group...</th>\r\n                        </tr>\r\n                    </thead>\r\n                    <tbody class="project-list">\r\n                    </tbody>\r\n                </table>\r\n            </div>\r\n            <div class="modal-footer">\r\n                <div class="panel-buttons">\r\n                    <button class="btn btn-default pull-left btn-refresh" title="Reload project list..."\r\n                            style="position: relative;"><i class="glyphicon glyphicon-refresh"></i></button>\r\n                    <button class="btn btn-default pull-left btn-create-new">Create new...</button>\r\n                    <button class="btn btn-default" data-dismiss="modal">Close</button>\r\n                </div>\r\n                <div class="panel-create-new control-group">\r\n                    <div class="input-group">\r\n                        <div class="input-group-btn">\r\n                            <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">\r\n                                <span class="selected-owner-id" title="Owner of New Project">Username</span>\r\n                                <span class="caret"></span>\r\n                            </button>\r\n                            <ul class="dropdown-menu ownerId-list">\r\n                            </ul>\r\n                        </div><!-- /btn-group -->\r\n                        <input type="text" class="input-xlarge txt-project-name form-control"\r\n                               placeholder="Project name..." />\r\n                    </div><!-- /input-group -->\r\n\r\n                    <button class="btn btn-primary btn-save corner-button" disabled>Create</button>\r\n                    <button class="btn btn-default btn-cancel corner-button">Cancel</button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>';
}),define("css!js/Dialogs/Projects/styles/ProjectsDialog",[],function(){}),define("js/Dialogs/Projects/ProjectsDialog",["js/logger","js/Constants","js/Loader/LoaderCircles","js/Utils/GMEConcepts","js/Dialogs/CreateProject/CreateProjectDialog","js/Dialogs/Confirm/ConfirmDialog","common/storage/util","js/util","common/regexp","text!./templates/ProjectsDialog.html","css!./styles/ProjectsDialog.css"],function(e,t,n,i,o,r,s,a,l,c){"use strict";var d,h="DATA_PROJECT",p="READ_ONLY_FILTER",g=$('<tr class="project-row"></tr>');return d=function(t,n,i){this._logger=e.create("gme:Dialogs:Projects:ProjectsDialog",WebGMEGlobal.gmeConfig.client.log),this._client=t,this._projectIds=[],this._projectList={},this._filter=void 0,this._userId=null,this._ownerId=null,this._creatingNew=n,this._createType=i||"seed",this._logger.debug("Created"),this._dontAskOnDelete=!1,this._openingProject=!1},d.prototype.show=function(){var e=this;this._initDialog(),this._dialog.modal("show"),this._dialog.on("hidden.bs.modal",function(){e._tableBody.off("dblclick"),e._tableBody.off("click"),e._tableHead.off("click"),e._btnCreateNew.off("click"),e._btnNewProjectCancel.off("click"),e._ownerIdList.off("click"),e._txtNewProjectName.off("keyup"),e._txtNewProjectName.off("keydown"),e._btnNewProjectCreate.off("click"),e._btnRefresh.off("click"),e._dialog.remove(),e._dialog.empty(),e._dialog=void 0,e._client.unwatchDatabase(e._projectEventHandling,function(t){t&&e._logger.error("error during unsubscribe",t)})}),this._refreshProjectList(),this._projectEventHandling=function(n,i){(i.etype===t.CLIENT.STORAGE.PROJECT_CREATED||i.etype===t.CLIENT.STORAGE.PROJECT_DELETED)&&(e._logger.debug("projectList changed event",i),e._refreshProjectList.call(e))},e._client.watchDatabase(e._projectEventHandling,function(t){t&&e._logger.error("unable to follow project events",t)})},d.prototype._initDialog=function(){function e(e){u._logger.debug("openProject requested, already opening?",u._openingProject),u._projectList[e].rights.read===!0&&u._openingProject===!1&&(u._openingProject=!0,u._client.selectProject(e,null,function(e){u._openingProject=!1,e&&u._logger.error(e),u._dialog.modal("hide")}))}function t(){var e,t=u._txtNewProjectName.val();""!==t&&-1===u._projectIds.indexOf(t)&&(u._dialog.modal("hide"),e=new o(u._client,t,u._createType,u._logger.fork("CreateProjectDialog")),e.show(function(e,n,i,o,r){e&&n?u._createProject(t,e,n,i,o,r):u._logger.debug("Closed create dialog with arguments",e,n)}))}function i(e){var t,n=WebGMEGlobal.gmeConfig.authentication.enable?s.getProjectDisplayedNameFromProjectId(e):s.getProjectNameFromProjectId(e),i=function(){},o=function(){document.location.href=window.location.href.split("?")[0]},a=function(){u._client.deleteProject(e,function(t){return t?void u._logger.error(t):void(u._activeProject===e?o():i())})};if(u._projectList[e].rights["delete"]===!0){if(u._dontAskOnDelete===!0)return void a();t=new r,t.show({deleteItem:n,enableDontAskAgain:!0,onHideFn:function(){u._modalContent.removeClass("in-background")}},function(e){e&&(u._dontAskOnDelete=!0),a()}),u._modalContent.addClass("in-background")}}function a(e,t){return l.PROJECT_NAME.test(e)&&-1===u._projectIds.indexOf(t)}var d,g,u=this;this._dialog=$(c),this._userId=WebGMEGlobal.userInfo._id,this._modalContent=this._dialog.find(".modal-content").first(),this._el=this._dialog.find(".modal-body").first(),this._table=this._el.find("table").first(),this._tableHead=this._table.find("thead").first(),this._tableBody=this._table.find("tbody").first(),this._modalFooter=this._dialog.find(".modal-footer"),this._panelButtons=this._modalFooter.find(".panel-buttons"),this._panelCreateNew=this._modalFooter.find(".panel-create-new").hide(),this._btnCreateNew=this._panelButtons.find(".btn-create-new"),this._btnRefresh=this._panelButtons.find(".btn-refresh"),this._btnNewProjectCancel=this._panelCreateNew.find(".btn-cancel"),this._btnNewProjectCreate=this._panelCreateNew.find(".btn-save"),this._txtNewProjectName=this._panelCreateNew.find(".txt-project-name"),this._ownerIdList=this._panelCreateNew.find("ul.ownerId-list"),this._selectedOwner=this._panelCreateNew.find(".selected-owner-id"),this._ownerId=this._userId,this._selectedOwner.text(this._ownerId),this._ownerIdList.append($('<li><a class="ownerId-selection">'+u._userId+"</a></li>")),WebGMEGlobal.userInfo.adminOrgs.length>0&&(this._ownerIdList.append($('<li role="separator" class="divider"></li>')),WebGMEGlobal.userInfo.adminOrgs.forEach(function(e){u._ownerIdList.append($('<li><a class="ownerId-selection">'+e._id+"</a></li>"))})),WebGMEGlobal.gmeConfig.authentication.enable===!0&&this._ownerId===WebGMEGlobal.gmeConfig.authentication.guestAccount&&(d=[{title:"DEMO",active:!0,data:p}],u._filter=p),this._loader=new n({containerElement:this._btnRefresh}),this._loader.setSize(14),this._dialog.find(".tabContainer").first().groupedAlphabetTabs({onClick:function(e){u._filter=e,u._updateFilter()},noMatchText:"Nothing matched your filter, please click another letter.",extraTabs:d}),this._tableBody.on("dblclick","tr",function(t){g=$(this).data(h)._id,t.stopPropagation(),t.preventDefault(),e(g)}),this._tableBody.on("click","span.open-link",function(t){g=$(this).data("projectId"),t.stopPropagation(),t.preventDefault(),e(g)}),this._tableHead.on("click","i.btn-info-toggle",function(e){var t=$(this),n=!u._table.hasClass("info-displayed");n?(u._table.find(".extra-info").removeClass("info-hidden"),u._table.addClass("info-displayed"),t.removeClass("glyphicon-plus"),t.addClass("glyphicon-minus")):(u._table.find(".extra-info").addClass("info-hidden"),u._table.removeClass("info-displayed"),t.removeClass("glyphicon-minus"),t.addClass("glyphicon-plus")),e.stopPropagation(),e.preventDefault()}),this._tableHead.on("click","th",function(e){var t,n,i=$(this),o=i.hasClass("reverse-order");if(e.stopPropagation(),e.preventDefault(),i.hasClass("title-owner"))n="owner";else if(i.hasClass("title-name"))n="name";else if(i.hasClass("title-modified"))n="modified";else if(i.hasClass("title-viewed"))n="viewed";else{if(!i.hasClass("title-created"))return;n="created"}u._tableHead.find("th").removeClass("reverse-order in-order"),o?i.addClass("in-order"):i.addClass("reverse-order"),t=u._tableBody.children("tr"),t.sort(function(e,t){var i=$(e).data(h),r=$(t).data(h),s=0;return i[n]>r[n]?s=1:i[n]<r[n]&&(s=-1),("modified"===n||"viewed"===n||"created"===n)&&(s=-1*s),0===s&&(s=i._id.toUpperCase()>r._id.toUpperCase()?1:-1),o?-1*s:s}),t.detach().appendTo(u._tableBody)}),this._tableBody.on("click","i.delete-project",function(e){g=$(this).data("projectId"),e.stopPropagation(),e.preventDefault(),i(g)}),WebGMEGlobal.userInfo.canCreate!==!0?this._btnCreateNew.hide():this._btnCreateNew.on("click",function(e){u._txtNewProjectName.val(""),u._panelButtons.hide(),u._panelCreateNew.show(),u._txtNewProjectName.focus(),u._creatingNew=!0,e.stopPropagation(),e.preventDefault()}),this._btnNewProjectCancel.on("click",function(e){u._panelButtons.show(),u._panelCreateNew.hide(),u._btnNewProjectCreate.show(),u._creatingNew=!1,u._updateFilter(),e.stopPropagation(),e.preventDefault()}),this._ownerIdList.on("click","a.ownerId-selection",function(){var e=$(this).text(),t=u._txtNewProjectName.val(),n=s.getProjectIdFromOwnerIdAndProjectName(e,t);u._ownerId=e,u._selectedOwner.text(e),a(t,n)===!1?(u._panelCreateNew.addClass("has-error"),u._btnNewProjectCreate.disable(!0)):(u._panelCreateNew.removeClass("has-error"),u._btnNewProjectCreate.disable(!1))}),this._txtNewProjectName.on("keyup",function(){var e=u._txtNewProjectName.val(),t=s.getProjectIdFromOwnerIdAndProjectName(u._ownerId,e);1===e.length?u._updateFilter([e.toUpperCase()[0],e.toUpperCase()[0]]):0===e.length&&u._updateFilter(),a(e,t)===!1?(u._panelCreateNew.addClass("has-error"),u._btnNewProjectCreate.disable(!0)):(u._panelCreateNew.removeClass("has-error"),u._btnNewProjectCreate.disable(!1))}),this._btnNewProjectCreate.on("click",function(e){t(),e.stopPropagation(),e.preventDefault()}),this._txtNewProjectName.on("keydown",function(e){var n=13===e.which,i=u._txtNewProjectName.val(),o=s.getProjectIdFromOwnerIdAndProjectName(u._ownerId,i);n&&a(i,o)&&(t(u._client),e.stopPropagation(),e.preventDefault())}),this._btnRefresh.on("click",function(e){u._refreshProjectList.call(u),e.stopPropagation(),e.preventDefault()})},d.prototype._refreshProjectList=function(){var e=this,t={rights:!0,info:!0};this._loader.start(),this._btnRefresh.disable(!0),this._btnRefresh.find("i").css("opacity","0"),this._client.getProjects(t,function(t,n){function i(e){var t=0;return e.rights.write===!0?t=2:e.rights.read===!0&&(t=1),t}var o,r;for(e._activeProject=e._client.getActiveProjectId(),e._projectList={},e._projectIds=[],o=0;o<n.length;o+=1)e._projectIds.push(n[o]._id),e._projectList[n[o]._id]=n[o];e._projectIds.sort(function(t,n){var o,r=i(e._projectList[t]),s=i(e._projectList[n]);return r>s?o=-1:s>r?o=1:r===s&&(o=t.toLowerCase()<n.toLowerCase()?-1:1),o}),e._updateProjectNameList(),e._loader.stop(),e._btnRefresh.find("i").css("opacity","1"),e._btnRefresh.disable(!1),e._creatingNew&&(r=e._txtNewProjectName.val(),r&&r.length>0&&e._updateFilter([r.toUpperCase()[0],r.toUpperCase()[0]]),e._panelButtons.hide(),e._panelCreateNew.show(),setTimeout(function(){e._txtNewProjectName.focus()},500))})},d.prototype._updateProjectNameList=function(){function e(e,t,n,i){var o=s.getProjectDisplayedNameFromProjectId(m._projectIds[e]);return o+" was "+t+" by "+(n||"N/A")+" at "+a.formattedDate(i)}var t,n,i,o,r,l,c,d,p,u,f,m=this,_=this._projectIds.length;if(this._tableBody.empty(),this._tableHead.find("th").removeClass("reverse-order in-order"),_>0)for(t=0;_>t;t+=1)o=!1,u=this._projectList[this._projectIds[t]],d=s.getProjectNameFromProjectId(this._projectIds[t]),p=s.getOwnerFromProjectId(this._projectIds[t]),f=g.clone(),l=u.info.viewedAt?new Date(u.info.viewedAt):new Date(1447879297957),r=u.info.modifiedAt?new Date(u.info.modifiedAt):new Date(1447879297957),c=u.info.createdAt?new Date(u.info.createdAt):new Date(1431343297957),f.data(h,{_id:this._projectIds[t],modified:r.getTime(),viewed:l.getTime(),created:c.getTime(),name:d.toUpperCase(),owner:p.toUpperCase()}),$("<td/>").addClass("owner").text(p).appendTo(f),n=$("<span/>").addClass("open-link").attr("title","Open").text(d).data("projectId",this._projectIds[t]),$("<td/>").addClass("name").append(n).append('<span class="name-read-only">[Read-Only]</span>').appendTo(f),n=$("<span/>").attr("title",e(t,"modified",u.info.modifier,r)).text(a.formattedDate(r,"elapsed")),$("<td/>").addClass("modified").append(n).appendTo(f),n=$("<span/>").attr("title",e(t,"viewed",u.info.viewer,l)).text(a.formattedDate(l,"elapsed")),$("<td/>").addClass("viewed extra-info info-hidden").append(n).appendTo(f),n=$("<span/>").attr("title",e(t,"created",u.info.creator,c)).text(a.formattedDate(c,"elapsed")),$("<td/>").addClass("created extra-info info-hidden").append(n).appendTo(f),i=$("<td/>").addClass("icons").appendTo(f),this._projectIds[t]===this._activeProject&&f.addClass("active"),u.rights.write!==!0&&f.addClass("read-only"),u.rights["delete"]===!0?i.append($('<i class="glyphicon glyphicon-trash delete-project extra-info info-hidden"/>').data("projectId",this._projectIds[t])):i.append('<i class="glyphicon glyphicon-lock locked extra-info info-hidden"/>'),this._tableBody.append(f);else this._table.addClass("no-children");this._table.hasClass("info-displayed")&&this._table.find(".extra-info").removeClass("info-hidden"),m._updateFilter()},d.prototype._updateFilter=function(e){var t=this,n=0;e=e||t._filter,t._tableBody.children("tr").each(function(){var t,i=$(this);e&&e===p?i.hasClass("read-only")?(i.removeClass("filtered-out"),n+=1):i.addClass("filtered-out"):e?(t=i.data(h).name.toUpperCase()[0],t>=e[0]&&t<=e[1]?(i.removeClass("filtered-out"),n+=1):i.addClass("filtered-out")):(i.removeClass("filtered-out"),n+=1)}),0===n?t._table.addClass("no-children"):t._table.removeClass("no-children")},d.prototype._createProject=function(e,t,i,o,r){function s(e){a._client.selectProject(e,null,function(e){e?a._logger.error("Cannot select project",e):a._logger.debug("Selected project"),c.stop()})}var a=this,l={type:t,projectName:e,seedName:i,seedBranch:o,seedCommit:r,ownerId:a._ownerId},c=new n({containerElement:$("body")});c.start(),"duplicate"===t?(a._logger.debug("Duplicating project: ",i,e,a._ownerId),a._client.duplicateProject(i,e,a._ownerId,function(e,t){e?(a._logger.error("Failed to duplicate project",e),c.stop()):(a._logger.debug("Duplicated project"),s(t))})):"package"===t?(a._logger.debug("Importing package: "),a._client.importProjectFromFile(e,"master",i,a._ownerId,"",function(e,t){e?(a._logger.error("Failed to import project package",e),c.stop()):(a._logger.debug("Project package imported"),s(t))})):(a._logger.debug("Creating new project from seed: ",l),a._client.seedProject(l,function(e,t){e?(a._logger.error("Cannot create seed project",e),c.stop()):(a._logger.debug("Created new project from seed"),s(t.projectId))}))},d}),define("js/Controls/PropertyGrid/Widgets/StringWidget",["js/Controls/PropertyGrid/Widgets/WidgetBase"],function(e){"use strict";var t,n=$("<input/>",{type:"text"});return t=function(t){var i=this;e.call(this,t),this.__input=n.clone(),this.__input.val(this.propertyValue),t.regex&&(t.regexMessage=t.regexMessage||"Value has to match regex: "+t.regex,this.__input.attr("pattern",t.regex),this.__input.attr("title",t.regexMessage)),this.__input.on("keyup change",function(e){e.stopPropagation(),e.preventDefault(),i.setValue(i.__input.val())}),this.__input.on("blur",function(){i.fireFinishChange()}),this.__input.on("keydown",function(e){13===e.keyCode&&this.blur()}),this.updateDisplay(),this.el.append(this.__input)},t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.prototype.updateDisplay=function(){return document.activeElement!==this.__input[0]&&this.__input.val(this.getValue()),e.prototype.updateDisplay.call(this)},t.prototype.setReadOnly=function(t){e.prototype.setReadOnly.call(this,t),this._isReadOnly===!0?this.__input.attr("disabled","disabled"):this.__input.removeAttr("disabled")},t}),define("js/Controls/PropertyGrid/Widgets/NumberWidgetBase",["js/Controls/PropertyGrid/Widgets/WidgetBase"],function(e){"use strict";var t;return t=function(t){e.call(this,t),this.__min=t.minValue,this.__max=t.maxValue,this.__step=t.stepValue,void 0===this.__step||null===this.__step?0===this.originalValue?this.__impliedStep=1:this.__impliedStep=Math.pow(10,Math.floor(Math.log(this.originalValue)/Math.LN10))/10:this.__impliedStep=this.__step,this.__precision=this._numDecimals(this.__impliedStep)},t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.prototype.setValue=function(t){return void 0!==this.__min&&t<this.__min?t=this.__min:void 0!==this.__max&&t>this.__max&&(t=this.__max),void 0!==this.__step&&t%this.__step!==0&&(t=Math.round(t/this.__step)*this.__step),e.prototype.setValue.call(this,t),this.updateDisplay(),this},t.prototype._numDecimals=function(e){return e=e.toString(),e.indexOf(".")>-1?e.length-e.indexOf(".")-1:0},t.prototype.min=function(e){return this.__min=e,this},t.prototype.max=function(e){return this.__max=e,this},t.prototype.step=function(e){return this.__step=e,this},t}),define("js/Controls/PropertyGrid/Widgets/NumberBoxWidget",["js/Controls/PropertyGrid/Widgets/NumberWidgetBase"],function(e){"use strict";var t,n=$("<input/>",{type:"text"});return t=function(t){var i=this;this.__truncationSuspended=!1,e.call(this,t),this.__input=n.clone(),this.__input.val(this.propertyValue),this.__input.on("change",function(){i._onChange()}),this.__input.on("blur",function(){i._onBlur()}),this.__input.on("keydown",function(e){13===e.keyCode&&(i.__truncationSuspended=!0,this.blur(),i.__truncationSuspended=!1)}),this.updateDisplay(),this.el.append(this.__input)},t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.prototype.updateDisplay=function(){var t=this.__truncationSuspended?this.getValue():this._roundToDecimal(this.getValue(),this.__precision);return this.__input.val(t),e.prototype.updateDisplay.call(this)},t.prototype._roundToDecimal=function(e,t){var n=Math.pow(10,t);return""===e?e:Math.round(e*n)/n},t.prototype._onChange=function(){var e=parseFloat(this.__input.val());_.isNaN(e)?this.__input.val(this.originalValue):this.setValue(e)},t.prototype._onBlur=function(){this._onChange(),this.fireFinishChange()},t.prototype.setReadOnly=function(t){e.prototype.setReadOnly.call(this,t),this._isReadOnly===!0?this.__input.attr("disabled","disabled"):this.__input.removeAttr("disabled")},t}),define("js/Controls/PropertyGrid/Widgets/BooleanWidget",["js/Controls/PropertyGrid/Widgets/WidgetBase"],function(e){"use strict";var t,n=$("<input/>",{type:"checkbox"});return t=function(t){var i=this;e.call(this,t),this.__checkbox=n.clone(),this.__checkbox.prop("checked",this.propertyValue),this.__checkbox.on("change",function(){i.setValue($(this).is(":checked")),i.fireFinishChange()}),this.updateDisplay(),this.el.append(this.__checkbox)},t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.prototype.updateDisplay=function(){return this.getValue()===!0?this.__checkbox.attr("checked",!0):this.__checkbox.attr("checked",!1),e.prototype.updateDisplay.call(this)},t.prototype.setReadOnly=function(t){e.prototype.setReadOnly.call(this,t),this._isReadOnly===!0?this.__checkbox.attr("disabled","disabled"):this.__checkbox.removeAttr("disabled")},t}),define("js/Controls/PropertyGrid/Widgets/LabelWidget",["js/Controls/PropertyGrid/Widgets/WidgetBase"],function(e){"use strict";var t,n=$("<span/>",{"class":"user-select-on"});return t=function(t){e.call(this,t),this.__label=n.clone(),this.updateDisplay(),this.el.append(this.__label)},t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.prototype.updateDisplay=function(){return this.__label.text(this.propertyValue),this.__label.attr("title",this.propertyValue),e.prototype.updateDisplay.call(this)},t}),define("css!js/Controls/styles/iCheckBox",[],function(){}),define("js/Controls/iCheckBox",["jquery","css!./styles/iCheckBox.css"],function(){"use strict";var e,t="ON",n="OFF",i="checked",o="disabled",r=$('<div class="iCheckBox checked"><div class="sw"></div><div class="txt"></div></div>');return e=function(e){var i=this;this._checkedText=e&&e.checkedText||t,this._checkedText=this._checkedText.toUpperCase(),this._uncheckedText=e&&e.uncheckedText||n,this._uncheckedText=this._uncheckedText.toUpperCase(),this.el=r.clone(),e.icon&&this.el.find(".sw").append('<i class="'+e.icon+'"></i>'),e.title&&this.el.attr("title",e.title),this._txt=this.el.find(".txt").first(),this._txt.text(this._checkedText),e&&e.hasOwnProperty("checked")&&this.setChecked(e.checked),e&&e.data&&this.el.data(e.data),this.el.on("click",null,function(e){i.toggleChecked(),e.stopPropagation()}),this._checkChangedFn=e&&e.checkChangedFn},e.prototype.toggleChecked=function(){this.setChecked(!this.isChecked())},e.prototype.isChecked=function(){return this.el.hasClass(i)},e.prototype.setChecked=function(e){var t=this.el,n=this.isChecked(),r=this.el.data();"false"===e&&(e=!1),t.hasClass(o)||n!==e&&(this.el.toggleClass(i),this._txt.text(e?this._checkedText:this._uncheckedText),this._checkChangedFn&&this._checkChangedFn.call(this,r,e))},e.prototype.setEnabled=function(e){e?this.el.removeClass(o):this.el.addClass(o)},e}),define("js/Controls/PropertyGrid/Widgets/iCheckBoxWidget",["js/Controls/PropertyGrid/Widgets/WidgetBase","js/Controls/iCheckBox"],function(e,t){"use strict";var n;return n=function(n){var i=this;e.call(this,n),this.__checkbox=new t({checkedText:"TRUE",uncheckedText:"FALSE",title:n.title,checkChangedFn:function(e,t){i.setValue(t),i.fireFinishChange()}}),this.updateDisplay(),this.el.append(this.__checkbox.el)},n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.prototype.updateDisplay=function(){return this.__checkbox.setChecked(this.getValue()),e.prototype.updateDisplay.call(this)},n.prototype.setReadOnly=function(t){e.prototype.setReadOnly.call(this,t),this.__checkbox.setEnabled(!this._isReadOnly)},n}),define("js/Controls/PropertyGrid/Widgets/OptionWidget",["js/Controls/PropertyGrid/Widgets/WidgetBase"],function(e){"use strict";var t,n=$('<option value="empty"/>'),i=$("<option/>");return t=function(t){var o,r,s=this;for(e.call(this,t),this.__select=$("<select/>"),null===t.value&&(r=n.clone(),r.text(""),this.__select.append(r)),o=0;o<this.valueItems.length;o+=1)r=i.clone(),r.text(this.valueItems[o]),this.__select.append(r);-1===this.valueItems.indexOf(t.value)&&this.el.prop("title",'"'+t.value+'" <'+typeof t.value+"> not part of enum"),this.__select.on("change",function(e){var t=s.__select.val();e.stopPropagation(),e.preventDefault(),"float"===s.valueType?t=parseFloat(t):"integer"===s.valueType&&(t=parseInt(t,10)),NaN!==t&&(s.__select.find('option[value="empty"]').remove(),s.setValue(t),s.fireFinishChange())}),this.updateDisplay(),this.el.append(this.__select)},t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.prototype.updateDisplay=function(){return this.__select.val(this.getValue()),e.prototype.updateDisplay.call(this)},t.prototype.setReadOnly=function(t){e.prototype.setReadOnly.call(this,t),this._isReadOnly===!0?this.__select.attr("disabled","disabled"):this.__select.removeAttr("disabled")},t}),define("css!js/Controls/styles/ColorPicker",[],function(){}),define("js/Controls/ColorPicker",["jquery-spectrum","css!./styles/ColorPicker.css"],function(){"use strict";var e;return e=function(e){var t=this,n=e.color||"#dd3333";this.el=e.el,this.el.spectrum({color:n,showPalette:!0,showSelectionPalette:!1,showInput:!0,showInitial:!0,preferredFormat:"hex",allowEmpty:!0,palette:[["rgb(255, 255, 255)","rgb(242, 242, 242);","rgb(230, 230, 230);","rgb(204, 204, 204);","rgb(179, 179, 179);","rgb(153, 153, 153);","rgb(128, 128, 128);","rgb(102, 102, 102);","rgb(77, 77, 77);","rgb(51, 51, 51);","rgb(26, 26, 26);","rgb(0, 0, 0);"],["rgb(255, 204, 204);","rgb(255, 230, 204);","rgb(255, 255, 204);","rgb(230, 255, 204);","rgb(204, 255, 204);","rgb(204, 255, 230);","rgb(204, 255, 255);","rgb(204, 229, 255);","rgb(204, 204, 255);","rgb(229, 204, 255);","rgb(255, 204, 255);","rgb(255, 204, 230);"],["rgb(255, 153, 153);","rgb(255, 204, 153);","rgb(255, 255, 153);","rgb(204, 255, 153);","rgb(153, 255, 153);","rgb(153, 255, 204);","rgb(153, 255, 255);","rgb(153, 204, 255);","rgb(153, 153, 255);","rgb(204, 153, 255);","rgb(255, 153, 255);","rgb(255, 153, 204);"],["rgb(255, 102, 102);","rgb(255, 179, 102);","rgb(255, 255, 102);","rgb(179, 255, 102);","rgb(102, 255, 102);","rgb(102, 255, 179);","rgb(102, 255, 255);","rgb(102, 178, 255);","rgb(102, 102, 255);","rgb(178, 102, 255);","rgb(255, 102, 255);","rgb(255, 102, 179);"],["rgb(255, 51, 51);","rgb(255, 153, 51);","rgb(255, 255, 51);","rgb(153, 255, 51);","rgb(51, 255, 51);","rgb(51, 255, 153);","rgb(51, 255, 255);","rgb(51, 153, 255);","rgb(51, 51, 255);","rgb(153, 51, 255);","rgb(255, 51, 255);","rgb(255, 51, 153);"],["rgb(255, 0, 0);","rgb(255, 128, 0);","rgb(255, 255, 0);","rgb(128, 255, 0);","rgb(0, 255, 0);","rgb(0, 255, 128);","rgb(0, 255, 255);","rgb(0, 127, 255);","rgb(0, 0, 255);","rgb(127, 0, 255);","rgb(255, 0, 255);","rgb(255, 0, 128);"],["rgb(204, 0, 0);","rgb(204, 102, 0);","rgb(204, 204, 0);","rgb(102, 204, 0);","rgb(0, 204, 0);","rgb(0, 204, 102);","rgb(0, 204, 204);","rgb(0, 102, 204);","rgb(0, 0, 204);","rgb(102, 0, 204);","rgb(204, 0, 204);","rgb(204, 0, 102);"],["rgb(153, 0, 0);","rgb(153, 76, 0);","rgb(153, 153, 0);","rgb(77, 153, 0);","rgb(0, 153, 0);","rgb(0, 153, 77);","rgb(0, 153, 153);","rgb(0, 76, 153);","rgb(0, 0, 153);","rgb(76, 0, 153);","rgb(153, 0, 153);","rgb(153, 0, 77);"],["rgb(102, 0, 0);","rgb(102, 51, 0);","rgb(102, 102, 0);","rgb(51, 102, 0);","rgb(0, 102, 0);","rgb(0, 102, 51);","rgb(0, 102, 102);","rgb(0, 51, 102);","rgb(0, 0, 102);","rgb(51, 0, 102);","rgb(102, 0, 102);","rgb(102, 0, 51);"]],show:function(){var e=$(".sp-container"),n=e.find(".sp-clear");n.off("click.spectrum"),n.on("click.ColorPicker",function(e){e.stopPropagation(),e.preventDefault(),t.el.spectrum("hide"),t.onColorChanged()})},hide:function(){t._destroy()},change:function(e){t._destroy(),e?t.onColorChanged(e.toHexString()):t.onColorChanged()}}),this.el.spectrum("show")},e.prototype.setColor=function(e){this.el.spectrum("set",e)},e.prototype.onColorChanged=function(e){console.log("ColorPicker.onColorChanged not overridden: "+e)},e.prototype._destroy=function(){this.el.spectrum("destroy")},e}),define("js/Controls/PropertyGrid/Widgets/ColorPickerWidget",["js/Controls/PropertyGrid/Widgets/WidgetBase","js/Controls/ColorPicker"],function(e,t){"use strict";var n,i=$("<div/>",{id:"cpw","class":"color-picker"});return n=function(n){var o,r,s=this;this._enabled=!0,e.call(this,n),this.__colorDiv=i.clone(),this.__colorDiv.on("click",function(e){e.preventDefault(),e.stopPropagation(),s._enabled&&(o=s.getValue(),r=new t({el:s.__colorDiv,color:o}),r.onColorChanged=function(e){s.setValue(e),s.fireFinishChange()})}),this.updateDisplay(),this.el.append(this.__colorDiv)},n.prototype=Object.create(e.prototype),n.prototype.constructor=n,n.prototype.updateDisplay=function(){return this.__colorDiv.css("background-color",this.getValue()),e.prototype.updateDisplay.call(this)},n.prototype.setReadOnly=function(t){e.prototype.setReadOnly.call(this,t),this._enabled=!this._isReadOnly},n}),define("js/Utils/ColorUtil",[],function(){"use strict";function e(e){var t,n,i,o,r,s=/^#[0-9A-F]{6}$/,a=/^#[0-9A-F]{3}$/,l=/rgb\(\s*(\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3})\s*\)$/,c=/rgba\(\s*(\d{1,3}),\s*(\d{1,3}),\s*(\d{1,3}),\s*(\d+(.\d*))\s*\)$/;return"string"==typeof e&&(e=e.toUpperCase(),n=e.match(s),n?t=e:(n=e.match(a),n?t="#"+e[1]+e[1]+e[2]+e[2]+e[3]+e[3]:(n=e.match(l)||e.match(c),n&&(i=parseInt(n[1],10).toString(16),1===i.length&&(i="0"+i),o=parseInt(n[2],10).toString(16),1===o.length&&(o="0"+o),r=parseInt(n[3],10).toString(16),1===r.length&&(r="0"+r),t=("#"+i+o+r).toUpperCase())))),t}return{getHexColor:e,isColor:function(t){return void 0!==e(t)}}}),define("js/Controls/PropertyGrid/Widgets/DialogWidget",["js/Controls/PropertyGrid/Widgets/WidgetBase"],function(e){"use strict";var t,n=$("<span/>",{}),i=$('<a class="btn btn-mini btn-dialog-open">...</a>');return t=function(t){var o=this;e.call(this,t),this.__label=n.clone(),this.el.append(this.__label),t.dialog&&(this.__btnDialogOpen=i.clone(),this.el.append(this.__btnDialogOpen),this.__btnDialogOpen.on("click",function(e){var n=t.dialog,i=new n;e.stopPropagation(),e.preventDefault(),i.show(function(e){o.setValue(e),o.fireFinishChange()},o.getValue())})),this.updateDisplay()},t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.prototype.updateDisplay=function(){return this.__label.text(this.propertyValue),this.__label.attr("title",this.propertyValue),e.prototype.updateDisplay.call(this)},t.prototype.setReadOnly=function(t){e.prototype.setReadOnly.call(this,t),this.__btnDialogOpen&&(this._isReadOnly===!0?this.__btnDialogOpen.disable(!0):this.__btnDialogOpen.disable(!1))},t}),define("js/Controls/PropertyGrid/Widgets/FloatWidget",["js/Controls/PropertyGrid/Widgets/WidgetBase"],function(e){"use strict";var t,n=$("<input/>",{type:"text"});return t=function(t){var i=this;e.call(this,t),this._helpMessage="Enter float ",this._input=n.clone(),this._input.val(t.value),this.min=null,"number"==typeof t.minValue?(this.min=t.minValue,this._helpMessage+="["+this.min):this._helpMessage+="(-inf",this.max=null,"number"==typeof t.maxValue?(this.max=t.maxValue,this._helpMessage+=", "+this.max+"]"):this._helpMessage+=", inf)",this._input.prop("title",this._helpMessage),this._input.on("change",function(){i._onChange()}),this._input.on("blur",function(){i._onBlur()}),this._input.on("keydown",function(e){13===e.keyCode&&this.blur()}),this.el.append(this._input)},t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.prototype.setValue=function(t){return e.prototype.setValue.call(this,t),this.updateDisplay(),this},t.prototype._onChange=function(){var e=parseFloat(this._input.val());isNaN(e)?this._input.val(this.getValue()):null!==this.min&&e<this.min?this._input.val(this.getValue()):null!==this.max&&e>this.max?this._input.val(this.getValue()):(this._input.val(e),this.setValue(e))},t.prototype._onBlur=function(){this._onChange(),this.fireFinishChange()},t.prototype.setReadOnly=function(t){e.prototype.setReadOnly.call(this,t),this._isReadOnly===!0?this._input.attr("disabled","disabled"):this._input.removeAttr("disabled")},t.prototype.destroy=function(){this._input.off("change"),this._input.off("blur"),this._input.off("keydown"),e.prototype.destroy.call(this)},t}),define("js/Controls/PropertyGrid/Widgets/IntegerWidget",["js/Controls/PropertyGrid/Widgets/WidgetBase"],function(e){"use strict";var t,n=$("<input/>",{type:"number",step:"1"});return t=function(t){var i,o=this;e.call(this,t),this._input=n.clone(),this._input.val(t.value),"number"==typeof t.minValue&&(i={},i.min=t.minValue),"number"==typeof t.maxValue&&(i=i||{},i.max=t.maxValue),i&&this._input.attr(i),this._input.on("change",function(){o._onChange()}),this._input.on("blur",function(){o._onBlur()}),this._input.on("keydown",function(e){13===e.keyCode&&this.blur()}),this.el.append(this._input)},t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.prototype.setValue=function(t){return e.prototype.setValue.call(this,t),this.updateDisplay(),this},t.prototype._onChange=function(){var e=this._input.val();e=parseFloat(e),isNaN(e)?this._input.val(this.getValue()):this.setValue(Math.round(e))},t.prototype._onBlur=function(){this._onChange(),this.fireFinishChange()},t.prototype.setReadOnly=function(t){e.prototype.setReadOnly.call(this,t),this._isReadOnly===!0?this._input.attr("disabled","disabled"):this._input.removeAttr("disabled")},t.prototype.destroy=function(){this._input.off("change"),this._input.off("blur"),this._input.off("keydown"),e.prototype.destroy.call(this)},t}),define("js/DragDrop/DragEffects",[],function(){"use strict";return{DRAG_COPY:"DRAG_COPY",DRAG_MOVE:"DRAG_MOVE",DRAG_CREATE_INSTANCE:"DRAG_CREATE_INSTANCE",DRAG_CREATE_POINTER:"DRAG_CREATE_POINTER",DRAG_SET_REPLACEABLE:"DRAG_SET_REPLACEABLE"}}),define("js/DragDrop/DragConstants",[],function(){"use strict";return{DRAG_ITEMS:"DRAG_ITEMS",DRAG_EFFECTS:"DRAG_EFFECTS",DRAG_INFO:"DRAG_INFO",DRAG_PARAMS:"DRAG_PARAMS"}}),define("js/DragDrop/DropTarget",["./DragEffects","./DragConstants"],function(e,t){"use strict";function n(e,n){var i;i=function(i,o,r){var s,a=r.helper;a&&(s=a.data(t.DRAG_INFO)),n&&_.isFunction(n[i])&&n[i].call(e,o,s)},e.droppable({tolerance:"pointer",over:function(e,t){i("over",e,t)},out:function(e,t){i("out",e,t)},drop:function(e,t){i("drop",e,t)},activate:function(e,t){i("activate",e,t)},deactivate:function(e,t){i("deactivate",e,t)}})}function i(e){r(e)&&e.droppable("destroy")}function o(e,t){var n=t?"enable":"disable";r(e)&&e.droppable(n)}function r(e){return e.hasClass("ui-droppable")}return{makeDroppable:n,destroyDroppable:i,enableDroppable:o}}),define("css!js/Controls/PropertyGrid/Widgets/styles/PointerWidget",[],function(){}),define("js/Controls/PropertyGrid/Widgets/PointerWidget",["js/Controls/PropertyGrid/Widgets/WidgetBase","js/Utils/DisplayFormat","js/Constants","js/DragDrop/DropTarget","js/DragDrop/DragConstants","css!./styles/PointerWidget.css"],function(e,t,n,i,o){"use strict";var r;return r=function(t){var n,i,o=this;this._gmeNodeId=null,this.USE_ACTUAL_POINTER_NAME=!1,e.call(this,t),i=WebGMEGlobal.State.getActiveSelection(),n=WebGMEGlobal.State.getActiveObject(),i&&i.length>0?1===i.length&&(this._gmeNodeId=i[0]):n&&(this._gmeNodeId=n),this._client=t.client,this._div=$("<div/>",{"class":"ptr-widget"}),this.el.append(this._div),this.__label=$("<span/>",{"class":"user-select-on"}),this._div.append(this.__label),this.__iconAssignNullPointer=$("<i/>",{"class":"glyphicon glyphicon-minus-sign"}),this.__iconAssignNullPointer.attr("title","Assign null-pointer"),this.__iconAssignNullPointer.on("click",function(e){
e.stopPropagation(),e.preventDefault(),o.setValue(null),o.fireFinishChange()}),this.__label.on("click",function(e){e.stopPropagation(),e.preventDefault(),o._followPointer()}),this.__nodeDropTarget=this._div,this._makeDroppable(),this.updateDisplay()},_.extend(r.prototype,e.prototype),r.prototype._makeDroppable=function(){var e=this;"base"!==this.propertyName&&this._gmeNodeId&&(e._div.addClass("drop-area"),e._div.append(this.__iconAssignNullPointer),i.makeDroppable(e.__nodeDropTarget,{over:function(t,n){e._isValidPointerDrop(n)?e._div.addClass("accept-drop"):e._div.addClass("reject-drop")},out:function(){e._div.removeClass("accept-drop reject-drop")},drop:function(t,n){e._isValidPointerDrop(n)&&(e.setValue(n[o.DRAG_ITEMS][0]),e.fireFinishChange()),e._div.removeClass("accept-drop reject-drop")}}))},r.prototype._destroyDroppable=function(){"base"!==this.propertyName&&this._gmeNodeId&&(this._div.removeClass("drop-area"),i.destroyDroppable(this.__nodeDropTarget),this.__iconAssignNullPointer.detach())},r.prototype._isValidPointerDrop=function(e){var t,n=this,i=!1;return 1===e[o.DRAG_ITEMS].length&&this._gmeNodeId&&(t=n._client.getNode(e[o.DRAG_ITEMS][0]),i=t&&t.isValidTargetOf(this._gmeNodeId,this.propertyName)),i},r.prototype.setReadOnly=function(t){e.prototype.setReadOnly.call(this,t),this._destroyDroppable(),this._isReadOnly!==!0&&this._makeDroppable()},r.prototype.updateDisplay=function(){var t,n=this.propertyValue,i=this;return this._updatePointerName(),n&&"_nullptr"!==n&&(this._removeTerritory(),this._territoryId=this._client.addUI(this,function(){i._updatePointerName()}),t={},t[n]={children:0},this._client.updateTerritory(this._territoryId,t)),e.prototype.updateDisplay.call(this)},r.prototype.destroy=function(){this._removeTerritory()},r.prototype._removeTerritory=function(){this._territoryId&&this._client.removeUI(this._territoryId)},r.prototype._updatePointerName=function(){var e,n,i=this.propertyValue;"_nullptr"===i?(e="NULL",i="Null-pointer",this.__label.removeClass("btn btn-micro btn-follow-pointer")):i?(n=this._client.getNode(i),n&&(e=t.resolve(n),(""===e||this.USE_ACTUAL_POINTER_NAME===!0)&&(e=n.getFullyQualifiedName()),i="Follow Pointer: ["+i+"]"),this.__label.addClass("btn btn-micro btn-follow-pointer")):this.__label.removeClass("btn btn-micro btn-follow-pointer"),this.__label.text(e),this.__label.attr("title",i)},r.prototype._followPointer=function(){var e,t=this.propertyValue,n=this._client;t&&"_nullptr"!==t&&(e=n.getNode(t),e&&(WebGMEGlobal.State.registerActiveObject(t),WebGMEGlobal.State.registerActiveSelection([])))},r.prototype.destroy=function(){this._removeTerritory(),this.__iconAssignNullPointer&&this.__iconAssignNullPointer.off("click"),this.__label.off("click"),e.prototype.destroy.call(this)},r}),define("js/Controls/PropertyGrid/Widgets/MetaTypeWidget",["js/Controls/PropertyGrid/Widgets/WidgetBase","./PointerWidget"],function(e,t){"use strict";var n;return n=function(t){var n,i,o=this;this._gmeNodeId=null,this.USE_ACTUAL_POINTER_NAME=!0,e.call(this,t),i=WebGMEGlobal.State.getActiveSelection(),n=WebGMEGlobal.State.getActiveObject(),i&&i.length>0?1===i.length&&(this._gmeNodeId=i[0]):n&&(this._gmeNodeId=n),this._client=t.client,this._div=$("<div/>",{"class":"ptr-widget"}),this.el.append(this._div),this.__label=$("<span/>",{"class":"user-select-on"}),this._div.append(this.__label),this.__label.on("click",function(e){e.stopPropagation(),e.preventDefault(),o._followPointer()}),this.updateDisplay()},_.extend(n.prototype,t.prototype),n.prototype.setReadOnly=function(t){e.prototype.setReadOnly.call(this,t)},n}),define("css!js/Controls/PropertyGrid/Widgets/styles/MultiSelectWidget",[],function(){}),define("js/Controls/PropertyGrid/Widgets/MultiSelectWidget",["js/Controls/PropertyGrid/Widgets/WidgetBase","bootstrap-multiselect","css!./styles/MultiSelectWidget.css"],function(e){"use strict";function t(t){var i,o,r,s,a=this;for(e.call(this,t),this.el.addClass("multiselect-widget"),this._select=n.clone(),this._wasChanged=!1,i=t.value.split(" "),s=0;s<i.length;s+=1)o=i[s],o&&-1===t.valueItems.indexOf(o)&&(r||(r=$("<optgroup/>",{label:"Unavailable"}),a._select.append(r)),r.append($("<option/>",{text:o,value:o,selected:"selected"})));for(r?(r=$("<optgroup/>",{label:"Available"}),a._select.append(r)):r=a._select,s=0;s<t.valueItems.length;s+=1)o=t.valueItems[s],-1===i.indexOf(o)?r.append($("<option/>",{text:o,value:o})):r.append($("<option/>",{text:o,value:o,selected:"selected"}));this.el.append(this._select),this._select.multiselect({onDropdownHide:function(){a._onBlur()},onChange:function(){a._onChange()},buttonClass:"btn btn-link",disableIfEmpty:!0,disabledText:"None available ..."}),this._dropDownMenu=this.el.find(".multiselect-container.dropdown-menu"),this._dropDownMenu.on("mouseleave",function(){a._onBlur()})}var n=$("<select/>",{multiple:"multiple"});return t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.prototype._onChange=function(){this._wasChanged=!0},t.prototype._onBlur=function(){var e;this._wasChanged===!0&&(this._wasChanged=!1,e=this._select.val()?this._select.val().join(" "):"",this.setValue(e),this.fireFinishChange())},t.prototype.setReadOnly=function(t){e.prototype.setReadOnly.call(this,t),this._isReadOnly===!0?this._select.multiselect("disable"):this._select.multiselect("enable")},t.prototype.destroy=function(){this._dropDownMenu.off("mouseleave"),e.prototype.destroy.call(this)},t}),define("css!js/Controls/PropertyGrid/Widgets/styles/SvgSelectWidget",[],function(){}),define("js/Controls/PropertyGrid/Widgets/SvgSelectWidget",["js/Controls/PropertyGrid/Widgets/WidgetBase","css!./styles/SvgSelectWidget.css"],function(e){"use strict";var t;return t=function(t){var n,i,o,r=this;e.call(this,t),r._items=t.items,r._dropDownItems=[],r._value=t.value,r._dropDown=$('<div class="btn-group"></div>'),r._dropDownButton=$('<button type="button" class="multiselect dropdown-toggle btn btn-link" data-toggle="dropdown" aria-expanded="true"></button>'),r._dropDownList=$('<ul class="svgselect-container dropdown-menu"></ul>'),r._dropDown.append(r._dropDownButton),r._dropDown.append(r._dropDownList),r._dropDownButton.html("<span>"+r._items[r._value]+"</span>"),o=function(e){r.setValue($(e.currentTarget).attr("data-value")),r.fireFinishChange()};for(n in r._items)i=$('<li data-value="'+n+'"><a href="#">'+r._items[n]+"</a></li>"),i.on("click",o),r._dropDownItems.push(i),r._dropDownList.append(i);this.updateDisplay(),this.el.addClass("svgselect-widget"),this.el.append(r._dropDown)},t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.prototype.updateDisplay=function(){return e.prototype.updateDisplay.call(this)},t.prototype.setReadOnly=function(t){e.prototype.setReadOnly.call(this,t),$(this._dropDownButton).disable(t)},t.prototype.destroy=function(){var t;for(t=0;t<this._dropDownItems.length;t+=1)this._dropDownItems[t].off("click");e.prototype.destroy.call(this)},t}),define("js/Controls/PropertyGrid/PropertyGridWidgets",[],function(){"use strict";return{DIALOG_WIDGET:"DIALOG_WIDGET",ASSET_WIDGET:"ASSET_WIDGET",POINTER_WIDGET:"POINTER_WIDGET",META_TYPE_WIDGET:"META_TYPE_WIDGET",MULTI_SELECT_WIDGET:"MULTI_SELECT_WIDGET",COLOR_PICKER:"COLOR_PICKER",SVG_SELECT:"SVG_SELECT"}}),define("js/Controls/PropertyGrid/PropertyGridWidgetManager",["js/Controls/PropertyGrid/Widgets/StringWidget","js/Controls/PropertyGrid/Widgets/NumberBoxWidget","js/Controls/PropertyGrid/Widgets/BooleanWidget","js/Controls/PropertyGrid/Widgets/LabelWidget","js/Controls/PropertyGrid/Widgets/iCheckBoxWidget","js/Controls/PropertyGrid/Widgets/OptionWidget","js/Controls/PropertyGrid/Widgets/ColorPickerWidget","js/Utils/ColorUtil","js/Controls/PropertyGrid/Widgets/DialogWidget","js/Controls/PropertyGrid/Widgets/AssetWidget","js/Controls/PropertyGrid/Widgets/FloatWidget","js/Controls/PropertyGrid/Widgets/IntegerWidget","js/Controls/PropertyGrid/Widgets/PointerWidget","js/Controls/PropertyGrid/Widgets/MetaTypeWidget","js/Controls/PropertyGrid/Widgets/MultiSelectWidget","js/Controls/PropertyGrid/Widgets/SvgSelectWidget","./PropertyGridWidgets"],function(e,t,n,i,o,r,s,a,l,c,d,h,p,g,u,f,m){"use strict";var b;return b=function(){this._registeredWidgets={}},b.prototype.getWidgetForProperty=function(o){var b,y=o.valueType||typeof o.value,v=o.readOnly===!0,C=_.isArray(o.valueItems),E=a.isColor(o.value),D=o.widget;if(v&&"boolean"!==y)b=new i(o);else if(D)switch(D){case m.DIALOG_WIDGET:b=new l(o);break;case m.META_TYPE_WIDGET:b=new g(o);break;case m.POINTER_WIDGET:b=new p(o);break;case m.MULTI_SELECT_WIDGET:b=new u(o);break;case m.COLOR_PICKER:b=new s(o);break;case m.SVG_SELECT:b=new f(o);break;default:b=new D(o)}else b=C?new r(o):E?new s(o):"asset"===y?new c(o):"float"===y?new d(o):"integer"===y?new h(o):this._registeredWidgets[y]?new this._registeredWidgets[y](o):"number"===y?new t(o):"boolean"===y?new n(o):new e(o);return b.setReadOnly(v),b},b.prototype.registerWidgetForType=function(e,t){if("string"==typeof t)switch(t){case"iCheckBox":this.registerWidgetForType(e,o)}else this._registeredWidgets[e]=t},b}),define("text!js/Dialogs/PluginConfig/templates/PluginConfigDialog.html",[],function(){return'<div class="plugin-config-dialog modal fade" tabindex="-1" role="dialog">\r\n    <div class="modal-dialog modal-lg">\r\n        <div class="modal-content">\r\n            <div class="modal-header">\r\n                <button type="button" class="close" data-dismiss="modal">×</button>\r\n                <h3 class="modal-title"></h3>\r\n            </div>\r\n            <div class="modal-body">\r\n            </div>\r\n            <div class="modal-footer">\r\n                <form>\r\n                    <label class="save-configuration pull-left">\r\n                        <input type="checkbox"> Save these settings in the current user\r\n                    </label>\r\n                </form>\r\n                <a href="#" class="btn btn-save btn-primary">Save &amp; Run...</a>\r\n                <a href="#" class="btn btn-default" data-dismiss="modal">Cancel</a>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>'}),define("css!js/Dialogs/PluginConfig/styles/PluginConfigDialog",[],function(){}),define("js/Dialogs/PluginConfig/PluginConfigDialog",["js/Controls/PropertyGrid/PropertyGridWidgetManager","text!./templates/PluginConfigDialog.html","css!./styles/PluginConfigDialog.css"],function(e,t){"use strict";var n,i="plugin",o="attribute",r=$('<div><fieldset><form class="form-horizontal" role="form"></form><fieldset></div>'),s=$('<div class="form-group"><div class="row"><label class="col-sm-4 control-label">NAME</label><div class="col-sm-8 controls"></div></div><div class="row description"><div class="col-sm-4"></div></div></div>'),a=$('<div class="desc muted col-sm-8"></div>');return n=function(t){this._propertyGridWidgetManager=new e,this._propertyGridWidgetManager.registerWidgetForType("boolean","iCheckBox"),this._pluginWidgets={},this._globalWidgets={},this._globalConfig=null,this._pluginConfig=null,this._client=t.client},n.prototype.show=function(e,t,n,i){var o=this;this._globalOptions=e,this._pluginMetadata=t,this._prevConfg=n||{},this._initDialog(),this._dialog.on("hidden.bs.modal",function(){var e=o._saveConfigurationCb.find("input").is(":checked");o._dialog.remove(),o._dialog.empty(),o._dialog=void 0,i&&(o._globalConfig&&o._pluginConfig?i(o._globalConfig,o._pluginConfig,e):i(!1))}),this._dialog.on("shown",function(){o._dialog.find("input").first().focus()}),this._dialog.modal("show")},n.prototype._closeAndSave=function(){var e=this._dialog.find("input:invalid"),t=this;0===e.length?(t._pluginConfig={},t._globalConfig={},Object.keys(t._pluginWidgets).forEach(function(e){t._pluginConfig[e]=t._pluginWidgets[e].getValue()}),Object.keys(t._globalWidgets).forEach(function(e){t._globalConfig[e]=t._globalWidgets[e].getValue()}),this._dialog.modal("hide")):$(e[0]).focus()},n.prototype._initDialog=function(){var e,n=this;this._dialog=$(t),this._btnSave=this._dialog.find(".btn-save"),this._divContainer=this._dialog.find(".modal-body"),this._saveConfigurationCb=this._dialog.find(".save-configuration"),this._modalHeader=this._dialog.find(".modal-header"),this._pluginMetadata.icon?(this._pluginMetadata.icon.src?(e=$("<img>",{"class":this._pluginMetadata.icon["class"],src:["/plugin",this._pluginMetadata.id,this._pluginMetadata.id,this._pluginMetadata.icon.src].join("/")}),this._modalHeader.prepend()):e=$("<i/>",{"class":this._pluginMetadata.icon["class"]||"glyphicon glyphicon-cog"}),e.addClass("plugin-icon pull-left")):e=$('<i class="plugin-icon pull-left glyphicon glyphicon-cog"/>'),this._modalHeader.prepend(e),this._title=this._modalHeader.find(".modal-title"),this._title.text(this._pluginMetadata.id+" v"+this._pluginMetadata.version),this._generateConfigSection(!0),this._divContainer.append($('<hr class="global-and-plugin-divider">')),this._generateConfigSection(),this._btnSave.on("click",function(e){n._closeAndSave(),e.stopPropagation(),e.preventDefault()}),this._dialog.on("keydown.PluginConfigDialog",function(e){13===e.keyCode&&(e.ctrlKey||e.metaKey)&&(e.stopPropagation(),e.preventDefault(),n._closeAndSave())})},n.prototype._generateConfigSection=function(e){var t,n,l,c,d,h,p=e?this._globalOptions.length:this._pluginMetadata.configStructure.length,g=r.clone();for(e?g.data(i,"Global Options"):g.data(i,this._pluginMetadata.id),this._divContainer.append(g),h=g.find(".form-horizontal"),t=0;p>t;t+=1)l=e?this._globalOptions[t]:this._pluginMetadata.configStructure[t],d=void 0,l=JSON.parse(JSON.stringify(l)),!e&&this._prevConfg.hasOwnProperty(l.name)&&(l.value=this._prevConfg[l.name]),this._client.getProjectAccess().write===!1&&l.writeAccessRequired===!0&&(l.readOnly=!0),c=this._propertyGridWidgetManager.getWidgetForProperty(l),e?this._globalWidgets[l.name]=c:this._pluginWidgets[l.name]=c,n=s.clone(),n.data(o,l.name),n.find("label.control-label").text(l.displayName),l.description&&""!==l.description&&(d=d||a.clone(),d.text(l.description)),void 0!==l.minValue&&null!==l.minValue&&""!==l.minValue&&(d=d||a.clone(),d.append(" The minimum value is: "+l.minValue+".")),void 0!==l.maxValue&&null!==l.maxValue&&""!==l.maxValue&&(d=d||a.clone(),d.append(" The maximum value is: "+l.maxValue+".")),e&&"runOnServer"===l.name&&l.readOnly===!0?(d.css({color:"grey","padding-top":"7px","padding-left":"0px","font-style":"italic"}),n.find(".controls").append(d)):(n.find(".controls").append(c.el),d&&n.find(".description").append(d)),h.append(n)},n.prototype._readConfig=function(){var e,t,n={};for(e in this._widgets)if(this._widgets.hasOwnProperty(e))for(t in this._widgets[e])this._widgets[e].hasOwnProperty(t)&&(n[e]=n[e]||{},n[e][t]=this._widgets[e][t].getValue());return n},n}),define("common/util/util",[],function(){"use strict";function e(e){return"object"==typeof e&&null!==e&&e instanceof Array==!1}function t(n,i){var o,r=Object.keys(i);for(o=0;o<r.length;o+=1)e(i[r[o]])&&e(n[r[o]])?t(n[r[o]],i[r[o]]):n[r[o]]=i[r[o]]}function n(e){var t,n,i,o=[];for(t=0;t<e.length;t+=1){for(i=-1,n=0;-1===i&&n<o.length;)o[n].length>e[t].length&&(i=n),n+=1;-1===i?o.push(e[t]):o.splice(i,0,e[t])}return o}function i(e,t,n){for(var i=e.length>n?n:e.length;i--;)if(e[i]===t)return i;return-1}function o(e,t,n,i){for(var o=e.length>n?n:e.length;o--;)if(e[o][i]===t[i])return o;return-1}function r(e,t){for(var n,o=e.length,r=t.length;r--;)n=t[r],-1===i(e,n,o)&&e.push(n)}function s(e,t,n){for(var i,r=e.length,s=t.length;s--;)i=t[s],-1===o(e,i,r,n)&&e.push(i)}return{isTrueObject:e,updateFieldsRec:t,orderStringArrayByElementLength:n,extendArrayUnique:r,extendObjectArrayUnique:s}}),define("js/Utils/ComponentSettings",["common/util/util","superagent"],function(e,t){"use strict";function n(t,n,i){return n&&"object"==typeof n&&e.updateFieldsRec(t,n),i&&"object"==typeof i&&e.updateFieldsRec(t,i),t}function i(e,t){var i,o;if("undefined"==typeof WebGMEGlobal)throw new Error("WebGMEGlobal must be defined for this function, use resolveSettings");return i=WebGMEGlobal.componentSettings&&WebGMEGlobal.componentSettings[t],o=WebGMEGlobal.userInfo&&WebGMEGlobal.userInfo.settings&&WebGMEGlobal.userInfo.settings[t],n(e,i,o)}function o(e,n,i){t.patch("api/user/settings/"+e).send(n).end(function(e,t){return e||200!==t.status?void i(e||new Error("Did not return status 200: "+t.status)):void i(null,t.body)})}function r(e,n,i){t.put("api/user/settings/"+e).send(n).end(function(e,t){return e||200!==t.status?void i(e||new Error("Did not return status 200: "+t.status)):void i(null,t.body)})}return{resolveSettings:n,resolveWithWebGMEGlobal:i,updateComponentSettings:o,overwriteComponentSettings:r}}),define("js/Utils/InterpreterManager",["plugin/PluginResult","plugin/PluginMessage","js/Dialogs/PluginConfig/PluginConfigDialog","js/logger","js/Utils/ComponentSettings"],function(e,t,n,i,o){"use strict";var r=function(e,t){this._client=e,this.gmeConfig=t,this._savedConfigs={},this.logger=i.create("gme:InterpreterManager",t.client.log),this.logger.debug("InterpreterManager ctor")};return r.prototype.GLOBAL_OPTIONS="Global Options",r.prototype.getPluginErrorResult=function(n,i,o,r){var s=new e,a=new t;return a.severity="error",a.message=i,s.setSuccess(!1),s.setPluginName(n),s.setProjectId(r||this._client.getActiveProjectId()||"N/A"),s.addMessage(a),s.setStartTime(o),s.setFinishTime((new Date).toISOString()),s.setError(a.message),s},r.prototype.configureAndRun=function(t,i){var o=this,r=new n({client:this._client}),s=o._client.getCurrentPluginContext(t.id),a=this.getGlobalOptions(t,{namespace:s.managerConfig.namespace});return a instanceof e?void i(a):void r.show(a,t,this.getStoredConfiguration(t),function(n,r,a){function l(n,r){n?(o.logger.error(n),i(r?new e(r):o.getPluginErrorResult(t.id,n.message,c,s.managerConfig.project.projectId))):i(new e(r))}var c=(new Date).toISOString();if(n===!1)return void i(!1);o._savedConfigs[t.id]=r,a===!0&&o.saveSettingsInUser(t,r),s.pluginConfig=r,s.managerConfig.namespace=n.namespace;var d=!n.runOnServer&&!t.writeAccessRequired,h=o._client.getBranchStatus()&&o._client.getBranchStatus()!==o._client.CONSTANTS.BRANCH_STATUS.SYNC;return!d&&h?void i(o.getPluginErrorResult(t.id,"Not allowed to invoke server plugin while local branch is AHEAD or PULLING changes from server.",c)):void(n.runOnServer===!0?o._client.runServerPlugin(t.id,s,l):o._client.runBrowserPlugin(t.id,s,l))})},r.prototype.getGlobalOptions=function(e,t){var n,i={name:"runOnServer",displayName:"Execute on Server",description:"",value:t.hasOwnProperty("runOnServer")?t.runOnServer:!1,valueType:"boolean",readOnly:!1},o={name:"namespace",displayName:"Used Namespace",description:"The namespace the plugin should run under.",value:t.hasOwnProperty("namespace")?t.namespace:"",valueType:"string",valueItems:[],readOnly:!1},r=[],s=this.gmeConfig.plugin.allowServerExecution===!0,a=!e.disableServerSideExecution,l=this.gmeConfig.plugin.allowBrowserExecution===!0,c=!e.disableBrowserSideExecution;return s===!1&&l===!1?n="Plugin execution is disabled!":a===!1&&c===!1?n="This plugin cannot run on the server nor in the browser!?":l?s?c?a||(i.readOnly=!0,i.description="This plugin can not run on the server."):(i.readOnly=!0,i.value=!0,i.description="This plugin can not run in the browser."):c?(i.readOnly=!0,i.description="Server execution is disabled."):n="This plugin can only run on the server which is disabled!":c?(i.readOnly=!0,i.value=!0,i.description="Browser execution is disabled."):n="This plugin can only run on the server which is disabled!",n?this.getPluginErrorResult(e.id,n,(new Date).toISOString()):(r.push(i),o.valueItems=this._client.getLibraryNames(),o.valueItems.length>0&&(o.valueItems.unshift(""),r.push(o)),r)},r.prototype.getStoredConfiguration=function(e){var t,n=this.getPluginComponentId(e);return this._savedConfigs.hasOwnProperty(e.id)?t=this._savedConfigs[e.id]:"undefined"!=typeof WebGMEGlobal&&(t={},o.resolveWithWebGMEGlobal(t,n)),t},r.prototype.saveSettingsInUser=function(e,t,n){var i=this,r=this.getPluginComponentId(e.id);this.logger.debug("Saving plugin config in user",r,t),o.overwriteComponentSettings(r,t,function(e,t){n?e?n(e):n(null,t):e?i.logger.error(new Error("Failed storing settings for user"),e):i.logger.debug("Stored new settings for plugin at",r,t)})},r.prototype.getPluginComponentId=function(e){var t="Plugin_"+e.id+"__"+e.version.split(".").join("_");return this.logger.debug('Resolved componentId for plugin "'+t+'"'),t},r}),define("js/WebGME",["js/logger","js/client","js/Constants","js/Panels/MetaEditor/MetaEditorConstants","js/Utils/GMEConcepts","js/Utils/GMEVisualConcepts","js/Utils/StateManager","js/Utils/WebGMEUrlManager","js/LayoutManager/LayoutManager","js/Decorators/DecoratorManager","js/KeyboardManager/KeyboardManager","js/PanelManager/PanelManager","./WebGME.History","js/Utils/PreferencesHelper","js/Dialogs/Projects/ProjectsDialog","js/Utils/InterpreterManager","js/Utils/ComponentSettings","common/storage/util","q","jquery"],function(e,t,n,i,o,r,s,a,l,c,d,h,p,g,u,f,m,b,y){"use strict";function v(i){function v(e){var t=e.splice(0,1)[0];w.loadPanel(t,function(){e.length>0?v(e):(_.isFunction(i)&&i(O),O.connectToDatabase(function(e){return e?void M.error("Failed to connect to database",e):void(R.createNewProject?P():R.projectToLoad?D():I(!1))}))})}function D(){y.nfcall(O.selectProject,R.projectToLoad,void 0).then(function(){return R.branchToLoad?y.nfcall(O.getBranches,R.projectToLoad):{}}).then(function(e){return R.commitToLoad?y.nfcall(O.selectCommit,R.commitToLoad):R.branchToLoad&&e[R.branchToLoad]?y.nfcall(O.selectBranch,R.branchToLoad,null):void 0}).then(function(){T(R.objectToLoad,R.activeSelectionToLoad,R.visualizerToLoad,R.tabToSelect)})["catch"](function(e){M.error("error during startup",e),I(!1)})}function I(e){WebGMEGlobal.State.registerSuppressVisualizerFromNode(!1),L=!1,M.info("init-phase false"),M.info("about to open projectOpenDialog, connect:",e),e?O.connectToDatabase(function(e){return e?void M.error("Failed to connect to database",e):void(k.disableProjectsDialog===!1?(S=new u(O),S.show()):N())}):k.disableProjectsDialog===!1?(S=new u(O),S.show()):N()}function T(e,t,i,o){function r(e){var r,a,l,d={};if(M.debug("events from selectObject",e),"complete"!==e[0].etype)return void M.warn("partial events only");for(M.debug('active "'+c+'" node loaded'),r=0;r<e.length;r+=1)if(e[r].eid===c&&(a=O.getNode(c))){d[n.STATE_ACTIVE_OBJECT]=c,t=t||[],t.length>0&&(d[n.STATE_ACTIVE_SELECTION]=t),o=parseInt(o,10),o>=0&&i&&(d[n.STATE_ACTIVE_VISUALIZER]=i,d[n.STATE_ACTIVE_TAB]=o,WebGMEGlobal.State.registerActiveVisualizer(i),WebGMEGlobal.State.registerActiveTab(o),"ModelEditor"===i&&(l=a.getValidAspectNames(),l.sort(function(e,t){var n=e.toLowerCase(),i=t.toLowerCase();return i>n?-1:1}),l.unshift("All"),d[n.STATE_ACTIVE_ASPECT]=l[o]||"All")),setTimeout(function(){WebGMEGlobal.State.set(d),WebGMEGlobal.State.registerSuppressVisualizerFromNode(!1)});break}O.removeUI(s)}var s,a={},l={},c="root"===e?n.PROJECT_ROOT_ID:e;l[c]={children:0},M.debug("selectObject",e),M.debug("activeSelectionToLoad",t),t&&t.length>0?l[c]={children:1}:l[c]={children:0},s=O.addUI(a,r),O.updateTerritory(s,l)}function P(){y.nfcall(O.getProjects,{}).then(function(e){var t,n=y.defer(),i=!1,o=WebGMEGlobal.userInfo._id,r=o+O.CONSTANTS.STORAGE.PROJECT_ID_SEP+R.projectToLoad;for(t=0;t<e.length;t+=1)if(e[t]._id===r){i=!0;break}return i?(y.nfcall(O.selectProject,r,void 0).then(function(){return y.nfcall(O.getBranches,r)}).then(n.resolve)["catch"](n.reject),n.promise):(y.nfcall(O.seedProject,{type:"file",projectName:R.projectToLoad,seedName:WebGMEGlobal.gmeConfig.seedProjects.defaultProject}).then(function(){return y.nfcall(O.selectProject,r,void 0)}).then(function(){return y.nfcall(O.getBranches,r)}).then(n.resolve)["catch"](n.reject),n.promise)}).then(function(e){return R.commitToLoad?y.nfcall(O.selectCommit,R.commitToLoad):R.branchToLoad&&e[R.branchToLoad]?y.nfcall(O.selectBranch,R.branchToLoad,null):void 0}).then(function(){T(R.objectToLoad,R.activeSelectionToLoad,R.visualizerToLoad,R.tabToSelect)})["catch"](function(e){M.error("error during startup",e),I(!1)})}function N(){$('<div class="modal fade" tabindex="-1" role="dialog"><div class="modal-dialog" style="margin-top: 200px;"><div class="modal-content" style="background: none; border: none;"><h1 style="text-align: center;">No project opened ...</h1></div></div></div>').modal("show")}function A(e){function t(t){var i,o;for(i=0;i<t.length;i+=1)if(t[i].eid===e&&(o=O.getNode(e))){WebGMEGlobal.State.registerActiveObject(e);break}O.removeUI(n)}var n,i={};i[e]={children:0},n=O.addUI(null,t),O.updateTerritory(n,i)}var w,O,S,x=WebGMEGlobal.gmeConfig,M=e.create("gme:WebGME",WebGMEGlobal.gmeConfig.client.log),R=a.parseInitialThingsToDoFromUrl(),L=!0,k=E;m.resolveWithWebGMEGlobal(k,C),(R.projectToLoad||R.createNewProject)===!1&&(R.projectToLoad=k.initialContext.project,R.branchToLoad=R.branchToLoad||k.initialContext.branch,R.objectToLoad=R.objectToLoad||k.initialContext.node||R.objectToLoad),w=new l,w.loadLayout(R.layoutToLoad,function(){var e,i,a=[],l=w._currentLayout.panels,u=l?l.length:0;O=new t(x),WebGMEGlobal.Client=O,WebGMEGlobal.InterpreterManager=new f(O,x),Object.defineProperty(WebGMEGlobal,"State",{value:s.initialize(),writable:!1,enumerable:!0,configurable:!1}),O.registerUIStateGetter(function(){return WebGMEGlobal.State.toJSON()}),WebGMEGlobal.State.on("change:"+n.STATE_ACTIVE_OBJECT,function(){O.emitStateNotification()}),WebGMEGlobal.State.registerLayout(R.layoutToLoad),document.title=k.pageTitle,M.info("init-phase true"),p.initialize(),o.initialize(O),r.initialize(O),g.initialize(O),O.addEventListener(O.CONSTANTS.BRANCH_CHANGED,function(e,t){w.setPanelReadOnly(O.isCommitReadOnly()||O.isProjectReadOnly()),t?WebGMEGlobal.State.registerActiveBranchName(t):O.getActiveCommitHash()?WebGMEGlobal.State.registerActiveCommit(O.getActiveCommitHash()):WebGMEGlobal.State.registerActiveBranchName(null)}),O.addEventListener(O.CONSTANTS.PROJECT_OPENED,function(e,t){var i,o;document.title=WebGMEGlobal.gmeConfig.authentication.enable?b.getProjectDisplayedNameFromProjectId(t):b.getProjectNameFromProjectId(t),w.setPanelReadOnly(O.isProjectReadOnly()),WebGMEGlobal.State.registerActiveProjectName(t),L===!1&&(i=O.getActiveProjectName(),o=k.byProjectId.nodeAtOpen.hasOwnProperty(t)?k.byProjectId.nodeAtOpen[t]:k.byProjectName.nodeAtOpen.hasOwnProperty(i)?k.byProjectName.nodeAtOpen[i]:k.nodeAtOpen,A(o?o:n.PROJECT_ROOT_ID))}),O.addEventListener(O.CONSTANTS.PROJECT_CLOSED,function(){document.title=k.pageTitle,L=!1,WebGMEGlobal.State.clear()}),O.decoratorManager=new c,e=x.visualization.decoratorsToPreload||WebGMEGlobal.allDecorators||[],O.decoratorManager.downloadAll(e,function(e){for(e&&M.error(e),i=0;u>i;i+=1)a.push({panel:l[i].panel,container:l[i].container,control:l[i].control,params:{client:O}});v(a),WebGMEGlobal.KeyboardManager=d,WebGMEGlobal.KeyboardManager.setEnabled(!0),WebGMEGlobal.PanelManager=new h(O)})})}var C="GenericUIWebGMEStart",E={pageTitle:"WebGME",disableProjectsDialog:!1,initialContext:{project:null,branch:null,node:null},nodeAtOpen:"",byProjectName:{nodeAtOpen:{}},byProjectId:{nodeAtOpen:{}}};return{start:v}}),define("text!js/Layouts/DefaultLayout/templates/DefaultLayout.html",[],function(){return'<div class="ui-layout-center"></div>\r\n<div class="ui-layout-east side-panel no-print"></div>\r\n<div class="ui-layout-west side-panel no-print"></div>\r\n<div class="ui-layout-north no-print"></div>\r\n<div class="ui-layout-south no-print"></div>\r\n'}),define("text!js/Layouts/DefaultLayout/DefaultLayoutConfig.json",[],function(){return'{\r\n  "panels": [\r\n    {\r\n      "id": "Header",\r\n      "panel": "Header/HeaderPanel",\r\n      "container": "header",\r\n      "DEBUG_ONLY": false\r\n    },\r\n    {\r\n      "id": "Footer",\r\n      "panel": "FooterControls/FooterControlsPanel",\r\n      "container": "footer",\r\n      "DEBUG_ONLY": false\r\n    },\r\n    {\r\n      "id": "ObjectBrowserPanel",\r\n      "panel": "ObjectBrowser/ObjectBrowserPanel",\r\n      "container": "east",\r\n      "DEBUG_ONLY": false\r\n    },\r\n    {\r\n      "id": "VisualizerPanel",\r\n      "panel": "Visualizer/VisualizerPanel",\r\n      "container": "west",\r\n      "DEBUG_ONLY": false\r\n    },\r\n    {\r\n      "id": "PartBrowserPanel",\r\n      "panel": "PartBrowser/PartBrowserPanel",\r\n      "container": "west",\r\n      "DEBUG_ONLY": false\r\n    },\r\n    {\r\n      "id": "PropertyEditorPanel",\r\n      "panel": "PropertyEditor/PropertyEditorPanel",\r\n      "container": "east",\r\n      "DEBUG_ONLY": false\r\n    }\r\n  ]\r\n}\r\n'}),define("js/Layouts/DefaultLayout/DefaultLayout",["jquery-layout","js/logger","js/Utils/ComponentSettings","text!./templates/DefaultLayout.html","text!./DefaultLayoutConfig.json"],function(e,t,n,i,o){"use strict";var r,s=10,a=10,l=3,c=6,d=WebGMEGlobal.SUPPORTS_TOUCH?s:l,h=WebGMEGlobal.SUPPORTS_TOUCH?a:c,p=210;return r=function(e){this._logger=e&&e.logger||t.create("gme:Layouts:DefaultLayout",WebGMEGlobal.gmeConfig.client.log),this._config=r.getDefaultConfig(),n.resolveWithWebGMEGlobal(this._config,r.getComponentId()),this._logger.debug("Resolved component-settings",this._config),this.panels=e&&e.panels||this._config.panels,this._template=e&&e.template||i},r.getComponentId=function(){return"GenericUIDefaultLayout"},r.getDefaultConfig=function(){return JSON.parse(o)},r.prototype.init=function(){var e=this;this._body=$("body"),this._body.html(this._template),this._westPanel=this._body.find("div.ui-layout-west"),this._centerPanel=this._body.find("div.ui-layout-center"),this._eastPanel=this._body.find("div.ui-layout-east"),this._headerPanel=this._body.find("div.ui-layout-north"),this._footerPanel=this._body.find("div.ui-layout-south"),this._eastPanels=[],this._westPanels=[],this._centerPanels=[],this._body.layout({defaults:{},north:{closable:!1,resizable:!1,slidable:!1,spacing_open:0,size:64},south:{closable:!1,resizable:!1,slidable:!1,spacing_open:0,size:27},east:{size:p,minSize:p,resizable:!0,slidable:!1,spacing_open:d,spacing_closed:h,onresize:function(){e._onEastResize()}},west:{size:p,minSize:p,showOverflowOnHover:!0,resizable:!0,slidable:!1,spacing_open:d,spacing_closed:h,onresize:function(){e._onWestResize()}},center:{onresize:function(){e._onCenterResize()}}})},r.prototype.addToContainer=function(e,t){if("header"===t)this._headerPanel.append(e.$pEl);else if("footer"===t)this._footerPanel.append(e.$pEl);else{if("west"===t)return this._westPanel.append(e.$pEl),this._westPanels.push(e),this._onWestResize(),this._onWestResize;if("east"===t)return this._eastPanel.append(e.$pEl),this._eastPanels.push(e),this._onEastResize(),this._onEastResize;if("center"===t)return this._centerPanel.append(e.$pEl),this._centerPanels.push(e),this._onCenterResize(),this._onCenterResize}},r.prototype.remove=function(e){var t;t=this._eastPanels.indexOf(e),-1===t?(t=this._westPanels.indexOf(e),-1===t?(t=this._centerPanels.indexOf(e),-1===t?this._logger.warn("Panel to be removed not found"):(this._centerPanels.splice(t,1),this._onCenterResize())):this._westPanels.splice(t,1)):(this._eastPanels.splice(t,1),this._onEastResize())},r.prototype.destroy=function(){this._body.empty()},r.prototype._onCenterResize=function(){var e,t=this._centerPanels.length,n=this._centerPanel.width(),i=this._centerPanel.height(),o=Math.floor(i/t);for(e=0;t>e;e+=1)this._centerPanels[e].setSize(n,o)},r.prototype._onEastResize=function(){var e,t=this._eastPanels.length,n=this._eastPanel.width(),i=this._eastPanel.height(),o=Math.floor(i/t);for(e=0;t>e;e+=1)this._eastPanels[e].setSize(n,o)},r.prototype._onWestResize=function(){var e,t=this._westPanels.length,n=this._westPanel.width(),i=this._westPanel.height();2===t&&(e=this._westPanels[0].$pEl.outerHeight(!0),this._westPanels[1].setSize(n,i-e))},r}),define("js/PanelBase/PanelBase",["jquery","js/logger"],function(e,t){"use strict";var n;return n=function(e){var i="gme:PanelBase:PanelBase";e&&e[n.OPTIONS.LOGGER_INSTANCE_NAME]&&(i="gme:"+e[n.OPTIONS.LOGGER_INSTANCE_NAME]),
this.logger=t.create(i,WebGMEGlobal.gmeConfig.client.log),this.$pEl=this.$el=$("<div/>"),this._isReadOnly=!1},n.OPTIONS={LOGGER_INSTANCE_NAME:"LOGGER_INSTANCE_NAME"},n.READ_ONLY_CLASS="read-only",n.prototype.setReadOnly=function(e){this._isReadOnly!==e&&(this._isReadOnly=e,this.logger.debug('ReadOnly mode changed to "'+e+'"'),this.onReadOnlyChanged(this._isReadOnly))},n.prototype.isReadOnly=function(){return this._isReadOnly},n.prototype.onReadOnlyChanged=function(e){e===!0?this.$el.addClass(n.READ_ONLY_CLASS):this.$el.removeClass(n.READ_ONLY_CLASS)},n.prototype._getSize=function(){this.size={width:this.$el.outerWidth(!0),height:this.$el.outerHeight(!0)}},n.prototype.clear=function(){},n.prototype.destroy=function(){this.clear(),this.$el.remove()},n.prototype.setSize=function(e,t){this.size={width:e,height:t},this.onResize(this.size.width,this.size.height)},n.prototype.onResize=function(e,t){this.logger.debug("onResize --> width: "+e+", height: "+t)},n.prototype.afterAppend=function(){this.offset=this.$el.offset(),this._getSize()},n.prototype.setContainerUpdateFn=function(e,t){t?this.updateContainerSize=function(){t.call(e)}:this.updateContainerSize=function(){this.logger.warn("updateContainerSize not implemented for container in current-layout")}},n}),define("css!js/Widgets/ProjectTitle/styles/ProjectTitleWidget",[],function(){}),define("js/Widgets/ProjectTitle/ProjectTitleWidget",["js/logger","js/client/constants","css!./styles/ProjectTitleWidget.css"],function(e,t){"use strict";var n,i='<div class="project-title navbar-text"><span class="title">WebGME</span><span class="readOnlyInfo">[READ ONLY]</span></div>';return n=function(t,n){this._logger=e.create("gme:Widgets:ProjectTitle:ProjectTitleWidget",WebGMEGlobal.gmeConfig.client.log),this._client=n,this._el=t,this._initializeUI(),this._logger.debug("Created")},n.prototype._initializeUI=function(){var e=this;this._el.html(i),this._projectTitle=this._el.find(".title"),this._client.addEventListener(t.PROJECT_OPENED,function(){e._refresh()}),this._client.addEventListener(t.PROJECT_CLOSED,function(){e._refresh()}),this._client.addEventListener(t.BRANCH_CHANGED,function(){e._refresh()})},n.prototype._refresh=function(){var e=this._client,t=e.getActiveProjectId(),n=e.getActiveBranchName(),i=e.isProjectReadOnly()||e.isCommitReadOnly(),o=t+" @ "+n,r=o+(i?" [READ-ONLY]":"");this._projectTitle.text(o),document.title="-= "+r+" =- WebGME"},n}),define("js/Widgets/UserProfile/UserProfileWidget",["js/logger"],function(e){"use strict";var t,n='<i class="glyphicon glyphicon-user icon-white" title="Logged in as"></i> <a href="/profile/" target="_top" class="navbar-link" title="View profile">__USERNAME__</a> <a href="/logout" target="_top" class="navbar-link"><i class="glyphicon glyphicon-eject icon-white" title="Log out"></i></a>',i='<i class="glyphicon glyphicon-user" title="Not logged in"></i>';return t=function(t,n){this._logger=e.create("gme:Widgets:UserProfile:UserProfileWidget",WebGMEGlobal.gmeConfig.client.log),this._client=n,this._el=t,this._initializeUI(),this._logger.debug("Created")},t.prototype._initializeUI=function(){var e=i;e=n.replace("__USERNAME__",WebGMEGlobal.userInfo._id),e='<p class="navbar-text">'+e+"</p>",this._el.html(e)},t}),define("js/UIEvents",[],function(){"use strict";return{LOCATE_NODE:"LOCATE_NODE"}}),define("css!js/Widgets/ConnectedUsers/styles/ConnectedUsersWidget",[],function(){}),define("js/Widgets/ConnectedUsers/ConnectedUsersWidget",["js/logger","js/UIEvents","css!./styles/ConnectedUsersWidget.css","jquery"],function(e,t){"use strict";function n(t,n){var i=this;this.logger=e.create("gme:Widgets:ConnectedUsers:ConnectedUsersWidget",WebGMEGlobal.gmeConfig.client.log),this.client=n,this.$el=$("<div/>",{"class":"connected-users-widget"}),t.append(this.$el),this.rooms={},this.userId=WebGMEGlobal.userInfo._id,this.client.addEventListener(this.client.CONSTANTS.CONNECTED_USERS_CHANGED,function(e,t){i._userChanged(t)}),this.client.addEventListener(this.client.CONSTANTS.PROJECT_OPENED,function(){i._reinitialize()}),this.client.addEventListener(this.client.CONSTANTS.BRANCH_CHANGED,function(){i._reinitialize()}),this.logger.debug("ctor"),this._reinitialize()}var i=["default","primary","success","danger","info","warning"];return n.prototype._reinitialize=function(){var e,t=this.client.getActiveProjectId(),n=this.client.getActiveBranchName(),i=this;t&&n?(e=this._getBranchRoomName({projectId:t,branchName:n}),Object.keys(this.rooms).forEach(function(t){t!==e&&(Object.keys(i.rooms[t].users).forEach(function(e){i.rooms[t].users[e].$el.off("click"),i.rooms[t].users[e].$el.remove()}),delete i.rooms[t])})):(this.$el.empty(),this.rooms={})},n.prototype._userChanged=function(e){e.type===this.client.CONSTANTS.STORAGE.BRANCH_ROOM_SOCKETS?e.join===!0?(this.logger.debug("user joined branch-room",e),this._userJoined(e)):(this.logger.debug("user left branch-room",e),this._userLeft(e)):e.type===this.client.CONSTANTS.STORAGE.CLIENT_STATE_NOTIFICATION?(this.logger.debug("user updated its state",e),this._userUpdated(e)):this.logger.error(new Error("Unexpected event type "+e.type))},n.prototype._userJoined=function(e){var n,o,r=this._getBranchRoomName(e),s=this;return this.rooms[r]=this.rooms[r]||{users:{},colors:i.slice()},this.rooms[r].users.hasOwnProperty(e.userId)===!0?void this.logger.debug("New user was already added",e.userId):e.userId===this.userId?void this.logger.debug("New user was you",e.userId):(n=Math.floor(Math.random()*this.rooms[r].colors.length),o={userId:e.userId,color:this.rooms[r].colors[n],$el:$("<button/>",{"class":"user-badge btn btn-xs",title:e.userId,text:e.userId[0].toUpperCase()}),state:{}},o.$el.addClass("btn-"+o.color),o.$el.on("click",function(){"string"==typeof o.state.activeObject&&s.client.dispatchEvent(t.LOCATE_NODE,{nodeId:o.state.activeObject})}),this.rooms[r].colors.splice(n,1),0===this.rooms[r].colors.length&&(this.rooms[r].colors=i.slice()),this.rooms[r].users[e.userId]=o,void this.$el.append(o.$el.hide().fadeIn(3e3)))},n.prototype._userLeft=function(e){var t=this._getBranchRoomName(e),n=this.rooms[t]&&this.rooms[t].users[e.userId];return n?(n.$el.remove(),delete this.rooms[t].users[e.userId],void this.rooms[t].colors.push(n.color)):void this.logger.debug("Leaving user was already removed",e.userId)},n.prototype._userUpdated=function(e){var t,n=this._getBranchRoomName(e);return e.userId===this.userId?void this.logger.debug("Updating user was you",e.userId):(this._userJoined(e),t=this.rooms[n].users[e.userId],void(e.state&&t.state.activeObject!==e.state.activeObject&&(t.state.activeObject=e.state.activeObject,t.$el.prop("title",t.userId+"@"+t.state.activeObject))))},n.prototype._getBranchRoomName=function(e){return e.hasOwnProperty("projectId")!==!1&&e.hasOwnProperty("branchName")!==!1?e.projectId+this.client.CONSTANTS.STORAGE.ROOM_DIVIDER+e.branchName:void this.logger.error(new Error('EventData did not contain branch room info "'+e.projectId+'", "'+e.branchName+'"'))},n}),define("js/Toolbar/ButtonBase",[],function(){"use strict";function e(e){var t,n="btn btn-mini";return t=$("<a/>",{"class":n,href:"#",title:e.title}),e.data&&t.data(e.data),e.icon&&("string"==typeof e.icon?t.append($('<i class="'+e.icon+'"></i>')):t.append(e.icon)),e.text&&(e.icon&&t.append(" "),t.append(e.text)),e.clickFn&&t.on("click",function(n){t.hasClass("disabled")||e.clickFn.call(this,$(this).data()),e.clickFnEventCancel!==!1&&(n.stopPropagation(),n.preventDefault())}),t.enabled=function(e){e===!0?t.disable(!1):t.disable(!0)},t}return{createButton:e}}),define("js/Toolbar/ToolbarItemBase",[],function(){"use strict";var e;return e=function(){this._toolbar=void 0},e.prototype.show=function(){this.el&&this.el.show()},e.prototype.hide=function(){this.el&&this.el.hide()},e.prototype.enabled=function(){},e.prototype.destroy=function(){this.el&&(this.el.remove(),this.el.empty(),this.el=void 0)},e}),define("js/Toolbar/ToolbarButton",["./ButtonBase","./ToolbarItemBase"],function(e,t){"use strict";var n;return n=function(t){this.el=$('<div class="toolbar-button"></div>'),this._btn=e.createButton(t),this.el.append(this._btn)},_.extend(n.prototype,t.prototype),n.prototype.enabled=function(e){this._btn.enabled(e)},n}),define("js/Toolbar/ToolbarSeparator",["./ToolbarItemBase"],function(e){"use strict";var t,n=$('<div class="separator"></div>');return t=function(){this.el=n.clone()},_.extend(t.prototype,e.prototype),t}),define("js/Toolbar/ToolbarRadioButtonGroup",["./ButtonBase","./ToolbarItemBase"],function(e,t){"use strict";var n,i=$("<div/>",{"class":"btn-group"});return n=function(e){var t;this.el=t=i.clone(),e&&t.on("click",".btn",function(n){$(this).hasClass("disabled")||(t.find(".btn.active").removeClass("active"),$(this).addClass("active"),e.call(this,$(this).data())),n.stopPropagation(),n.preventDefault()})},_.extend(n.prototype,t.prototype),n.prototype.addButton=function(t){var n;return t.clickFn&&delete t.clickFn,n=e.createButton(t),this.el.append(n),0===this.el.find(".btn.active").length&&n.addClass("active"),t&&t.selected&&t.selected===!0&&(this.el.find(".btn.active").removeClass("active"),n.addClass("active")),n},n.prototype.enabled=function(e){e===!0?this.el.find(".btn").disable(!1):this.el.find(".btn").disable(!0)},n}),define("js/Toolbar/ToolbarToggleButton",["./ButtonBase","./ToolbarItemBase"],function(e,t){"use strict";var n,i=$('<div class="toolbar-button"></div>');return n=function(t){var n,o,r=t.clickFn;n=function(e){o.toggleClass("active"),r&&r.call(this,e,o.hasClass("active"))},t.clickFn=n,o=this._btn=e.createButton(t),this.el=i.clone(),this.el.append(this._btn)},_.extend(n.prototype,t.prototype),n.prototype.setToggled=function(e){this._btn.removeClass("active"),e===!0&&this._btn.addClass("active")},n}),define("js/Toolbar/ToolbarTextBox",["./ToolbarItemBase"],function(e){"use strict";var t,n=$('<div class="toolbar-input"></div>'),i=$("<div/>",{"class":"input-prepend"}),o=$("<input/>",{"class":"input-medium input-mini",type:"text"}),r=$("<span/>",{"class":"add-on add-on-mini"});return t=function(e){var t,s,a=i.clone(),l=o.clone();this.el=n.clone(),this._textBox=l,e&&e.label&&(t=r.clone(),t.text(e.label+": ")),e&&e.prependContent&&(t=r.clone(),t.html(e.prependContent)),e&&e.collapse&&l.addClass("no-focus-collapse"),t&&a.append(t),e&&e.placeholder&&l.attr("placeholder",e.placeholder),a.append(l),e&&e.textChangedFn&&l.on("keyup",function(){var t=$(this).val();t!==s&&(e.textChangedFn.call(this,s,t),s=t)}),l.on("keypress",function(t){var n;return 13===t.keyCode?(e&&e.onEnterFn&&(n=$(this).val(),e.onEnterFn.call(this,n)),!1):void 0}),this.el.append(a)},_.extend(t.prototype,e.prototype),t.prototype.enabled=function(e){e===!0?this._textBox.removeAttr("disabled"):this._textBox.attr("disabled","disabled")},t.prototype.setText=function(e){this._textBox.val(e)},t.prototype.getText=function(){return this._textBox.val()},t}),define("js/Toolbar/ToolbarLabel",["./ToolbarItemBase"],function(e){"use strict";var t,n=$('<div class="toolbar-label"></div>');return t=function(){this.el=n.clone()},_.extend(t.prototype,e.prototype),t.prototype.text=function(e,t){this.el&&(this.el.text(e),t!==!0&&this._toolbar.refresh())},t}),define("js/Toolbar/ToolbarCheckBox",["js/Controls/iCheckBox","./ToolbarItemBase"],function(e,t){"use strict";var n;return n=function(t){e.apply(this,[t]),this.el.addClass("toolbar-checkbox")},_.extend(n.prototype,e.prototype),_.extend(n.prototype,t.prototype),n}),define("js/Toolbar/ToolbarDropDownButton",["./ButtonBase","js/Controls/iCheckBox","js/logger","./ToolbarItemBase"],function(e,t,n,i){"use strict";var o,r=$("<div/>",{"class":"btn-group"}),s=$('<span class="caret"></span>'),a=$('<ul class="dropdown-menu"></ul>'),l=$('<li class="divider"></li>'),c=$("<li/>",{"class":"chkbox"}),d=$('<a href="#"></a>'),h=$("<li></li>");return o=function(t){var i,o;this.el=r.clone(),this._logger=n.create("gme:ToolBar:ToolBarButtonDropDown:"+(new Date).toISOString(),WebGMEGlobal.gmeConfig.client.log),t.clickFn&&(i=t.clickFn,t.clickFnEventCancel=!1,t.clickFn=function(){i()}),this._dropDownTxt=t.text,this._dropDownLimit=t.limitTxtLength||0,delete t.text,this._dropDownBtn=e.createButton(t),this.dropDownText(this._dropDownTxt),o=s.clone(),this._ulMenu=a.clone(),t&&t.menuClass&&this._ulMenu.addClass(t.menuClass),this._dropDownBtn.append(" ").append(o),this._dropDownBtn.addClass("dropdown-toggle"),this._dropDownBtn.attr("data-toggle","dropdown"),this.el.append(this._dropDownBtn).append(this._ulMenu),this._logger.debug("ctor")},_.extend(o.prototype,i.prototype),o.prototype.clear=function(){this._ulMenu.empty()},o.prototype.enabled=function(e){return this.el?void(e===!0?this.el.find(".btn").disable(!1):this.el.find(".btn").disable(!0)):void this._logger.error("trying to enable",e)},o.prototype.addButton=function(t){var n,i,o=h.clone(),r=this._dropDownBtn;t.clickFn&&(i=t.clickFn,t.clickFn=function(e){r.dropdown("toggle"),i(e)}),n=e.createButton(t),n.removeClass("btn btn-mini"),n.addClass("dropdown-list-button"),t.disabled===!0&&n.disable(!0),o.append(n),this._ulMenu.append(o)},o.prototype.addDivider=function(){var e=l.clone();this._ulMenu.append(e)},o.prototype.addCheckBox=function(e){var n,i=c.clone(),o=d.clone();return e.text&&o.append(e.text),n=new t(e),n.el.addClass("pull-right"),o.append(n.el),i.append(o),i.on("click",function(e){n.toggleChecked(),e.stopPropagation(),e.preventDefault()}),this._ulMenu.append(i),i.setEnabled=function(e){e?i.disable(!1):i.disable(!0),n.setEnabled(e)},i.setChecked=function(e){n.setChecked(e)},i},o.prototype.destroy=function(){this.el.remove(),this.el.empty(),this.el=void 0,this._logger.debug("destroyed")},o.prototype.dropDownText=function(e){var t,n,i,o=this._dropDownBtn.html();return"string"!=typeof e?this._dropDownTxt:(this._dropDownTxt=e,i=e,this._dropDownLimit&&i.length>this._dropDownLimit&&(i=i.substr(0,this._dropDownLimit)+"..."),t=o.indexOf("<span"),n=i+" "+o.substr(t),this._dropDownBtn.html(n),void 0)},o}),define("js/Toolbar/ToolbarColorPicker",["js/Controls/ColorPicker","./ToolbarButton"],function(e,t){"use strict";var n;return n=function(n){var i=this;n=n||{},n.clickFn=function(){var t=new e({el:i.el});t.onColorChanged=function(e){n&&n.colorChangedFn&&n.colorChangedFn.call(i,e)}},t.apply(this,[n])},_.extend(n.prototype,t.prototype),n}),define("js/DragDrop/DragSource",["./DragEffects","./DragConstants"],function(e,t){"use strict";function n(e,n){e.draggable({zIndex:a,appendTo:l,cursorAt:n.cursorAt||c,helper:function(i){var o,r=s(e,n,i);return o=n&&_.isFunction(n.helper)?n.helper.call(e,i,r):e.clone(),o.css({"pointer-events":"none"}),o.data(t.DRAG_INFO,r),o},start:function(t,i){return n&&_.isFunction(n.start)?n.start.call(e,t,i):void 0},drag:function(t,i){return n&&_.isFunction(n.drag)?n.drag.call(e,t,i):void 0},stop:function(t){return n&&_.isFunction(n.stop)?n.stop.call(e,t):void 0}})}function i(e){r(e)&&e.draggable("destroy")}function o(e,t){var n=t?"enable":"disable";r(e)&&e.draggable(n)}function r(e){return e.hasClass("ui-draggable")}function s(e,n,i){var o={};return o[t.DRAG_ITEMS]=[],n&&_.isFunction(n.dragItems)&&(o[t.DRAG_ITEMS]=n.dragItems(e)||[]),o[t.DRAG_EFFECTS]=[],n&&_.isFunction(n.dragEffects)&&(o[t.DRAG_EFFECTS]=n.dragEffects(e,i)||[]),o[t.DRAG_PARAMS]=void 0,n&&_.isFunction(n.dragParams)&&(o[t.DRAG_PARAMS]=n.dragParams(e,i)),o}var a=1e5,l=$("body"),c={left:10,top:10};return{DRAG_EFFECTS:e,DEFAULT_CURSOR_AT:{left:c.left,top:c.top},makeDraggable:n,destroyDraggable:i,enableDraggable:o}}),define("js/Toolbar/ToolbarDragItem",["./ButtonBase","./ToolbarItemBase","js/DragDrop/DragSource"],function(e,t,n){"use strict";function i(t){this.el=$('<div class="toolbar-drag-item"></div>'),this._dragBtn=e.createButton(t),n.makeDraggable(this.el,t),this.el.append(this._dragBtn)}return _.extend(i.prototype,t.prototype),i.prototype.enabled=function(e){this._dragBtn.enabled(e),n.enableDraggable(this.el,e)},i.prototype.destroy=function(){n.destroyDraggable(this.el),t.prototype.destroy.call(this)},i}),define("css!js/Toolbar/styles/Toolbar",[],function(){}),define("js/Toolbar/Toolbar",["js/logger","./ToolbarButton","./ToolbarSeparator","./ToolbarRadioButtonGroup","./ToolbarToggleButton","./ToolbarTextBox","./ToolbarLabel","./ToolbarCheckBox","./ToolbarDropDownButton","./ToolbarColorPicker","./ToolbarDragItem","css!./styles/Toolbar.css"],function(e,t,n,i,o,r,s,a,l,c,d){"use strict";function h(e){return p||(p=new g(e)),$(window).on("resize",function(){p._updateLayout.call(p)}),p}var p,g,u="webgme-toolbar",f="webgme-toolbar-ext",m="shown",_="webgme-toolbar-ext-toggle",b=10;return g=function(t){var n=this;this._el=$("<div/>",{"class":u}),this._toolbarExt=$("<div/>",{"class":f}),this._toolbarExtToggleBtn=$('<div class="'+_+'"><i class="glyphicon glyphicon-chevron-down"/><i class="glyphicon glyphicon-chevron-down"/></div>'),this._toolbarExtToggleBtn.on("click",function(e){n._toolbarExt.toggleClass(m),e.stopPropagation(),e.preventDefault()}),this._logger=e.create("gme:Toolbar:Toolbar",WebGMEGlobal.gmeConfig.client.log),t.append(this._el).append(this._toolbarExt)},g.prototype.add=function(e){e.el?(this._el.append(e.el),e._toolbar=this):this._logger.error('The given toolbarItem does not have an "el" to append to the toolbar...')},g.prototype.addButton=function(e){var n=new t(e);return this.add(n),n},g.prototype.addSeparator=function(){var e=new n;return this.add(e),e},g.prototype.addRadioButtonGroup=function(e){var t=new i(e);return this.add(t),t},g.prototype.addToggleButton=function(e){var t=new o(e);return this.add(t),t},g.prototype.addTextBox=function(e){var t=new r(e);return this.add(t),t},g.prototype.addLabel=function(){var e=new s;return this.add(e),e},g.prototype.addCheckBox=function(e){var t=new a(e);return this.add(t),t},g.prototype.addDropDownButton=function(e){var t=new l(e);return this.add(t),t},g.prototype.addColorPicker=function(e){var t=new c(e);return this.add(t),t},g.prototype.addDragItem=function(e){var t=new d(e);return this.add(t),t},g.prototype.refresh=function(){this._updateLayout()},g.prototype._updateLayout=function(){var e,t,n,i=this._el.width(),o=!1;if(i>0){for(this._logger.debug("_updateLayout: "+i),this._toolbarExt.children().appendTo(this._el),this._toolbarExt.removeClass(m),this._toolbarExtToggleBtn.detach(),e=this._el.children(),t=e.length,n=0;t>n;n+=1){var r=$(e[n]);if(r.offset().left+r.width()>i-b){o=!0;break}}if(o)for(this._toolbarExtToggleBtn.insertBefore(this._toolbarExt);t>n;n+=1)$(e[n]).appendTo(this._toolbarExt)}},{createToolbar:h}}),define("js/Loader/ProgressNotification",["jquery"],function(){"use strict";function e(e){var t,n=$.notify(e,{showProgressbar:!0,delay:0,type:"info",offset:{x:20,y:37}}),i=15;return n.update("progress",i),t=setInterval(function(){50>i?i+=5:70>i?i+=2:98>i?i+=1:(i=10,n.update("type","warning")),n.update("progress",i)},5e3),{note:n,intervalId:t}}return{startProgressNotification:e,start:e}}),define("text!js/Dialogs/Commit/templates/CommitDialog.html",[],function(){return'<div class="commit-dialog modal fade" tabindex="-1" role="dialog">\r\n    <div class="modal-dialog modal-lg">\r\n        <div class="modal-content">\r\n            <div class="modal-header">\r\n                <button type="button" class="close" data-dismiss="modal">×</button>\r\n                <h3>Commit</h3>\r\n            </div>\r\n            <div class="modal-body">\r\n                <fieldset>\r\n                    <legend>Selected branch</legend>\r\n                    <div class="alert alert-error" style="text-align: center;font-weight: bold;">\r\n                        Oooops, you are not ready to commit since you are not on a branch right now. Select a branch\r\n                        first to be able to make your commit.\r\n                    </div>\r\n                </fieldset>\r\n                <fieldset class="fs-message">\r\n                    <legend>Commit message</legend>\r\n                    <div class="control-group control-group-message" style="margin-top: 0">\r\n                        <textarea class="input-block-level txt-message form-control" rows="3"></textarea>\r\n                    </div>\r\n                </fieldset>\r\n            </div>\r\n            <div class="modal-footer">\r\n                <button href="#" class="btn btn-primary btn-commit">Commit</button>\r\n                <button href="#" class="btn btn-default" data-dismiss="modal">Cancel</button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>'}),define("css!js/Dialogs/Commit/styles/CommitDialog",[],function(){}),define("js/Dialogs/Commit/CommitDialog",["js/logger","text!./templates/CommitDialog.html","css!./styles/CommitDialog.css"],function(e,t){"use strict";var n;return n=function(t){this._logger=e.create("gme:Dialogs:Commit:CommitDialog",WebGMEGlobal.gmeConfig.client.log),this._client=t,this._logger.debug("Created")},n.prototype.show=function(){var e=this;this._initDialog(),this._dialog.modal("show"),this._dialog.on("shown.bs.modal",function(){e._txtMessage.focus()}),this._dialog.on("hidden.bs.modal",function(){e._dialog.remove(),e._dialog.empty(),e._dialog=void 0})},n.prototype._initDialog=function(){var e=this,n=this._client.getActiveBranchName();this._dialog=$(t),this._messagePanel=this._dialog.find(".fs-message"),this._btnCommit=this._dialog.find(".btn-commit"),this._branchAlertLabel=this._dialog.find(".alert"),this._txtMessage=this._dialog.find(".txt-message"),this._controlGroupMessage=this._dialog.find(".control-group-message"),void 0===n||null===n?(this._messagePanel.remove(),this._btnCommit.remove()):(this._branchAlertLabel.removeClass("alert-error").addClass("alert-info"),this._branchAlertLabel.text(n)),e._controlGroupMessage.addClass("has-error"),e._btnCommit.disable(!0),this._txtMessage.on("keyup",function(){var t=e._txtMessage.val();""===t?(e._controlGroupMessage.addClass("has-error"),e._btnCommit.disable(!0)):(e._controlGroupMessage.removeClass("has-error"),e._btnCommit.disable(!1))}),this._btnCommit.on("click",function(){var t=e._txtMessage.val();""!==t&&(e._btnCommit.off("click").hide(),e._logger.error("TODO: Make commit not supported/implemented."))})},n}),define("text!js/Dialogs/Merge/templates/MergeDialog.html",[],function(){return'<div class="merge-dialog modal fade" tabindex="-1" role="dialog">\r\n    <div class="modal-dialog modal-lg">\r\n        <div class="modal-content">\r\n            <div class="modal-header">\r\n                <button type="button" class="close" data-dismiss="modal">×</button>\r\n                <h3>Merge results</h3>\r\n            </div>\r\n            <div class="modal-body">\r\n\r\n                <!-- Merge was successful -->\r\n                <div class="alert alert-success merge-success" role="alert">Successful merge</div>\r\n\r\n                <!-- Error placeholder -->\r\n                <div class="alert alert-danger merge-failed" role="alert">Failed</div>\r\n\r\n                <!-- Diff placeholder -->\r\n                <div class="alert alert-warning no-diff" role="alert">Diff information is not available.</div>\r\n\r\n                <div class="diff-placeholder"></div>\r\n            </div>\r\n            <div class="modal-footer">\r\n                <button href="#" class="btn btn-danger btn-abort" data-dismiss="modal">Abort</button>\r\n                <button href="#" class="btn btn-primary btn-resolve" data-dismiss="modal">Resolve</button>\r\n                <button href="#" class="btn btn-primary btn-ok" data-dismiss="modal">Ok</button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>'}),define("text!js/Dialogs/Merge/templates/DiffTemplate.html",[],function(){return'<div class="diff">\r\n\r\n    <div>\r\n        <p>\r\n            Information is shown below about the conflicts. They have to be resolved to finish the merge.\r\n            The highlighted values will be used for the conflict resolution.\r\n            Click on the row to change the alter the selected value.\r\n        </p>\r\n    </div>\r\n\r\n    <div class="commits">\r\n        <span>Base:   </span><span class="base"></span>\r\n        <br>\r\n        <span>Theirs: </span><span class="theirs"></span>\r\n        <br>\r\n        <span>Mine:   </span><span class="mine"></span>\r\n        <br>\r\n        <span>TargetBranch:   </span><span class="branch"></span>\r\n    </div>\r\n\r\n    <hr>\r\n\r\n    <div class="container-fluid conflicts">\r\n\r\n    </div>\r\n\r\n</div>'}),define("css!js/Dialogs/Merge/styles/MergeDialog",[],function(){}),define("js/Dialogs/Merge/MergeDialog",["js/logger","text!./templates/MergeDialog.html","text!./templates/DiffTemplate.html","css!./styles/MergeDialog.css"],function(e,t,n){"use strict";var i;return i=function(t){this._logger=e.create("gme:Dialogs:Merge:MergeDialog",WebGMEGlobal.gmeConfig.client.log),this._client=t,this._logger.debug("Created"),this.resolution=null},i.prototype.show=function(e,t){var n=this;this._initDialog(),e?(this._alertFailed.show(),this._alertFailed.text(e),t?(this._addDiff(t),this._btnResolve.show(),this._btnAbort.show()):(this._warningNoDiff.show(),this._btnOk.show())):(this._alertSuccess.show(),this._btnOk.show()),this._dialog.modal("show"),this._dialog.on("shown.bs.modal",function(){}),this._dialog.on("hidden.bs.modal",function(){n._dialog.remove(),n._dialog.empty(),n._dialog=void 0}),this._btnResolve.on("click",function(){n._client.resolve(n.resolution,function(e,t){var o=new i(n._client);e?n._logger.error("resolve finished",e,t):n._logger.debug("resolve finished",t),o.show(e,t)})})},i.prototype._initDialog=function(){this._dialog=$(t),this._alertSuccess=this._dialog.find(".merge-success"),this._alertFailed=this._dialog.find(".merge-failed"),this._warningNoDiff=this._dialog.find(".no-diff"),this._diffPlaceholder=this._dialog.find(".diff-placeholder"),this._btnResolve=this._dialog.find(".btn-resolve"),this._btnAbort=this._dialog.find(".btn-abort"),this._btnOk=this._dialog.find(".btn-ok"),this._alertSuccess.hide(),this._alertFailed.hide(),this._warningNoDiff.hide(),this._btnResolve.hide(),this._btnAbort.hide(),this._btnOk.hide()},i.prototype._addDiff=function(e){var t,i,o,r,s,a,l,c,d,h=this,p=$(n),g=$('<div class="row conflict-item"><div class="col-md-6 path"></div><div class="col-md-3 value-theirs"></div><div class="col-md-3 value-mine"></div></div>'),u=/((\/\d+)*)/,f=function(e){return e.slice(0,e.lastIndexOf("/"))};if(this.resolution=e,p.find(".base").text(e.baseCommitHash),p.find(".mine").text(e.myCommitHash),p.find(".theirs").text(e.theirCommitHash),p.find(".branch").text(e.targetBranchName),t=p.find(".conflicts"),e.hasOwnProperty("conflict")&&e.conflict.hasOwnProperty("items"))for(o=g.clone(),o.find(".path").text("Path to conflict"),o.find(".value-theirs").text("Theirs (current branch)"),o.find(".value-mine").text("Mine (merging in)"),t.append(o),e.conflict.items.sort(function(e,t){return e.theirs.path>t.theirs.path?1:e.theirs.path<t.theirs.path?-1:0}),d=0;d<e.conflict.items.length;d+=1)i=e.conflict.items[d],o=g.clone(),o.find(".path").text(i.theirs.path),l="?project="+encodeURIComponent(h._client.getActiveProjectId())+"&commit="+encodeURIComponent(e.theirCommitHash)+"&node="+encodeURIComponent(f(u.exec(i.theirs.path)[0]))+"&selection="+encodeURIComponent(u.exec(i.theirs.path)[0]),a=$('<div><a class="glyphicon glyphicon-link" href="'+l+'" target="_blank" tooltip="Open"></a><span><xmp style="word-wrap: break-word; white-space: normal">'+JSON.stringify(i.theirs.value)+"</xmp></span></div>"),o.find(".value-theirs").append(a),r=i.theirs.path===i.mine.path?JSON.stringify(i.mine.value):i.mine.path+": "+JSON.stringify(i.mine.value),c="?project="+encodeURIComponent(h._client.getActiveProjectId())+"&commit="+encodeURIComponent(e.myCommitHash)+"&node="+encodeURIComponent(f(u.exec(i.mine.path)[0]))+"&selection="+encodeURIComponent(u.exec(i.mine.path)[0]),s=$('<div><a class="glyphicon glyphicon-link" href="'+c+'"  target="_blank" tooltip="Open"></a><span><xmp style="word-wrap: break-word; white-space: normal">'+r+"</xmp></span></div>"),o.find(".value-mine").append(s),this._updateSelection(i,o),this._addClickHandler(i,o),t.append(o);this._diffPlaceholder.append(p)},i.prototype._addClickHandler=function(e,t){var n=this;t.on("click",function(i){"A"!==i.target.tagName&&("mine"===e.selected?e.selected="theirs":"theirs"===e.selected?e.selected="mine":e.selected="mine",n._updateSelection(e,t))})},i.prototype._updateSelection=function(e,t){"mine"===e.selected?(t.find(".value-mine").addClass("selected"),t.find(".value-theirs").removeClass("selected")):"theirs"===e.selected?(t.find(".value-mine").removeClass("selected"),t.find(".value-theirs").addClass("selected")):(t.find(".value-mine").removeClass("selected"),t.find(".value-theirs").removeClass("selected"))},i}),define("text!js/Dialogs/ProjectRepository/templates/ProjectRepositoryDialog.html",[],function(){return'<div class="repository-dialog modal fade" tabindex="-1" role="dialog">\r\n    <div class="modal-dialog modal-xlg">\r\n        <div class="modal-content">\r\n            <div class="modal-header">\r\n                <button type="button" class="close" data-dismiss="modal">×</button>\r\n                <span class="title-container">\r\n                    <span class="project-repository-title">Project Repository</span>\r\n                    <select class="form-control selector">\r\n                        <optgroup class="history-selector-group group-project" label="Project">\r\n                            <option value="$allBranchesAndTags">All branches & tags</option>\r\n                            <option value="$allBranches">All branches</option>\r\n                            <option value="$allTags">All tags</option>\r\n                            <option value="$commits">Recent commits</option>\r\n                        </optgroup>\r\n                        <optgroup class="history-selector-group group-branches" label="Branches">\r\n                        </optgroup>\r\n                        <optgroup class="history-selector-group group-tags" label="Tags">\r\n                        </optgroup>\r\n                    </select>\r\n                </span>\r\n            </div>\r\n            <div class="modal-body">\r\n            </div>\r\n            <div class="modal-footer">\r\n                <button href="#" class="btn btn-default" data-dismiss="modal">Close</button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>'}),define("js/Widgets/ProjectRepository/ProjectRepositoryWidgetControl",["js/logger","js/Dialogs/Confirm/ConfirmDialog"],function(e,t){"use strict";var n;return n=function(n,i){var o=this;o._client=n,o._view=i,o._lastCommitID=null,o._view.onLoadCommit=function(e){o._client.selectCommit(e.id,function(e){e&&o._logger.error(e),o._refreshActualCommit()})},o._view.onDeleteBranchClick=function(e,t){var n=o._client.getActiveProjectId();o._client.deleteBranch(n,e,t,function(t){t&&o._logger.error(t),o._refreshBranchesAndTags(),o._refreshActualCommit(),o._view._start===e&&o._view.noMoreCommitsToDisplay()})},o._view.onDeleteTagClick=function(e){var t=o._client.getActiveProjectId();o._client.deleteTag(t,e,function(e){e&&o._logger.error(e),o._refreshBranchesAndTags(),o._refreshActualCommit()})},o._view.onCreateBranchFromCommit=function(e){var t=o._client.getActiveProjectId();o._client.createBranch(t,e.name,e.commitId,function(e){e&&o._logger.error(e),o._refreshBranchesAndTags()})},o._view.onCreateTagFromCommit=function(e){var t=o._client.getActiveProjectId();o._client.createTag(t,e.name,e.commitId,function(e){e&&o._logger.error(e),o._refreshBranchesAndTags()})},o._view.onSquashFromCommit=function(e,n){var i=new t,r=!1;i.show({title:"Squash Commits",iconClass:"glyphicon glyphicon-compressed",question:"Would you like to squash all commits above "+e.commitId.substr(0,7)+" (not included) into a single commit?",input:{label:"Message",placeHolder:"Enter optional commit message...",required:!1},severity:"warning",onHideFn:function(){r||n()}},function(t,n){r=!0,o._client.squashCommits(o._client.getActiveProjectId(),e.commitId,e.branchName,n||null,function(t,n){
t?o._logger.error(t):"SYNCED"===n.status?o._view._dialog.setSelectorValue(e.branchName):(o._client.notifyUser({severity:"info",message:"Squashing branch '"+e.branchName+"' forked ["+n.hash+"]"}),o._view._dialog.setSelectorValue())})})},o._view.onSelectBranch=function(e){o._client.selectBranch(e,null,function(t){t?o._logger.error(t):o._logger.debug("Branch selected in client",e)})},o._view.onLoadMoreCommits=function(e,t){o._loadMoreCommits(e,t)},o._logger=e.create("gme:Widgets:ProjectRepository:ProjectRepositoryWidgetControl_RepositoryLogControl",WebGMEGlobal.gmeConfig.client.log),o._logger.debug("Created")},n.prototype._loadMoreCommits=function(e,t){var n,i,o=this,r=null,s=o._view._el.scrollTop()||0;i=function(i,a){var l,c,d;if(o._logger.debug("commitsLoaded, err: '"+i+"', data: "+a===!0?a.length:"null"),i)_.isEmpty(i)?o._logger.error('the mysterious error returned by "getCommitsAsync"'):o._logger.error(i);else{if(r=a.concat([]),t&&(o._view.clear(),o._view._initializeUI(),o._lastCommitID=null),c=r.length,c>0){for(l=0;c>l;l+=1)n=r[l],o._lastCommitID!==n._id&&(d={id:n._id,message:n.message,parents:n.parents,timestamp:n.time,user:n.updater.join(",")},o._view.addCommit(d));o._lastCommitID=r[l-1]._id,o._view.render(),o._refreshActualCommit()}o._refreshBranchesAndTags(),o._view.hideProgressbar(),e>c&&o._view.noMoreCommitsToDisplay(),o._view._el.scrollTop(s)}},o._view.showProgressbar(),o._logger.debug("_loadMoreCommits",e,t),t?o._client.getHistory(o._client.getActiveProjectId(),t,e,i):o._client.getCommits(o._client.getActiveProjectId(),this._lastCommitID||(new Date).getTime()+1,e,i)},n.prototype._refreshActualCommit=function(){this._view.setActualCommitId(this._client.getActiveCommitHash())},n.prototype._refreshBranchesAndTags=function(){var e=this,t=e._client.getActiveProjectId();e._view.clearBranches(),e._view.clearTags(),e._client.getBranches(t,function(n,i){var o,r;if(e._logger.debug("getBranches: err, data: ",n,i),n)return void e._logger.error(n);for(r=Object.keys(i),o=0;o<r.length;o+=1)e._view.addBranch({name:r[o],commitId:i[r[o]]});e._client.getTags(t,function(t,n){var i,o;if(e._logger.debug("getTags: err, data: ",t,n),t)return void e._logger.error(t);for(o=Object.keys(n),i=0;i<o.length;i+=1)e._view.addTag({name:o[i],commitId:n[o[i]]});e._view.branchesAndTagsUpdated()})})},n}),define("css!js/Widgets/ProjectRepository/styles/ProjectRepositoryWidget",[],function(){}),define("js/Widgets/ProjectRepository/ProjectRepositoryWidget",["js/logger","js/util","js/Loader/LoaderCircles","./ProjectRepositoryWidgetControl","common/regexp","moment","blockies","raphaeljs","css!./styles/ProjectRepositoryWidget.css"],function(e,t,n,i,o,r,s){"use strict";var a,l="master",c="project-repository-widget",d="Show more...",h=100,p="commitData",g="commit",u="actual",f=15,m=25,_=1,b=1,y=8,v=8,C=5,E="#000000",D="grad1",I="create-branch-from-commit",T="branch-label",P="tag-label",N="common-label",A="btnLoadCommit",w="commitId",O="commit-message",S={};return a=function(t,n,o){var r="commit_count";this._el=t,this._historyType="commits",this._start=null,this._dialog=o.dialog,this._projectAccess=n.getProjectAccess(),this.clear(),this._initializeUI(),o&&(h=o[r]||h,this._start=o.start),new i(n,this),this._logger=e.create("gme:Widgets:ProjectRepository:ProjectRepositoryWidget",WebGMEGlobal.gmeConfig.client.log),this._logger.debug("Created")},a.prototype.clear=function(){this._commits=[],this._orderedCommitIds=[],this._actualCommitId=void 0,this._branches=[],this._branchNames=[],this._branchListUpdated=!1,this._tags=[],this._tagNames=[],this._tagListUpdated=!1,this._y=0,this._trackEnds=[],this._renderIndex=-1,this._width=_,this._height=b,this._nonExistingParentPaths=[],this._el.empty(),this._el.off("click"),this._el.off("keyup"),this._el.parent().css({width:"","margin-left":"","margin-top":"",top:""})},a.prototype.destroy=function(){this.clear(),this._el.removeClass(c)},a.prototype.addBranch=function(e){this._addBranch(e)},a.prototype.clearBranches=function(){this._clearBranches()},a.prototype.addTag=function(e){this._addTag(e)},a.prototype.clearTags=function(){this._clearTags()},a.prototype.addCommit=function(e){var t=this._orderedCommitIds.push(e.id)-1;this._commits.push({x:-1,y:-1,id:e.id,commitData:e,ui:void 0}),this._calculatePositionForCommit(t)},a.prototype.showProgressbar=function(){this._btnShowMore.hide(),this._loader.start()},a.prototype.hideProgressbar=function(){this._loader.stop(),this._btnShowMore.show()},a.prototype.render=function(){this._render()},a.prototype.noMoreCommitsToDisplay=function(){this._noMoreCommitsToDisplay()},a.prototype.loadMoreCommits=function(e){e?this.onLoadMoreCommits(this._commits.length+h,e):this.onLoadMoreCommits(h,e)},a.prototype.branchesAndTagsUpdated=function(){0===this._commits.length?this._table.addClass("no-commits-in-table"):this._table.removeClass("no-commits-in-table")},a.prototype.onLoadMoreCommits=function(e,t){this._logger.warn('onLoadMoreCommits not overridden in Controller num: "'+e+'", start: "'+t+'"')},a.prototype.onLoadCommit=function(e){this._logger.warn("onLoadCommit is not overridden in Controller...params: '"+JSON.stringify(e)+"'")},a.prototype.onDeleteBranchClick=function(e,t){this._logger.warn("onDeleteBranchClick is not overridden in Controller...branch, branchHash:",e,t)},a.prototype.onDeleteTagClick=function(e,t){this._logger.warn("onDeleteTagClick is not overridden in Controller...branch, branchHash:",e,t)},a.prototype.onCreateBranchFromCommit=function(e){this._logger.warn("onCreateBranchFromCommit is not overridden in Controller...params: '"+JSON.stringify(e)+"'")},a.prototype.onCreateTagFromCommit=function(e){this._logger.warn("onCreateTagFromCommit is not overridden in Controller...params: '"+JSON.stringify(e)+"'")},a.prototype.onSquashFromCommit=function(e){this._logger.warn("onSquashFromCommit is not overridden in Controller...params: '"+JSON.stringify(e)+"'")},a.prototype.onSelectBranch=function(e){this._logger.warn("onSelectBranch is not overridden in Controller...params: '"+JSON.stringify(e)+"'")},a.cMessageStyleStr="div."+O+" { max-width: __MW__px; }",a.prototype._initializeUI=function(){var e=this;this._el.empty(),this._el.addClass(c),this._cMessageStyle=$("<style/>",{type:"text/css"}),this._cMessageStyle.html(a.cMessageStyleStr.replace("__MW__","400")),this._el.append(this._cMessageStyle),this._table=$("<table/>",{"class":"table table-hover user-select-on commit-list"}),this._tHead=$("<thead/>"),this._tHead.append($("<tr><th>Graph</th><th>Actions</th><th>Commit</th><th>Message</th><th>User</th><th>Time</th></tr>")),this._tBody=$("<tbody/>"),this._table.append(this._tHead).append(this._tBody),this._tableCellActionsIndex=1,this._tableCellCommitIDIndex=2,this._tableCellMessageIndex=3,this._tableCellUserIndex=4,this._tableCellTimeStampIndex=5,this._el.append(this._table),this._showMoreContainer=$("<div/>",{"class":"show-more"}),this._el.append(this._showMoreContainer),this._loader=new n({containerElement:this._showMoreContainer}),this._loader.setSize(30),this._btnShowMore=$("<a/>",{"class":"",href:"#"}),this._btnShowMore.append(d),this._showMoreContainer.append(this._btnShowMore),this._commitsContainer=$("<div/>",{"class":"commits",tabindex:0}),this._el.append(this._commitsContainer),this._svgPaper=Raphael(this._commitsContainer[0]),this._svgPaper.canvas.style.pointerEvents="visiblePainted",this._svgPaper.setSize("100%","1px"),$(this._svgPaper.canvas).css({top:"0"}),this._generateSVGGradientDefinition(),this._el.on("click."+A,"."+A,function(){var t=$(this),n=t.data(w);e.onLoadCommit({id:n})}),this._el.on("click.iconRemove",".remove-branch-button",function(t){var n,i,o=$(this),r=o.data("branch")+"";for(i=0;i<e._branches.length;i+=1)e._branches[i].name===r&&(n=e._branches[i].commitId);e.onDeleteBranchClick(r,n),t.stopPropagation(),t.preventDefault()}),this._el.on("click.iconRemove",".remove-tag-button",function(t){var n=$(this),i=n.data("tag")+"";e.onDeleteTagClick(i),t.stopPropagation(),t.preventDefault()}),this._el.on("click.select-branch-in-text",".select-branch-in-text",function(t){var n=$(this).text();e.onSelectBranch(n),t.stopPropagation(),t.preventDefault()}),this._btnShowMore.on("click",null,function(t){e.loadMoreCommits(e._start),t.stopPropagation(),t.preventDefault()}),this._el.off("click.btnCreateBranchFromCommit",".btnCreateBranchFromCommit"),this._el.on("click.btnCreateBranchFromCommit",".btnCreateBranchFromCommit",function(){e._onCreateFromCommitButtonClick($(this))}),this._el.off("click.btnCreateTagFromCommit",".btnCreateTagFromCommit"),this._el.on("click.btnCreateTagFromCommit",".btnCreateTagFromCommit",function(){e._onCreateFromCommitButtonClick($(this))}),this._el.off("click.btnSquashFromCommit",".btnSquashFromCommit"),this._el.on("click.btnSquashFromCommit",".btnSquashFromCommit",function(){e._onCreateFromCommitButtonClick($(this))})},a.prototype._calculatePositionForCommit=function(e){var t,n,i,o=this._trackEnds.length,r=this._commits[e],s=!1,a=!1;for(n=0;o>n;n+=1)if(i=this._orderedCommitIds.indexOf(this._trackEnds[n]),t=this._commits[i],-1!==t[p].parents.indexOf(r.id)){s=!0;break}if(r.y=this._y,this._y+=m,s===!0)r.x=t.x,this._trackEnds[n]=r.id;else if(this._branches&&this._branches.length>0&&this._branches[0].name===l&&this._branches[0].commitId===r.id&&(a=!0),a===!0){for(this._trackEnds.splice(0,0,r.id),r.x=0,n=this._commits.length-1;n--;)this._commits[n].x+=f;this._renderIndex=-1}else this._trackEnds.push(r.id),r.x=(this._trackEnds.length-1)*f},a.prototype._render=function(){var e,t,n,i,o,r=this._commits.length,s=-1===this._renderIndex?0:this._renderIndex;for(-1===this._renderIndex&&(this._commitsContainer.find("."+g).remove(),this._svgPaper.clear(),this._tBody.empty()),t=s;r>t;t+=1)e=this._commits[t],e.ui&&e.ui.remove(),e.ui=this._createItem({x:e.x,y:e.y,id:e.id,parents:e[p].parents,branch:e[p].branch,user:e[p].user,timestamp:e[p].timestamp,message:e[p].message,singleBranch:"string"==typeof this._start});for(this._renderIndex=t,this._resizeDialog(this._width,this._height),t=this._nonExistingParentPaths.length;t--;)this._nonExistingParentPaths[t].remove();for(this._nonExistingParentPaths=[],t=0;r>t;t+=1)if(e=this._commits[t],e[p].parents&&e[p].parents.length>0){for(o=!1,i=0;i<e[p].parents.length;i+=1)n=this._orderedCommitIds.indexOf(e[p].parents[i]),n>=s&&this._drawLine(this._commits[n],e),o=-1!==n;o===!1&&this._drawLine(void 0,e)}this._addBranchHeaderLabels(),this._addTagHeaderLabels()},a.prototype._removeBranchHeaderLabels=function(){this._tBody.find("."+T).remove()},a.prototype._removeTagHeaderLabels=function(){this._tBody.find("."+P).remove()},a.prototype._addBranchHeaderLabels=function(){var e,t=this._branches.length;if(this._branchListUpdated===!0){for(this._removeBranchHeaderLabels();t--;)e=this._orderedCommitIds.indexOf(this._branches[t].commitId),-1!==e&&this._applyBranchHeaderLabel(this._commits[e],this._branches[t].name);this._branchListUpdated=!1}},a.prototype._addTagHeaderLabels=function(){var e,t=this._tags.length;if(this._tagListUpdated===!0){for(this._removeTagHeaderLabels();t--;)e=this._orderedCommitIds.indexOf(this._tags[t].commitId),-1!==e&&this._applyTagHeaderLabel(this._commits[e],this._tags[t].name);this._tagListUpdated=!1}},a.prototype._branchLabelDOMBase=$('<span class="label"><span class="label-name select-branch-in-text" title="Select branch"></span><i data-branch="" class="glyphicon glyphicon-remove icon-white remove-branch-button" title="Delete branch"></i></span>'),a.prototype._tagLabelDOMBase=$('<span class="label"><span class="label-name"><i data-tag="" class="glyphicon glyphicon-tag tag-label-icon"></i></span>'),a.prototype._applyBranchHeaderLabel=function(e,t){var n,i,o=this._branchLabelDOMBase.clone();o.find("span.label-name").text(t),o.find("i").attr("data-branch",t),o.addClass(T),o.addClass(N),o.addClass("label-success"),this._projectAccess.write===!1&&o.addClass("delete-prohibited"),n=this._tBody.children()[this._orderedCommitIds.indexOf(e.id)].cells[this._tableCellMessageIndex],i=$(n).find("div."+O)[0],i.insertBefore(o[0],i.childNodes[0])},a.prototype._applyTagHeaderLabel=function(e,t){var n,i,o=this._tagLabelDOMBase.clone();o.find("span.label-name").text(t),o.append($('<i data-tag="'+t+'" class="glyphicon glyphicon-remove icon-white remove-tag-button" title="Delete tag"/>')),o.addClass(P),o.addClass(N),o.addClass("label-primary"),this._projectAccess["delete"]===!1&&o.addClass("delete-prohibited"),n=this._tBody.children()[this._orderedCommitIds.indexOf(e.id)].cells[this._tableCellMessageIndex],i=$(n).find("div."+O)[0],i.insertBefore(o[0],i.childNodes[0])},a.prototype._addBranch=function(e){var t,n=e.name;t=this._branchNames.indexOf(n),-1!==t?this._branches[t]=e:n===l?(this._branches.splice(0,0,e),this._branchNames.splice(0,0,n)):(this._branches.push(e),this._branchNames.push(n)),this._branchListUpdated=!0,this._addBranchHeaderLabels()},a.prototype._addTag=function(e){var t,n=e.name;t=this._tagNames.indexOf(n),-1!==t?this._tags[t]=e:(this._tags.push(e),this._tagNames.push(n)),this._tagListUpdated=!0,this._addTagHeaderLabels()},a.prototype._clearBranches=function(){this._branches=[],this._branchNames=[],this._removeBranchHeaderLabels(),this._branchListUpdated=!0},a.prototype._clearTags=function(){this._tags=[],this._tagNames=[],this._removeTagHeaderLabels(),this._tagListUpdated=!0},a.prototype._trDOMBase=$('<tr><td></td><td class="actions"></td><td class="commit-hash"></td><td class="message-column"><div class="'+O+'"></div></td><td></td><td></td></tr>'),a.prototype._createBranchBtnDOMBase=$('<button class="btn btn-default btn-xs btnCreateBranchFromCommit" href="#" title="Create new branch from here"><i class="glyphicon glyphicon-edit create-branch-icon"></i></button>'),a.prototype._createTagBtnDOMBase=$('<button class="btn btn-default btn-xs btnCreateTagFromCommit" href="#" title="Create a tag here"><i class="glyphicon glyphicon-tags create-tag-icon"></i></button>'),a.prototype._squashBtnDOMBase=$('<button class="btn btn-default btn-xs btnSquashFromCommit" href="#" title="Squash branch from this commit"><i class="glyphicon glyphicon-compressed squash-branch-icon"></i></button>'),a.prototype._createItem=function(e){var t,n,i,o,a=0===this._tBody.children().length,l=e.user||"";return t=$("<div/>",{"class":g,"data-id":e.id,"data-b":e.branch}),t.css({left:e.x,top:e.y}),e.actual&&t.addClass("actual"),this._commitsContainer.append(t),this._width=Math.max(this._width,e.x+y),this._height=Math.max(this._height,e.y+v),n=this._trDOMBase.clone(),a===!0&&(this._graphPlaceHolder=$("<div/>"),$(n[0].cells[0]).append(this._graphPlaceHolder)),o=new Date(parseInt(e.timestamp,10)),$(n[0].cells[this._tableCellCommitIDIndex]).append(e.id.substr(0,7)),$(n[0].cells[this._tableCellCommitIDIndex]).attr("title","Select commit "+e.id),$(n[0].cells[this._tableCellCommitIDIndex]).addClass(A),$(n[0].cells[this._tableCellCommitIDIndex]).data(w,e.id),$(n[0].cells[this._tableCellMessageIndex]).find("div."+O).text(e.message),S.hasOwnProperty(l)===!1&&(S[l]=s({seed:l,size:6,scale:8}).toDataURL()),$(n[0].cells[this._tableCellUserIndex]).addClass("user-column"),$(n[0].cells[this._tableCellUserIndex]).append($('<span class="avatar-container">'+l+'<img class="avatar-image" src="'+S[l]+'"/></span>')),$(n[0].cells[this._tableCellTimeStampIndex]).append(r(o).fromNow()),$(n[0].cells[this._tableCellTimeStampIndex]).attr("title",r(o).local().format("dddd, MMMM Do YYYY, h:mm:ss a")),i=this._createBranchBtnDOMBase.clone(),i.data(w,e.id),this._projectAccess.write===!1&&i.disable(!0),n[0].cells[this._tableCellActionsIndex].appendChild(i[0]),i=this._createTagBtnDOMBase.clone(),i.data(w,e.id),this._projectAccess.write===!1&&i.disable(!0),n[0].cells[this._tableCellActionsIndex].appendChild(i[0]),e.singleBranch&&(i=this._squashBtnDOMBase.clone(),i.data(w,e.id),this._projectAccess.write===!1&&i.disable(!0),n[0].cells[this._tableCellActionsIndex].appendChild(i[0])),this._tBody.append(n),t},a.prototype.setActualCommitId=function(e){var t=this._actualCommitId;this._actualCommitId!==e&&(this._actualCommitId=e,this._updateActualCommitUI(t,this._actualCommitId))},a.prototype._updateActualCommitUI=function(e,t){var n=this._orderedCommitIds.indexOf(e);-1!==n&&this._commits[n].ui.removeClass(u),n=this._orderedCommitIds.indexOf(t),-1!==n&&(this._commits[n].ui.addClass(u),$(this._tBody.children()[n].cells[this._tableCellActionsIndex]).find("."+A).remove())},a.prototype._drawLine=function(e,t){var n,i,o,r=void 0===e,s=r?t.x+y/2:e.x+y/2,a=r?this._height:e.y+v/2,l=t.x+y/2,c=t.y+v/2,d=l-s;0===d?(c=t.y+v+2,r===!1?(a=e.y-2,n=["M",s,a,"L",l,c]):a!==t.y+v&&(n=["M",s,a-m,"L",l,c],o=["M",s-1,a,"M",s,a,"L",l,a-m])):s>l?(l=t.x+y+2,a=e.y-1,c+=1,n=["M",s,a,"L",s,c+C,"L",s-C,c,"L",l,c]):(s=e.x+y+2,c=t.y+v+3,a+=1,n=["M",s,a,"L",l-C,a,"L",l,a-C,"L",l,c]),r===!0?(n&&(i=this._svgPaper.path(n.join(",")),i.attr({stroke:E}),this._nonExistingParentPaths.push(i)),o&&(i=this._svgPaper.path(o.join(",")),i.node.setAttribute("stroke","url(#"+D+")"),this._nonExistingParentPaths.push(i))):(i=this._svgPaper.path(n.join(",")),i.attr({stroke:E}))},a.prototype._resizeDialog=function(e,t){var n,i=30,o=70,r=70,s=$(window).height(),l=$(window).width();this._svgPaper.setSize(e,t),this._generateSVGGradientDefinition(),this._graphPlaceHolder.css("width",e),l-=2*i,s=s-2*i-o-r,this._cMessageStyle.html(a.cMessageStyleStr.replace("__MW__",.66*l)),n=this._table.width(),this._showMoreContainer.css("width",n)},a.prototype._noMoreCommitsToDisplay=function(){this._btnShowMore.hide(),this._btnShowMore.off("click"),this._loader.destroy(),this._showMoreContainer.empty(),this._showMoreContainer.remove(),this._showMoreContainer=void 0},a.prototype._generateSVGGradientDefinition=function(){if(!this._svgPaper.canvas.getElementById(D)){var e,t,n,i=document.createElementNS("http://www.w3.org/2000/svg","defs");e=document.createElementNS("http://www.w3.org/2000/svg","linearGradient"),e.setAttribute("x1","0%"),e.setAttribute("x2","0%"),e.setAttribute("y1","0%"),e.setAttribute("y2","100%"),e.setAttribute("id",D),t=document.createElementNS("http://www.w3.org/2000/svg","stop"),t.setAttribute("offset","0%"),t.setAttribute("style","stop-color: "+E),n=document.createElementNS("http://www.w3.org/2000/svg","stop"),n.setAttribute("offset","100%"),n.setAttribute("style","stop-color: #FFFFFF"),e.appendChild(t),e.appendChild(n),i.appendChild(e),this._svgPaper.canvas.appendChild(i)}},a.prototype._onCreateFromCommitButtonClick=function(e){var t,n,i,r=e.parent(),s=e.hasClass("btnCreateBranchFromCommit"),a=e.hasClass("btnSquashFromCommit"),l=$('<div class="input-group form-group"></div>'),c=$('<input class="form-control span2 input-mini" type="text">'),d=$('<button class="btn btn-default btn-xs" type="button" title="Create"><i class="glyphicon glyphicon-ok"></i></button>'),h=$('<button class="btn btn-default btn-xs" type="button" title="Cancel"><i class="glyphicon glyphicon-remove"></i></button>'),p=this;return a?(i=e.data(w),n=this._orderedCommitIds.indexOf(i),this._tBody.find("tr:lt("+n+")").addClass("in-selection"),void p.onSquashFromCommit({branchName:this._start,commitId:i},function(){p._tBody.find("tr").removeClass("in-selection")})):(t=this._tBody.find("."+I+" > .btn"),0!==t.length&&$(t[1]).trigger("click"),l.addClass(I),l.append(c).append(d).append(h),r.children().css("display","none"),r.append(l),h.on("click",function(e){r.find("."+I).remove(),r.children().css("display","inline-block"),e.stopPropagation()}),c.on("keyup",function(e){var t=c.val(),n=!1;switch(n=""===t?!0:s?-1!==p._branchNames.indexOf(t)||!o.BRANCH.test(t):-1!==p._tagNames.indexOf(t)||!o.TAG.test(t),n?(l.addClass("has-error"),d.disable(!0)):(l.removeClass("has-error"),d.disable(!1)),e.which){case 27:h.trigger("click"),e.preventDefault(),e.stopPropagation();break;case 13:d.trigger("click"),e.preventDefault(),e.stopPropagation()}}),c.focus().trigger("keyup"),void d.on("click",function(t){var n=c.val(),i=s?p._branchNames.indexOf(n)>-1:p._tagNames.indexOf(n)>-1;""!==n&&i===!1&&(r.find("."+I).remove(),r.children().css("display","inline-block"),s?p.onCreateBranchFromCommit({commitId:e.data(w),name:n}):p.onCreateTagFromCommit({commitId:e.data(w),name:n})),t.stopPropagation()}))},a}),define("css!js/Dialogs/ProjectRepository/styles/ProjectRepositoryDialog",[],function(){}),define("js/Dialogs/ProjectRepository/ProjectRepositoryDialog",["js/logger","text!./templates/ProjectRepositoryDialog.html","js/Widgets/ProjectRepository/ProjectRepositoryWidget","css!./styles/ProjectRepositoryDialog.css"],function(e,t,n){"use strict";var i;return i=function(t){this._logger=e.create("gme:Dialogs:ProjectRepository:ProjectRepositoryDialog",WebGMEGlobal.gmeConfig.client.log),this._client=t,this._widget=null,this._selector=null,this._groupBranches=null,this._branchNames=[],this._groupTags=null,this._tags=[],this._tagCommitHashes=[],this._selectedValue=null,this._logger.debug("Created")},i.prototype.show=function(e){var t=this;this._branchNames=e.branches,this._initDialog(e),this._dialog.on("hide.bs.modal",function(){t._dialog.remove(),t._dialog.empty(),t._dialog=void 0}),this._dialog.modal("show")},i.prototype._initDialog=function(e){var n,i=this,o=20,r=$(window).height();this._dialog=$(t),this._selector=this._dialog.find("select.selector"),this._groupBranches=this._selector.find("optgroup.group-branches"),this._groupTags=this._selector.find("optgroup.group-tags"),"string"==typeof e.start?(e.historyType="branch",this._selectedValue=e.start):"object"==typeof e.start&&e.start instanceof Array&&e.start.length>0?(e.historyType="branches",this._selectedValue="$allBranches"):(e.historyType="commits",e.start=null,this._selectedValue="$commits"),this._populateOptions(e),this._selector.on("change",function(){var e={start:null,type:null},t=i._selector.val();t&&(i._selectedValue=t,"$allBranchesAndTags"===t?e.start=i._branchNames.concat(i._tagCommitHashes):"$allBranches"===t?e.start=i._branchNames:"$allTags"===t?e.start=i._tagCommitHashes:"$commits"===t?e.start=null:e.start=t,i._initializeWidget(n,e))}),n=this._dialog.find(".modal-body"),this._initializeWidget(n,e),this._dialog.on("show.bs.modal",function(){var t,s=i._dialog.find(".modal-header").outerHeight(!0),a=i._dialog.find(".modal-footer").outerHeight(!0),l=parseInt(n.css("padding-top"),10)+parseInt(n.css("padding-bottom"),10);t=r-2*o,i._dialog.removeClass("fade"),n.css({"max-height":t-l-s-a,height:t-l-s-a}),i._widget.loadMoreCommits(e.start)}),this._dialog.on("hide",function(){i._widget.clear()})},i.prototype._populateOptions=function(){var e=this,t=!1;this._groupBranches.children().remove(),this._groupTags.children().remove(),this._branchNames.sort(),this._tags.sort(function(e,t){return e.name>t.name?1:e.name<t.name?-1:0}),this._tagCommitHashes=[],this._branchNames.forEach(function(n){e._groupBranches.append($("<option>",{text:n,value:n})),e._selectedValue===n&&(t=!0)}),this._tags.forEach(function(n){e._groupTags.append($("<option>",{text:n.name,value:n.commitId})),e._tagCommitHashes.push(n.commitId),e._selectedValue===n.commitId&&(t=!0)}),this._selectedValue&&this._selectedValue[0].indexOf("$")>-1?this._selector.val(this._selectedValue):t?this._selector.val(this._selectedValue):this._selector.val("")},i.prototype._initializeWidget=function(e,t){var i=this,o=!1;this._widget&&(o=!0,this._widget.clear()),this._widget=new n(e,i._client,{commit_count:100,historyType:t.historyType,start:t.start,dialog:i}),this._widget.branchesAndTagsUpdated=function(){i._logger.debug("branches, old, new",i._branchNames,i._widget._branchNames),i._logger.debug("tags, old, new",i._tags,i._widget._tags),i._branchNames=i._widget._branchNames.slice(),i._tags=i._widget._tags.slice(),i._populateOptions(),n.prototype.branchesAndTagsUpdated.call(i._widget)},o&&i._widget.loadMoreCommits(t.start)},i.prototype.setSelectorValue=function(e){this._selector.val(e||"$commits"),this._selector.trigger("change")},i}),define("text!js/Dialogs/Branches/templates/BranchesDialog.html",[],function(){return'<div class="branches-dialog modal fade" tabindex="-1" role="dialog">\r\n    <div class="modal-dialog modal-lg">\r\n        <div class="modal-content">\r\n            <div class="modal-header">\r\n                <button type="button" class="close" data-dismiss="modal">×</button>\r\n                <h3>Branches</h3>\r\n            </div>\r\n            <div class="pre-body">\r\n                <div class="tabContainer"></div>\r\n            </div>\r\n            <div class="modal-body">\r\n                <ul class="nav nav-pills nav-stacked">\r\n                </ul>\r\n            </div>\r\n            <div class="modal-footer">\r\n                <div class="panel-buttons">\r\n                    <button class="btn btn-default pull-left btn-refresh" title="Reload branch list..."\r\n                            style="position: relative;"><i class="glyphicon glyphicon-refresh"></i></button>\r\n                    <button class="btn btn-primary btn-open">Open</button>\r\n                    <button class="btn btn-danger btn-delete">Delete</button>\r\n                    <button class="btn btn-default" data-dismiss="modal">Close</button>\r\n                </div>\r\n                <div class="panel-create-new control-group">\r\n                    <div class="input-group">\r\n                        <div class="input-group-btn">\r\n                            <button type="button" class="btn btn-default dropdown-toggle disabled" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">\r\n                                <span class="username">Username</span>\r\n                                <!--<span class="caret"></span>-->\r\n                            </button>\r\n                            <ul class="dropdown-menu">\r\n                                <!--<li><a href="#">Username</a></li>-->\r\n                                <!--<li><a href="#">Another action</a></li>-->\r\n                                <!--<li><a href="#">Something else here</a></li>-->\r\n                                <!--<li role="separator" class="divider"></li>-->\r\n                                <!--<li><a href="#">Separated link</a></li>-->\r\n                            </ul>\r\n                        </div><!-- /btn-group -->\r\n                        <input type="text" class="input-xlarge txt-branch-name form-control"\r\n                               placeholder="Branch name..." />\r\n                    </div><!-- /input-group -->\r\n\r\n                    <button class="btn btn-default btn-cancel">Cancel</button>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>'}),define("css!js/Dialogs/Branches/styles/BranchesDialog",[],function(){}),define("js/Dialogs/Branches/BranchesDialog",["angular","js/logger","js/Constants","js/Loader/LoaderCircles","js/Utils/GMEConcepts","common/storage/util","text!./templates/BranchesDialog.html","css!./styles/BranchesDialog.css"],function(e,t,n,i,o,r,s){"use strict";var a,l,c,d="BRANCH_ID",h=$('<li class="center pointer"><a class="btn-env"></a>');return angular.module("gme.ui.branchesDialog",["isis.ui.simpleDialog"]).run(function(e,t,n){l=e,c=n}),a=function(e){this._logger=t.create("gme:Dialogs:Branches:BranchesDialog",WebGMEGlobal.gmeConfig.client.log),this._client=e,this._projectId=e.getActiveProjectId(),this._selectedBranch=e.getActiveBranchName(),this._branchNames=[],this._branches={},this._filter=void 0,this._ownerId=null,this._logger.debug("Created")},a.prototype.show=function(){var e=this;e._initDialog(),e._dialog.modal("show"),e._dialog.on("hidden.bs.model",function(){e._dialog.remove(),e._dialog.empty(),e._dialog=void 0,e._client.unwatchProject(e._projectId,e._projectEventHandling)}),e._branchEventHandling=function(t,i){(i.etype===n.CLIENT.STORAGE.BRANCH_CREATED||i.etype===n.CLIENT.STORAGE.BRANCH_DELETED||i.etype===n.CLIENT.STORAGE.BRANCH_HASH_UPDATED)&&(e._logger.debug("branchlist changed event",i),e._refreshBranchList())},e._client.watchProject(e._projectId,e._branchEventHandling),this._refreshBranchList()},a.prototype._initDialog=function(){function e(e){n._client.selectBranch(e,null,function(t){t&&this._logger.error("unable to open branch",{metadata:{error:t}}),n._selectedBranch=e,n._dialog.modal("hide")})}function t(e){n._client.deleteBranch(n._projectId,e,n._branches[e],function(e){e&&n._logger.error("unable to remove branch",{metadata:{error:e}})})}var n=this,o=this._selectedBranch;this._dialog=$(s),this._dialog.find("h3").first().text("Branches of project ["+r.getProjectDisplayedNameFromProjectId(this._projectId)+"]"),this._el=this._dialog.find(".modal-body").first(),this._ul=this._el.find("ul").first(),this._panelButtons=this._dialog.find(".panel-buttons"),this._panelCreateNew=this._dialog.find(".panel-create-new").hide(),this._btnOpen=this._dialog.find(".btn-open"),this._btnDelete=this._dialog.find(".btn-delete"),this._btnRefresh=this._dialog.find(".btn-refresh"),this._ownerId=WebGMEGlobal.userInfo._id,this._loader=new i({containerElement:this._btnRefresh}),this._loader.setSize(14),this._dialog.find(".tabContainer").first().groupedAlphabetTabs({onClick:function(e){n._filter=e,n._refreshBranchList()},noMatchText:"Nothing matched your filter, please click another letter."}),this._ul.on("click","li:not(.disabled)",function(e){o=$(this).data(d),e.stopPropagation(),e.preventDefault(),n._ul.find(".active").removeClass("active"),$(this).addClass("active")}),this._ul.on("dblclick","li:not(.disabled)",function(t){o=$(this).data(d),t.stopPropagation(),t.preventDefault(),e(o)}),this._btnOpen.on("click",function(t){t.stopPropagation(),t.preventDefault(),e(o)}),this._btnDelete.on("click",function(e){e.stopPropagation(),e.preventDefault(),t(o)}),this._btnRefresh.on("click",function(e){n._refreshBranchList(),e.stopPropagation(),e.preventDefault()})},a.prototype._refreshBranchList=function(){var e=this;e._client.getBranches(e._projectId,function(t,n){t&&(e._logger.error("cannot get branch list:",{metadata:{error:t}}),e._branchNames=[]),e._branches=n,e._branchNames=Object.keys(n),e._updateBranchList()})},a.prototype._updateBranchList=function(){var e,t,n,i=this._branchNames.length,o=0,r=$('<li class="center"><i>No projects in this group...</i></li>');if(this._ul.empty(),i>0)for(e=0;i>e;e+=1)n=!1,n=void 0===this._filter?!0:this._branchNames[e].toUpperCase()[0]>=this._filter[0]&&this._branchNames[e].toUpperCase()[0]<=this._filter[1],n&&(t=h.clone(),t.find("a").text(this._branchNames[e]),t.data(d,this._branchNames[e]),this._branchNames[e]===this._selectedBranch&&t.addClass("active"),this._ul.append(t),o+=1);0===o&&this._ul.append(r.clone())},a}),define("text!js/Dialogs/MultiTab/templates/MultiTabDialog.html",[],function(){return'<div class="multi-tab-dialog modal fade" tabindex="-1" role="dialog">\r\n    <div class="modal-dialog">\r\n        <div class="modal-content">\r\n            <div class="modal-header">\r\n                <button type="button" class="close" data-dismiss="modal">×</button>\r\n                <i class="header-icon"></i><span class="header-title"></span>\r\n            </div>\r\n            <div class="pre-body">\r\n                <div class="tabContainer">\r\n                    <ul class="nav nav-tabs">\r\n                    </ul>\r\n                </div>\r\n            </div>\r\n            <div class="modal-body">\r\n            </div>\r\n            <div class="modal-footer">\r\n                <button class="btn btn-default" data-dismiss="modal">Cancel</button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>'}),define("text!js/Dialogs/MultiTab/templates/ModalBodyForm.html",[],function(){return'<form class="form-horizontal" role="form">\r\n    <h5><span class="info-title">Some info title</span>\r\n        <i class="glyphicon glyphicon-info-sign toggle-info-btn"/>\r\n    </h5>\r\n        <span class="info-details hidden">Some detailed info text</span>\r\n        <div class="form-control-container">\r\n\r\n        </div>\r\n</form>'}),define("css!js/Dialogs/MultiTab/styles/MultiTabDialog",[],function(){}),
define("js/Dialogs/MultiTab/MultiTabDialog",["js/Loader/LoaderCircles","text!./templates/MultiTabDialog.html","text!./templates/ModalBodyForm.html","css!./styles/MultiTabDialog.css"],function(e,t,n){"use strict";var i;return i=function(){},i.prototype.show=function(e,t){var n=this;this._initDialog(e),this._dialog.on("hide.bs.modal",function(){t(),n._onHide()}),this._dialog.modal("show")},i.prototype.showAlert=function(e,t){t=t||"danger",this._errorBadge.removeClass("alert-success alert-info alert-warning alert-danger"),this._errorBadge.addClass("alert-"+t),this._errorBadge.text(e),this._errorBadge.show()},i.prototype.hideAlert=function(){this._errorBadge.hide()},i.prototype._initDialog=function(n){var i;for(this._dialog=$(t),this._loader=new e({containerElement:this._dialog}),this._modalContent=this._dialog.find(".modal-content"),this._modalHeader=this._modalContent.find(".modal-header"),this._preBody=this._modalContent.find(".pre-body"),this._modalBody=this._modalContent.find(".modal-body"),this._modalFooter=this._modalContent.find(".modal-footer"),this._modalHeader.find(".header-icon").addClass(n.iconClass||"glyphicon glyphicon-comment"),this._modalHeader.find(".header-title").text(n.title||"Missing parameters.title"),n.extraClasses&&this._dialog.addClass(n.extraClasses),this._tabsUl=this._preBody.find("ul.nav-tabs"),this._currentTabIndex=n.activeTabIndex||0,this._tabEls=[],this._formEls=[],this._okBtnEls=[],i=0;i<n.tabs.length;i+=1)this._addTab(n.tabs[i],i),i===this._currentTabIndex?this._tabEls[i].addClass("active"):(this._formEls[i].hide(),this._okBtnEls[i].hide());1===n.tabs.length&&this._preBody.hide(),this._errorBadge=$('<div class="alert alert-danger error-badge" role="alert"></div>'),this._errorBadge.hide(),this._modalBody.append(this._errorBadge)},i.prototype._onHide=function(){this._loader.destroy(),this._dialog.find("li.tab").off("click"),this._dialog.find(".toggle-info-btn").off("click"),this._dialog.find(".ok-btn").off("click"),this._dialog.remove(),this._dialog.empty(),this._dialog=void 0},i.prototype._addTab=function(e,t){var i,o,r,s=this,a=$(n);i=$('<li class="tab"><a href="#" data-toggle="tab">'+e.title+"</a></li>"),i.on("click",function(){s._tabIndexChanged(t)}),this._tabsUl.append(i),this._tabEls.push(i),a=$(n),o=a.find(".info-title").text(e.infoTitle),o=a.find(".info-details"),o.text(e.infoDetails),a.find(".toggle-info-btn").on("click",function(){o.hasClass("hidden")?o.removeClass("hidden"):o.addClass("hidden")}),a.find(".form-control-container").append(e.formControl),this._formEls.push(a),this._modalBody.append(a),r=$('<button class="btn btn-primary ok-btn">OK</button>'),r.on("click",function(){s._errorBadge.hide(),s._modalContent.css("opacity",0),s._loader.start(),e.onOK(function(e){s._loader.stop(),s._modalContent.css("opacity",1),e?s.showAlert("string"==typeof e?e:e.message):s._dialog.modal("hide")})}),this._okBtnEls.push(r),this._modalFooter.prepend(r)},i.prototype._tabIndexChanged=function(e){this._currentTabIndex!==e&&(this._formEls[this._currentTabIndex].hide(),this._okBtnEls[this._currentTabIndex].hide(),this._tabEls[this._currentTabIndex].removeClass("active"),this._currentTabIndex=e,this._formEls[this._currentTabIndex].show(),this._okBtnEls[this._currentTabIndex].show(),this._tabEls[this._currentTabIndex].addClass("active"),this._errorBadge.hide())},i}),define("js/Dialogs/AddCommits/AddCommitsDialog",["js/logger","common/regexp","js/Controls/PropertyGrid/Widgets/AssetWidget","js/Dialogs/MultiTab/MultiTabDialog"],function(e,t,n,i){"use strict";function o(t,n,i){this._client=t,this._logger=e.create("gme:js:Dialogs:AddCommits:AddCommitsDialog",n.client.log),this._branches=i}return o.prototype.show=function(e){var t=this,n={title:"Add Commits",extraClasses:"add-commits-dialog",iconClass:"glyphicon glyphicon-fast-forward",activeTabIndex:0,tabs:[this._getFromProjectTab(),this._getApplyCommitQueueTab()]};this._dialog=new i,this._projectId=e.projectId,this._branchName=e.branchName,this._dialog.show(n,function(){t._assetWidgetCQ.destroy(),t._assetWidgetProject.destroy(),t._nameInputEl.off("keyup"),t._nameInputEl.off("keydown")})},o.prototype._getFromProjectTab=function(){function e(e){return t._assetWidgetProject.propertyValue?void t._client.updateProjectFromFile(t._projectId,t._branchName,t._assetWidgetProject.propertyValue,function(n,i){n?e("Failed to add commit from project: "+n):t._checkCommitStatus(i.status)?e():e("Project imported at commit "+i.hash.substring(0,7)+" but could not update branch.")}):void e("No file uploaded.")}var t=this;return this._assetWidgetProject=new n({propertyName:"AddProjectCommit",propertyValue:""}),{title:"Project",infoTitle:"From exported webgmex project",infoDetails:"The exported project does not have to relate to the current project at all. However it is typically recommended that they stem from the same source. Otherwise following the history may not make much sense.",formControl:t._assetWidgetProject.el,onOK:e}},o.prototype._getApplyCommitQueueTab=function(){function e(e){var t={fastForward:s,newBranchName:r._nameInputEl.val()};return a?l?void r._client.applyCommitQueue(o,t,function(t){t?(r._logger(t),e("Failed to apply commit queue"+t)):e()}):void e("The provided branch is not valid, enter another one."):void e("The uploaded data is invalid")}function i(e){return e.hasOwnProperty("webgmeVersion")&&e.hasOwnProperty("projectId")&&e.hasOwnProperty("branchName")&&e.hasOwnProperty("commitQueue")&&e.commitQueue.length>0&&e.commitQueue[0].hasOwnProperty("commitObject")&&"string"==typeof e.commitQueue[0].commitObject._id&&t.HASH.test(e.commitQueue[0].commitObject._id)}var o,r=this,s=!1,a=!1,l=!1,c=$('<div class="apply-commit-queue-controls">');return this._assetWidgetCQ=new n({propertyName:"ApplyCommitQueue",propertyValue:""}),this._nameInputEl=$('<input type="text" class="input form-control branch-name" placeholder="Enter a new branch name..."/>'),c.append(this._assetWidgetCQ.el),c.append(this._nameInputEl),this._nameInputEl.hide(),this._assetWidgetCQ.onFinishChange(function(){r._assetWidgetCQ.getTargetAsJson(function(e){s=!1,o=[],e?i(e)===!1?(r._dialog.showAlert("Uploaded file is not the right format.","danger"),r._isValidData=!1):e.projectId!==r._projectId?(r._dialog.showAlert('Exported data "'+e.projectId+'" is not from this project.',"danger"),r._isValidData=!1):-1===e.commitQueue[0].commitObject.parents.indexOf(r._branches[r._branchName])?(r._dialog.showAlert("Exported data is from the same project, but the first queued commit hash does not have the current one as a parent. A new branch with the changes will be created.","warning"),a=!0,o=e.commitQueue):(r._dialog.showAlert("Exported data fits the current branch and applied changes will be attempted to be fast forwarded. Please provide a branch name just in case it fails. ","success"),a=!0,s=!0,o=e.commitQueue):(a=!1,r._dialog.showAlert("Uploaded file must be a json file! Try again...","danger")),a===!0?(r._nameInputEl.show(),r._nameInputEl.focus()):r._nameInputEl.hide()})}),this._nameInputEl.on("keyup",function(){var e=$(this),n=e.val();l=""!==n&&r._branches.hasOwnProperty(n)===!1&&t.BRANCH.test(n),l?c.removeClass("has-error"):c.addClass("has-error")}),this._nameInputEl.on("keydown",function(e){var t=13===e.which;t&&(e.preventDefault(),e.stopPropagation())}),{title:"Commit Queue",infoTitle:"From downloaded commit queue",infoDetails:'If you got disconnected and or for some other reason was forced to download uncommitted local changes. This is where such changes can be persisted back to the database. N.B. this is not an export format or a way to "save" changes - but rather a fallback when connection or device-power was lost.',formControl:c,onOK:e}},o.prototype._checkCommitStatus=function(e){return e===this._client.CONSTANTS.STORAGE.SYNCED||e===this._client.CONSTANTS.STORAGE.MERGED},o}),define("js/Utils/Exporters",["js/Loader/ProgressNotification"],function(e){"use strict";function t(t,n,i,o,r){var s=e.start("<strong>Exporting </strong> project ...");t.exportProjectToFile(i?i.projectId:t.getActiveProjectId(),i?i.branchName:t.getActiveBranchName(),i?i.commitHash:t.getActiveCommitHash(),o,function(e,t){clearInterval(s.intervalId),e?(n.error("unable to save project",e),s.note.update({message:"<strong>Failed to export: </strong>"+e.message,type:"danger",progress:100})):s.note.update({message:'<strong>Exported </strong> project <a href="'+t.downloadUrl+'" target="_blank">'+t.fileName+"</a>",progress:100,type:"success"}),"function"==typeof r&&r(e)})}function n(t,n,i,o,r){var s=e.start("<strong>Exporting </strong> models ...");o=o===!1?!1:!0,t.exportSelectionToFile(t.getActiveProjectId(),t.getActiveCommitHash(),i,o,function(e,t){clearInterval(s.intervalId),e?(n.error("unable to export models",e),s.note.update({message:"<strong>Failed to export: </strong>"+e.message,type:"danger",progress:100})):s.note.update({message:'<strong>Exported </strong> models <a href="'+t.downloadUrl+'" target="_blank">'+t.fileName+"</a>",progress:100,type:"success"}),"function"==typeof r&&r(e)})}return{exportProject:t,exportModels:n}}),define("js/Panels/Header/ProjectNavigatorController",["js/logger","js/Constants","angular","js/Loader/ProgressNotification","js/Dialogs/Projects/ProjectsDialog","js/Dialogs/Commit/CommitDialog","js/Dialogs/Merge/MergeDialog","js/Dialogs/ProjectRepository/ProjectRepositoryDialog","js/Dialogs/Branches/BranchesDialog","js/Dialogs/Confirm/ConfirmDialog","js/Dialogs/AddCommits/AddCommitsDialog","common/storage/util","js/Utils/Exporters","q","js/Utils/ComponentSettings"],function(e,t,n,i,o,r,s,a,l,c,d,h,p,g,u){"use strict";angular.module("gme.ui.ProjectNavigator",[]).run(function(){});var f;return f=function(t,n,i,o,r){var s=this;s.logger=e.create("gme:Panels:Header:ProjectNavigatorController",WebGMEGlobal.gmeConfig.client.log),s.$scope=t,s.$window=o,s.gmeClient=n,s.$timeout=i,s.$http=r,s.config=f.getDefaultConfig(),u.resolveWithWebGMEGlobal(s.config,f.getComponentId()),s.logger.debug("Resolved component-settings",s.config),s.projects={},s.config.disableProjectActions===!0?(s.navIdProject=0,s.navIdBranch=1):(s.navIdRoot=0,s.navIdProject=1,s.navIdBranch=2),s.root={id:"root",label:s.config.rootDisplayName,itemClass:s.config.rootMenuClass,menu:[]},s.requestedSelection=null,s.userId=null,s.initialize()},f.prototype.update=function(){this.logger.debug("update"),this.$timeout(function(){})},f.prototype.initialize=function(){var e,t,n=this;n.$scope.navigator={items:[],separator:!0},t=function(){var e=new o(n.gmeClient);e.show()},e=function(e){var t=new o(n.gmeClient,!0,e.newType);t.show()},n.userId=WebGMEGlobal.userInfo._id,n.config.disableProjectActions===!1&&(n.root.menu=[{id:"top",items:[{id:"manageProject",label:"Manage projects ...",iconClass:"glyphicon glyphicon-folder-open",action:t,actionData:{}},{id:"newProject",label:"New project ...",disabled:WebGMEGlobal.userInfo.canCreate!==!0,iconClass:"glyphicon glyphicon-plus",action:e,actionData:{newType:"seed"}},{id:"importProject",label:"Import project ...",disabled:WebGMEGlobal.userInfo.canCreate!==!0,iconClass:"glyphicon glyphicon-import",action:e,actionData:{newType:"import"}}]},{id:"projects",label:"Recent projects",totalItems:20,items:[],showAllItems:t}]),n.initWithClient(),n.$scope.navigator={items:n.config.disableProjectActions?[]:[n.root],separator:!0}},f.prototype.initWithClient=function(){var e=this;e.gmeClient.addEventListener(t.CLIENT.NETWORK_STATUS_CHANGED,function(n,i){var o;if(e.logger.debug("NETWORK_STATUS_CHANGED",i),i===t.CLIENT.STORAGE.CONNECTED)e.updateProjectList(function(n){return n?void e.logger.error("Failed to populate ProjectNavigator",n):void e.gmeClient.watchDatabase(function(n,i){e.logger.debug("watchDatabase event",i),i.etype===t.CLIENT.STORAGE.PROJECT_CREATED?e.gmeClient.getBranches(i.projectId,function(t,n){return t?void(t.message.indexOf("Not authorized to read project")>-1?e.logger.debug(t.message):(e.logger.error("Could not get branches for newly created project "+i.projectId),e.logger.error(t))):(e.logger.debug("Got branches before joining room:",Object.keys(n)),void e.addProject(i.projectId,null,{modifiedAt:(new Date).toISOString()},!0,function(t){return t?void e.logger.error(t):void e.gmeClient.getBranches(i.projectId,function(t,n){return t?void e.logger.error(t):(e.logger.debug("Got branches after joining room:",Object.keys(n)),void Object.keys(n).forEach(function(t){e.addBranch(i.projectId,t,{branchHash:n[t]})}))})}))}):i.etype===t.CLIENT.STORAGE.PROJECT_DELETED?e.removeProject(i.projectId):e.logger.error("Unexpected event type",i.etype)})});else if(i===t.CLIENT.STORAGE.RECONNECTED)e.updateProjectList();else if(i===t.CLIENT.STORAGE.DISCONNECTED){if(e.projects)for(o in e.projects)e.projects.hasOwnProperty(o)&&e.gmeClient.unwatchProject(o,e.projects[o]._watcher)}else e.logger.error("Error network status, no actions done",i)}),e.gmeClient.addEventListener(t.CLIENT.PROJECT_OPENED,function(n,i){e.logger.debug(t.CLIENT.PROJECT_OPENED,i),e.selectProject({projectId:i})}),e.gmeClient.addEventListener(t.CLIENT.PROJECT_CLOSED,function(n,i){e.logger.debug(t.CLIENT.PROJECT_CLOSED,i),e.selectProject({})}),e.gmeClient.addEventListener(t.CLIENT.BRANCH_CHANGED,function(n,i){e.logger.debug(t.CLIENT.BRANCH_CHANGED,i),e.selectBranch({projectId:e.gmeClient.getActiveProjectId(),branchId:i})}),angular.element(e.$window).on("keydown",function(t){(t.metaKey||t.ctrlKey)&&90===t.keyCode&&(t.shiftKey?e.$timeout(function(){e.gmeClient.redo(e.gmeClient.getActiveBranchName(),function(){})}):e.$timeout(function(){e.gmeClient.undo(e.gmeClient.getActiveBranchName(),function(){})}))}),e.gmeClient.addEventListener(t.CLIENT.UNDO_AVAILABLE,function(n,i){e.logger.debug(t.CLIENT.UNDO_AVAILABLE,i),e.$timeout(function(){e.$scope.navigator&&e.$scope.navigator.items&&e.$scope.navigator.items[e.navIdBranch]&&(i?e.$scope.navigator.items[e.navIdBranch].undoLastCommitItem.disabled=!1:e.$scope.navigator.items[e.navIdBranch].undoLastCommitItem.disabled=!0)})}),e.gmeClient.addEventListener(t.CLIENT.REDO_AVAILABLE,function(n,i){e.logger.debug(t.CLIENT.REDO_AVAILABLE,i),e.$timeout(function(){e.$scope.navigator&&e.$scope.navigator.items&&e.$scope.navigator.items[e.navIdBranch]&&(i?e.$scope.navigator.items[e.navIdBranch].redoLastUndoItem.disabled=!1:e.$scope.navigator.items[e.navIdBranch].redoLastUndoItem.disabled=!0)})})},f.prototype.updateProjectList=function(e){var t=this,n={asObject:!0,rights:!0,branches:!0,info:!0};t.logger.debug("updateProjectList"),t.projects={},e=e||function(e){e&&t.logger.error(e)},t.gmeClient.getProjects(n,function(n,i){function o(e,n,i){var o=g.defer();return t.gmeClient.getCommits(e,i,1,function(r,s){r?(t.logger.error(r),o.resolve({projectId:e,branchId:n,branchHash:i,commitObject:null})):1!==s.length?(t.logger.error(new Error("Could not get commit object",e,n,i)),o.resolve({projectId:e,branchId:n,branchHash:i,commitObject:null})):o.resolve({projectId:e,branchId:n,branchHash:i,commitObject:s[0]})}),o.promise}var r,s,a=[];if(n)return void e(n);t.logger.debug("getProjects",i),t.projects={};for(r in i)if(i.hasOwnProperty(r)){t.addProject(r,i[r].rights,i[r].info,!0);for(s in i[r].branches)i[r].branches.hasOwnProperty(s)&&a.push(o(r,s,i[r].branches[s]))}g.all(a).then(function(n){n.forEach(function(e){t.addBranch(e.projectId,e.branchId,e,!0)}),t.requestedSelection?(t.selectBranch(t.requestedSelection),t.requestedSelection=null):t.update(),e(null)})["catch"](function(t){e(t)})})},f.prototype.addProject=function(e,n,i,o,r){var s,a,d,p,g,u,f,m=this;for(n=n||{"delete":!0,read:!0,write:!0},f=WebGMEGlobal.gmeConfig.authentication.enable?h.getProjectDisplayedNameFromProjectId(e):h.getProjectNameFromProjectId(e),u=function(){m.updateProjectList.call(m)},a=function(e){m.showHistory(e)},p=function(e){var t=new c;t.show({deleteItem:f},function(){m.gmeClient.deleteProject(e.projectId,function(t){t?m.logger.error("Failed deleting project",t):e.projectId===m.gmeClient.getActiveProjectId()?m.refreshPage():m.removeProject(e.projectId)})})},d=function(t){var n;m.gmeClient.getActiveProjectId()===t.projectId?(n=new l(m.gmeClient),n.show()):m.selectProject({projectId:e},function(e){var t=new l(m.gmeClient);e||t.show()})},g=function(e){m.selectProject(e)},m.projects[e]={id:e,label:f,iconClass:n.write?"":"glyphicon glyphicon-lock",iconPullRight:!n.write,projectIsReadOnly:!n.write,disabled:!n.read,itemClass:m.config.projectMenuClass,modifiedAt:i.modifiedAt,isSelected:!1,branches:{},action:g,actionData:{projectId:e},menu:[{id:"top",items:[{id:"showHistory",label:"Project history ...",iconClass:"glyphicon glyphicon-time",disabled:!n.read,action:a,actionData:{projectId:e}}]},{id:"branches",label:"Recent branches",totalItems:20,items:[],showAllItems:function(){d({projectId:e})}}],_watcher:function(n,i){var o,r;m.logger.debug("watchProject event",e,i),i.etype===t.CLIENT.STORAGE.BRANCH_CREATED?m.addBranch(e,i.branchName,{branchHash:i.newHash}):i.etype===t.CLIENT.STORAGE.BRANCH_DELETED?(m.removeBranch(e,i.branchName),o=m.$scope.navigator.items[m.navIdProject],r=m.$scope.navigator.items[m.navIdBranch],r&&r.id===i.branchName&&o.id===e&&m.gmeClient.selectCommit(m.gmeClient.getActiveCommitHash(),function(e){e&&m.logger.error("cannot select latest commit",{metadata:{error:e}}),m.logger.debug("active branch deleted, switched to last viewed commit",{metadata:{commitHash:m.gmeClient.getActiveCommitHash()}})})):i.etype===t.CLIENT.STORAGE.BRANCH_HASH_UPDATED?m.updateBranch(e,i.branchName,i.newHash):m.logger.error("Unexpected event type",i.etype)}},m.config.disableProjectActions===!1&&m.projects[e].menu[0].items.unshift({id:"deleteProject",label:"Delete project",iconClass:"glyphicon glyphicon-remove",disabled:!n["delete"],action:p,actionData:{projectId:e}}),m.gmeClient.watchProject(e,m.projects[e]._watcher,r),s=0;s<m.root.menu.length;s+=1)if("projects"===m.root.menu[s].id){m.root.menu[s].items=m.mapToArray(m.projects,[{key:"modifiedAt",reverse:!0},{key:"id"}]);break}o===!0||m.update()},f.prototype.addBranch=function(e,t,n,o){function r(e){p.exportProject(C.gmeClient,C.logger,{projectId:e.projectId,branchId:e.branchId,commitHash:e.projectId===C.gmeClient.getActiveProjectId()&&e.branchId===C.gmeClient.getActiveBranchName()?C.gmeClient.getActiveCommitHash():e.commitHash},!0)}function a(e){C.showHistory(e)}function l(e){var t=new c,n=h.getProjectDisplayedNameFromProjectId(e.projectId)+"  ::  "+e.branchId;t.show({deleteItem:n},function(){C.gmeClient.deleteBranch(e.projectId,e.branchId,e.branchInfo.branchHash,function(t){t?C.logger.error("Failed deleting branch of project.",e.projectId,e.branchId,t):C.removeBranch(e.projectId,e.branchId)})})}function g(e){var t=i.start("<strong>Merging </strong> branch "+e.branchId+" into "+C.$scope.navigator.items[C.navIdBranch].id+"...");e.projectId!==C.gmeClient.getActiveProjectId()?(C.logger.error(new Error("Cannot merge branch from a different project..")),clearInterval(t.intervalId),t.note.update({message:"<strong>Failed to merge: </strong> cannot merge branch from a different project.",type:"danger",progress:100})):C.gmeClient.autoMerge(e.projectId,e.branchId,C.$scope.navigator.items[C.navIdBranch].id,function(e,n){clearInterval(t.intervalId),t.note.update("progress",100),t.note.close();var i=new s(C.gmeClient);return e?(C.logger.error("merge of branch failed",e),void i.show(e)):void(n&&n.conflict&&n.conflict.items.length>0?(C.logger.error("merge ended in conflicts",n),i.show("merge ended in conflicts",n)):(C.logger.debug("successful merge"),i.show(null,n)))})}function u(e){C.selectBranch(e)}var f,m,_,b,y,v,C=this;if(C.projects.hasOwnProperty(e)===!1)return void C.logger.warn("project is not in the list yet: ",e);if(!C.projects[e].disabled){for(m={id:"deleteBranch",label:"Delete branch",iconClass:"glyphicon glyphicon-remove",disabled:C.projects[e].projectIsReadOnly,action:l,actionData:{projectId:e,branchId:t,branchInfo:n}},_={id:"mergeBranch",label:"Merge into current branch",iconClass:"fa fa-share-alt fa-rotate-90",disabled:C.projects[e].projectIsReadOnly,action:g,actionData:{projectId:e,branchId:t}},b={id:"addCommits",label:"Add external commits ...",iconClass:"glyphicon glyphicon-fast-forward",disabled:!0,action:function(e){C.gmeClient.getBranches(e.projectId,function(t,n){if(t)return void C.logger.error(new Error("Failed getting branches before adding commits"));var i=new d(C.gmeClient,WebGMEGlobal.gmeConfig,n);i.show(e)})},actionData:{projectId:e,branchName:t}},y={id:"undoLastCommit",label:"Undo last commit",iconClass:"fa fa-reply",disabled:!0,action:function(e){C.gmeClient.undo(e.branchId,function(){})},actionData:{projectId:e,branchId:t,branchInfo:n}},v={id:"redoLastUndo",label:"Redo last undo",iconClass:"fa fa-mail-forward",disabled:!0,action:function(e){C.gmeClient.redo(e.branchId,function(){})},actionData:{projectId:e,branchId:t,branchInfo:n}},C.projects[e].branches[t]={id:t,label:t,properties:{commitHash:n.branchHash,commitObject:n.commitObject||{time:Date.now()}},isSelected:!1,itemClass:C.config.branchMenuClass,action:u,actionData:{projectId:e,branchId:t},menu:[{items:[y,v,{id:"branchHistory",label:"Branch history ...",iconClass:"glyphicon glyphicon-time",action:a,actionData:{projectId:e,branchId:t,branchInfo:n}},{id:"createBranch",label:"Create branch ...",iconClass:"glyphicon glyphicon-plus",action:a,actionData:{projectId:e,branchId:t,branchInfo:n}},m,_,b,{id:"exportBranch",label:"Export branch",iconClass:"glyphicon glyphicon-export",action:r,actionData:{projectId:e,branchId:t,commitHash:n.branchHash}}]}]},C.projects[e].branches[t].deleteBranchItem=m,C.projects[e].branches[t].mergeBranchItem=_,C.projects[e].branches[t].undoLastCommitItem=y,C.projects[e].branches[t].redoLastUndoItem=v,C.projects[e].branches[t].applyCommitQueueItem=b,f=0;f<C.projects[e].menu.length;f+=1)if("branches"===C.projects[e].menu[f].id){C.projects[e].menu[f].items=C.mapToArray(C.projects[e].branches,[{key:"properties.commitObject.time",reverse:!0},{key:"id"}]);break}o===!0||C.update()}},f.prototype.removeProject=function(e){var t,n=this;if(n.projects.hasOwnProperty(e)){for(n.gmeClient.unwatchProject(e,n.projects[e]._watcher),delete n.projects[e],t=0;t<n.root.menu.length;t+=1)if("projects"===n.root.menu[t].id){n.root.menu[t].items=n.mapToArray(n.projects,[{key:"modifiedAt",reverse:!0},{key:"id"}]);break}e===n.gmeClient.getActiveProjectId()&&n.refreshPage(),n.update()}},f.prototype.removeBranch=function(e,t){var n,i=this;if(i.projects.hasOwnProperty(e)&&i.projects[e].branches.hasOwnProperty(t)){for(delete i.projects[e].branches[t],n=0;n<i.projects[e].menu.length;n+=1)if("branches"===i.projects[e].menu[n].id){i.projects[e].menu[n].items=i.mapToArray(i.projects[e].branches,[{key:"properties.commitObject.time",reverse:!0},{key:"id"}]);break}i.update()}},f.prototype.selectProject=function(e,t){this.selectBranch(e,t)},f.prototype.selectBranch=function(e,t){var n=this,i=e.projectId,o=e.branchId,r=n.$scope.navigator.items[n.navIdProject],s=n.$scope.navigator.items[n.navIdBranch];if(t=t||function(){},r&&r.id===i&&s&&(s.id===o||void 0===o||""===o))return void t(null);if(r&&(r.isSelected=!1),s&&(s.isSelected=!1,s.deleteBranchItem.disabled=!1,s.mergeBranchItem.disabled=!1,s.undoLastCommitItem.disabled=!0,s.redoLastUndoItem.disabled=!0,s.applyCommitQueueItem.disabled=!0,r&&r.projectIsReadOnly&&(s.deleteBranchItem.disabled=!0,s.mergeBranchItem.disabled=!0)),i||""===i){if(n.projects.hasOwnProperty(i)===!1)return n.logger.warn(i+" does not exist yet in the navigation bar, requesting selection to be loaded."),n.requestedSelection=e,void this.updateProjectList();if(n.projects[i].disabled)return r&&(r.isSelected=!0),void(s&&(s.isSelected=!0,s.deleteBranchItem.disabled=!0,s.mergeBranchItem.disabled=!0));if(n.$scope.navigator.items[n.navIdProject]=n.projects[i],n.projects[i].isSelected=!0,i!==n.gmeClient.getActiveProjectId())return void n.gmeClient.selectProject(i,null,function(e){return e?(n.logger.error(e),void t(e)):void(o&&o!==n.gmeClient.getActiveBranchName()?n.gmeClient.selectBranch(o,null,function(e){return e?(n.logger.error(e),void t(e)):void t(null)}):t(null))});if(o||""===o){if(n.projects[i].branches.hasOwnProperty(o)===!1)return n.logger.error(i+" - "+o+" branch does not exist in the navigation bar"),void(n.requestedSelection=e);if(n.$scope.navigator.items[n.navIdBranch]=n.projects[i].branches[o],n.projects[i].branches[o].isSelected=!0,n.projects[i].branches[o].deleteBranchItem.disabled=!0,n.projects[i].branches[o].mergeBranchItem.disabled=!0,n.projects[i].projectIsReadOnly===!1&&(n.projects[i].branches[o].applyCommitQueueItem.disabled=!1),o!==n.gmeClient.getActiveBranchName())return void n.gmeClient.selectBranch(o,null,function(e){return e?(n.logger.error(e),void t(e)):void t(null)})}else n.$scope.navigator.items.splice(n.navIdBranch,1)}else n.$scope.navigator.items.splice(n.navIdProject,2);t(null),n.update()},f.prototype.updateBranch=function(e,t,n){this.projects.hasOwnProperty(e)&&this.projects[e].branches.hasOwnProperty(t)?(this.projects[e].branches[t].properties={commitHash:n,commitObject:null},this.update()):this.logger.warn("project or branch is not in the list yet: ",e,t,n)},f.prototype.mapToArray=function(e,t){var n=Object.keys(e),i=n.map(function(t){return e[t]});return t=t||[],i.sort(function(e,n){var i,o,r,s,a,l,c=0;for(i=0;i<t.length;i+=1){for(r=t[i].key.split("."),o=t[i].reverse===!0?-1:1,l=r.shift(),s=e,a=n;l&&null!==s&&null!==a&&"object"==typeof s&&"object"==typeof a&&s.hasOwnProperty(l)&&a.hasOwnProperty(l);){if(0===r.length){s[l]>a[l]&&(c=1*o),s[l]<a[l]&&(c=-1*o);break}s=s[l],a=a[l],l=r.shift()}if(0!==c)break}return c}),i},f.prototype.showHistory=function(e){var t,n=this,i={start:null,branches:null};n.gmeClient.getActiveProjectId()===e.projectId?(t=new a(n.gmeClient),i.branches=Object.keys(n.projects[e.projectId].branches),i.start=e.branchId||i.branches,t.show(i)):n.selectProject({projectId:e.projectId},function(o){return o?void n.logger.error("Could not show history",o):(t=new a(n.gmeClient),i.branches=Object.keys(n.projects[e.projectId].branches),i.start=e.branchId||i.branches,void t.show(i))})},f.prototype.refreshPage=function(){document.location.href=window.location.href.split("?")[0]},f.getComponentId=function(){return"GenericUIProjectNavigatorController"},f.getDefaultConfig=function(){return{disableProjectActions:!1,rootMenuClass:"gme-root",rootDisplayName:"GME",projectMenuClass:"",branchMenuClass:""}},f}),define("text!js/Dialogs/PluginResults/templates/PluginResultsDialog.html",[],function(){return'<div class="plugin-results-dialog modal fade" tabindex="-1" role="dialog">\r\n    <div class="modal-dialog modal-lg">\r\n        <div class="modal-content">\r\n            <div class="modal-header">\r\n                <button type="button" class="close" data-dismiss="modal">×</button>\r\n                <h3>Plugin results...</h3>\r\n            </div>\r\n            <div class="modal-body">\r\n            </div>\r\n            <div class="modal-footer">\r\n                <a href="#" class="btn btn-primary btn-clear">Clear results</a>\r\n                <a href="#" class="btn btn-default" data-dismiss="modal">Close</a>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>'}),define("css!js/Dialogs/PluginResults/styles/PluginResultsDialog",[],function(){}),define("js/Dialogs/PluginResults/PluginResultsDialog",["js/util","blob/BlobClient","text!./templates/PluginResultsDialog.html","js/logger","common/storage/util","css!./styles/PluginResultsDialog.css"],function(e,t,n,i,o){"use strict";var r,s=$("<div/>",{"class":"plugin-result"}),a=$('<div class="alert"></div>'),l="alert-success",c="alert-danger",d="alert-warning",h=$('<i class="glyphicon glyphicon-ok"/>'),p=$('<i class="glyphicon glyphicon-warning-sign"/>'),g=$("<span/>",{"class":"title"}),u=$("<span/>",{"class":"time"}),f=$('<span class="btn btn-micro btn-details pull-right">Details</span>'),m=$("<div/>",{"class":"messages collapse"}),_=$('<div class="msg"><div class="msg-title"></div><div class="msg-body"></div></div>'),b=$('<span class="btn btn-micro btn-node pull-right">Show node</span>'),y=$('<div class="artifacts collapse"><div class="artifacts-title">Generated artifacts</div><div class="artifacts-body"><ul></ul></div></div>'),v=$('<div class="artifacts history collapse"><div class="artifacts-title history-title">Execution History</div><div class="history-body"><ul></ul></div></div>'),C=$('<li><span class="btn btn-micro btn-commit" title="Select commit"></span><span class="commit-msg"></span><span class="btn btn-micro btn-branch" title="Select branch"></span></li>'),E=$('<li><a href="#" target="_self">Loading...</a></li>'),D="Message #";return r=function(){this.logger=i.create("gme:Dialogs:PluginResults:PluginResultsDialog",WebGMEGlobal.gmeConfig.client.log)},r.prototype.show=function(e,t){var i=this;this._dialog=$(n),this._client=e,this._initDialog(t),this._dialog.on("hidden.bs.modal",function(){i._dialog.remove(),i._dialog.empty(),i._dialog=void 0}),this._dialog.modal("show")},r.prototype._initDialog=function(n){function i(e,t){var n,i,r,s,a,l=v.clone(),c=l.find("ul");for(a=0;a<e.length;a+=1)s=0===a?"started from":e[a].status===o.CONSTANTS.SYNCED?"updated":e[a].status===o.CONSTANTS.MERGED?"merged into":e[a].status?"forked and created":"made commit",n=C.clone(),i=n.find(".btn-commit"),i.text(e[a].commitHash.substring(0,7)),i.attr("project-id",t),i.attr("commit-hash",e[a].commitHash),n.find(".commit-msg").text(s),r=n.find(".btn-branch").text(e[a].branchName),r.text(e[a].branchName),r.attr("project-id",t),r.attr("branch-name",e[a].branchName),c.append(n);return l}var r,I,T,P,N,A,w,O,S,x,M,R,L,k,j,G,B,W,F,z,V,H=this,U=this._dialog,Y=this._client,J=U.find(".modal-body"),X="unread";for(V=function(e,t,n){n.getMetadata(e,function(i,o){if(i)return void H.logger.error(i);var r=n.getHumanSize(o.size);j=E.clone(),G=j.find("a"),G.attr("href",n.getDownloadURL(e)),G.text(o.name+" ("+r+")"),t.append(j)})},B=0;B<n.length;B+=1){for(I=n[B],r=s.clone(),I.__unread===!0&&(r.addClass(X),delete I.__unread),W=I.getPluginName?I.getPluginName():"PluginName N/A",P=g.clone(),T=a.clone(),I.getSuccess()===!0?(T.append(h.clone()),Y.getProjectObject()&&Y.getProjectObject().projectId!==I.projectId?(T.addClass(d),P.text(W+" - was invoked on different project ("+o.getProjectDisplayedNameFromProjectId(I.projectId)+").")):(T.addClass(l),P.text(W))):(T.addClass(c),T.append(p.clone()),P.text(W+" - "+I.error)),T.append(P),F=I.getFinishTime?e.formattedDate(new Date(I.getFinishTime()),"elapsed"):"Time: N/A",N=u.clone(),N.text(F),T.append(N),w=f.clone(),T.append(w),A=m.clone(),x=I.getMessages(),M=0;M<x.length;M+=1)O=_.clone(),O.find(".msg-title").text(D+(M+1)),(x[M].activeNode.id||""===x[M].activeNode.id)&&(S=b.clone(),x[M].projectId=I.projectId,O.append(S),O.find(".btn-node").attr("node-result-details",JSON.stringify(x[M]))),O.find(".msg-body").html(x[M].message),A.append(O);if(R=void 0,z=new t({logger:this.logger.fork("BlobClient")}),L=I.getArtifacts(),L.length>0)for(R=y.clone(),k=R.find("ul"),M=0;M<L.length;M+=1)V(L[M],k,z);r.append(T),r.append(i(I.commits,I.projectId)),R&&r.append(R),r.append(A),J.append(r)}U.find(".btn-clear").on("click",function(){J.empty(),n.splice(0,n.length)}),U.on("click",".btn-details",function(e){var t=$(this),n=t.parent().parent().find(".messages"),i=t.parent().parent().find(".artifacts");n.toggleClass("in"),i.toggleClass("in"),e.stopPropagation(),e.preventDefault()}),U.on("click",".btn-commit",function(){var e=$(this),t=e.attr("project-id"),n=e.attr("commit-hash");Y.getProjectObject()&&Y.getProjectObject().projectId===t?Y.selectCommit(n,function(e){e&&H.logger.error(e)}):H.logger.error("Project for result is not the same as open project",t)}),U.on("click",".btn-branch",function(){var e=$(this),t=e.attr("project-id"),n=e.attr("branch-name");Y.getProjectObject()&&Y.getProjectObject().projectId===t?Y.selectBranch(n,null,function(e){e&&H.logger.error(e)}):H.logger.error("Project for result is not the same as open project",t)}),U.on("click",".btn-node",function(){var e=$(this),t=JSON.parse(e.attr("node-result-details")),n=t.activeNode.id,i=t.projectId,o={},r=Y.addUI(this,function(e){
var t=!1;e.forEach(function(e){"load"===e.etype&&e.eid===n&&(t=!0)}),t?(WebGMEGlobal.State.registerActiveObject(n),WebGMEGlobal.State.registerActiveSelection([]),U.modal("hide")):H.logger.error("Could not load the linked node at path",n),Y.removeUI(r)});Y.getProjectObject()&&Y.getProjectObject().projectId===i?(r=Y.addUI(this,function(e){var t=!1;e.forEach(function(e){"load"===e.etype&&e.eid===n&&(t=!0)}),t?(WebGMEGlobal.State.registerActiveObject(n),WebGMEGlobal.State.registerActiveSelection([]),U.modal("hide")):H.logger.error("Could not load the linked node at path",n),Y.removeUI(r)}),o[n]={children:0},Y.updateTerritory(r,o)):H.logger.error("Project for result is not the same as open project",i)})},r}),define("js/Panels/Header/PluginToolbar",["js/Dialogs/PluginResults/PluginResultsDialog"],function(e){"use strict";var t,n=$('<span class="label label-info"></span>');return t=function(e){this._client=e,this._results=[],this.$btnExecutePlugin=null,this._initialize()},t.prototype._initialize=function(){var t,i,o,r,s,a=this,l=WebGMEGlobal.Toolbar,c=this._client,d=0,h="label";r=function(e){a.$btnExecutePlugin.el.find("."+h).text(e)},t=function(){var e=WebGMEGlobal.gmeConfig.plugin.displayAll?WebGMEGlobal.allPlugins:c.filterPlugins(WebGMEGlobal.allPlugins,WebGMEGlobal.State.getActiveObject()),t=function(e){i(e)},n=c.getProjectAccess();a.$btnExecutePlugin.clear(),a._results.length>0&&(a.$btnExecutePlugin.addButton({title:"Show results...",text:"Show results...",clickFn:function(){o()}}),e.length>0&&a.$btnExecutePlugin.addDivider()),e.forEach(function(e){var i=WebGMEGlobal.allPluginsMetadata[e],o={title:i.id+" v"+i.version+" - "+i.description,text:i.name,data:i,clickFn:t,disabled:i.writeAccessRequired===!0&&n.write===!1,icon:$('<i class="plugin-icon"/>')};i.icon.src?(o.icon=$("<img/>",{src:["/plugin",i.id,i.id,i.icon.src].join("/")}),o.icon.addClass(i.icon["class"])):i.icon["class"]?o.icon.addClass(i.icon["class"]):o.icon.addClass("glyphicon glyphicon-cog"),o.icon.addClass("plugin-icon"),o.icon.css({width:"14px","margin-right":"4px"}),a.$btnExecutePlugin.addButton(o)})},i=function(e){WebGMEGlobal.InterpreterManager.configureAndRun(e,function(e){e!==!1&&(e.__unread=!0,a._results.splice(0,0,e),a.$btnExecutePlugin.el.find(".btn").disable(!1),d+=1,d>0&&r(d))})},o=function(){var t=new e;t.show(c,a._results),d=0,r("")},this.$btnExecutePlugin=l.addDropDownButton({title:"Execute plug-in",icon:"glyphicon glyphicon-play",menuClass:"no-min-width",clickFn:function(){t()}}),this.$btnExecutePlugin.el.find("a > i").css({"margin-top":"0px"}),s=n.clone(),s.insertAfter(this.$btnExecutePlugin.el.find("a > i")),s.css("margin-left","3px")},t.prototype.disableButtons=function(e){e=e&&0===this._results.length,this.$btnExecutePlugin.el.find(".btn").disable(e)},t}),define("text!js/Dialogs/ConstraintCheckResults/templates/ConstraintCheckResultsDialog.html",[],function(){return'<div class="constraint-check-results-dialog modal fade" tabindex="-1" role="dialog">\r\n    <div class="modal-dialog modal-lg">\r\n        <div class="modal-content">\r\n            <div class="modal-header">\r\n                <button type="button" class="close" data-dismiss="modal">×</button>\r\n                <h3>Constraint Validation Results</h3>\r\n            </div>\r\n            <div class="modal-body">\r\n            </div>\r\n            <div class="modal-footer">\r\n                <a href="#" class="btn btn-primary btn-clear">Clear results</a>\r\n                <a href="#" class="btn btn-default" data-dismiss="modal">Close</a>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>'}),define("css!js/Dialogs/ConstraintCheckResults/styles/ConstraintCheckResultsDialog",[],function(){}),define("js/Dialogs/ConstraintCheckResults/ConstraintCheckResultsDialog",["js/util","common/regexp","js/logger","text!./templates/ConstraintCheckResultsDialog.html","css!./styles/ConstraintCheckResultsDialog.css"],function(e,t,n,i){"use strict";var o=function(e){this._dialogTitle=e,this.logger=n.create("gme:Dialogs:ConstraintCheckResults:ConstraintCheckResultsDialog",WebGMEGlobal.gmeConfig.client.log),this.logger.debug("ctor")},r=$("<div/>",{"class":"constraint-check-result"}),s=$('<div class="alert"></div>'),a="alert-success",l="alert-danger",c=$('<i class="glyphicon glyphicon-ok"/>'),d=$('<i class="glyphicon glyphicon-warning-sign"/>'),h=$("<span/>",{"class":"title"}),p=$("<span/>",{"class":"time"}),g=$('<span class="btn btn-micro btn-details pull-right result-details"><i class="glyphicon glyphicon-plus"/></span>'),u=$("<div/>",{"class":"messages collapse"}),f=$("<div/>",{"class":"constraint-check-result"}),m=$('<span class="btn btn-micro btn-node pull-left"><i class="glyphicon glyphicon-link"/></span>'),_=$('<div class="msg"><div class="msg-title"></div><div class="msg-body"></div></div>');return o.prototype.show=function(e,t){var n=this;this._dialog=$(i),this._dialogTitle&&this._dialog.find("h3").first().text(this._dialogTitle),this._client=e,this._initDialog(t),this._dialog.on("hidden.bs.modal",function(){n._dialog.remove(),n._dialog.empty(),n._dialog=void 0}),this._dialog.modal("show")},o.prototype._initDialog=function(n){var i,o,b,y,v,C,E,D,I,T,P,N,A,w,O,S=this._dialog,x=this._client,M=this,R=S.find(".modal-body"),L="unread";for(A=0;A<n.length;A+=1){o=n[A],i=r.clone(),o.__unread===!0&&(i.addClass(L),delete o.__unread),b=s.clone(),o.hasViolation===!0?(b.addClass(l),b.append(d.clone())):(b.append(c.clone()),b.addClass(a));var k=o.info||"unspecified checking";y=h.clone(),y.text(k),b.append(y);var j=o.__time?e.formattedDate(new Date(o.__time),"elapsed"):"Time: N/A";for(v=p.clone(),v.text(j),b.append(v),D=g.clone(),D.addClass("main-details"),b.append(D),E=Object.keys(o),w=E.length;--w>=0;)t.GUID.test(E[w])&&o[E[w]].hasViolation===!0||E.splice(w,1);for(C=u.clone(),w=0;w<E.length;w++){for(I=f.clone(),I.attr("GMEpath",o[E[w]]._path),I.append(m.clone()),y=h.clone(),y.text(o[E[w]]._name),I.append(y),D=g.clone(),I.append(D),P=Object.keys(o[E[w]]),O=P.length;--O>=0;)o[E[w]][P[O]].hasViolation||P.splice(O,1);for(T=u.clone(),O=0;O<P.length;O++)N=_.clone(),N.find(".msg-title").text(P[O]),N.find(".msg-body").html(o[E[w]][P[O]].message),T.append(N);I.append(T),C.append(I)}b.append(C),0===w&&D.addClass("no-details-available"),i.append(b),R.append(i)}S.find(".btn-clear").on("click",function(){R.empty(),n.splice(0,n.length)}),S.on("click",".btn-details",function(e){$(this).siblings(".messages").toggleClass("in"),$(this).children(".glyphicon-plus").length>0?$(this).html('<i class="glyphicon glyphicon-minus"/>'):$(this).html('<i class="glyphicon glyphicon-plus"/>'),e.stopPropagation(),e.preventDefault()}),S.on("click",".btn-node",function(){var e=$(this).parent().attr("GMEpath"),t={},n=x.addUI(this,function(t){var i=!1;t.forEach(function(t){"load"===t.etype&&t.eid===e&&(i=!0)}),i?(WebGMEGlobal.State.registerActiveObject(e),WebGMEGlobal.State.registerActiveSelection([]),S.modal("hide")):M.logger.error("Could not load the linked node at path",e),x.removeUI(n)});t[e]={children:0},x.updateTerritory(n,t)})},o}),define("js/Panels/Header/ConstraintToolbar",["js/Dialogs/ConstraintCheckResults/ConstraintCheckResultsDialog"],function(e){"use strict";var t,n=$('<span class="label label-info"></span>');return t=function(e){this._client=e,this._initialize()},t.prototype._initialize=function(){function t(e,t){var n,i;for(n=0;n<t.length;n+=1)i=t[n],i.__time=(new Date).getTime(),i.__unread=!0,p.splice(0,0,i),d+=1,s(d)}var i,o,r,s,a,l=this,c=WebGMEGlobal.Toolbar,d=0,h="label",p=[];s=function(e){o.el.find("."+h).text(e)},i=function(){var e;o.clear(),l._client.getActiveProjectId()?(p.length>0&&(o.addButton({title:"Show results...",text:"Show results...",clickFn:function(){r()}}),o.addDivider()),o.addButton({title:"Check entire project",text:"Check constraints for entire project",clickFn:function(){l._client.checkCustomConstraints([""],!0)}}),e=WebGMEGlobal.State.getActiveObject(),e&&(o.addButton({title:"Check custom constraints node",text:"Check constraints for node ["+e+"]",clickFn:function(){l._client.checkCustomConstraints([e],!0)}}),o.addButton({title:"Check constraints model",text:"Check constraints for node ["+e+"] and its children...",clickFn:function(){l._client.checkCustomConstraints([e],!0)}}))):o.addButton({title:"No Project is opened",text:"No Project is opened...",clickFn:function(){}})},l._client.addEventListener(l._client.CONSTANTS.CONSTRAINT_RESULT,t),r=function(){var t=new e;t.show(l._client,p),d=0,s("")},o=c.addDropDownButton({title:"Custom Constraints",icon:"glyphicon glyphicon-fire",menuClass:"no-min-width",clickFn:function(){i()}}),o.el.find("a > i").css({"margin-top":"0px"}),a=n.clone(),a.insertAfter(o.el.find("a > i")),a.css("margin-left","3px")},t}),define("js/Panels/Header/MetaRulesToolbar",["js/Dialogs/ConstraintCheckResults/ConstraintCheckResultsDialog"],function(e){"use strict";var t,n=$('<span class="label label-info"></span>');return t=function(e){this._client=e,this._initialize()},t.prototype._initialize=function(){function t(e,t){var n,i;for(n=0;n<t.length;n+=1)i=t[n],i.__time=(new Date).getTime(),i.__unread=!0,p.splice(0,0,i),d+=1,s(d)}var i,o,r,s,a,l=this,c=WebGMEGlobal.Toolbar,d=0,h="label",p=[];s=function(e){o.el.find("."+h).text(e)},i=function(){var e;o.clear(),l._client.getActiveProjectId()?(p.length>0&&(o.addButton({title:"Show results...",text:"Show results...",clickFn:function(){r()}}),o.addDivider()),o.addButton({title:"Check meta rules for entire project",text:"Check meta rules for entire project",clickFn:function(){l._client.checkMetaRules([""],!0)}}),e=WebGMEGlobal.State.getActiveObject(),e&&(o.addButton({title:"Check meta rules model",text:"Check meta rules for model ["+e+"]",clickFn:function(){l._client.checkMetaRules([e],!0)}}),o.addButton({title:"Check meta rules model",text:"Check meta rules for node ["+e+"] and its children...",clickFn:function(){l._client.checkMetaRules([e],!0)}}))):o.addButton({title:"No Project is opened",text:"No Project is opened...",clickFn:function(){}})},l._client.addEventListener(l._client.CONSTANTS.META_RULES_RESULT,t),r=function(){var t=new e("Meta Rules Validation Results");t.show(l._client,p),d=0,s("")},o=c.addDropDownButton({title:"Meta Rules",icon:"glyphicon glyphicon-ok-sign",menuClass:"no-min-width",clickFn:function(){i()}}),o.el.find("a > i").css({"margin-top":"0px"}),a=n.clone(),a.insertAfter(o.el.find("a > i")),a.css("margin-left","3px")},t}),define("js/Panels/Header/DefaultToolbar",["js/util","js/Constants","js/Dialogs/Projects/ProjectsDialog","js/Dialogs/Commit/CommitDialog","js/Dialogs/ProjectRepository/ProjectRepositoryDialog","./PluginToolbar","./ConstraintToolbar","./MetaRulesToolbar"],function(e,t,n,i,o,r,s,a){"use strict";var l;return l=function(e,t){this._client=e,this._pluginToolBar=null,this._metaRulesToolBar=null,this._constraintToolBar=null,this._initialize()},l.prototype._initialize=function(){function e(){var e=WebGMEGlobal.State.getActiveObject(),t=WebGMEGlobal.allPlugins,i=[];"undefined"!=typeof e?(i=n._client.filterPlugins(t,e),0===i.length?n._pluginToolBar.disableButtons(!0):n._pluginToolBar.disableButtons(!1)):n._pluginToolBar.disableButtons(!0)}var n=this;this._pluginToolBar=new r(this._client),this._metaRulesToolBar=new a(this._client),this._client.gmeConfig.core.enableCustomConstraints===!0&&(this._constraintToolBar=new s(this._client)),n._pluginToolBar.disableButtons(!0),WebGMEGlobal.State.on("change:"+t.STATE_ACTIVE_OBJECT,e),this._client.addEventListener(this._client.CONSTANTS.PROJECT_OPENED,e),this._client.addEventListener(this._client.CONSTANTS.BRANCH_CHANGED,e),this._client.addEventListener(this._client.CONSTANTS.BRANCH_STATUS_CHANGED,e)},l.prototype._createDummyControls=function(){var e=WebGMEGlobal.Toolbar;e.addSeparator(),e.addButton({title:"Commit1...",icon:"glyphicon glyphicon-share",clickFn:function(){console.log("Commit1...")}});var t=e.addRadioButtonGroup(function(e){console.log(JSON.stringify(e))});t.addButton({title:"Radio button 1",icon:"glyphicon glyphicon-align-left",data:{type:"1"}}),t.addButton({title:"Radio button 2",icon:"glyphicon glyphicon-align-center",data:{type:"2"}}),t.addButton({title:"Radio button 3",icon:"glyphicon glyphicon-align-right",data:{type:"3"}}),e.addToggleButton({title:"Toggle button",icon:"glyphicon glyphicon-plane",clickFn:function(e,t){console.log("toggled: "+t)}}),e.addTextBox({prependContent:'<i class="glyphicon glyphicon-search"></i>&nbsp;',placeholder:"Find...",textChangedFn:function(e,t){console.log(t)},onEnterFn:function(e){console.log(e)}});var n=e.addLabel();n.text("Something:"),e.addCheckBox({title:"BLA",checkChangedFn:function(e,t){console.log("checked: "+t+", data: "+JSON.stringify(e))}});var i=e.addDropDownButton({text:"Create..."});i.addButton({title:"Create 1 item",icon:"glyphicon glyphicon-plus-sign",text:"1 item",data:{howmany:1},clickFn:function(e){console.log(JSON.stringify(e))}}),i.addDivider(),i.addButton({title:"Create 10 items",icon:"glyphicon glyphicon-plus-sign",text:"10 items",data:{howmany:10},clickFn:function(e){console.log(JSON.stringify(e))}}),i.addCheckBox({text:"check1",data:{idx:1},checkChangedFn:function(e,t){console.log("checked: "+t+" , "+JSON.stringify(e))}})},l}),define("js/Panels/Header/HeaderPanel",["js/PanelBase/PanelBase","js/Widgets/ProjectTitle/ProjectTitleWidget","js/Widgets/UserProfile/UserProfileWidget","js/Widgets/ConnectedUsers/ConnectedUsersWidget","js/Toolbar/Toolbar","./ProjectNavigatorController","./DefaultToolbar","js/Utils/WebGMEUrlManager","js/Utils/ComponentSettings"],function(e,t,n,i,o,r,s,a,l){"use strict";var c,d=e;return angular.module("gme.ui.headerPanel",["isis.ui.dropdownNavigator","gme.ui.ProjectNavigator"]).run(["$rootScope","$location",function(e,t){var n;WebGMEGlobal&&WebGMEGlobal.State?WebGMEGlobal.State.on("change",function(){var i=a.serializeStateToUrl();n!==i&&(t.state(WebGMEGlobal.State.toJSON()),t.search(i),n=i,e.$$phase||e.$apply())}):console.error("WebGMEGlobal.State does not exist, cannot update url based on state changes.")}]),c=function(t,n){var i={};i[e.OPTIONS.LOGGER_INSTANCE_NAME]="HeaderPanel",d.apply(this,[i]),this._client=n.client,this._config=c.getDefaultConfig(),l.resolveWithWebGMEGlobal(this._config,c.getComponentId()),this._initialize(),this.logger.debug("HeaderPanel ctor finished")},_.extend(c.prototype,d.prototype),c.prototype._initialize=function(){var e,t,a,l,c,d=$("<div/>",{"class":"navbar navbar-inverse navbar-fixed-top"}),h=$("<div/>",{"class":"navbar-inner"});d.append(h),this.$el.append(d),e=angular.module("gmeApp"),e.controller("ProjectNavigatorController",["$scope","gmeClient","$timeout","$window","$http",r]),t=$('<div style="display: inline;" data-ng-controller="ProjectNavigatorController"><dropdown-navigator style="display: inline-block;" navigator="navigator"></dropdown-navigator></div>',{"class":"inline"}),h.append(t),h.append($('<div class="spacer pull-right"></div>')),this._config.disableUserProfile===!1&&WebGMEGlobal.gmeConfig.authentication.enable===!0&&(a=$("<div/>",{"class":"inline pull-right",style:"padding: 6px 0px;"}),this.defaultUserProfileWidget=new n(a,this._client),h.append(a)),c=$("<div/>",{"class":"inline pull-right",style:"padding: 6px 0px;"}),this.connectedUsersWidget=new i(c,this._client),h.append(c),l=$("<div/>",{"class":"toolbar-container"}),this.$el.append(l),WebGMEGlobal.Toolbar=o.createToolbar(l),new s(this._client)},c.getDefaultConfig=function(){return{disableUserProfile:!1}},c.getComponentId=function(){return"GenericUIPanelHeader"},c}),define("js/Controls/DropDownMenu",["jquery"],function(){"use strict";var e,t="disabled";return e=function(e){this._initialize(e)},e.prototype.onItemClicked=function(){},e.prototype.onDropDownMenuOpen=function(){},e.prototype.appendTo=function(e){this._el.appendTo(e)},e.prototype.getEl=function(){return this._el},e.prototype.addItem=function(e){this._addItem(e)},e.prototype.clear=function(e){this._clear(e)},e.prototype._DOMBase=$('<div class="btn-group"><button class="btn"></button><button class="btn dropdown-toggle" data-toggle="dropdown"><span class="caret"></span></button><ul class="dropdown-menu"></ul></div>'),e.prototype._initialize=function(e){var t=this;if(this._sorted=!1,this._el=this._DOMBase.clone(),this._btnSelected=this._el.find(".btn").first(),this._btnDropDownToggle=this._el.find(".dropdown-toggle").first(),this._ul=this._el.find("ul.dropdown-menu"),this.clear(),e){if(e.dropUp===!0&&this._el.addClass("dropup"),e.pullRight===!0&&this._el.addClass("pull-right"),e.size)switch(e.size){case"large":case"mini":case"micro":this._btnSelected.addClass("btn-"+e.size),this._btnDropDownToggle.addClass("btn-"+e.size)}e.sort===!0&&(this._sorted=!0),e.icon&&"string"==typeof e.icon&&""!==e.icon&&(this._icon=$('<i class="'+e.icon+'"></i>'))}this._ul.on("click","li",function(){t._onItemClick($(this))}),this._btnSelected.on("click","",function(e){t._btnDropDownToggle.trigger("click"),e.stopPropagation()}),this._btnDropDownToggle.on("click","",function(){t.onDropDownMenuOpen()})},e.prototype._addItem=function(e){var t;if(t=e.html?$(e.html):$('<li><a href="#">'+e.text+"</a></li>"),t.data("val",e.value),this._sorted===!1)this._ul.append(t);else{for(var n,i=this._ul.children(),o=i.length;o--;){var r=$(i[o]);if(e.text>=r.find("> a").text()){n=r;break}}n?t.insertAfter(n):this._ul.prepend(t)}0===this._ul.parent().length&&(this._el.append(this._btnDropDownToggle),this._el.append(this._ul))},e.prototype._clear=function(e){this._ul.empty(),e!==!0&&(this._ul.detach(),this._el.removeClass("open"),this._btnDropDownToggle.detach())},e.prototype._onItemClick=function(e){var t=e.data("val");this.onItemClicked(t)},e.prototype.setTitle=function(e){this._btnSelected.text(e),this._icon&&this._btnSelected.prepend(this._icon)},e.prototype.setEnabled=function(e){e?(this._btnSelected.removeClass(t),this._btnDropDownToggle.removeClass(t)):(this._btnSelected.addClass(t),this._btnDropDownToggle.addClass(t))},e.prototype.COLORS={BLUE:0,LIGHT_BLUE:1,GREEN:2,ORANGE:3,RED:4,BLACK:5,GRAY:6},e.prototype._colorClasses=["btn-primary","btn-info","btn-success","btn-warning","btn-danger","btn-inverse","btn-gray"],e.prototype.setColor=function(e){this.removeColor(),this._colorClasses.hasOwnProperty(e)&&(this._btnSelected.addClass(this._colorClasses[e]),this._btnDropDownToggle.addClass(this._colorClasses[e]))},e.prototype.removeColor=function(){for(var e=this._colorClasses.length;e--;)this._btnSelected.removeClass(this._colorClasses[e]),this._btnDropDownToggle.removeClass(this._colorClasses[e])},e}),define("css!js/Controls/styles/PopoverBox",[],function(){}),define("js/Controls/PopoverBox",["jquery","css!./styles/PopoverBox.css"],function(){"use strict";var e,t=2e3;return e=function(e){this._el=e,this._timeout=null},e.prototype.show=function(e,n,i){var o=this._el,r=i===!0||i>0;i===!0&&(i=t),clearTimeout(this._timeout),o.addClass("pobox"),o.popover({placement:"top",content:e,container:this._el}),o.popover("show"),o.find(".popover").addClass("pobox"),o.popover("show"),n&&o.find(".popover").addClass(n),r===!0&&(this._timeout=setTimeout(function(){o.popover("destroy")},i))},e.prototype.alertLevels={SUCCESS:"ddwa-success",WARNING:"ddwa-warning",ERROR:"ddwa-error",INFO:"ddwa-info",success:"ddwa-success",warning:"ddwa-warning",warn:"ddwa-warning",error:"ddwa-error",info:"ddwa-info"},e}),define("js/Widgets/NetworkStatus/NetworkStatusWidget",["js/logger","js/Controls/DropDownMenu","js/Controls/PopoverBox","js/Constants"],function(e,t,n,i){"use strict";var o,r="connect",s="refresh",a="logout",l="downloadError";return o=function(t,n){this._logger=e.create("gme:Widgets:NetworkStatus:NetworkStatusWidget",WebGMEGlobal.gmeConfig.client.log),this._client=n,this._el=t,this._urlAtDisconnect="",this._initializeUI(),this._logger.debug("Created")},o.prototype._initializeUI=function(){var e=this,n=this._client.getNetworkStatus();this._el.empty(),this._ddNetworkStatus=new t({dropUp:!0,pullRight:!0,size:"micro",sort:!0}),this._ddNetworkStatus.setTitle("NETWORKSTATUS"),this._el.append(this._ddNetworkStatus.getEl()),this._ddNetworkStatus.onItemClicked=function(t){t===r||(t===s?document.location.href=e._urlAtDisconnect:t===a?document.location.href="/logout":t===l&&e._client.downloadError())},this._client.addEventListener(i.CLIENT.NETWORK_STATUS_CHANGED,function(t,n){e._refreshNetworkStatus(n)}),this._refreshNetworkStatus(n)},o.prototype._refreshNetworkStatus=function(e){switch(this._logger.debug("_refreshNetworkStatus",e),e){case i.CLIENT.STORAGE.CONNECTED:this._modeConnected();break;case i.CLIENT.STORAGE.RECONNECTED:this._modeReconnected();break;case i.CLIENT.STORAGE.DISCONNECTED:this._urlAtDisconnect=window.location.href,this._modeDisconnected();break;case i.CLIENT.STORAGE.INCOMPATIBLE_CONNECTION:this._modeIncompatible();break;case i.CLIENT.STORAGE.JWT_EXPIRED:this._modeTokenExpired();break;case i.CLIENT.STORAGE.CONNECTION_ERROR:this._modeError();break;case i.CLIENT.UNCAUGHT_EXCEPTION:this._modeUncaughtException()}},o.prototype._modeConnected=function(){this._ddNetworkStatus.clear(),this._ddNetworkStatus.setTitle("CONNECTED"),this._ddNetworkStatus.setColor(t.prototype.COLORS.GREEN),this._disconnected===!0&&(this._popoverBox.show("Connected to the server",this._popoverBox.alertLevels.SUCCESS,!0),delete this._disconnected)},o.prototype._modeReconnected=function(){this._ddNetworkStatus.clear(),this._ddNetworkStatus.setTitle("RECONNECTED"),this._ddNetworkStatus.setColor(t.prototype.COLORS.GREEN),this._disconnected===!0&&(this._popoverBox.show("Connection to the server has been restored...",this._popoverBox.alertLevels.SUCCESS,!0),delete this._disconnected)},o.prototype._modeDisconnected=function(){this._ddNetworkStatus.clear(),this._ddNetworkStatus.setTitle("DISCONNECTED"),this._ddNetworkStatus.addItem({text:"Awaiting automatic reconnect...",value:r}),this._ddNetworkStatus.setColor(t.prototype.COLORS.ORANGE),this._disconnected=!0,this._popoverBox=this._popoverBox||new n(this._ddNetworkStatus.getEl()),this._popoverBox.show("Connection to the server has been lost...",this._popoverBox.alertLevels.WARNING,!1)},o.prototype._modeIncompatible=function(){this._ddNetworkStatus.clear(),this._ddNetworkStatus.setTitle("INCOMPATIBLE_CONNECTION"),this._ddNetworkStatus.setColor(t.prototype.COLORS.RED),this._ddNetworkStatus.addItem({text:"Refresh...",value:s}),this._disconnected=!0,this._popoverBox=this._popoverBox||new n(this._ddNetworkStatus.getEl()),this._popoverBox.show("New connection is not compatible with client - refresh required.",this._popoverBox.alertLevels.ERROR,!0)},o.prototype._modeTokenExpired=function(){this._ddNetworkStatus.clear(),this._ddNetworkStatus.setTitle("AUTH_TOKEN_EXPIRED"),this._ddNetworkStatus.setColor(t.prototype.COLORS.RED),this._ddNetworkStatus.addItem({text:"Logout...",value:a}),this._disconnected=!0,this._popoverBox=this._popoverBox||new n(this._ddNetworkStatus.getEl()),this._popoverBox.show("Token has expired - a new login is required.",this._popoverBox.alertLevels.ERROR,!0)},o.prototype._modeError=function(){this._ddNetworkStatus.clear(),this._ddNetworkStatus.setTitle("CONNECTION_ERROR"),this._ddNetworkStatus.setColor(t.prototype.COLORS.RED),this._ddNetworkStatus.addItem({text:"Refresh...",value:s}),this._disconnected=!0,this._popoverBox=this._popoverBox||new n(this._ddNetworkStatus.getEl()),this._popoverBox.show("Unexpected connection error - refresh required.",this._popoverBox.alertLevels.ERROR,!0)},o.prototype._modeUncaughtException=function(){this._ddNetworkStatus.clear(),this._ddNetworkStatus.setTitle("UNCAUGHT_EXCEPTION"),this._ddNetworkStatus.setColor(t.prototype.COLORS.RED),this._ddNetworkStatus.addItem({text:"Refresh...",value:s}),this._ddNetworkStatus.addItem({text:"Download error data",value:l}),this._popoverBox=this._popoverBox||new n(this._ddNetworkStatus.getEl()),this._popoverBox.show("Uncaught exception - click here for actions",this._popoverBox.alertLevels.ERROR,!0)},o}),define("js/Widgets/BranchStatus/BranchStatusWidget",["js/logger","js/Controls/DropDownMenu","js/Controls/PopoverBox","js/Dialogs/Merge/MergeDialog","js/Constants"],function(e,t,n,i,o){"use strict";var r,s="fork",a="follow",l="merge",c="select",d="downloadError",h="downloadCommitQueue";return r=function(t,n){this._logger=e.create("gme:Widgets:BranchStatusWidget",WebGMEGlobal.gmeConfig.client.log),this._client=n,this._el=t,this._eventData=null,this._initializeUI(),this._logger.debug("Created")},r.prototype._initializeUI=function(){var e=this;this._el.empty(),this._ddBranchStatus=new t({dropUp:!0,pullRight:!0,size:"micro",sort:!0}),this._ddBranchStatus.setTitle("BRANCHSTATUS"),this._el.append(this._ddBranchStatus.getEl()),this._ddBranchStatus.onItemClicked=function(t){var n=e._client.getActiveBranchName(),o=e._client.getActiveProjectId();t===s?e._client.forkCurrentBranch(null,null,function(t,i){t?(e._logger.error("could not fork the branch",n),e._client.selectBranch(n,null,function(t){if(t)throw e._logger.error("could not re-select the branch",n),t})):e._client.selectBranch(i,null,function(t){if(t)throw e._logger.error("Could not select new branch",i),t})}):t===a?e._client.selectBranch(n,null,function(t){if(t)throw e._logger.error("could not re-select the branch",n),new Error(t)}):t===l?e._client.forkCurrentBranch(null,null,function(t,r,s){t?(e._logger.error("could not fork the branch",n),e._client.selectBranch(n,null,function(t){if(t)throw e._logger.error("could not re-select the branch",n),new Error(t)})):e._client.autoMerge(o,r,n,function(t,a){var l=new i(e.gmeClient);return t?(e._logger.error("Merging resulted in error",t),e._logger.info("Trying to select fork",r),void e._client.selectBranch(r,null,function(t){if(t)throw e._logger.error("Could not select new branch",r),new Error(t)})):void(a&&a.conflict&&a.conflict.items.length>0?(e._logger.error("merge had conflicts",a.conflict),e._client.selectBranch(r,null,function(t){if(t)throw e._logger.error("Could not select the new branch",r),new Error(t)})):(e._logger.debug("Merge was successful"),e._client.selectBranch(n,null,function(t){if(t)throw e._logger.error("could not select the branch after merge",n),new Error(t);l.show(null,a)}),e._client.deleteBranch(o,r,s,function(t){t&&e._logger.error("Could delete temporary branch after merge",r)})))})}):t===c?e._client.selectBranch(n,null,function(t){t?e._logger.error(t):e._logger.debug("branch selected: ",n)}):t===d?e._client.downloadError():t===h&&e._client.downloadCommitQueue()},this._client.addEventListener(o.CLIENT.BRANCH_STATUS_CHANGED,function(t,n){e._refreshBranchStatus(n)}),this._refreshBranchStatus({status:this._client.getBranchStatus()}),window.addEventListener("beforeunload",function(t){var n,i=e._client.getCommitQueue();return i.length>0?(n="There are "+i.length+" commit(s) in your commitQueue. You will loose this data unless you take an action in the branch status (footer) widget.",t.returnValue=n,n):void 0})},r.prototype._refreshBranchStatus=function(e){var t=e.status;switch(this._eventData=e,t){case o.CLIENT.BRANCH_STATUS.SYNC:this._branchInSync();break;case o.CLIENT.BRANCH_STATUS.AHEAD_NOT_SYNC:this._branchAheadNotSync(e);break;case o.CLIENT.BRANCH_STATUS.AHEAD_SYNC:this._branchAhead(e);break;case o.CLIENT.BRANCH_STATUS.MERGING:this._branchMerging(e);break;case o.CLIENT.BRANCH_STATUS.PULLING:this._branchPulling(e);break;case o.CLIENT.BRANCH_STATUS.ERROR:this._branchError(e);break;default:this._noBranch()}},r.prototype._branchInSync=function(){this._ddBranchStatus.clear(),this._ddBranchStatus.setTitle("IN SYNC"),this._ddBranchStatus.setColor(t.prototype.COLORS.GREEN),this._outOfSync===!0&&(this._popoverBox.show("Back in sync...",this._popoverBox.alertLevels.SUCCESS,!0),delete this._outOfSync)},r.prototype._branchAheadNotSync=function(e){this._ddBranchStatus.clear(),this._outOfSync=!0,this._client.isConnected()&&(this._ddBranchStatus.addItem({text:"Create a branch with local changes.",value:s}),this._ddBranchStatus.addItem({text:"Drop local changes and follow branch.",value:a}),this._ddBranchStatus.addItem({text:"Attempt to merge in local changes.",value:l})),this._ddBranchStatus.addItem({text:"Download local changes.",value:h}),this._ddBranchStatus.setTitle("AHEAD["+e.commitQueue.length+"]"),this._ddBranchStatus.setColor(t.prototype.COLORS.ORANGE),this._popoverBox=this._popoverBox||new n(this._ddBranchStatus.getEl()),this._popoverBox.show("You are out of sync from the origin.",this._popoverBox.alertLevels.WARNING,!0)},r.prototype._branchAhead=function(e){this._ddBranchStatus.clear(),this._ddBranchStatus.addItem({text:"Download local changes.",value:h}),this._ddBranchStatus.setTitle("AHEAD["+e.commitQueue.length+"]"),this._ddBranchStatus.setColor(t.prototype.COLORS.LIGHT_BLUE)},r.prototype._branchMerging=function(e){this._ddBranchStatus.clear(),this._ddBranchStatus.setTitle("MERGING["+e.commitQueue.length+"]"),this._ddBranchStatus.setColor(t.prototype.COLORS.BLUE)},r.prototype._branchPulling=function(e){this._ddBranchStatus.clear(),this._ddBranchStatus.setTitle("PULLING["+e.updateQueue.length+"]"),this._ddBranchStatus.setColor(t.prototype.COLORS.GRAY)},r.prototype._branchError=function(e){this._ddBranchStatus.clear(),this._ddBranchStatus.setTitle("ERROR"),this._ddBranchStatus.setColor(t.prototype.COLORS.RED),this._popoverBox=this._popoverBox||new n(this._ddBranchStatus.getEl()),this._popoverBox.show("Critical error - detached from branch.",this._popoverBox.alertLevels.ERROR,!0),this._ddBranchStatus.addItem({text:"Reselect branch",value:c}),this._ddBranchStatus.addItem({text:"Download error data",value:d})},r.prototype._noBranch=function(){this._ddBranchStatus.clear(),this._ddBranchStatus.setTitle("NO BRANCH"),this._ddBranchStatus.setColor(t.prototype.COLORS.GRAY),this._outOfSync=!1},r}),define("js/Widgets/KeyboardManager/KeyboardManagerWidget",["js/logger","js/Controls/iCheckBox"],function(e,t){"use strict";var n;return n=function(t){this._logger=e.create("gme:Widgets:KeyboardManager:KeyboardManagerWidget",WebGMEGlobal.gmeConfig.client.log),this._el=t,this._initializeUI(),this._logger.debug("Created")},n.prototype._initializeUI=function(){this.__checkbox=new t({checkedText:"ON",uncheckedText:"OFF",icon:"gme icon-gme_keyboard",checkChangedFn:function(e,t){WebGMEGlobal.KeyboardManager.setEnabled(t)}}),this._el.append(this.__checkbox.el)},n}),define("css!js/Widgets/Notification/styles/NotificationWidget",[],function(){}),define("js/Widgets/Notification/NotificationWidget",["js/logger","js/Controls/DropDownMenu","js/Controls/PopoverBox","js/Constants","css!./styles/NotificationWidget.css"],function(e,t,n,i){"use strict";var o,r="clearAll",s='<li><a class="notification-drop-down-menu-item notification-drop-down-menu-item-clear empty">Clear Notifications<i class="glyphicon glyphicon-trash clear-all-icon pull-right"/></a></li>';return o=function(t,n){this._logger=e.create("gme:Widgets:NotificationWidget",WebGMEGlobal.gmeConfig.client.log),this._client=n,this._el=t,this._el.addClass("notification-widget"),this._notifications=[],this._initializeUI(),this._logger.debug("Created")},o.prototype._initializeUI=function(){var e=this;this._el.empty(),this._ddNotification=new t({dropUp:!0,pullRight:!0,size:"micro"}),this._ddNotification.setTitle("NOTIFICATIONS [0]"),this._ddNotification.setColor(t.prototype.COLORS.BLUE),this._ddNotification.onItemClicked=function(t){t===r&&(e._notifications=[],e._ddNotification.clear(),e._ddNotification.setTitle("NOTIFICATIONS [0]"))},this._el.append(this._ddNotification.getEl()),this._popoverBox=this._popoverBox||new n(this._ddNotification.getEl()),this._client.addEventListener(i.CLIENT.NOTIFICATION,function(t,n){e._refreshNotifications(n)})},o.prototype._refreshNotifications=function(e){var t=this,n=t._popoverBox.alertLevels[e.severity]||t._popoverBox.alertLevels.INFO;0===t._notifications.length&&t._ddNotification.addItem({html:s,value:r}),t._notifications.push(e),t._ddNotification.setTitle("NOTIFICATIONS ["+t._notifications.length+"]"),this._ddNotification.addItem({html:'<li><a class="notification-drop-down-menu-item notification-drop-down-menu-item-'+e.severity.toLowerCase()+'">'+e.message+"</a></li>"
}),this._ddNotification._el.hasClass("open")===!1&&("error"===e.severity.toLowerCase()?t._popoverBox.show(e.message,n,5e3):t._popoverBox.show("New message",n,500))},o}),define("js/Panels/FooterControls/FooterControlsPanel",["js/PanelBase/PanelBase","js/Widgets/NetworkStatus/NetworkStatusWidget","js/Widgets/BranchStatus/BranchStatusWidget","js/Widgets/KeyboardManager/KeyboardManagerWidget","js/Widgets/Notification/NotificationWidget"],function(e,t,n,i,o){"use strict";var r,s=e;return r=function(t,n){var i={};i[e.OPTIONS.LOGGER_INSTANCE_NAME]="FooterControlsPanel",s.apply(this,[i]),this._client=n.client,this._initialize(),this.logger.debug("FooterControlsPanel ctor finished")},_.extend(r.prototype,s.prototype),r.prototype._initialize=function(){var e=$("<div/>",{"class":"navbar navbar-inverse navbar-fixed-bottom"}),t=$("<div/>",{"class":"navbar-inner"}),n=$('<div class="spacer pull-right"></div>');e.append(t),this.$el.append(e),this.createCredits(t),t.append(n.clone()),this.createWidgets(t)},r.prototype.createCredits=function(e){var t,n=$('<div class="pull-left inline"></div>');n.append($('<div class="navbar-text"><div class="webgme-copyright">&copy; 2016 <a href="http://www.isis.vanderbilt.edu/" title="Vanderbilt University" target="_blank">Vanderbilt University</a></div></div>')),e.append(n),n=$('<div class="pull-left inline"></div>'),t=WebGMEGlobal.NpmVersion?'version: <a href="https://github.com/webgme/webgme/releases/tag/v'+WebGMEGlobal.version+'">'+WebGMEGlobal.version+"</a>":"version: "+WebGMEGlobal.version+"</a>",n.append($('<div class="navbar-text"><div class="webgme-version">'+t+"</div></div>")),e.append(n),WebGMEGlobal.GitHubVersion&&(n=$('<div class="pull-left inline"></div>'),n.append($('<div class="navbar-text"><div class="webgme-version">SHA1 or branch - <a href="https://github.com/webgme/webgme/commits/'+WebGMEGlobal.GitHubVersion+'">'+WebGMEGlobal.GitHubVersion+"</a></div></div>")),e.append(n))},r.prototype.createWidgets=function(e){var r,s,a,l,c=$('<div class="pull-right"></div>'),d=$('<div class="spacer pull-right"></div>');WebGMEGlobal.SUPPORTS_TOUCH!==!0&&(l=c.clone(),new i(l),e.append(l).append(d.clone())),a=c.clone(),new t(a,this._client),e.append(a).append(d.clone()),s=c.clone(),new o(s,this._client),e.append(s).append(d.clone()),r=c.clone(),new n(r,this._client),e.append(r).append(d.clone())},r}),define("css!js/PanelBase/styles/PanelBaseWithHeader",[],function(){}),define("js/PanelBase/PanelBaseWithHeader",["js/PanelBase/PanelBase","css!./styles/PanelBaseWithHeader.css"],function(e){"use strict";var t,n="panel-base-wh",i="panel-base-scroll";return t=function(n,i){n[t.OPTIONS.LOGGER_INSTANCE_NAME]=n[t.OPTIONS.LOGGER_INSTANCE_NAME]||"PanelBaseWithHeader",n[t.OPTIONS.HEADER_TITLE]=n[t.OPTIONS.HEADER_TITLE]===!0,n[t.OPTIONS.FLOATING_TITLE]=n[t.OPTIONS.FLOATING_TITLE]===!0,e.apply(this,[n,i]),this.initUI(n)},t.OPTIONS=_.extend(e.OPTIONS,{HEADER_TITLE:"HEADER_TITLE",FLOATING_TITLE:"FLOATING_TITLE",NO_SCROLLING:"NO_SCROLLING"}),_.extend(t.prototype,e.prototype),t.prototype.setSize=function(e,t){this._setSize(e,t),this.onResize(this.size.width,this.size.height)},t.prototype.onReadOnlyChanged=function(e){this._onReadOnlyChanged(e)},t.prototype.initUI=function(e){void 0===this.$_el&&(this.$_el=this.$el),this.$_el.empty(),this.$_el.addClass(n),e[t.OPTIONS.NO_SCROLLING]!==!0&&this.$_el.addClass(i),this.$panelHeader=$("<div/>",{"class":"panel-header"}),this.$el=this.$panelBody=$("<div/>",{"class":"panel-body drawing-canvas"}),this.$panelReadOnlyIndicator=$("<div/>",{"class":"ro-icon",title:"READ-ONLY mode ON"}),this.$panelReadOnlyIndicator.append($('<i class="glyphicon glyphicon-lock"></i>')),e[t.OPTIONS.HEADER_TITLE]===!0?(this.$_el.append(this.$panelHeader),this.$_el.append(this.$panelBody),this.$panelHeader.append(this.$panelReadOnlyIndicator),this.$panelHeaderTitle=$("<div/>",{"class":"panel-header-title"}),this.$panelHeader.append(this.$panelHeaderTitle)):e[t.OPTIONS.FLOATING_TITLE]===!0?(this.$_el.append(this.$panelBody),this.$_el.append(this.$panelHeader),this.$panelHeader.addClass("absolute-header"),this.$floatingTitle=$("<div/>",{"class":"floating-title"}),this.$panelHeaderTitle=$("<div/>",{"class":"panel-header-title"}),this.$floatingTitle.append(this.$panelReadOnlyIndicator),this.$floatingTitle.append(this.$panelHeaderTitle),this.$_el.append(this.$floatingTitle)):(this.$_el.append(this.$panelBody),this.$_el.append(this.$panelReadOnlyIndicator))},t.prototype.destroy=function(){this.clear(),this.$_el.remove()},t.prototype.setTitle=function(e){this.$panelHeaderTitle&&this.$panelHeaderTitle.text(e)},t.prototype._setSize=function(e,t){var n=this.$panelHeader.outerHeight(!0),i=parseInt(this.$panelHeader.css("padding-left"))+parseInt(this.$panelHeader.css("padding-right")),o=parseInt(this.$panelBody.css("padding-left"))+parseInt(this.$panelBody.css("padding-right")),r=parseInt(this.$panelBody.css("padding-top"))+parseInt(this.$panelBody.css("padding-bottom")),s=parseInt(this.$_el.css("border-left-width"))+parseInt(this.$_el.css("border-right-width")),a=parseInt(this.$_el.css("margin-top"))+parseInt(this.$_el.css("margin-bottom"));e-=s,t-=a,this.$_el.width(e).height(t),this.$panelHeader.width(e-i),this.$panelBody.width(e-o).height(t-n-r),this.offset=this.$el.offset(),this.size={width:e-o,height:t-n-r}},t.prototype._onReadOnlyChanged=function(t){t===!0?this.$_el.addClass(e.READ_ONLY_CLASS):this.$_el.removeClass(e.READ_ONLY_CLASS)},t}),define("js/Panels/ObjectBrowser/ObjectBrowserControlBase",["js/RegistryKeys","js/Constants"],function(e,t){"use strict";function n(e,n,i){var o=this;this._client=e,this._treeBrowser=n,this._treeBrowser.onMakeNodeSelected=this._makeNodeSelected,this._treeBrowser.getDragEffects=function(){var e,t,n=o._treeBrowser.getSelectedIDs(),i=!1,r=!1;for(t=0;t<n.length;t+=1)e=o._client.getNode(n[t]),e&&(e.isLibraryRoot()&&(i=!0),e.isLibraryElement()&&(r=!0));return i?[]:r?[o._treeBrowser.DRAG_EFFECTS.DRAG_COPY,o._treeBrowser.DRAG_EFFECTS.DRAG_CREATE_POINTER,o._treeBrowser.DRAG_EFFECTS.DRAG_CREATE_INSTANCE,o._treeBrowser.DRAG_EFFECTS.DRAG_SET_REPLACEABLE]:[o._treeBrowser.DRAG_EFFECTS.DRAG_COPY,o._treeBrowser.DRAG_EFFECTS.DRAG_MOVE,o._treeBrowser.DRAG_EFFECTS.DRAG_CREATE_POINTER,o._treeBrowser.DRAG_EFFECTS.DRAG_CREATE_INSTANCE,o._treeBrowser.DRAG_EFFECTS.DRAG_SET_REPLACEABLE]},this._treeBrowser.getDragItems=function(){return o._treeBrowser.getSelectedIDs()},this._treeBrowser.onExtendMenuItems=function(e,n){var i=o._client.getNode(e);(!i||i.isReadOnly()||e===t.PROJECT_ROOT_ID)&&(delete n["delete"],delete n.rename,delete n.separatorOperationsStart)},this._treeBrowser.onNodeTitleChanged=function(t,n,i){return e.setAttribute(t,"name",i),!1},this._treeBrowser.onNodeDelete=function(t){for(var n,o=t.length;o--;)n=e.getNode(t[o]),n&&null===n.getBaseId()&&(i.warn("Can not delete item with ID: "+t[o]+". Possibly it is the ROOT or FCO"),t.splice(o,1));e.deleteNodes(t)}}return n.prototype.getIcon=function(t,n){var i,o;return i="string"==typeof t?this._client.getNode(t):t,i&&(o=n?i.getRegistry(e.TREE_ITEM_EXPANDED_ICON)||i.getRegistry(e.TREE_ITEM_COLLAPSED_ICON):i.getRegistry(e.TREE_ITEM_COLLAPSED_ICON)||i.getRegistry(e.TREE_ITEM_EXPANDED_ICON)),o?"/assets/DecoratorSVG/"+o:null},n.prototype.getMetaInfo=function(e){var t=e.getMetaTypeId(),n={name:"",isMetaNode:e.isMetaNode()};return t&&this._client.getNode(t)&&(n.name=this._client.getNode(t).getFullyQualifiedName()),n},n.prototype._makeNodeSelected=function(e){WebGMEGlobal.State.registerActiveSelection([e])},n}),define("css!js/Dialogs/AddOrUpdateLibrary/styles/AddOrUpdateLibraryDialog",[],function(){}),define("js/Dialogs/AddOrUpdateLibrary/AddOrUpdateLibraryDialog",["js/Controls/PropertyGrid/Widgets/AssetWidget","js/util","js/Utils/WebGMEUrlManager","common/regexp","js/Dialogs/MultiTab/MultiTabDialog","css!./styles/AddOrUpdateLibraryDialog.css"],function(e,t,n,i,o){"use strict";function r(e,t){this._client=e,this._addLibrary=t}return r.prototype.show=function(e){var t,n=this,i=new o,r={title:this._addLibrary?"Add Library":"Update Library",extraClasses:"add-or-update-library-dialog",iconClass:"glyphicon glyphicon-folder-close",activeTabIndex:0,tabs:[]};this._addLibrary?this._libraryName=e:t=this._client.getNode(e),t&&(this._libraryName=t.getFullyQualifiedName(),this._storedLibraryInfo=this._client.getLibraryInfo(this._libraryName),this._libraryName&&this._storedLibraryInfo&&this._storedLibraryInfo.projectId&&this._storedLibraryInfo.branchName&&r.tabs.push(this._getRefreshTab())),r.tabs.push(this._getFileTab()),r.tabs.push(this._getUrlTab()),i.show(r,function(){n._urlInputControl.off("keyup"),n._urlInputControl.off("keydown"),n._assetWidget.destroy()})},r.prototype._getRefreshTab=function(){function e(e){t._client.updateLibrary(t._libraryName,null,function(n,i){n?e("Failed to refresh library: "+n):t._checkCommitStatus(i.status)?e():e("Project updated with library at commit "+i.hash.substring(0,7)+" but could not update branch.")})}var t=this,i="/?"+n.getSearchQuery({projectId:this._storedLibraryInfo.projectId,branchName:this._storedLibraryInfo.branchName});return{title:"Refresh",infoTitle:"Refresh from branch "+this._storedLibraryInfo.branchName+" in "+this._storedLibraryInfo.projectId,infoDetails:"The library info stored at the library root node indicates that this library originated from a project within this deployment. It also has a branch stored and it is therefore possible to attempt to update the attached library to the head of the branch linked. Use the link below to view the current state of the branch.",formControl:$('<a class="refresh-link" href="'+i+'" target="_blank">View branch of library</a>'),onOK:e}},r.prototype._getFileTab=function(){function t(e){function t(t,i){t?e("Error getting library from blob: "+t):n._checkCommitStatus(i.status)?e():e("Project updated with library at commit "+i.hash.substring(0,7)+" but could not update branch.")}return n._assetWidget.propertyValue?void(n._addLibrary?n._client.addLibrary(n._libraryName,n._assetWidget.propertyValue,t):n._client.updateLibrary(n._libraryName,n._assetWidget.propertyValue,t)):void e("No file uploaded.")}var n=this;return this._assetWidget=new e({propertyName:"AddOrUpdateLibraryDialog",propertyValue:""}),{title:"File",infoTitle:"From webgmex file",infoDetails:"Use an exported project package (webgmex-file) as the source of the library.",formControl:n._assetWidget.el,onOK:t}},r.prototype._getUrlTab=function(){function e(e){function t(t,i){t?e("Error getting library via url: "+t):n._checkCommitStatus(i.status)?e():e("Project updated with library at commit "+i.hash.substring(0,7)+" but could not update branch.")}return"string"!=typeof o.projectId?void e("Provided url is not valid, it must at least contain a project id."):void(n._addLibrary?n._client.addLibrary(n._libraryName,o,t):n._client.updateLibrary(n._libraryName,o,t))}var n=this,i=$('<div class="input-group"><span class="input-group-addon">URL</span><input type="text" class="form-control"></div>'),o={};return this._urlInputControl=i.find(".form-control"),this._urlInputControl.on("keyup",function(){o={projectId:t.getURLParameterByNameFromString(n._urlInputControl.val(),"project"),branchName:t.getURLParameterByNameFromString(n._urlInputControl.val(),"branch"),commitHash:t.getURLParameterByNameFromString(n._urlInputControl.val(),"commit")}}),this._urlInputControl.on("keydown",function(e){var t=13===e.which;t&&(e.preventDefault(),e.stopPropagation())}),{title:"URL",infoTitle:"From intra deployment URL",infoDetails:"Use the URL of the project as the source of the library. To obtain the url, open up the project you would like to use as library and copy the full url from the address field. N.B. if you later would like to be able to refresh the library, make sure that a branch i opened before copying.",formControl:i,onOK:e}},r.prototype._checkCommitStatus=function(e){return e===this._client.CONSTANTS.STORAGE.SYNCED||e===this._client.CONSTANTS.STORAGE.MERGED},r}),define("js/Utils/LibraryManager",["js/Dialogs/Confirm/ConfirmDialog","js/Dialogs/AddOrUpdateLibrary/AddOrUpdateLibraryDialog","common/regexp"],function(e,t,n){"use strict";var i=function(n){this._add=new t(n,!0),this._update=new t(n),this._remove=new e,this._getName=new e,this._doNotAskRemove=!1,this._client=n};return i.prototype.add=function(){var e=this,t=this._client.getLibraryNames();this._getName.show({title:"Add Library",iconClass:"glyphicon glyphicon-folder-close",question:"Give a unique name of the new library..",input:{label:"Name",placeHolder:"Enter name of new library...",required:!0,checkFn:function(e){return-1!==t.indexOf(e)?!1:n.DOCUMENT_KEY.test(e)}},severity:"info"},function(t,n){e._add.show(n)})},i.prototype.update=function(e){this._update.show(e)},i.prototype.remove=function(e){var t,n=this._client.getNode(e),i=this;if(n){if(t=n.getFullyQualifiedName(),this._doNotAskRemove)return void this._client.removeLibrary(t);this._remove.show({enableDontAskAgain:!0,deleteItem:n.getFullyQualifiedName()+" library"},function(e){i._doNotAskRemove=e,i._client.removeLibrary(t)})}},i.prototype.rename=function(e){var t,i,o=this,r=this._client.getNode(e);r&&(t=r.getFullyQualifiedName(),i=this._client.getLibraryNames(),i.splice(i.indexOf(t),1),this._getName.show({title:"Rename Library",iconClass:"glyphicon glyphicon-folder-close",question:'Would you like to rename "'+t+'"?',input:{label:"Name",placeHolder:"Enter new library name...",required:!0,checkFn:function(e){return-1!==i.indexOf(e)?!1:n.DOCUMENT_KEY.test(e)}},severity:"info"},function(e,n){o._client.renameLibrary(t,n)}))},i}),define("js/Dialogs/ImportModel/ImportModelDialog",["js/Controls/PropertyGrid/Widgets/AssetWidget","js/Dialogs/MultiTab/MultiTabDialog"],function(e,t){"use strict";function n(e,t){this._client=e,this._logger=t}return n.prototype.show=function(e){var n=this,i=new t,o={title:"Import Models",extraClasses:"import-model-dialog",iconClass:"glyphicon glyphicon-import",activeTabIndex:0,tabs:[n._getFileTab()]};this._parentId=e,i.show(o,function(){n._assetWidget.destroy()})},n.prototype._getFileTab=function(){function t(e){return n._assetWidget.propertyValue?void n._client.importSelectionFromFile(n._client.getActiveProjectId(),n._client.getActiveBranchName(),n._parentId,n._assetWidget.propertyValue,function(t,i){t?e("Failed to import model"+t):n._checkCommitStatus(i.status)?e():e("Project updated model at commit "+i.hash.substring(0,7)+" but could not update branch.")}):void e("No file uploaded.")}var n=this;return this._assetWidget=new e({propertyName:"ImportModelDialog",propertyValue:""}),{title:"File",infoTitle:"From webgmexm file",infoDetails:"The exported model(s) must come from a project that shares the same meta as the current project. Specifically all the meta-types used in exported model(s) must have matching meta-nodes (w.r.t GUIDs) in this project. If you are uncertain, there is no harm in trying to import the model(s) - an error will just be returned.",formControl:n._assetWidget.el,onOK:t}},n.prototype._checkCommitStatus=function(e){return e===this._client.CONSTANTS.STORAGE.SYNCED||e===this._client.CONSTANTS.STORAGE.MERGED},n}),define("js/Panels/ObjectBrowser/TreeBrowserControl",["js/logger","js/NodePropertyNames","js/Constants","js/RegistryKeys","./ObjectBrowserControlBase","js/Utils/LibraryManager","js/Dialogs/ImportModel/ImportModelDialog","js/Utils/Exporters"],function(e,t,n,i,o,r,s,a){"use strict";function l(t,i,l){function I(){var e=t.getActiveProjectId(),n=t.getActiveProjectName();l.byProjectId.treeRoot.hasOwnProperty(e)?j._treeRootId=l.byProjectId.treeRoot[e]:l.byProjectName.treeRoot.hasOwnProperty(n)?j._treeRootId=l.byProjectName.treeRoot[n]:j._treeRootId=l.treeRoot}function T(){var e=i.createNode(null,{id:j._treeRootId,name:"Initializing tree...",hasChildren:!0,"class":c});L[j._treeRootId]={treeNode:e,children:[],state:x},R={},R[j._treeRootId]={children:1},t.updateTerritory(N,R)}var P,N,A,w,O,S,x=0,M=1,R={},L={},k=!1,j=this;P=e.create("gme:Panels:ObjectBrowser:TreeBrowserControl",WebGMEGlobal.gmeConfig.client.log),this._logger=P,o.call(this,t,i,P),this._treeRootId=D,this._libraryManager=new r(this._client),w=function(){var e=t.getNode(n.PROJECT_ROOT_ID);P.debug("entered initialize"),I(),e?(P.debug("rootNode avaliable now"),N=t.addUI(j,function(e){j._eventCallback(e),k===!1&&(t.getNode(j._treeRootId)?(P.debug('loaded territory from "'+j._treeRootId+'" at initialize'),k=!0,P.debug("expanding tree-root",j._treeRootId),L[j._treeRootId].treeNode.setExpanded(!0)):(P.error("Specified tree-root "+j._treeRootId+" did not exist in model - falling back on root-node."),i.deleteNode(L[j._treeRootId].treeNode),j._treeRootId=n.PROJECT_ROOT_ID,L={},T()))}),T()):(P.debug("rootNode not avaliable at initialize"),setTimeout(w,500))},O=function(e,t){var i,o=e.getId();return i=o===n.PROJECT_ROOT_ID?g:e.isLibraryRoot()?f:e.getCrosscutsInfo().length>0||e.getValidSetNames().length>0?t?b:u:e.isConnection()?t?v:p:e.getChildrenIds().length>0?t?y:d:t?m:h},S=function(e){var n;return e.isLibraryRoot()?(n=t.getLibraryInfo(e.getFullyQualifiedName()),n?"origin: "+n.projectId+" : "+(n.branchName?n.branchName+"@"+n.commitHash:n.commitHash):null):null},i.onNodeOpen=function(e){var n,o,r,s,a,l,d,h,p=t.getNode(e),g=[];if(p){for(r=L[e].treeNode,s=p.getChildrenIds(),a=0;a<s.length;a+=1)l=s[a],d=t.getNode(l),h=null,d?(n=j.getMetaInfo(d),g.push({id:l,name:d.getFullyQualifiedName(),hasChildren:d.getChildrenIds().length>0,"class":O(d,n.isMetaNode),icon:j.getIcon(d),isConnection:d.isConnection(),isAbstract:d.isAbstract(),isLibrary:d.isLibraryRoot()||d.isLibraryElement(),isLibraryRoot:d.isLibraryRoot(),isMetaNode:n.isMetaNode,metaType:n.name,libraryInfo:S(d),STATE:M,CHILDREN:d.getChildrenIds()})):g.push({id:l,name:"Loading...",hasChildren:!1,"class":c,STATE:x,CHILDREN:[]});for(o=i.createNodes(r,g),a=0;a<g.length;a+=1)L[g[a].id]={treeNode:o[a],children:g[a].CHILDREN,state:g[a].STATE};i.updateNode(r,{icon:j.getIcon(p,!0)}),i.applyFilters()}R[e]={children:1},t.updateTerritory(N,R)},i.onNodeClose=function(e){var n,o=[];n=function(e,t){var i;if(L[e]){for(i=0;i<L[e].children.length;i+=1)n(L[e].children[i],!0);t===!0&&(delete L[e],R[e]&&(o.push({nodeid:e}),delete R[e]))}},n(e,!1),i.updateNode(L[e].treeNode,{icon:j.getIcon(e)}),o.length>0&&t.updateTerritory(N,R)},i.onNodeCopy=function(e){t.copyNodes(e)},i.onNodeDoubleClicked=function(e){P.debug("Firing onNodeDoubleClicked with nodeId: "+e),WebGMEGlobal.State.registerActiveObject(e)},i.onExtendMenuItems=function(e,i){var o,r,l=j._getValidChildrenTypesFlattened(e),c=j._treeBrowser.getSelectedIDs()||[],d=1===c.length,h=j._client.getNode(e),p=function(t){j._createChild(e,t)};if(h){if(d&&l["has.children"]===!0&&!h.isReadOnly())for(i.create={name:"Create child",icon:"add",items:{}},delete l["has.children"],o=Object.keys(l),o.sort(),r=0;r<o.length;r+=1)i.create.items[l[o[r]]]={name:o[r],callback:p};(h.isReadOnly()||e===n.PROJECT_ROOT_ID)&&delete i["delete"],(t.isReadOnly()||h.isLibraryElement())&&delete i.rename,i["delete"]||i.rename||i.create?i.separatorOperationsEnd="-":delete i.separatorOperationsStart,e===n.PROJECT_ROOT_ID&&(t.isReadOnly()===!1&&(i.addLibrary={name:"Add Library ...",callback:function(){j._libraryManager.add()},icon:!1}),i.exportProject={name:"Export project",icon:!1,items:{assetfull:{name:"with assets",callback:function(){a.exportProject(j._client,j._logger,null,!0)},icon:!1},assetless:{name:"without assets",callback:function(){a.exportProject(j._client,j._logger,null,!1)},icon:!1}}}),(-1===c.indexOf(n.PROJECT_ROOT_ID)||1===c.length)&&(-1===c.indexOf(n.PROJECT_ROOT_ID)&&(i.exportModel={name:"Export models",icon:!1,items:{assetfull:{name:"with assets",callback:function(){a.exportModels(j._client,j._logger,c,!0)},icon:!1},assetless:{name:"without assets",callback:function(){a.exportModels(j._client,j._logger,c,!1)},icon:!1}}},1===c.length&&(i.exportModel.name="Export model")),1===c.length&&h.isReadOnly()===!1&&(i.importModel={name:"Import models ...",icon:!1,callback:function(){var t=new s(j._client,j._logger.fork("ImportModel"));t.show(e)}})),h.isLibraryRoot()&&!h.isLibraryElement()&&(delete i.exportModel,delete i.importModel,i.library={name:"Library",items:{viewLibrary:{name:"View commit of library",callback:function(){j._client.openLibraryOriginInNewWindow(e)},icon:!1},followLibrary:{name:"View branch of library",callback:function(){j._client.openLibraryOriginInNewWindow(e,!0)},icon:!1}},icon:!1},t.isReadOnly()===!1&&(i.library.items.libraryEditSepararator="-",i.library.items.refreshLibrary={name:"Update library ...",callback:function(){j._libraryManager.update(e)},icon:!1},i.library.items.removeLibrary={name:"Remove library ...",callback:function(){j._libraryManager.remove(e)},icon:"delete"},i.rename.callback=function(){j._libraryManager.rename(e)},i.rename.name="Rename ...")),(h.getCrosscutsInfo().length>0||h.getValidSetNames().length>0)&&(i.open={name:"Open in visualizer",items:{defaultViz:i.open},icon:"paste"},i.open.items.defaultViz.name="Default visualizer",i.open.items.defaultViz.icon=!1,h.getCrosscutsInfo().length>0&&(i.open.items.crosscut={name:"Crosscuts",callback:function(){var t={};t[n.STATE_ACTIVE_OBJECT]=e,WebGMEGlobal.State.set(t),setTimeout(function(){var e={};e[n.STATE_ACTIVE_VISUALIZER]=C,WebGMEGlobal.State.set(e)})},icon:!1}),h.getValidSetNames().length>0&&(i.open.items.set={name:"Set membership",callback:function(){var t={};t[n.STATE_ACTIVE_OBJECT]=e,WebGMEGlobal.State.set(t),setTimeout(function(){var e={};e[n.STATE_ACTIVE_VISUALIZER]=E,WebGMEGlobal.State.set(e)})},icon:!1}))}},A=function(e,o){var r,s,a,l,d,h,p,g,u,f,m,b=null,y=null,v=0;if(P.debug("Refresh event '"+e+"', with objectId: '"+o+"'"),"insert"===e&&L[o]&&L[o].state===x&&(e="update"),("update"===e||"unload"===e)&&(r=[],L[o]&&(P.debug("Update object with id: "+o),s=t.getNode(o))))if(d=s.getChildrenIds(),L[o].state===x)f=j.getMetaInfo(s),a=O(s,f.isMetaNode),b={name:s.getFullyQualifiedName(),hasChildren:d.length>0,"class":a,icon:j.getIcon(s),isConnection:s.isConnection(),isAbstract:s.isAbstract(),isLibrary:s.isLibraryRoot()||s.isLibraryElement(),isLibraryRoot:s.isLibraryRoot(),libraryInfo:S(s),isMetaNode:f.isMetaNode,metaType:f.name},i.updateNode(L[o].treeNode,b),L[o].children=d,L[o].state=M;else{if(f=j.getMetaInfo(s),a=O(s,f.isMetaNode),b={name:s.getFullyQualifiedName(),hasChildren:d.length>0,"class":a,icon:j.getIcon(s),isConnection:s.isConnection(),isAbstract:s.isAbstract(),isLibrary:s.isLibraryRoot()||s.isLibraryElement(),isLibraryRoot:s.isLibraryRoot(),libraryInfo:S(s),isMetaNode:f.isMetaNode,metaType:f.name},l=L[o].children,i.isExpanded(L[o].treeNode))for(b.icon=j.getIcon(s,!0),h=_.difference(l,d),p=function(e){var t;if(L[e]){for(t=0;t<L[e].children.length;t+=1)p(L[e].children[t]);delete L[e],R[e]&&(r.push({nodeid:e}),delete R[e])}},v=0;v<h.length;v+=1)y=h[v],L[y]&&(i.deleteNode(L[y].treeNode),p(y));if(i.isExpanded(L[o].treeNode))for(g=_.difference(d,l),v=0;v<g.length;v+=1)y=g[v],u=t.getNode(y),f=j.getMetaInfo(u),m=null,u?(m=i.createNode(L[o].treeNode,{id:y,name:u.getFullyQualifiedName(),hasChildren:u.getChildrenIds().length>0,"class":O(u,f.isMetaNode),icon:j.getIcon(u),isConnection:u.isConnection(),isAbstract:u.isAbstract(),isLibrary:u.isLibraryRoot()||u.isLibraryElement(),isLibraryRoot:u.isLibraryRoot(),libraryInfo:S(u),isMetaNode:f.isMetaNode,metaType:f.name}),L[y]={treeNode:m,children:u.getChildrenIds(),state:M}):(m=i.createNode(L[o].treeNode,{id:y,name:"Loading...",hasChildren:!1,"class":c}),L[y]={treeNode:m,children:[],state:x});L[o].children=d,i.updateNode(L[o].treeNode,b),L[o].state=M,o!==n.PROJECT_ROOT_ID&&R[o]&&0===d.length&&(r.push({nodeid:o}),delete R[o]),r.length>0&&t.updateTerritory(N,R)}},this._eventCallback=function(e){var t,n=!1,o=e.length;for(t=0;o>t;t+=1)"complete"===e[t].etype||("update"===e[t].etype?(A("update",e[t].eid),n=!0):"load"===e[t].etype?(A("insert",e[t].eid),n=!0):"unload"===e[t].etype?(A("unload",e[t].eid),n=!0):P.debug("unknown event type '"+e[t].etype+"' received"));n&&i.applyFilters()},this.locateNode=function(e){for(var t,n=e;;){if(L.hasOwnProperty(n)&&L[n].treeNode["class"]!==c){t=L[n].treeNode,t.tree.activateKey(t.key),i._deselectSelectedNodes(),L[n].treeNode.setSelected(!0),n!==e&&t.setExpanded(!0),t.tree.setFocus(!0);break}if(!n)break;n=n.substring(0,n.lastIndexOf("/"))}},this.reLaunch=function(){P.debug("reLaunch from client..."),t.removeUI(N),i.deleteNode(L[j._treeRootId].treeNode),R={},L={},k=!1,w()},this.destroy=function(){$(document).find('link[href*="css/Panels/ObjectBrowser/TreeBrowserControl.css"]').remove()},setTimeout(w,250)}var c="node-progress",d="gme-model",h="gme-atom",p="gme-connection",g="gme-root",u="gme-aspect",f="gme-library",m="gme-meta-atom",b="gme-meta-set",y="gme-meta-model",v="gme-meta-connection",C="Crosscut",E="SetEditor",D=n.PROJECT_ROOT_ID;return l.prototype=Object.create(o.prototype),l.prototype.constructor=l,l.getDefaultConfig=function(){return{treeRoot:"",filters:{toggled:{hideConnections:!1,hideAbstracts:!1,hideLeaves:!1,hideLibraries:!1,hideMetaNodes:!1}},byProjectName:{treeRoot:{}},byProjectId:{treeRoot:{}}}},l.getComponentId=function(){return"GenericUITreeBrowserControl"},l.prototype._getValidChildrenTypes=function(e){var t,n,i,o,r,s,a,l={},c=this._client.getNode(e),d={};c&&(d=c.getValidChildrenTypesDetailed()),t=Object.keys(d||{});for(n in d)if(l["has.children"]=!0,s=this._client.getNode(n)){for(o=s.getFullyQualifiedName().split("."),r=o.pop(),i=l,a=0;a<o.length;a+=1)i[o[a]]=i[o[a]]||{},i=i[o[a]];i[r]=i[r]||{},i[r]["own.id"]=n,i[r]["own.title"]=r}return l},l.prototype._getValidChildrenTypesFlattened=function(e){var t,n,i,o,r={},s=this._client.getNode(e),a={};s&&(a=s.getValidChildrenTypesDetailed()),t=Object.keys(a||{});for(n in a)r["has.children"]=!0,o=this._client.getNode(n),o&&(i=o.getFullyQualifiedName(),r[i]=n);return r},l.prototype._createChild=function(e,t){var n=this._client,o={parentId:e};o[t]={registry:{}},o[t].registry[i.POSITION]={x:100,y:100},n.createChildren(o)},l}),define("js/Panels/ObjectBrowser/InheritanceBrowserControl",["js/logger","js/Utils/GMEConcepts","js/NodePropertyNames","js/Constants","./ObjectBrowserControlBase"],function(e,t,n,i,o){"use strict";var r="node-progress",s="gme-atom",a="gme-meta-atom",l="ModelEditor",c=0,d=1,h=function(t,n){var i=this;i._logger=e.create("gme:Panels:ObjectBrowser:InheritanceBrowserControl",WebGMEGlobal.gmeConfig.client.log),o.call(i,t,n,i._logger),i._fcoId=this._getRootId(),i._treeBrowser._enableNodeRename=!1,setTimeout(function(){i._initialize()},250)};return h.prototype=Object.create(o.prototype),h.prototype.constructor=h,h.prototype.destroy=function(){this._logger.debug("destroyed"),this._territoryId&&(this._client.removeUI(this._territoryId),this._territoryId=void 0),this._treeBrowser.deleteNode(this._nodes[this._fcoId].treeNode)},h.prototype.reLaunch=function(){this._logger.debug("reLaunch from client..."),this._territoryId&&(this._client.removeUI(this._territoryId),this._territoryId=void 0),this._treeBrowser.deleteNode(this._nodes[this._fcoId].treeNode),this._initialize()},h.prototype._initialize=function(){var e=this;if(this._fcoId=this._getRootId(),this._selfPatterns={},this._nodes={},this._fcoId){var t;this._territoryId=this._client.addUI(this,function(t){e._eventCallback(t)}),t=this._treeBrowser.createNode(null,{id:this._fcoId,name:"Initializing tree...",hasChildren:!1,"class":r}),this._nodes[this._fcoId]={treeNode:t,inheritance:[],state:c},this._selfPatterns[this._fcoId]={children:0},this._client.updateTerritory(this._territoryId,this._selfPatterns)}else setTimeout(function(){e._initialize()},500);this._treeBrowser.onNodeOpen=function(t){e._onNodeOpen(t)},this._treeBrowser.onNodeClose=function(t){e._onNodeClose(t)},this._treeBrowser.onNodeDoubleClicked=function(t){e._onNodeDoubleClicked(t)}},h.prototype._getRootId=function(){return t.getFCOId()},h.prototype._onNodeOpen=function(e){var t,n,i,o,s,a,l,h,p=this._client.getNode(e),g=[];if(p){for(i=this._nodes[e].treeNode,o=p.getInstancePaths(),this._treeBrowser.enableUpdate(!1),s=0;s<o.length;s+=1)a=o[s],l=this._client.getNode(a),h=null,l?(t=this.getMetaInfo(l),g.push({id:a,name:l.getFullyQualifiedName(),hasChildren:l.getInstancePaths().length>0,"class":this._getNodeClass(l,t.isMetaNode),icon:this.getIcon(l),STATE:d,INHERITANCE:l.getInstancePaths()})):(g.push({id:a,name:"Loading...",hasChildren:!1,"class":r,STATE:c,INHERITANCE:[]}),this._selfPatterns[a]={children:0});for(n=this._treeBrowser.createNodes(i,g),s=0;s<g.length;s+=1)this._nodes[g[s].id]={treeNode:n[s],inheritance:g[s].INHERITANCE,state:g[s].STATE};this._treeBrowser.updateNode(i,{icon:this.getIcon(p,!0)})}this._client.updateTerritory(this._territoryId,this._selfPatterns)},h.prototype._onNodeClose=function(e){var t,n=[],i=this;t=function(e,o){var r;if(i._nodes[e]){for(r=0;r<i._nodes[e].inheritance.length;r+=1)t(i._nodes[e].inheritance[r],!0);o===!0&&(delete i._nodes[e],n.push(e),delete i._selfPatterns[e])}},t(e,!1),this._treeBrowser.updateNode(this._nodes[e].treeNode,{icon:this.getIcon(e)}),n.length>0&&this._client.updateTerritory(this._territoryId,this._selfPatterns)},h.prototype._onNodeDoubleClicked=function(e){this._logger.debug("_onNodeDoubleClicked with nodeId: "+e);var t,n={},o=this._client.getNode(e);o&&(t=o.getParentId()),t||t===i.PROJECT_ROOT_ID?(n[i.STATE_ACTIVE_OBJECT]=t,n[i.STATE_ACTIVE_SELECTION]=[e]):n[i.STATE_ACTIVE_OBJECT]=e,n[i.STATE_ACTIVE_VISUALIZER]=l,WebGMEGlobal.State.set(n)},h.prototype._getNodeClass=function(e,t){return t?a:s},h.prototype._eventCallback=function(e){var t,n=e.length;for(t=0;n>t;t+=1)"load"===e[t].etype?this._refresh("insert",e[t].eid):"update"===e[t].etype?this._refresh("update",e[t].eid):"unload"===e[t].etype?this._refresh("unload",e[t].eid):this._logger.debug("unknown event type '"+e[t].etype+"' ignored")},h.prototype._refresh=function(e,t){var n,i,o,s,a,l,h,p,g,u,f,m,b=null,y=null,v=0,C=this._client,E=this;if(this._logger.debug("Refresh event '"+e+"', with objectId: '"+t+"'"),"insert"===e&&this._nodes[t]&&this._nodes[t].state===c&&(e="update"),("update"===e||"unload"===e)&&(n=[],this._nodes[t]&&(this._logger.debug("Update object with id: "+t),i=C.getNode(t))))if(this._nodes[t].state===c)f=this.getMetaInfo(i),o=this._getNodeClass(i,f.isMetaNode),b={name:i.getFullyQualifiedName(),hasChildren:i.getInstancePaths().length>0,"class":o,icon:E.getIcon(i)},this._treeBrowser.updateNode(this._nodes[t].treeNode,b),this._nodes[t].inheritance=i.getInstancePaths(),this._nodes[t].state=d;else{if(f=this.getMetaInfo(i),o=this._getNodeClass(i,f),b={name:i.getFullyQualifiedName(),hasChildren:i.getInstancePaths().length>0,"class":o,icon:E.getIcon(i)},s=this._nodes[t].inheritance,a=i.getInstancePaths(),this._treeBrowser.isExpanded(this._nodes[t].treeNode))for(b.icon=E.getIcon(i,!0),l=_.difference(s,a),h=function(e){if(E._nodes[e]){for(m=0;m<E._nodes[e].inheritance.length;m+=1)h(E._nodes[e].inheritance[m]);delete E._nodes[e],n.push(e),delete E._selfPatterns[e]}},v=0;v<l.length;v+=1)y=l[v],this._nodes[y]&&(this._treeBrowser.deleteNode(this._nodes[y].treeNode),h(y));if(this._treeBrowser.isExpanded(this._nodes[t].treeNode))for(p=_.difference(a,s),v=0;v<p.length;v+=1)y=p[v],g=C.getNode(y),f=this.getMetaInfo(i),o=this._getNodeClass(i,f),u=null,g?(u=this._treeBrowser.createNode(this._nodes[t].treeNode,{id:y,name:g.getFullyQualifiedName(),hasChildren:g.getInstancePaths().length>0,"class":o,icon:this.getIcon(g)}),this._nodes[y]={treeNode:u,inheritance:g.getInstancePaths(),state:d}):(u=this._treeBrowser.createNode(this._nodes[t].treeNode,{id:y,name:"Loading...",hasChildren:!1,"class":r}),this._nodes[y]={treeNode:u,inheritance:[],state:c});this._nodes[t].inheritance=i.getInstancePaths(),this._treeBrowser.updateNode(this._nodes[t].treeNode,b),this._nodes[t].state=d,n.length>0&&C.updateTerritory(this._territoryId,this._selfPatterns)}},h}),define("js/Panels/ObjectBrowser/CrosscutBrowserControl",["js/logger","js/Utils/GMEConcepts","js/NodePropertyNames","js/Constants","./ObjectBrowserControlBase"],function(e,t,n,i,o){"use strict";
var r="node-progress",s="gme-model",a="gme-atom",l=i.PROJECT_ROOT_ID,c="Crosscut",d="CrossCuts",h=function(t,n){var i=this;this._logger=e.create("gme:Panels:ObjectBrowser:CrosscutBrowserControl",WebGMEGlobal.gmeConfig.client.log),o.call(this,t,n,this._logger),setTimeout(function(){i._initialize()},250)};return h.prototype=Object.create(o.prototype),h.prototype.constructor=h,h.prototype.destroy=function(){},h.prototype.reLaunch=function(){this._logger.debug("reLaunch from client..."),this._territoryId&&(this._client.removeUI(this._territoryId),this._territoryId=void 0),this._treeBrowser.deleteNode(this._treeNodes[l]),this._initialize()},h.prototype._initialize=function(){var e=this;this._selfPatterns={},this._nodes={},this._crosscuts={},this._treeNodes={},this._crosscutTreeNodes={},this._treeBrowser.onNodeOpen=function(t){e._onNodeOpen(t)},this._treeBrowser.onNodeClose=function(t){e._onNodeClose(t)},this._treeBrowser.onNodeDoubleClicked=function(t){e._onNodeDoubleClicked(t)},this._territoryId=this._client.addUI(this,function(t){e._territoryCallback(t)}),this._treeNodes[l]=this._treeBrowser.createNode(null,{id:l,name:"Initializing tree...",hasChildren:!1,"class":r}),this._selfPatterns[l]={children:1},this._client.updateTerritory(this._territoryId,this._selfPatterns)},h.prototype._getNodeDescBase=function(){return{children:[],crosscuts:[]}},h.prototype._territoryCallback=function(e){var t,n=e.length;for(t=0;n>t;t+=1)switch(e[t].etype){case i.TERRITORY_EVENT_LOAD:this._insertOrUpdate(e[t].eid);break;case i.TERRITORY_EVENT_UPDATE:this._insertOrUpdate(e[t].eid);break;case i.TERRITORY_EVENT_UNLOAD:this._removeTreeNode(e[t].eid)}},h.prototype._insertOrUpdate=function(e,t){var n=this._needsToBeInTree(e),i=!1;return n?this._treeNodes[e]?this._updateTreeNode(e):i=this._createTreeNode(e,t):this._treeNodes[e]&&this._removeTreeNode(e),i},h.prototype._createTreeNode=function(e,t){var n,i=this._client.getNode(e),o=i.getParentId(),s=!1;return this._treeNodes[o]&&(this._treeNodes[o].isExpanded()||t===!0)&&(n=this._treeNodes[o],this._treeNodes[e]=this._treeBrowser.createNode(n,{id:e,name:"Loading...",hasChildren:!1,"class":r}),this._updateTreeNode(e),s=!0),s},h.prototype._updateTreeNode=function(e){var t,n=this._client.getNode(e);t={name:n.getFullyQualifiedName(),hasChildren:this._isExpandable(e),"class":s},this._treeNodes[e].isExpanded()?(t.icon=this.getIcon(e,!0),this._treeBrowser.updateNode(this._treeNodes[e],t),this._updateExpandedTreeNode(e)):(t.icon=this.getIcon(e),this._treeBrowser.updateNode(this._treeNodes[e],t))},h.prototype._updateExpandedTreeNode=function(e){var n,i,o,r,s=t.getCrosscuts(e),a=[],l=this._nodes[e].crosscuts.slice(0);for(_.each(s,function(e){a.push(e.SetID)}),n=_.difference(l,a),i=n.length;i--;)this._removeXCutTreeNode(e,n[i]);for(n=_.difference(a,l),i=n.length;i--;){for(r=s.length,o=void 0;r--;)if(s[r].SetID===n[i]){o=s[r];break}this._createXCutTreeNode(e,o)}for(n=_.intersection(l,a),i=n.length;i--;){for(r=s.length,o=void 0;r--;)if(s[r].SetID===n[i]){o=s[r];break}this._updateXCutTreeNode(e,o)}this._nodes[e].crosscuts=a.slice(0)},h.prototype._needsToBeInTree=function(e){var n=!1,i=this._client.getNode(e);return e===l?n=!0:i&&(n=i.getChildrenIds().length>0||t.getCrosscuts(e).length>0),n},h.prototype._onNodeOpen=function(e){var n,i,o,r=this._client.getNode(e),s=this;if(r){for(this._nodes[e]=this._getNodeDescBase(),n=r.getChildrenIds(),i=0;i<n.length;i+=1)o=n[i],this._insertOrUpdate(o,!0)&&(this._selfPatterns[o]={children:1},this._nodes[e].children.push(o));_.each(t.getCrosscuts(e),function(t){s._createXCutTreeNode(e,t,!0)}),this._treeBrowser.updateNode(this._treeNodes[e],{icon:this.getIcon(r,!0)})}this._client.updateTerritory(this._territoryId,this._selfPatterns)},h.prototype._createXCutTreeNode=function(e,t,n){var i,o=t.SetID,r=this._getFullCrosscutID(e,o);this._treeNodes[e]&&(this._treeNodes[e].isExpanded()||n===!0)&&(i=this._treeNodes[e],this._nodes[e].crosscuts.push(o),this._crosscutTreeNodes[r]=this._treeBrowser.createNode(i,{id:r,name:t.title,hasChildren:!1,"class":a}),this._crosscuts[r]=e)},h.prototype._getFullCrosscutID=function(e,t){return e+"_"+t},h.prototype._getCrosscutID=function(e,t){return e.substr(t.length+1)},h.prototype._onNodeClose=function(e){var t,n=[],i=this,o=this._selfPatterns;t=function(e,r){var s,a;if(i._nodes[e]){for(s=0;s<i._nodes[e].children.length;s+=1)t(i._nodes[e].children[s],!0);for(s=0;s<i._nodes[e].crosscuts.length;s+=1)a=i._getFullCrosscutID(e,i._nodes[e].crosscuts[s]),delete i._crosscuts[a],delete i._crosscutTreeNodes[a]}r===!0&&(delete i._nodes[e],delete i._treeNodes[e],n.push(e),delete o[e])},t(e,!1),this._nodes[e].crosscuts=[],this._nodes[e].children=[],this._treeBrowser.updateNode(this._treeNodes[e],{icon:this.getIcon(e)}),n.length>0&&this._client.updateTerritory(this._territoryId,o)},h.prototype._onNodeDoubleClicked=function(e){this._logger.debug("_onNodeDoubleClicked with nodeId: "+e);var t={},n=this,o=function(){var t,i,o=n._client.getNode(n._crosscuts[e]);if(o&&(t=o.getRegistry(d),t&&t.length>0))for(i=0;i<t.length;i+=1)if(t[i].SetID===n._getCrosscutID(e,n._crosscuts[e]))return t[i].order;return 0};this._crosscuts.hasOwnProperty(e)?(t[i.STATE_ACTIVE_OBJECT]=this._crosscuts[e],t[i.STATE_ACTIVE_TAB]=o()):(t[i.STATE_ACTIVE_OBJECT]=e,t[i.STATE_ACTIVE_TAB]=0),t[i.STATE_ACTIVE_VISUALIZER]=c,WebGMEGlobal.State.set(t)},h.prototype._isExpandable=function(e){var n=!1,i=this._client.getNode(e);return i&&(n=i.getChildrenIds().length>0||t.getCrosscuts(e).length>0),n},h.prototype._removeTreeNode=function(e){var t=this._treeNodes[e];t&&(t.isExpanded()&&this._onNodeClose(e),this._treeBrowser.deleteNode(t),delete this._nodes[e],delete this._treeNodes[e],delete this._selfPatterns[e],this._client.updateTerritory(this._territoryId,this._selfPatterns))},h.prototype._removeXCutTreeNode=function(e,t){var n,i=this._getFullCrosscutID(e,t);this._crosscutTreeNodes[i]&&(n=this._nodes[e].crosscuts.indexOf(t),this._nodes[e].crosscuts.splice(n,1),this._treeBrowser.deleteNode(this._crosscutTreeNodes[i]),delete this._crosscutTreeNodes[i],delete this._crosscuts[i])},h.prototype._updateXCutTreeNode=function(e,t){var n=t.SetID,i=this._getFullCrosscutID(e,n);this._crosscutTreeNodes[i]&&this._treeBrowser.updateNode(this._crosscutTreeNodes[i],{id:i,name:t.title})},h}),define("js/KeyboardManager/IKeyTarget",[],function(){"use strict";var e;return e=function(){},e.prototype.onKeyDown=function(e){this.logger.warn("IKeyTarget.prototype.onKeyDown IS NOT IMPLEMENTED!!! eventArgs: "+JSON.stringify(e))},e.prototype.onKeyUp=function(e){this.logger.warn("IKeyTarget.prototype.onKeyUp IS NOT IMPLEMENTED!!! eventArgs: "+JSON.stringify(e))},e}),define("js/Widgets/TreeBrowser/TreeBrowserWidget.Keyboard",["js/KeyboardManager/IKeyTarget"],function(e){"use strict";var t;return t=function(){this.selectionStartNode=null,this.prevFocused=null},_.extend(t.prototype,e.prototype),t.prototype._dropSelectionStateWithShift=function(){this.selectionStartNode=null},t.prototype._registerKeyboardListener=function(){WebGMEGlobal.KeyboardManager.setListener(this)},t.prototype._unregisterKeyboardListener=function(){WebGMEGlobal.KeyboardManager.setListener(void 0)},t.prototype.onKeyDown=function(e){var t,n,i,o,r,s,a=!0,l=this._treeInstance.getSelectedNodes(),c=this._treeInstance.getFocusNode(),d=null;switch(c||(c=this._treeInstance.getSelectedNodes(),c.length>0?c=c[0]:(c=this._treeInstance.getRootNode().getChildren(),c&&c.length>0&&(c=c[0]))),this.prevFocused=this._treeInstance.getFocusNode(),e.combo){case"del":this._dropSelectionStateWithShift(),this._nodeDelete(c),a=!1;break;case"return":this._dropSelectionStateWithShift(),this.onNodeDoubleClicked(c.key),a=!1;break;case"f2":this._dropSelectionStateWithShift(),setTimeout(function(){c.editStart()}),a=!1;break;case"up":case"shift+up":for(e.shiftKey!==!0&&this._deselectSelectedNodes(),d=c.getPrevSibling();d&&d.isExpanded()&&d.getChildren();)i=d.getChildren(),d=i[i.length-1];n=c.getParent(),!d&&n&&n.getParent()&&(d=n),d&&(d.setFocus(!0),d.setSelected(!0),e.shiftKey&&(l=this._treeInstance.getSelectedNodes(),this.selectionStartNode=this.selectionStartNode||this.prevFocused,r=l.indexOf(this.selectionStartNode),s=l.indexOf(d),s>=r&&this.prevFocused&&this.prevFocused.setSelected(!1))),a=!1;break;case"down":case"shift+down":if(e.shiftKey!==!0&&this._deselectSelectedNodes(),i=c.getChildren(),c.isExpanded()&&i)d=i[0];else for(t=c.getParentList(!1,!0),o=t.length-1;o>=0&&!(d=t[o].getNextSibling());o-=1);d&&(d.setFocus(!0),d.setSelected(!0),l=this._treeInstance.getSelectedNodes(),e.shiftKey&&(this.selectionStartNode=this.selectionStartNode||this.prevFocused,r=l.indexOf(this.selectionStartNode),s=l.indexOf(d),r>=s&&this.prevFocused&&this.prevFocused.setSelected(!1))),a=!1;break;case"left":this._dropSelectionStateWithShift(),c.isExpanded()&&(c.toggleExpanded(),c.setFocus(!0),c.setSelected(!0)),a=!1;break;case"right":this._dropSelectionStateWithShift(),c.isExpanded()||!c.getChildren()&&!c.isLazy()||(c.toggleExpanded(),c.setFocus(!0),c.setSelected(!0)),a=!1;break;case"ctrl+c":this._dropSelectionStateWithShift(),this._nodeCopy(),a=!1;break;case"ctrl+v":this._dropSelectionStateWithShift(),this._nodePaste(c),a=!1}return this.prevFocused=this._treeInstance.getFocusNode(),this.selectionStartNode=this.selectionStartNode||this.prevFocused,a},t.prototype.onKeyUp=function(){},t}),define("css!js/Widgets/TreeBrowser/styles/TreeBrowserWidget",[],function(){}),define("js/Widgets/TreeBrowser/TreeBrowserWidget",["js/logger","js/Constants","./TreeBrowserWidget.Keyboard","js/DragDrop/DragSource","jquery-fancytree","jquery-contextMenu","css!./styles/TreeBrowserWidget.css"],function(e,t,n,i){"use strict";function o(t,n){this._logger=e.create("gme:Widgets:TreeBrowser:TreeBrowserWidget",WebGMEGlobal.gmeConfig.client.log),n=n||{},this._el=t,this._isReadOnly=!1,this._initialize(n),this._logger.debug("Ctor finished...")}var r="node-progress",s="tree-browser";return o.prototype._initialize=function(e){var t,n,i=this;this._el.html(""),this._el.addClass(s),this._treeEl=$("<div/>",{}),this._initializeFilters(e),this._el.append(this._treeEl),n=function(e){return i._createContextMenu(e)},this._treeEl.contextMenu({selector:".fancytree-node",position:function(e){var t=e.$trigger.find(".fancytree-title").offset();e.$menu.css({top:t.top+10,left:t.left-10})},build:function(e){return{callback:function(e,t){var n=$.ui.fancytree.getNode(t.$trigger),i="clicked: '"+e+"' on '"+n.title+" ("+n.key+")'";alert(i)},items:n(e)}}}),this._treeEl.fancytree({source:[],toggleEffect:!1,checkbox:!1,selectMode:2,minExpandLevel:1,keyboard:!1,autoScroll:!0,imagePath:"/",debugLevel:0,quicksearch:!0,lazyLoad:function(e,t){i._logger.debug("onLazyRead node:"+t.node.key),i.onNodeOpen.call(i,t.node.key),e.preventDefault(),e.stopPropagation()},beforeActivate:function(e,t){i._logger.debug("### beforeActivate",t.node.title,e,t)},onActivate:function(e,t){i._logger.debug("### onActivate",t.node.title,e,t)},deactivate:function(e,t){i._logger.debug("### deactivate",t.node.title,e,t)},beforeSelect:function(e,t){i._logger.debug("### beforeSelect",t.node.title,e,t)},select:function(e,t){i._logger.debug("### select",t.node.title,e,t)},focus:function(e,t){i._logger.debug("### focus",e,t),i._registerKeyboardListener()},click:function(e,t){return i._logger.debug("### click",t.node.title,e,t),e.ctrlKey===!0||e.metaKey===!0?(t.node.isSelected()===!0?t.node.setFocus(!1):t.node.setFocus(!0),t.node.toggleSelected()):t.node.isSelected()===!1?(i._deselectSelectedNodes(),t.node.setSelected(!0),t.node.setFocus(!0)):t.node.setFocus(!1),"expander"!==t.targetType?void e.preventDefault():void 0},collapse:function(e,t){i._logger.debug("Collapsing node:"+t.node.key),t.node.resetLazy(),i.onNodeClose.call(i,t.node.key)},focusTree:function(e,t){i._logger.debug("### focusTree",e,t),i._registerKeyboardListener()},blurTree:function(e,t){i._logger.debug("### blurTree",e,t)},dblclick:function(e,n){return i._logger.debug("Node double-click: "+n.node.key),e.ctrlKey===!0||e.metaKey===!0?void e.preventDefault():"expander"===n.targetType?void e.preventDefault():(i._deselectSelectedNodes(),n.node.setSelected(!0),t=n.node,void($.isFunction(i.onNodeDoubleClicked)&&(i._logger.debug("default double-click handler: "+n.node.key),i.onNodeDoubleClicked.call(i,n.node.key),e.preventDefault())))},createNode:function(e,t){i._makeNodeDraggable(t.node)},removeNode:function(e,t){i._destroyDraggable(t.node)},extensions:["edit","filter"],edit:{adjustWidthOfs:4,allowEmpty:!0,inputCss:{minWidth:"3em"},triggerCancel:["enter"],triggerStart:[],beforeEdit:function(e,t){return i._logger.debug("beforeEdit",e,t),t.node.extraClasses===r||i._isReadOnly?!1:void 0},edit:function(e,t){i._logger.debug("edit",e,t)},beforeClose:function(e,t){i._logger.debug("beforeClose",e,t)},save:function(e,t){i._logger.debug("save",e,t)},close:function(e,t){i._logger.debug("close",e,t),t.dirty===!0&&i.onNodeTitleChanged(t.node.key,t.orgTitle,t.node.title),i._registerKeyboardListener()}},filter:{autoApply:!0,counter:!1,hideExpandedCounter:!0,mode:"hide",highlight:!1}}),this._treeInstance=this._treeEl.fancytree("getTree"),this._treeEl.append(this._noFilterMatchesEl)},o.prototype.enableUpdate=function(){this._logger.warn("TreeBrowserWidget.enableUpdate not valid with fancy tree. Use TreeBrowserWidgetcreateNodes instead!")},o.prototype.setReadOnly=function(e){this._isReadOnly=e},o.prototype.createNodes=function(e,t){var n,i,o,r=[];for(null===e&&(e=this._treeInstance.getRootNode()),e.getChildren()&&(n={},e.getChildren().forEach(function(e){n[e.key]=!0})),o=0;o<t.length;o+=1)r.push({title:t[o].name,tooltip:t[o].libraryInfo?t[o].libraryInfo:t[o].metaType?"<<"+t[o].metaType+">>":"",key:t[o].id,folder:!1,lazy:t[o].hasChildren,extraClasses:t[o]["class"]||"",icon:t[o].icon||null,isConnection:t[o].isConnection,isAbstract:t[o].isAbstract,isLibrary:t[o].isLibrary,isLibraryRoot:t[o].isLibraryRoot,libraryInfo:t[o].libraryInfo,metaType:t[o].metaType,isMetaNode:t[o].isMetaNode});if(r.length>0?(e.addChildren(r),i=e.getChildren().slice(),this.sortChildren(e,!1),this._logger.debug("nodes created",i)):(i=[],this._logger.debug("no new nodes created")),n)for(o=i.length-1;o>=0;o-=1)n[i[o].key]===!0&&i.splice(o,1);return i},o.prototype.createNode=function(e,t){var n,i,o,r;if(t.name=t.name||"",null===e&&(e=this._treeInstance.getRootNode()),n=null,i=e.getChildren())for(o=i.length-1;o>=0&&t.name.toLowerCase()<i[o].title.toLowerCase();o-=1)n=i[o];return r=e.addChildren({title:t.name,tooltip:t.libraryInfo?t.libraryInfo:t.metaType?"<<"+t.metaType+">>":"",key:t.id,folder:!1,lazy:t.hasChildren,extraClasses:t["class"]||"",icon:t.icon||null,isConnection:t.isConnection,isAbstract:t.isAbstract,isLibrary:t.isLibrary,isLibraryRoot:t.isLibraryRoot,libraryInfo:t.libraryInfo,metaType:t.metaType,isMetaNode:t.isMetaNode},n),this.sortChildren(e,!1),this._logger.debug("New node created: "+r.key),r},o.prototype.deleteNode=function(e){e&&(e.remove(),this._logger.debug("Node deleted: "+e.key))},o.prototype.updateNode=function(e,t){var n,i,o=!1,r=!1;e&&(t.hasOwnProperty("name")&&e.title!==t.name&&(n=t.name,e.setTitle(n),r=!0),(t.hasChildren===!0||t.hasChildren===!1)&&t.hasChildren!==e.isFolder()&&(e.folder=t.hasChildren,e.isExpanded()||t.hasChildren!==!0?t.hasChildren===!1&&(e.lazy=!1):e.resetLazy(),o=!0),t["class"]&&e.extraClasses!==t["class"]&&(e.extraClasses=t["class"],o=!0),t.icon&&e.icon!==t.icon&&(e.icon=t.icon,o=!0),t.hasOwnProperty("isAbstract")&&t.isAbstract!==e.data.isAbstract&&(e.data.isAbstract=t.isAbstract,o=!0),t.hasOwnProperty("isConnection")&&t.isConnection!==e.data.isConnection&&(e.data.isConnection=t.isConnection,o=!0),t.hasOwnProperty("metaType")&&t.metaType!==e.data.metaType&&(e.data.metaType=t.metaType,e.tooltip="<<"+t.metaType+">>",o=!0),t.hasOwnProperty("isMetaNode")&&t.isMetaNode!==e.data.isMetaNode&&(e.data.isMetaNode=t.isMetaNode,o=!0),t.hasOwnProperty("libraryInfo")&&"string"==typeof t.librayInfo&&t.libraryInfo!==e.data.libraryInfo&&(e.data.libraryInfo=t.libraryInfo,e.tooltip=t.libraryInfo,o=!0),t.hasOwnProperty("isLibrary")&&t.isLibrary!==e.data.isLibrary&&(e.data.isLibrary=t.isLibrary,o=!0),t.hasOwnProperty("isLibraryRoot")&&t.isLibraryRoot!==e.data.isLibraryRoot&&(e.data.isLibraryRoot=t.isLibraryRoot,o=!0),o===!0&&(e.render(!0),this._logger.debug("Node updated: "+e.key)),r===!0&&(i=e.getParent(),i&&this.sortChildren(i,!1)),o&&t.hasChildren===!0&&this.sortChildren(e,!1))},o.prototype.onNodeOpen=function(e){this._logger.warn("Default onNodeOpen for node "+e+" called, doing nothing. Please override onNodeOpen(nodeId)")},o.prototype.onNodeClose=function(e){this._logger.warn("Default onNodeClose for node "+e+" called, doing nothing. Please override onNodeClose(nodeId)")},o.prototype.onNodeTitleChanged=function(e,t,n){return this._logger.warn("Default onNodeTitleChanged for node "+e+" called, doing nothing.Please override onNodeTitleChanged(nodeId, oldText, newText)",t,n),!0},o.prototype.collapse=function(e){e.setExpanded(!1)},o.prototype.expand=function(e){e.setExpanded(!0)},o.prototype.isExpanded=function(e){return null===e?!0:e.isExpanded()},o.prototype._makeNodeDraggable=function(e){var t=$(e.span),n=this;i.makeDraggable(t,{helper:function(e){return n._dragHelper(this,e)},dragItems:function(t){return e.isSelected()===!1&&(n._deselectSelectedNodes(),e.setSelected(!0),e.setFocus(!0)),n.getDragItems(t)},dragEffects:function(e){return n.getDragEffects(e)},dragParams:function(e){return n.getDragParams(e)}})},o.prototype._destroyDraggable=function(e){var t=$(e.span);i.destroyDraggable(t)},o.prototype._dragHelper=function(e){var t,n,i,o,a=e.clone(),l=$('<div class="'+s+'"><ul class="fancytree-container"><li></li></ul></div>'),c=["fancytree-selected","fancytree-focus","fancytree-has-children","fancytree-lazy","fancytree-lastsib","fancytree-exp-cdl","fancytree-ico-c"];for(a.children().first().remove(),a.removeClass(c.join(" ")),l.find("li").append(a),a=l,t=[],n=this._treeInstance.getSelectedNodes(),i=0;i<n.length;i+=1)n[i].extraClasses!==r&&t.push(n[i].key);return t.length>1&&(o=a.find(".fancytree-title").text(),a.find(".fancytree-title").text(o+" (+"+(t.length-1)+")")),a},o.prototype.getDragItems=function(){return this._logger.warn("TreeBrowserWidget.getDragItems is not overridden in the controller!!!"),[]},o.prototype.getDragEffects=function(){return this._logger.warn("TreeBrowserWidget.getDragEffects is not overridden in the controller!!!"),[]},o.prototype.getDragParams=function(){return void this._logger.debug("TreeBrowserWidget.getDragParams is not overridden in the controller!!!")},o.prototype.DRAG_EFFECTS=i.DRAG_EFFECTS,o.prototype._nodeCopy=function(){var e,t,n=[];for(e=this._treeInstance.getSelectedNodes(),t=0;t<e.length;t+=1)e[t].extraClasses!==r&&n.push(e[t].key);this._logger.debug("Copy "+n),$.isFunction(this.onNodeCopy)&&this.onNodeCopy(n)},o.prototype._nodePaste=function(e){e.extraClasses!==r&&(this._logger.debug("Paste "+e.key),$.isFunction(this.onNodePaste)&&this.onNodePaste(e.key))},o.prototype._nodeDelete=function(e){var t,n,i;if(e.extraClasses!==r){for(t=[],n=this._treeInstance.getSelectedNodes(),i=0;i<n.length;i+=1)n[i].extraClasses!==r&&t.push(n[i].key);this._logger.debug("Delete "+t),$.isFunction(this.onNodeDelete)&&this.onNodeDelete(t)}},o.prototype._deselectSelectedNodes=function(){var e,t;for(t=this._treeInstance.getSelectedNodes(),e=0;e<t.length;e+=1)t[e].setSelected(!1);this._dropSelectionStateWithShift()},o.prototype._createContextMenu=function(e){var t,n=$.ui.fancytree.getNode(e),i={},o=this;return e.hasClass(r)!==!0?(n.isSelected()===!1&&(o._deselectSelectedNodes(),n.setSelected(!0)),n.setFocus(!0),t=o.getSelectedIDs().length>1,i={toggleNode:{name:"Expand",callback:function(){n.toggleExpanded()},icon:!1},selectNode:{name:"Select node",callback:function(){o.onMakeNodeSelected.call(o,n.key)},icon:!1},open:{name:"Open in visualizer",callback:function(){o.onNodeDoubleClicked.call(o,n.key)},icon:"paste"}},i.separatorOperationsStart="-",i.rename={name:"Rename",callback:function(){n.editStart()},icon:"edit"},i["delete"]={name:t?"Delete selection":"Delete",callback:function(){o._nodeDelete(n)},icon:"delete"},e.hasClass("fancytree-has-children")===!0?n.isExpanded()&&(i.toggleNode.name="Collapse"):delete i.toggleNode,o.onExtendMenuItems(n.key,i)):i={loading:{name:"Node is loading...",callback:function(){},icon:!1}},i},o.prototype.getSelectedIDs=function(){var e,t,n=[];for(e=this._treeInstance.getSelectedNodes(),t=0;t<e.length;t+=1)e[t].extraClasses!==r&&n.push(e[t].key);return n},o.prototype.onExtendMenuItems=function(e){this._logger.debug('onExtendMenuItems is not overridden for node with ID: "'+e+'".')},o.prototype.onCreatingContextMenu=function(e,t){this._logger.debug('onCreatingContextMenu is not overridden for node with ID: "'+e+'", contextMenuOptions: '+JSON.stringify(t))},o.prototype._initializeFilters=function(e){function t(e,t){var n,i,o,r=$('<div class="input-group input-group-sm filter-input-form">'),c=$('<input type="text" class="form-control" placeholder="'+t+'"aria-describedby="sizing-addon3">'),d=$('<span class="input-group-btn"><button class="btn btn-default btn-clear-filter" type="button"><i class="glyphicon glyphicon-remove-circle"/></button></span>');s||(s=$('<span class="btn-group input-filter-type" data-toggle="buttons"><label class="btn btn-default btn-xs btn-case-insensitive" title="Case insensitive"><input type="radio"/>AA</label><label class="btn btn-default btn-xs btn-case-sensitive" title="Case sensitive"><input type="radio">Aa</label><label class="btn btn-default btn-xs btn-regex" title="Regular expression"><input type="radio">.*</label></span>'),n=s.find(".btn-case-insensitive"),i=s.find(".btn-case-sensitive"),o=s.find(".btn-regex"),"caseInsensitive"===a._currentFilters[e].type?n.addClass("active"):"caseSensitive"===a._currentFilters[e].type?i.addClass("active"):"regex"===a._currentFilters[e].type&&o.addClass("active"),n.click(function(){a._currentFilters.hasOwnProperty("titleFilter")&&(a._currentFilters.titleFilter.type="caseInsensitive"),a._currentFilters.hasOwnProperty("metaTypeFilter")&&(a._currentFilters.metaTypeFilter.type="caseInsensitive"),a.applyFilters()}),i.click(function(){a._currentFilters.hasOwnProperty("titleFilter")&&(a._currentFilters.titleFilter.type="caseSensitive"),a._currentFilters.hasOwnProperty("metaTypeFilter")&&(a._currentFilters.metaTypeFilter.type="caseSensitive"),a.applyFilters()}),o.click(function(){a._currentFilters.hasOwnProperty("titleFilter")&&(a._currentFilters.titleFilter.type="regex"),a._currentFilters.hasOwnProperty("metaTypeFilter")&&(a._currentFilters.metaTypeFilter.type="regex"),a.applyFilters()}),l.append(s)),c.keyup(function(){a._currentFilters[e].text=c.val(),a.applyFilters()}),d.find("button.btn-clear-filter").click(function(){c.val(""),a._currentFilters[e].text=c.val(),a.applyFilters()}),r.append(c),r.append(d),l.append(r)}function n(e,t,n){var i=$('<button class="btn btn-default btn-xs" type="checkbox">'+n+"</button>");r=r||$('<span class="btn-group filter-toggle-buttons" data-toggle="buttons"/>'),a._currentFilters[e]===!0?(i.addClass("active"),i.prop("title","Show "+t)):i.prop("title","Hide "+t),i.click(function(){var n=$(this);n.hasClass("active")?(n.prop("title","Hide "+t),n.removeClass("active")):(n.prop("title","Show "+t),n.addClass("active")),a._currentFilters[e]=!a._currentFilters[e],a.applyFilters()}),r.append(i)}var i,o,r,s,a=this,l=$('<div class="filter-form">');this._filterFunctions=[],this._currentFilters={},"boolean"==typeof e.hideConnections&&(a._currentFilters.hideConnections=e.hideConnections,a._filterFunctions.push(function(e){return a._currentFilters.hideConnections===!0?e.data.isConnection!==!0:!0}),n("hideConnections","connections",'<i class="fa gme-connection"/>')),"boolean"==typeof e.hideAbstracts&&(a._currentFilters.hideAbstracts=e.hideAbstracts,a._filterFunctions.push(function(e){return a._currentFilters.hideAbstracts===!0?e.data.isAbstract!==!0:!0}),n("hideAbstracts","abstract nodes",'<i class="fa fa-code"/>')),"boolean"==typeof e.hideLeaves&&(a._currentFilters.hideLeaves=e.hideLeaves,a._filterFunctions.push(function(e){return a._currentFilters.hideLeaves===!0?e.isFolder()===!0||e.lazy===!0:!0}),n("hideLeaves","leaf nodes",'<i class="fa gme-atom"/>')),"boolean"==typeof e.hideLibraries&&(a._currentFilters.hideLibraries=e.hideLibraries,a._filterFunctions.push(function(e){return a._currentFilters.hideLibraries===!0?e.data.isLibrary!==!0:!0}),n("hideLibraries","libraries",'<i class="fa gme-library"/>')),"boolean"==typeof e.hideMetaNodes&&(a._currentFilters.hideMetaNodes=e.hideMetaNodes,a._filterFunctions.push(function(e){return a._currentFilters.hideMetaNodes===!0?e.data.isMetaNode!==!0:!0}),n("hideMetaNodes","meta nodes",'<i class="fa gme-meta-node"/>')),r&&l.append(r),e.titleFilter&&(a._currentFilters.titleFilter=e.titleFilter,a._filterFunctions.push(function(e){if(!a._currentFilters.titleFilter.text)return!0;if("caseInsensitive"===a._currentFilters.titleFilter.type)return e.title.toLowerCase().indexOf(a._currentFilters.titleFilter.text.toLowerCase())>-1;if("regex"!==a._currentFilters.titleFilter.type)return e.title.indexOf(a._currentFilters.titleFilter.text)>-1;try{return new RegExp(a._currentFilters.titleFilter.text).test(e.title)}catch(t){return!0}}),t("titleFilter","Filter by name...")),e.metaTypeFilter&&(a._currentFilters.metaTypeFilter=e.metaTypeFilter,a._filterFunctions.push(function(e){if(!a._currentFilters.metaTypeFilter.text)return!0;if("caseInsensitive"===a._currentFilters.metaTypeFilter.type)return(e.data.metaType||"").toLowerCase().indexOf(a._currentFilters.metaTypeFilter.text.toLowerCase())>-1;if("regex"!==a._currentFilters.metaTypeFilter.type)return(e.data.metaType||"").indexOf(a._currentFilters.metaTypeFilter.text)>-1;try{return new RegExp(a._currentFilters.metaTypeFilter.text).test(e.data.metaType||"")}catch(t){return!0}}),t("metaTypeFilter","Filter by meta type...")),i=$('<div class="filter-container collapsed"/>'),o=$('<button class="btn btn-default btn-xs btn-hide-show-filters pull-right" type="button"title="Show filters..."><i class="fa fa-angle-left expand-filter"/><i class="fa fa-angle-right collapse-filter"/><i class="glyphicon glyphicon-filter filter-icon"/></button>'),o.click(function(){var e=$(this);i.hasClass("collapsed")?(i.removeClass("collapsed"),e.prop("title","Hide filters...")):(i.addClass("collapsed"),e.prop("title","Show filters..."))}),i.append(o),i.append(l),this._treeEl.append(i),this._noFilterMatchesEl=$('<span class="all-filtered-out hidden">No matches...</span>')},o.prototype.applyFilters=function(e){var t,n,i=this;this._currentFilters=e||this._currentFilters,n=function(e){var t;for(t=0;t<i._filterFunctions.length;t+=1)if(i._filterFunctions[t](e)===!1)return!1;return!0},t=this._treeInstance.filterNodes(n),0===t?this._noFilterMatchesEl.removeClass("hidden"):this._noFilterMatchesEl.addClass("hidden")},o.prototype.clearFilters=function(){this._treeInstance.clearFilter()},o.prototype.sortChildren=function(e,t){var n=function(e,t){return e.data.isConnection!==!0||t.data.isConnection?(t.data.isConnection!==!0||e.data.isConnection)&&(e.data.isLibraryRoot!==!0||t.data.isLibraryRoot)?t.data.isLibraryRoot!==!0||e.data.isLibraryRoot?e.title.toLowerCase()>t.title.toLowerCase()?1:e.title.toLowerCase()<t.title.toLowerCase()?-1:0:1:-1:1};e.sortChildren(n,t)},_.extend(o.prototype,n.prototype),o}),define("css!js/Panels/ObjectBrowser/styles/ObjectBrowserPanel",[],function(){}),define("js/Panels/ObjectBrowser/ObjectBrowserPanel",["js/PanelBase/PanelBaseWithHeader","js/Constants","./TreeBrowserControl","./InheritanceBrowserControl","./CrosscutBrowserControl","js/Widgets/TreeBrowser/TreeBrowserWidget","js/Utils/ComponentSettings","js/UIEvents","css!./styles/ObjectBrowserPanel.css"],function(e,t,n,i,o,r,s,a){"use strict";var l,c=e,d="object-browser";return l=function(t,n){var i={};i[e.OPTIONS.LOGGER_INSTANCE_NAME]="ObjectBrowserPanel",i[e.OPTIONS.HEADER_TITLE]=!0,c.apply(this,[i,t]),this._client=n.client,this._initialize(),this.logger.debug("ObjectBrowserPanel ctor finished")},_.extend(l.prototype,c.prototype),l.prototype._initialize=function(){var e,t,l,c,h,p,g,u,f,m=this;this.$el.addClass(d),this.$el.html('<ul class="nav nav-tabs"><li class="composition active"><a class="composition-anchor" href="#composition" data-toggle="tab">Composition</a></li><li class="inheritance"><a href="#inheritance" data-toggle="tab">Inheritance</a></li><li class="crosscut"><a href="#crosscut" data-toggle="tab">Crosscut</a></li></ul><div class="tab-content"><div class="tab-pane active" id="composition">composition</div><div class="tab-pane" id="inheritance">inheritance</div><div class="tab-pane" id="crosscut">crosscut</div></div>'),f=this.$el.find("a.composition-anchor"),this.setTitle("Object Browser"),u=n.getDefaultConfig(),s.resolveWithWebGMEGlobal(u,n.getComponentId()),t=new r(this.$el.find("div#composition").first(),{hideConnections:u.filters.toggled.hideConnections,hideAbstracts:u.filters.toggled.hideAbstracts,hideLeaves:u.filters.toggled.hideLeaves,hideLibraries:u.filters.toggled.hideLibraries,hideMetaNodes:u.filters.toggled.hideMetaNodes,titleFilter:{text:"",type:"caseInsensitive"},metaTypeFilter:{text:"",type:"caseInsensitive"}}),l=new n(this._client,t,u),c=new r(this.$el.find("div#inheritance").first(),{titleFilter:{text:"",type:"caseInsensitive"}}),h=new i(this._client,c),p=new r(this.$el.find("div#crosscut").first(),{titleFilter:{text:"",type:"caseInsensitive"}}),g=new o(this._client,p),e=WebGMEGlobal.Toolbar,e&&(e.addSeparator(),e.addButton({title:"Locate in tree browser",icon:"glyphicon glyphicon-screenshot",data:{},clickFn:function(){var e=WebGMEGlobal.State.getActiveObject(),t=WebGMEGlobal.State.getActiveSelection();t&&t.length>0&&(e=t[0]),"string"==typeof e&&m._client.dispatchEvent(a.LOCATE_NODE,{nodeId:e})}})),this._client.addEventListener(a.LOCATE_NODE,function(e,t){f.click(),"string"==typeof t.nodeId&&l.locateNode(t.nodeId)})},l}),define("css!js/Loader/styles/LoaderProgressBar",[],function(){}),define("js/Loader/LoaderProgressBar",["css!js/Loader/styles/LoaderProgressBar.css"],function(){"use strict";var e;return e=function(e){if(this._el=e.containerElement,0===this._el.length)throw"LoaderProgressBar's container control with id:\""+e.containerElement+'" could not be found'},e.prototype._initialize=function(){this._createElements()},e.prototype._removeElements=function(){this._loaderDiv&&this._loaderDiv.remove(),this._loaderDiv=null},e.prototype._createElements=function(){this._loaderDiv||(this._loaderDiv=$("<div/>",{"class":"loader-progressbar"}),this._el.append(this._loaderDiv),this._el.width())},e.prototype.destroy=function(){this._removeElements()},e.prototype.stop=function(){this._removeElements()},e.prototype.start=function(){this._createElements()},e}),define("css!js/Panels/SplitPanel/styles/SplitPanel",[],function(){}),define("js/Panels/SplitPanel/SplitPanel",["js/PanelBase/PanelBase","css!./styles/SplitPanel.css"],function(e){"use strict";var t,n="split-panel",i="p1",o="p2",r="splitter",s=4,a="vertical",l="horizontal",c="resize",d=50,h=25,p=2;return t=function(){var t={};t[e.OPTIONS.LOGGER_INSTANCE_NAME]="SplitPanel",e.apply(this,[t]),this._panel1=void 0,this._panel2=void 0,this._readOnly=!1,this._splitterPos=.5,this._initialize(),this.logger.debug("SplitPanel ctor finished")},_.extend(t.prototype,e.prototype),t.prototype.onResize=function(e,t){this.logger.debug("onResize --> width: "+e+", height: "+t),this._width=e,this._height=t,this.$el.width(this._width),this.$el.height(this._height),this._updateUI()},t.prototype._initialize=function(){var e=this;this.$el.addClass(n),this._panel1Container=$("<div/>",{"class":i}),this.$el.append(this._panel1Container),this._splitter=$("<div/>",{"class":r}),this.$el.append(this._splitter),this._panel2Container=$("<div/>",{"class":o}),this.$el.append(this._panel2Container),this._panel1Container.on("mousedown",function(t){e._setActivePanel(0)}),this._panel2Container.on("mousedown",function(t){
e._setActivePanel(1)}),this._splitter.on("mousedown",function(t){e._startPanelResize(t),t.stopPropagation(),t.preventDefault()}),this._updateUI()},t.prototype._updateUI=function(){var e=this._width>this._height,t=this._width,n=this._height,i=this._width,o=this._height,r=s,c=s,d=0,h=0,p=0,g=0,u=0,f=0,m=void 0!==this._panel2;m?(this._splitter.show(),this._panel2Container.show(),this._splitter.removeClass([a,l].join(" "))):(this._splitter.hide(),this._panel2Container.hide()),m?(e?(c=this._height,t=Math.floor((this._width-r)*this._splitterPos),i=this._width-t-r,this._splitter.addClass(a),h=0,g=t,f=t+r):(r=this._width,n=Math.floor((this._height-c)*this._splitterPos),o=this._height-n-c,this._splitter.addClass(l),d=0,p=n,u=n+c),this._splitter.css({width:r,height:c,top:p,left:g}),this._panel1Container.css({width:t,height:n,top:d,left:h}),this._panel2Container.css({width:i,height:o,top:u,left:f}),this._panel1&&this._panel1.setSize(t,n),this._panel2&&this._panel2.setSize(i,o)):(this._panel1Container.css({width:t,height:n,top:d,left:h}),this._panel1&&this._panel1.setSize(t,n),this._splitterPos=.5)},t.prototype.setPanel=function(e,t){"p1"===t?(this._panel1Container.empty(),this._panel1=e,this._panel1Container.append(this._panel1.$pEl),this._panel1.afterAppend(),this._setActivePanel(0)):(this._panel2Container.empty(),this._panel2=e,this._panel2Container.append(this._panel2.$pEl),this._panel2.afterAppend(),this._setActivePanel(1)),this.onReadOnlyChanged(this._readOnly),this._updateUI()},t.prototype.deletePanel=function(e){"p1"===e?(this._panel1Container.empty(),this._panel1=void 0,this._setActivePanel(1)):(this._panel2Container.empty(),this._panel2=void 0,this._setActivePanel(0)),this._updateUI()},t.prototype.onReadOnlyChanged=function(t){e.prototype.onReadOnlyChanged.call(this,t),this._readOnly=t,this._panel1&&this._panel1.onReadOnlyChanged(t),this._panel2&&this._panel2.onReadOnlyChanged(t)},t.prototype._setActivePanel=function(e){var t=WebGMEGlobal.State.getSuppressVisualizerFromNode();WebGMEGlobal.State.registerSuppressVisualizerFromNode(!0),0===e&&WebGMEGlobal.PanelManager.setActivePanel(this._panel1),1===e&&WebGMEGlobal.PanelManager.setActivePanel(this._panel2),WebGMEGlobal.State.registerSuppressVisualizerFromNode(t)},t.prototype._startPanelResize=function(e){var t=this,n=this._width>this._height;this._splitterResize=this._splitter.clone().addClass(c),this.$el.append(this._splitterResize),this._splitterResizePos=this._splitterPos,this._splitStartMousePos=n?e.pageX:e.pageY,$(document).on("mousemove.SplitPanel",function(e){t._onMouseMove(e)}),$(document).on("mouseup.SplitPanel",function(e){t._onMouseUp(e)})},t.prototype._onMouseMove=function(e){var t=this._width>this._height,n=t?e.pageX:e.pageY,i=n-this._splitStartMousePos,o=t?this._width:this._height,r=i/o,s=h/o,a=d/o;this._splitterResizePos=this._splitterPos+r,this._splitterResizePos>=.5-s&&this._splitterResizePos<=.5+s&&(this._splitterResizePos=.5),this._splitterResizePos<a&&(this._splitterResizePos=a),this._splitterResizePos>1-a&&(this._splitterResizePos=1-a),this._updateSplitterResize()},t.prototype._updateSplitterResize=function(){var e,t,n=this._width>this._height,i=s+2*p,o=s+2*p;n?(o=this._height,e=Math.floor((this._width-i)*this._splitterResizePos)):(i=this._width,t=Math.floor((this._height-o)*this._splitterResizePos)),this._splitterResize.css({width:i,height:o,top:t,left:e})},t.prototype._onMouseUp=function(e){$(document).off("mousemove.SplitPanel"),$(document).off("mouseup.SplitPanel"),this._splitterPos=this._splitterResizePos,this._splitterResize.remove(),this._splitterResize=void 0,this._splitterResizePos=void 0,this._updateUI()},t}),define("css!js/Panels/Visualizer/styles/VisualizerPanel",[],function(){}),define("js/Panels/Visualizer/VisualizerPanel",["js/logger","js/Loader/LoaderProgressBar","js/Constants","js/RegistryKeys","js/PanelBase/PanelBaseWithHeader","js/Panels/SplitPanel/SplitPanel","css!./styles/VisualizerPanel.css"],function(e,t,n,i,o,r){"use strict";var s,a=WebGMEGlobal.allVisualizers;return s=function(e,t){var n={};n[o.OPTIONS.LOGGER_INSTANCE_NAME]="Visualizer",n[o.OPTIONS.HEADER_TITLE]=!1,o.apply(this,[n]),this._client=t.client,this._layoutManager=e,this._initialize(),this._activePanel={},this._activeVisualizer={},this._currentNodeID=null,this._visualizers={},this._validVisualizers=null,this.defaultVisualizer=a[0]||null,this._loadVisualizers(),this.logger.debug("VisualizerPanel ctor finished")},_.extend(s.prototype,o.prototype),s.prototype._isAvailableVisualizer=function(e){var t;for(t=0;t<a.length;t+=1)if(e===a[t].id)return!0;return!1},s.prototype._initialize=function(){var e=this,t=WebGMEGlobal.Toolbar,i=$("<i/>");this.setTitle("Visualizer"),this.$el.addClass("visualizer-panel"),t.addSeparator(),t.addToggleButton({title:"Split view ON/OFF",icon:i.clone().addClass("gme icon-gme_split-panels"),clickFn:function(t,n){e._p2Editor(n)}}),this._panel1VisContainer=$("<div/>"),this._ul1=$('<ul class="nav nav-pills nav-stacked">'),this._ul1.attr("data-id","p1"),this._panel1VisContainer.append($('<div class="pp">Panel 1:</div>')),this._panel1VisContainer.append(this._ul1),this.$el.append(this._panel1VisContainer),this.$el.on("click","ul > li:not(.active)",function(t){var n=$(this).attr("data-id"),i=$(this).parent();e._setActiveVisualizer(n,i),t.stopPropagation(),t.preventDefault()}),WebGMEGlobal.State.on("change:"+n.STATE_ACTIVE_OBJECT,function(t,n){e.selectedObjectChanged(n)}),this._client.addEventListener(n.CLIENT.PROJECT_CLOSED,function(){e._p2Editor(!1),e._validVisualizers=null}),this._client.addEventListener(n.CLIENT.PROJECT_OPENED,function(){e._p2Editor(!1),e._validVisualizers=null}),this._client.addEventListener(n.CLIENT.BRANCH_CHANGED,function(){e._p2Editor(!1),e._validVisualizers=null}),WebGMEGlobal.State.on("change:"+n.STATE_ACTIVE_VISUALIZER,function(t,n){e._settingVisualizer!==!0&&e.setActiveVisualizer(n)}),this._splitPanel=new r,this._layoutManager.addPanel("visualizerSplitPanel",this._splitPanel,"center")},s.prototype._loadVisualizers=function(){for(var e=this,t=a.length;t--;)a[t]["default"]&&(e.defaultVisualizer=a[t]);this.addRange(a,function(){e._setActiveVisualizer(e.defaultVisualizer.id,e._ul1)})},s.prototype._setActiveVisualizer=function(e,t){var i,o=t.attr("data-id");this._settingVisualizer=!0,this._activeVisualizer[o]!==e&&this._visualizers.hasOwnProperty(e)&&(this._activePanel[o]&&this._activePanel[o].destroy(),this._activeVisualizer[o]=e,t.find("> li").removeClass("active"),t.find('> li[data-id="'+e+'"]').addClass("active"),this._activePanel[o]=null,this._visualizers[e]&&(i=this._visualizers[e].panel,i&&(this._activePanel[o]=new i(this._layoutManager,{client:this._client}),this._activePanel[o][n.VISUALIZER_PANEL_IDENTIFIER]=this._visualizers[e].id,this._splitPanel.setPanel(this._activePanel[o],o)),(this._currentNodeID||this._currentNodeID===n.PROJECT_ROOT_ID)&&this._activePanel[o]&&this._activePanel[o].control&&_.isFunction(this._activePanel[o].control.selectedObjectChanged)&&this._activePanel[o].control.selectedObjectChanged(this._currentNodeID)),WebGMEGlobal.State.registerActiveVisualizer(e)),this._settingVisualizer=!1},s.prototype._updateValidVisualizers=function(e){var t,o;if(e||e===n.PROJECT_ROOT_ID)if(t=this._client.getNode(e)){if(o=t.getRegistry(i.VALID_VISUALIZERS))return void(this._validVisualizers=o.split(" "))}else this.logger.error("could not load node in _updateValidVisualizers",e);else this.logger.debug("nodePath not given");this._validVisualizers=null},s.prototype._getActivePanelElem=function(){var e=WebGMEGlobal.PanelManager.getActivePanel()===this._activePanel.p1?"p1":"p2";return"p1"===e?this._ul1:this._ul2},s.prototype._updateListedVisualizers=function(e){var t,i,o,r=this,s=this._getActivePanelElem(),a=r._client.getNode(r._currentNodeID),l={},c=!1;if(a&&(c=a.isLibraryRoot()),s.children("li").each(function(e,t){var n=$(t),i=n.attr("data-id");null===r._validVisualizers?c&&"SetEditor"===i?n.hide():n.show():(r._validVisualizers.indexOf(i)>-1&&(!c||c&&"SetEditor"!==i)?n.show():n.hide(),l[i]=n.detach())}),null!==r._validVisualizers){for(i=0;i<r._validVisualizers.length;i+=1)o=r._validVisualizers[i],l.hasOwnProperty(o)&&(s.append(l[o]),l[o]=null);for(o in l)null!==l[o]&&s.append(l[o])}this.updateContainerSize(),r._validVisualizers?(t=r._validVisualizers[0],r._isAvailableVisualizer(t)||(t=r.defaultVisualizer.id)):t=r.defaultVisualizer.id,r._isAvailableVisualizer(t)||(t=r._isAvailableVisualizer(n.DEFAULT_VISUALIZER)?n.DEFAULT_VISUALIZER:null),e&&t&&setTimeout(function(){r._setActiveVisualizer(t,s)},0)},s.prototype.setActiveVisualizer=function(e){this._setActiveVisualizer(e,this._getActivePanelElem())},s.prototype._removeLoader=function(e,t){e.loader&&(e.loader.stop(),e.loader.destroy(),delete e.loader),t.remove()},s.prototype.add=function(e,n){var i,o,r=$('<li class="center pointer"><a class="btn-env" id=""></a></li>'),s=r.find("> a"),a=this;return o=function(){n&&n()},e.DEBUG_ONLY===!0&&DEBUG!==!0?void o():void(this._visualizers[e.id]?(this.logger.warn('A visualizer with the ID "'+e.id+'" already exists...'),o()):(r.attr("data-id",e.id),s.text(e.title),this._ul1.append(r),e.panel?(i=$("<div/>",{"class":"vis-loader"}),r.loader=new t({containerElement:i}),r.loader.start(),s.append(i),require([e.panel],function(t){a.logger.debug("downloaded: "+e.panel),a._visualizers[e.id]={panel:t,id:e.id},a._removeLoader(r,i),o()},function(e){var t='Failed to download "'+e.requireModules[0]+'"';a.logger.error(t),s.append(' <i class="glyphicon glyphicon-warning-sign" title="'+t+'"></i>'),a._removeLoader(r,i),o()})):(s.append(' <i class="glyphicon glyphicon-warning-sign"></i>'),this.logger.warn('The visualizer with the ID "'+e.id+'" is missing "panel" or "control"'),o())))},s.prototype.addRange=function(e,t){var n,i,o=0,r=e.length;for(t&&(i=function(){o-=1,0===o&&t()}),n=0;r>n;n+=1)o+=1,this.add(e[n],i)},s.prototype.selectedObjectChanged=function(e){this._currentNodeID=e,this._updateValidVisualizers(e),this._updateListedVisualizers(!WebGMEGlobal.State.getSuppressVisualizerFromNode())},s.prototype._p2Editor=function(e){var t,n,i,o;e?(this._panel2VisContainer=this._panel1VisContainer.clone(),this._ul2=this._panel2VisContainer.find("ul"),this._ul2.attr("data-id","p2"),this._panel2VisContainer.find(".pp").text("Panel 2:"),this.$el.append(this._panel2VisContainer),t=this._panel2VisContainer.find("ul > li.active"),n=t.attr("data-id"),i=t.parent(),this._setActiveVisualizer(n,i)):(o="p2",this._activePanel[o]&&this._activePanel[o].destroy&&this._activePanel[o].destroy(),this._activePanel[o]=null,this._activeVisualizer[o]=null,this._panel2VisContainer&&(this._panel2VisContainer.remove(),this._panel2VisContainer=void 0,this._splitPanel.deletePanel("p2"),delete this._ul2),"string"==typeof this._currentNodeID&&WebGMEGlobal.State.registerActiveObject(this._currentNodeID)),this.updateContainerSize()},s}),define("css!js/Widgets/PartBrowser/styles/PartBrowserWidget",[],function(){}),define("js/Widgets/PartBrowser/PartBrowserWidget",["js/logger","js/Constants","js/DragDrop/DragSource","js/Toolbar/ToolbarDropDownButton","js/Toolbar/ToolbarRadioButtonGroup","css!./styles/PartBrowserWidget.css"],function(e,t,n,i,o){"use strict";var r,s="ALL",a="Exclude Libraries",l="part-browser",c="part",d="name-part";return r=function(t){this._logger=e.create("gme:Widgets:PartBrowser:PartBrowserWidget.DecoratorBase",WebGMEGlobal.gmeConfig.client.log),this._el=t,this._initialize(),this._logger.debug("PartBrowserWidget ctor finished")},r.prototype._initialize=function(){var e=this;this._showNamesOnly=!0,this._container=$("<div/>"),this._container.css({width:"100%",height:"100%"}),this._toolbar=$("<div/>"),this._partsContainer=$("<div/>"),this._partsContainer.css({width:"100%",height:"100%"}),this._partsContainer.addClass(l),this._list=$("<ul/>"),this._list.addClass(c),this._namelist=$("<ul/>"),this._namelist.addClass(d),this._listSwitcher=new o(function(t){t.isList?(e._showNamesOnly=!0,e._list.hide(),e._namelist.show()):(e._showNamesOnly=!1,e._list.show(),e._namelist.hide())}),this._listSwitcher.addButton({title:"Decorated part list",icon:"glyphicon glyphicon-th-large",data:{isList:!1}}),this._listSwitcher.addButton({title:"Only part name list",icon:"glyphicon glyphicon-list",data:{isList:!0}}),this._selector=new i({title:"Namespace selector",showSelected:!0,limitTxtLength:8}),this._toolbar.append(this._listSwitcher.el),this._toolbar.append(this._selector.el),this._partsContainer.append(this._list),this._partsContainer.append(this._namelist),this._parts={},this._partDraggableEl={},this._container.append(this._toolbar),this._container.append(this._partsContainer),this._el.append(this._container),this._list.show(),this._namelist.hide()},r.prototype.clear=function(){for(var e in this._parts)this._parts.hasOwnProperty(e)&&this.removePart(e);this._list.empty(),this._namelist.empty()},r.prototype.$_DOMBase=$("<div/>").attr({"class":c}),r.prototype.$_DOMBaseForName=$("<div/>").attr({"class":d}),r.prototype.addPart=function(e,t){var n,i=this._getPartDiv(e),o={decorated:$("<li />",{"class":"decorated-list-item"}),onlyName:$("<li />",{"class":"name-list-item"})},r=t.decoratorClass;return i.decorated.length>0?this.updatePart(e,t):(i={decorated:null,onlyName:null},n=new r({preferencesHelper:t.preferencesHelper,aspect:t.aspect}),n.setControl(t.control),n.setMetaInfo(t.metaInfo),i.decorated=this.$_DOMBase.clone(),i.decorated.attr({id:e}),i.onlyName=this.$_DOMBaseForName.clone(),i.onlyName.attr({id:e,title:t.name}),i.onlyName.append(t.name),n.beforeAppend(),i.decorated.append(n.$el),this._partDraggableEl[e]=i,this._list.append(o.decorated.append(i.decorated)),this._namelist.append(o.onlyName.append(i.onlyName)),n.afterAppend(),this._makeDraggable({el:i.decorated,partDesc:t,partId:e}),this._makeDraggable({el:i.onlyName,partDesc:t,partId:e,realDragTarget:i.decorated}),this._parts[e]={decoratorInstance:n,decoratorClass:t.decoratorClass,filtered:!1},n)},r.prototype._makeDraggable=function(e){var t=e.el,i=this,o={dragItems:function(e){return i.getDragItems(e)},dragEffects:function(e){return i.getDragEffects(e)},dragParams:function(e){return i.getDragParams(e)}};e.realDragTarget&&(o.helper=function(){return e.realDragTarget.clone()}),n.makeDraggable(t,o)},r.prototype.getDragItems=function(){return this._logger.warn("PartBrowserWidget.getDragItems is not overridden in the controller!!!"),[]},r.prototype.getDragEffects=function(){return this._logger.warn("PartBrowserWidget.getDragEffects is not overridden in the controller!!!"),[]},r.prototype.getDragParams=function(){return void this._logger.debug("PartBrowserWidget.getDragParams is not overridden in the controller!!!")},r.prototype.DRAG_EFFECTS=n.DRAG_EFFECTS,r.prototype._getPartDiv=function(e){var t={decorated:null,onlyName:null};return t.decorated=this._list.find("div."+c+'[id="'+e+'"]'),t.onlyName=this._namelist.find("div."+d+'[id="'+e+'"]'),t},r.prototype.removePart=function(e){var t=this._getPartDiv(e);t&&t.decorated.length>0&&(n.destroyDraggable(t.decorated),n.destroyDraggable(t.onlyName),t.decorated=t.decorated.parent(),t.decorated.remove(),t.decorated.empty(),t.onlyName=t.onlyName.parent(),t.onlyName.remove(),t.onlyName.empty(),delete this._parts[e],delete this._partDraggableEl[e])},r.prototype.updatePart=function(e,t){var n=this._parts[e]?this._parts[e].decoratorInstance:void 0,i=t.decoratorClass,o=this._getPartDiv(e);if(n){if(t.decoratorClass&&n.DECORATORID!==t.decoratorClass.prototype.DECORATORID){this._logger.debug('decorator update: "'+n.DECORATORID+'" --> "'+t.decoratorClass.prototype.DECORATORID+'"...');var r=n.getControl(),s=n.getMetaInfo();return n.$el.remove(),n.destroy(),n=new i({preferencesHelper:t.preferencesHelper,aspect:t.aspect}),n.setControl(r),n.setMetaInfo(s),n.beforeAppend(),o.decorated.append(n.$el),n.afterAppend(),o.onlyName.empty(),o.onlyName.append(t.name),this._parts[e].decoratorInstance=n,this._parts[e].decoratorClass=t.decoratorClass,this._logger.debug("DesignerItem's [\""+this.id+'"] decorator  has been updated.'),n}return n.update(),o.onlyName.empty(),o.onlyName.append(t.name),n}return 0===o.decorated.length?this.addPart(e,t):void 0},r.prototype.setReadOnly=function(e){for(var t=this._list.find("."+c),i=t.length;i--;)n.enableDraggable($(t[i]),!e)},r.prototype.notifyPart=function(e,t){var n=this._parts[e]?this._parts[e].decoratorInstance:void 0;n&&n.notifyComponentEvent(t)},r.prototype.setEnabled=function(e,t){var i=this._partDraggableEl[e]?this._partDraggableEl[e]:void 0;i&&(n.enableDraggable(i.decorated,t),n.enableDraggable(i.onlyName,t),t?(i.decorated.fadeTo(1,1),i.onlyName.fadeTo(1,1)):(i.decorated.fadeTo(1,.3),i.onlyName.fadeTo(1,.3)))},r.prototype.hidePart=function(e,t){var n=this._getPartDiv(e);n&&n.decorated&&n.onlyName?(n.decorated.hide(),n.onlyName.hide()):this._logger.warn("Unknown partId ["+e+"] to hide.")},r.prototype.showPart=function(e){var t=this._getPartDiv(e);t&&t.decorated&&t.onlyName?(t.decorated.show(),t.onlyName.show()):this._logger.warn("Unknown partId ["+e+"] to show.")},r.prototype.getCurrentSelectorValue=function(){return this._selector.el.is(":hidden")?"":this._selector.dropDownText()||""},r.prototype.updateSelectorInfo=function(e){var t,n,i=this,o=i.getCurrentSelectorValue(),r=function(e){i._selector.dropDownText()!==e.value&&(i._selector.dropDownText(e.value),i.onSelectorChanged(e.value))};for(i._selector.clear(),t=0;t<e.length;t+=1)"-"===e[t]?i._selector.addDivider():(n=e[t]===s?"Show all available meta nodes.":e[t]===a?"Exclude meta nodes defined in attached libraries.":'Show meta nodes from the library/namespace "'+e[t]+'".',i._selector.addButton({title:n,text:e[t],clickFn:r,data:{value:e[t]}}));0===e.length?i._selector.hide():(i._selector.show(),-1===e.indexOf(o)&&(i._selector.dropDownText(e[0]),i.onSelectorChanged(e[0])))},r.prototype.onSelectorChanged=function(e){this._logger.error("onSelectorChanged function should be overwritten for proper usage!",e)},r}),define("js/Panels/PartBrowser/PartBrowserPanelControl",["js/logger","js/Constants","js/Utils/GMEConcepts","js/NodePropertyNames","js/RegistryKeys","js/Utils/PreferencesHelper"],function(e,t,n,i,o,r){"use strict";var s,a="ALL",l="Exclude Libraries",c="PartBrowser",d="ModelDecorator";return s=function(n,i){var o=this;this._client=n,this._partBrowserView=i,this._partBrowserView.onSelectorChanged=function(){o._updateDescriptor(o._getPartDescriptorCollection())},this._containerNodeId=WebGMEGlobal.State.getActiveObject()||null,this._componentIDPartIDMap={},this._aspect=null,this._guid="_part_browser_",this._descriptorCollection={},this._partInstances={},this._shortMetaDescriptor={},this._territoryRules={"":{children:0}},this._visualizer=null,this._libraryFilter={},this._initDragDropFeatures(),this._logger=e.create("gme:Panels:PartBrowser:PartBrowserPanelControl",WebGMEGlobal.gmeConfig.client.log),this._logger.debug("Created"),WebGMEGlobal.State.on("change:"+t.STATE_ACTIVE_OBJECT,function(e,t){o._containerNodeId=t;var n=o._client.getNode(t);n&&-1!==n.getValidAspectNames().indexOf(o._aspect)||(o._aspect=null),n&&o._client&&!o._client.isProjectReadOnly()&&o._partBrowserView&&(o._partBrowserView.setReadOnly(n.isLibraryElement()||n.isLibraryRoot()),o.setReadOnly(n.isLibraryElement()||n.isLibraryRoot())),o._updateDescriptor(o._getPartDescriptorCollection())}),WebGMEGlobal.State.on("change:"+t.STATE_ACTIVE_TAB,function(){var e=WebGMEGlobal.State.getActiveAspect();e=e===t.ASPECT_ALL?null:e,o._aspect!==e&&(o._aspect=e,o._updateDescriptor(o._getPartDescriptorCollection()))}),WebGMEGlobal.State.on("change:"+t.STATE_ACTIVE_VISUALIZER,function(e,t){o._visualizer!==t&&(o._visualizer=t,o._updateDescriptor(o._getPartDescriptorCollection()))}),this._nodeEventHandling=function(e){var t,n=!1,i=o._getShortMetaDescriptor();for(t=0;t<e.length;t+=1)if(e[t].eid===o._containerNodeId){n=!0;break}JSON.stringify(o._shortMetaDescriptor)!==JSON.stringify(i)||n?(o._shortMetaDescriptor=i,o._updateLibrarySelector(),o._updateDescriptor(o._getPartDescriptorCollection())):o._updateDecorators()},this._client.addUI(o,o._nodeEventHandling,this._guid),this._client.updateTerritory(this._guid,this._territoryRules)},s.prototype._defaultCompare=function(e,t){var n=e.name.localeCompare(t.name);return n?n:e.id.localeCompare(t.id)},s.prototype._getShortMetaDescriptor=function(){var e,t,n={},i=this._client.getAllMetaNodes(),o={};for(e=0;e<i.length;e+=1)o[i[e].getGuid()]=e;for(t=Object.keys(o).sort(),e=0;e<t.length;e+=1)n[t[e]]={path:i[o[t[e]]].getId(),name:i[o[t[e]]].getAttribute("name"),meta:this._client.getChildrenMeta(o[t[e]])};return n.libraryNames=this._client.getLibraryNames().sort(),n},s.prototype._updateDescriptor=function(e){var t,n,i,o=e||{},r=this;for(t=Object.keys(e||{}).map(function(e){return o[e]}).sort(r._defaultCompare).map(function(e){return e.id}),n=0;n<t.length;n+=1)this._descriptorCollection[t[n]]?(this._descriptorCollection[t[n]].decorator!==e[t[n]].decorator||this._descriptorCollection[t[n]].name!==e[t[n]].name)&&(this._partInstances[t[n]]=this._partBrowserView.updatePart(t[n],e[t[n]])):this._partInstances[t[n]]=this._partBrowserView.addPart(t[n],e[t[n]]),this._descriptorCollection[t[n]]&&this._descriptorCollection[t[n]].visibility===e[t[n]].visibility||("hidden"===e[t[n]].visibility?this._partBrowserView.hidePart(t[n]):"visible"===e[t[n]].visibility?(this._partBrowserView.showPart(t[n]),this._partBrowserView.setEnabled(t[n],!0)):"filtered"===e[t[n]].visibility?this._partBrowserView.hidePart(t[n]):(this._partBrowserView.showPart(t[n]),this._partBrowserView.setEnabled(t[n],!1)));for(t=Object.keys(this._descriptorCollection),n=0;n<t.length;n+=1)e[t[n]]||(this._partBrowserView.removePart(t[n]),delete this._partInstances[t[n]]);this._descriptorCollection=e,i=this._getTerritoryPatterns(),JSON.stringify(this._territoryRules)!==JSON.stringify(i)?(this._territoryRules=i,setTimeout(function(){r._client.updateTerritory(r._guid,r._territoryRules)},0)):this._updateDecorators()},s.prototype._getPartDescriptorCollection=function(){var e,n,i,o,r=this._client.getNode(this._containerNodeId),s=this._client.getAllMetaNodes(),c={},d=this._partBrowserView.getCurrentSelectorValue(),h=function(e){var t=d;return d===a?!1:(d===l&&(t=""),c[e].namespace!==t)};for(o=0;o<s.length;o+=1)e=this._getPartDescriptor(s[o].getId()),e&&(c[s[o].getId()]=this._getPartDescriptor(s[o].getId()),c[s[o].getId()].visibility="hidden");if(r)for("GraphViz"===this._visualizer?n={}:"SetEditor"===this._visualizer?n={}:"METAAspect"===this._visualizer?(r=this._client.getNode(t.PROJECT_ROOT_ID),n=r.getValidChildrenTypesDetailed(null,!0)):n=r.getValidChildrenTypesDetailed(this._aspect),i=Object.keys(n),o=0;o<i.length;o+=1)n[i[o]]?c[i[o]].visibility="visible":c[i[o]].visibility="grayed",h(i[o])&&(c[i[o]].visibility="filtered");return c},s.prototype._getTerritoryPatterns=function(){var e={"":{children:0}};return this._containerNodeId&&(e[this._containerNodeId]={children:0}),e},s.prototype._getObjectDescriptor=function(e){var t,n=this._client.getNode(e);return n?(t={},t.id=n.getId(),t.decorator=n.getRegistry(o.DECORATOR)||d,t.namespace=n.getNamespace(),t.name=n.getFullyQualifiedName()):this._logger.error("Node not loaded",e),t},s.prototype._getItemDecorator=function(e){var t;return t=this._client.decoratorManager.getDecoratorForWidget(e,c),t||(t=this._client.decoratorManager.getDecoratorForWidget(d,c)),t},s.prototype._getPartDescriptor=function(e){var n=this._getObjectDescriptor(e);return n&&(n.decoratorClass=this._getItemDecorator(n.decorator),n.control=this,n.metaInfo={},n.metaInfo[t.GME_ID]=e,n.preferencesHelper=r.getPreferences(),n.aspect=this._aspect),n},s.prototype.registerComponentIDForPartID=function(e,t){this._componentIDPartIDMap[e]=this._componentIDPartIDMap[e]||[],-1===this._componentIDPartIDMap[e].indexOf(t)&&this._componentIDPartIDMap[e].push(t)},s.prototype.unregisterComponentIDFromPartID=function(e,t){var n;this._componentIDPartIDMap&&this._componentIDPartIDMap[e]&&(n=this._componentIDPartIDMap[e].indexOf(t),-1!==n&&(this._componentIDPartIDMap[e].splice(n,1),0===this._componentIDPartIDMap[e].length&&delete this._componentIDPartIDMap[e]))},s.prototype._initDragDropFeatures=function(){var e=this._partBrowserView.DRAG_EFFECTS;this._partBrowserView.getDragEffects=function(){return[e.DRAG_CREATE_INSTANCE]},this._partBrowserView.getDragItems=function(e){return[e.attr("id")]}},s.prototype._updateDecorators=function(){var e,t=Object.keys(this._partInstances||{});for(e=0;e<t.length;e+=1)this._descriptorCollection[t[e]]&&"hidden"!==this._descriptorCollection[t[e]].visibility&&this._partInstances[t[e]].update()},s.prototype._updateLibrarySelector=function(){var e=this,t=e._client.getLibraryNames().sort();t.length>0&&(t.unshift("-"),t.unshift(l),t.unshift(a)),e._partBrowserView.updateSelectorInfo(t)},s}),define("js/Panels/PartBrowser/PartBrowserPanel",["js/PanelBase/PanelBaseWithHeader","js/Widgets/PartBrowser/PartBrowserWidget","./PartBrowserPanelControl"],function(e,t,n){"use strict";var i,o=e;return i=function(t,n){var i={};i[e.OPTIONS.LOGGER_INSTANCE_NAME]="PartBrowserPanel",i[e.OPTIONS.HEADER_TITLE]=!1,i[e.OPTIONS.NO_SCROLLING]=!0,o.apply(this,[i]),this._client=n.client,this._initialize(),this.logger.debug("PartBrowserPanel ctor finished")},_.extend(i.prototype,o.prototype),i.prototype._initialize=function(){var e=this;this.setTitle("Part Browser"),this._partBrowserWidget=new t(this.$el),this._panelControl=new n(this._client,this._partBrowserWidget),this._panelControl.setReadOnly=function(t){e.setReadOnly(t)}},i.prototype.onReadOnlyChanged=function(e){o.prototype.onReadOnlyChanged.call(this,e),this._partBrowserWidget.setReadOnly(e)},i}),define("css!js/Controls/PropertyGrid/styles/PropertyGridPart",[],function(){}),define("js/Controls/PropertyGrid/PropertyGridPart",["js/Controls/PropertyGrid/PropertyGridWidgetManager","js/Constants","css!./styles/PropertyGridPart.css"],function(e,t){"use strict";var n,i="pgp",o="closed",r="cr",s=$('<i class="glyphicon glyphicon-remove-circle reset-badge btn-reset" title="Reset value"/>'),a=$('<i class="fa fa-exclamation-triangle reset-badge" title="Inherits META-invalid property"/>'),l=$('<i class="glyphicon glyphicon-exclamation-sign reset-badge btn-reset" title="Remove META-invalid property"/>');return n=function(t){t.el&&(this._containerElement=t.el),this._el=$("<div/>",{"class":i}),this.__ul=$("<ul/>",{}),this._el.append(this.__ul),this.__folders={},this.__widgets={},this._closed=!1,this.__onChange=void 0,this.__onFinishChange=void 0,this.__onReset=void 0,this._name=t.name||void 0,this._parent=t.parent,void 0===t.parent?(this._widgetManager=new e,this._containerElement.append(this._el)):(this._addNestedGUI(t),this._widgetManager=t.parent._widgetManager)},n.prototype._addNestedGUI=function(e){var t,n=this._addRow(this,$(document.createTextNode(e.text||e.name))),i=this;t=function(e){return e.preventDefault(),e.stopPropagation(),i._toggleClosed(),!1},n.addClass("title"),n.on("click",t)},n.prototype._toggleClosed=function(){this._closed===!0?this.open():this.close()},n.prototype._addRow=function(e,t,n){var i=$("<li/>");return t&&i.append(t),n?i.insertBefore(n):this.__ul.append(i),i},n.prototype._change=function(e){this.__onChange&&this.__onChange.call(this,e)},n.prototype._finishChange=function(e){this.__onFinishChange&&this.__onFinishChange.call(this,e)},n.prototype._reset=function(e){this.__onReset&&this.__onReset.call(this,e)},n.prototype._getAccumulatedName=function(){var e=this._parent?this._parent._getAccumulatedName():void 0;return e?e+"."+this._name:this._name},n.prototype.open=function(){this._closed=!1,this.__ul.removeClass(o)},n.prototype.close=function(){this._closed=!0,this.__ul.addClass(o)},n.prototype.add=function(e){var t,n,i,o=$("<div/>"),c=$("<span/>",{"class":"property-name"}),d=$("<div/>",{"class":"p-reset"}),h=this,p={};if(void 0!==this.__widgets[e.name])throw new Error('You already have a widget with the name "'+e.name+'"');return e.id||(e.id=this._getAccumulatedName()+"."+e.name),t=this._widgetManager.getWidgetForProperty(e),this.__widgets[e.name]=t,t.el.addClass("c"),t.onChange(function(e){h._change(e)}),t.onFinishChange(function(e){h._finishChange(e)}),c.text(t.propertyText||t.propertyName),c.attr("title",t.propertyText||t.propertyName),e.options&&(e.options.textColor&&(p.color=e.options.textColor),e.options.textItalic&&(p["font-style"]="italic"),e.options.textBold&&(p["font-weight"]="bold"),c.css(p),e.options.invalidValue===!0&&t.el.addClass("has-invalid-value"),e.options.invalid===!0&&e.options.resetable===!0?i=l.clone():e.options.resetable===!0?i=s.clone():e.options.invalid===!0&&(d.append(a.clone()),c.addClass("p-reset")),i&&(d.append(i),c.addClass("p-reset"),i.on("click",function(t){h._reset(e.id),t.stopPropagation(),t.preventDefault()}))),o.append(c).append(d).append(t.el),n=this._addRow(void 0,o,void 0),n.addClass(r),e.valueType?n.addClass(e.valueType):n.addClass(typeof e.value),t},n.prototype.addFolder=function(e,t){var i,o,r={name:e,text:t,parent:this},s=this;if(void 0!==this.__folders[e])throw new Error('You already have a folder with the name "'+e+'"');return i=new n(r),this.__folders[e]=i,i.onChange(function(e){s._change(e)}),i.onFinishChange(function(e){s._finishChange(e)}),i.onReset(function(e){s._reset(e)}),o=this._addRow(this,i._el),o.addClass("folder"),i},n.prototype.onChange=function(e){return this.__onChange=e,this},n.prototype.onFinishChange=function(e){return this.__onFinishChange=e,this},n.prototype.onReset=function(e){return this.__onReset=e,this},n.prototype.clear=function(){var e;this._parent&&(this.__onChange=void 0,this.__onFinishChange=void 0);for(e in this.__widgets)this.__widgets.hasOwnProperty(e)&&(this.__widgets[e].remove(),delete this.__widgets[e]);for(e in this.__folders)this.__folders.hasOwnProperty(e)&&(this.__folders[e].clear(),delete this.__folders[e]);this.__ul.empty()},n.prototype.setReadOnly=function(e){var t;for(t in this.__widgets)this.__widgets.hasOwnProperty(t)&&this.__widgets[t].setReadOnly(e);for(t in this.__folders)this.__folders.hasOwnProperty(t)&&this.__folders[t].setReadOnly(e)},n.prototype.registerWidgetForType=function(e,t){this._widgetManager.registerWidgetForType(e,t)},n}),define("js/Controls/PropertyGrid/PropertyGrid",["js/logger","js/Controls/PropertyGrid/PropertyGridPart"],function(e,t){"use strict";var n;return n=function(){var n=this;this._logger=e.create("gme:Controls:PropertyGrid:PropertyGrid",WebGMEGlobal.gmeConfig.client.log),this.$el=$("<div/>",{"class":"property-list"}),this._propertyList={},this._initDefaultWidgets(),this._isReadOnly=!1,this._ordered=!1,this.__onChange=null,this.__onFinishChange=null,this.__onReset=null,this._gui=new t({el:this.$el}),this._gui.onChange(function(e){n._logger.debug("onChange: "+JSON.stringify(e)),n.__onChange&&n.__onChange.call(n,e)}),this._gui.onFinishChange(function(e){n._logger.debug("onFinishChange: "+JSON.stringify(e)),n.__onFinishChange&&n.__onFinishChange.call(n,e)}),this._gui.onReset(function(e){n._logger.debug("onReset: "+e),n.__onReset&&n.__onReset.call(n,e)}),this._logger.debug("Created")},n.prototype._initDefaultWidgets=function(){},n.prototype.registerWidgetForType=function(e,t){this._gui.registerWidgetForType(e,t)},n.prototype._render=function(){var e,t=[];if(this._folders={},this._widgets={},this._gui.clear(),this._ordered===!0){for(e in this._propertyList)this._propertyList.hasOwnProperty(e)&&(this._propertyList[e].id=e,t.push(e));for(t.sort(),e=0;e<t.length;e+=1)this._addPropertyItem(t[e].split("."),"",this._propertyList[t[e]],this._gui)}else for(e in this._propertyList)this._propertyList.hasOwnProperty(e)&&(this._propertyList[e].id=e,this._addPropertyItem(e.split("."),"",this._propertyList[e],this._gui))},n.prototype._addPropertyItem=function(e,t,n,i){var o,r;e.length>1?(r=e[0],o=""===t?r:t+r,this._folders[o]=this._folders[o]||i.addFolder(r),e.splice(0,1),this._addPropertyItem(e,o+".",n,this._folders[o])):n.isFolder===!0?this._folders[n.name]=i.addFolder(n.name,n.text):this._widgets[n.id]=i.add(n)},n.prototype.setPropertyList=function(e){
this._propertyList=e||{},this._render(),this.setReadOnly(this._isReadOnly)},n.prototype.onChange=function(e){this.__onChange=e},n.prototype.onFinishChange=function(e){this.__onFinishChange=e},n.prototype.onReset=function(e){this.__onReset=e},n.prototype.destroy=function(){this._gui.clear()},n.prototype.setOrdered=function(e){this._ordered!==e&&(this._ordered=e,this._render())},n.prototype.setReadOnly=function(e){this._isReadOnly=e,this._gui.setReadOnly(e)},n}),define("text!js/Dialogs/DecoratorSVGExplorer/templates/DecoratorSVGExplorerDialog.html",[],function(){return'<div class="decorator-svg-dialog modal fade" tabindex="-1" role="dialog">\r\n    <div class="modal-dialog modal-xlg">\r\n        <div class="modal-content">\r\n            <div class="modal-header">\r\n                <button type="button" class="close" data-dismiss="modal">×</button>\r\n                <i class="glyphicon glyphicon-picture header-icon"></i><span>SVG Icons</span>\r\n            </div>\r\n            <div class="pre-body">\r\n                <div class="tabContainer">\r\n                    <ul class="nav nav-tabs">\r\n                        <!--<li class="tab All"><a href="#" data-toggle="tab">All</a></li>-->\r\n                    </ul>\r\n                </div>\r\n            </div>\r\n            <div class="modal-body">\r\n\r\n            </div>\r\n            <div class="modal-footer">\r\n                <div class="input-prepend pull-left">\r\n                    <span class="add-on"><i class="icon-search"></i>\r\n                    </span><input id="txtFilter" class="input-xlarge" type="text" placeholder="Enter filter...">\r\n                </div>\r\n                <a href="#" class="btn btn-primary btn-select disabled">Select</a>\r\n                <a href="#" class="btn btn-default" data-dismiss="modal">Close</a>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>'}),define("css!js/Dialogs/DecoratorSVGExplorer/styles/DecoratorSVGExplorerDialog",[],function(){}),define("js/Dialogs/DecoratorSVGExplorer/DecoratorSVGExplorerDialog",["js/Constants","assets/decoratorSVG","text!./templates/DecoratorSVGExplorerDialog.html","css!./styles/DecoratorSVGExplorerDialog.css"],function(e,t,n){"use strict";var i,o=$('<div class="image-container"><img src=""/><div class="desc">description</div></div>'),r='<li class="tab"><a href="#" data-toggle="tab">__GROUP_NAME__</a></li>',s=e.ASSETS_DECORATOR_SVG_FOLDER,a=[""].concat(t.DecoratorSVGIconList.slice(0)),l="data-filename",c="data-normalized-filename",d="data-tab-group",h="tab-group-",p="__UNGROUPED__";return i=function(){},i.prototype.show=function(e,t){var n,i=this;this._fnCallback=e,this._groups={},this._groupNames=null,this._initDialog(),this._dialog.on("hidden.bs.modal",function(){i._dialog.remove(),i._dialog.empty(),i._dialog=void 0}),this._dialog.on("hide.bs.modal",function(){i._fnCallback&&(i.result||""===i.result)&&i._fnCallback(i.result)}),this._dialog.modal("show"),t&&(n=i._modalBody.find("["+l+'="'+t+'"]'),this._setSelected(t,n))},i.prototype.registerResult=function(){this.result=this._selectedSVG},i.prototype._initDialog=function(){var e,t,i,g,u,f,m=this,_=a.length;for(this._dialog=$(n),this._modalBody=this._dialog.find(".modal-body"),this._btnSelect=this._dialog.find(".btn-select"),this._txtFind=this._dialog.find("#txtFilter"),this._groupTabList=this._dialog.find("ul.nav-tabs"),e=0;_>e;e+=1)t=a[e],f=o.clone(),i=t.split("/"),g=i[i.length-1],0===e&&""===t?(f.find("img").remove(),f.find(".desc").text("-- NONE --"),f.find(".desc").attr("title","-- NONE --")):(g=g.substring(0,g.length-".svg".length),f.find("img").attr("src",s+t),f.find("img").attr("title",t),f.find(".desc").text(g),f.find(".desc").attr("title",t)),f.data(l,t),f.attr(l,t),f.attr(c,g.toLowerCase()),f.data(c,g.toLowerCase()),1===i.length?f.addClass(h+p):(f.addClass(h+i[0]),this._groups[i[0]]=!0),this._modalBody.append(f),m._setSelected();for(this._groupNames=Object.keys(this._groups),u=$(r.replace("__GROUP_NAME__","All")),u.addClass("All active"),this._groupTabList.append(u),e=0;e<this._groupNames.length;e+=1)u=$(r.replace("__GROUP_NAME__",this._groupNames[e])),u.data(d,this._groupNames[e]),this._groupTabList.append(u);this._modalBody.on("mousedown","div.image-container",function(){var e=$(this);m._modalBody.find("div.image-container.selected").removeClass("selected"),m._setSelected(e.data(l),e)}),this._modalBody.on("dblclick","div.image-container",function(){m.registerResult(),m._dialog.modal("hide")}),this._btnSelect.on("click",function(){m.registerResult(),m._dialog.modal("hide")}),this._txtFind.on("keyup",function(){m._filter($(this).val())}),this._txtFind.on("keypress",function(e){return 13!==e.keyCode}),this._groupTabList.find("li.tab").on("click",function(){var e,t=$(this);m._setSelected(),t.hasClass("All")?m._modalBody.find("div.image-container").removeClass("not-in-tab-group"):(e=h+t.data(d),m._modalBody.find("div.image-container").each(function(){var t=$(this);t.hasClass(e)?t.removeClass("not-in-tab-group"):t.addClass("not-in-tab-group")}))})},i.prototype._setSelected=function(e,t){this._modalBody.find("div.image-container.selected").removeClass("selected"),t&&t.addClass("selected"),e||""===e?(this._selectedSVG=e,this._btnSelect.disable(!1)):(this._selectedSVG=void 0,this._btnSelect.disable(!0))},i.prototype._filter=function(e){this._setSelected(),e?this._modalBody.find("div.image-container").each(function(){var t=$(this),n=t.data(c);n&&n.indexOf(e.toLowerCase())<0?t.addClass("not-in-filter"):n?t.removeClass("not-in-filter"):t.addClass("not-in-filter")}):this._modalBody.find("div.image-container").removeClass("not-in-filter")},i}),define("text!js/Dialogs/ValidVisualizers/templates/ValidVisualizersDialog.html",[],function(){return'<div class="valid-visualizers-dialog modal fade" tabindex="-1" role="dialog">\r\n    <div class="modal-dialog modal-md">\r\n        <div class="modal-content">\r\n            <div class="modal-header">\r\n                <button type="button" class="close" data-dismiss="modal">×</button>\r\n                <i class="fa fa-list-ul header-icon"></i><span>Valid Visualizers</span>\r\n            </div>\r\n            <div class="modal-body">\r\n                <h5>Edit valid visualizers\r\n                    <i class="glyphicon glyphicon-info-sign toggle-info-btn"/>\r\n                </h5>\r\n                    <span class="info-message hidden">Drag and drop to choose valid visualizers for the selected node.\r\n                        If changes are persisted you need to navigate away and back to the node for changes to show.\r\n                        The order of the chosen visualizers (from top to bottom) is respected by the UI and the first\r\n                        one  will be activated when the node is navigated to.\r\n                     </span>\r\n                <span>\r\n                </span>\r\n                <div class="visualizers-selection-container">\r\n                    <h5>\r\n                        Available:\r\n                    </h5>\r\n                    <ul id="available" class="connectedSortable">\r\n                    </ul>\r\n                </div>\r\n                <div class="visualizers-selection-container">\r\n                    <h5>\r\n                        Chosen:\r\n                    </h5>\r\n                    <ul id="chosen" class="connectedSortable">\r\n                    </ul>\r\n                </div>\r\n            </div>\r\n            <div class="modal-footer">\r\n                <button class="btn btn-primary btn-ok">OK</button>\r\n                <button class="btn btn-default btn-cancel">Cancel</button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>'}),define("css!js/Dialogs/ValidVisualizers/styles/ValidVisualizersDialog",[],function(){}),define("js/Dialogs/ValidVisualizers/ValidVisualizersDialog",["text!./templates/ValidVisualizersDialog.html","css!./styles/ValidVisualizersDialog.css"],function(e){"use strict";function t(){this._dialog=null,this._okBtn=null,this._cancelBtn=null,this._infoBtn=null,this._infoSpan=null}return t.prototype.show=function(t,n){var i,o=this;this._dialog=$(e),this._infoBtn=this._dialog.find(".toggle-info-btn"),this._infoSpan=this._dialog.find(".info-message"),this._alertDiv=this._dialog.find(".alert"),this._okBtn=this._dialog.find(".btn-ok"),this._cancelBtn=this._dialog.find(".btn-cancel"),this._availableViz=this._dialog.find("#available"),this._chosenViz=this._dialog.find("#chosen"),this.populateLists(WebGMEGlobal.allVisualizers,n?n.split(" "):[]),this._dialog.find("#chosen, #available").sortable({connectWith:".connectedSortable"}).disableSelection(),this._infoBtn.on("click",function(){o._infoSpan.hasClass("hidden")?o._infoSpan.removeClass("hidden"):o._infoSpan.addClass("hidden")}),this._okBtn.on("click",function(e){e.preventDefault(),e.stopPropagation(),i=o.getResult(),o._dialog.modal("hide")}),this._cancelBtn.on("click",function(e){e.preventDefault(),e.stopPropagation(),o._dialog.modal("hide")}),this._dialog.on("hide.bs.modal",function(){o._okBtn.off("click"),o._cancelBtn.off("click"),o._infoBtn.off("click"),o._dialog.remove(),o._dialog.empty(),o._dialog=void 0,t("string"==typeof i?i:n)}),this._dialog.modal("show")},t.prototype.populateLists=function(e,t){var n,i,o,r={};for(o=0;o<e.length;o+=1)r[e[o].id]=e[o];for(o=0;o<t.length;o+=1)n=r[t[o]],n?(delete r[t[o]],n.DEBUG_ONLY?this._chosenViz.append($("<li/>",{"class":"alert alert-warning",text:n.id,title:"Appears as "+n.title+" (only shown in debug mode)."})):this._chosenViz.append($("<li/>",{"class":"alert alert-info",text:n.id,title:"Appears as "+n.title}))):this._chosenViz.append($("<li/>",{"class":"alert alert-danger",text:t[o],title:"No visualizer with id "+t[o]+" available!"}));for(i in r)n=r[i],n.DEBUG_ONLY&&DEBUG?this._availableViz.append($("<li/>",{"class":"alert alert-warning",text:n.id,title:"Appears as "+n.title+" (only shown in debug mode)."})):n.DEBUG_ONLY||this._availableViz.append($("<li/>",{"class":"alert alert-info",text:n.id,title:"Appears as "+n.title}))},t.prototype.getResult=function(){var e=[];return this._chosenViz.children("li").each(function(t,n){e.push($(n).text().trim())}),e.join(" ")},t}),define("js/Panels/PropertyEditor/PropertyEditorPanelController",["js/logger","js/util","js/NodePropertyNames","js/RegistryKeys","js/Constants","assets/line/lineSvgs","js/Utils/GMEConcepts","js/Utils/DisplayFormat","js/Dialogs/DecoratorSVGExplorer/DecoratorSVGExplorerDialog","js/Dialogs/ValidVisualizers/ValidVisualizersDialog","js/Controls/PropertyGrid/PropertyGridWidgets"],function(e,t,n,i,o,r,s,a,l,c,d){"use strict";var h,p="#f89406",g=[i.IS_PORT,i.IS_ABSTRACT,i.VALID_PLUGINS,i.USED_ADDONS,i.VALID_VISUALIZERS,i.VALID_DECORATORS],u="Templating",f=[i.DECORATOR,i.DISPLAY_FORMAT,i.SVG_ICON,i.TREE_ITEM_COLLAPSED_ICON,i.TREE_ITEM_EXPANDED_ICON,i.SVG_ICON,i.PORT_SVG_ICON,i.COLOR,i.TEXT_COLOR,i.BORDER_COLOR,i.LINE_STYLE,i.LINE_START_ARROW,i.LINE_END_ARROW,i.LINE_WIDTH,i.LINE_LABEL_PLACEMENT,i.REPLACEABLE],m=[o.POINTER_BASE];return h=function(t,n,i){this._client=t,this._propertyGrid=n,this._type=i||null,this._logger=e.create("gme:Panels:PropertyEditor:PropertyEditorController",WebGMEGlobal.gmeConfig.client.log),this._propertyGrid.setOrdered(!0),this._propertyGrid.registerWidgetForType("boolean","iCheckBox"),this._initEventHandlers(),this._logger.debug("Created")},h.prototype._initEventHandlers=function(){var e=this;WebGMEGlobal.State.on("change:"+o.STATE_ACTIVE_SELECTION,function(t,n){e._logger.debug("activeSelection changed",n);var i=WebGMEGlobal.State.getActiveObject();n&&n.length>0?e._selectedObjectsChanged(n):e._selectObjectsUsingActiveObject(i)}),WebGMEGlobal.State.on("change:"+o.STATE_ACTIVE_OBJECT,function(t,n){e._logger.debug("active object changed: ",n),e._selectObjectsUsingActiveObject(n)}),this._propertyGrid.onFinishChange(function(t){e._onPropertyChanged(t)}),this._propertyGrid.onReset(function(t){e._onReset(t)})},h.prototype._selectObjectsUsingActiveObject=function(e){e||e===o.PROJECT_ROOT_ID?this._selectedObjectsChanged([e]):this._selectedObjectsChanged([])},h.prototype._selectedObjectsChanged=function(e){var t,n={},i=this;if(this._idList=e,this._territoryId&&this._client.removeUI(this._territoryId),e.length>0){for(t=e.length;t--;)n[e[t]]={children:0};this._territoryId=this._client.addUI(this,function(e){i._logger.debug("about to refresh property list",e),i._refreshPropertyList()}),this._client.updateTerritory(this._territoryId,n)}else this._refreshPropertyList()},h.prototype._refreshPropertyList=function(){var e=this._getCommonPropertiesForSelection(this._idList);this._logger.debug("propList",this._idList,e),this._initializeReadOnlyForSelection(this._idList),this._propertyGrid.setPropertyList(e)},h.prototype._getCommonPropertiesForSelection=function(e){var t,n,r,s,a,l,c,h=this,p={},u=!0,m=[],_={},b={},y={},v={},C={},E=this._client.getNode(o.PROJECT_ROOT_ID),D=null,I=WebGMEGlobal.allDecorators;if(E&&E.getRegistry(i.VALID_DECORATORS)?(D=E.getRegistry(i.VALID_DECORATORS).split(" "),this._logger.debug("validDecorators registered on root-node",D),I=I.filter(function(e){return D.indexOf(e)>-1})):(this._logger.debug("Could not get validDecorators from root-node"),E||this._logger.warn("rootNode was not avaliable")),I.sort(function(e,t){return e.toLowerCase()<t.toLowerCase()?-1:1}),0===e.length)return p;for(r=e.length;--r>=0;)t=this._client.getNode(e[r]),t&&(m.push(t),s=this._getNodeAttributeValues(t),this._buildCommonAttrMeta(C,t,u),this._filterCommon(C,_,s,u),a=this._getNodeRegistryValues(t,f),this._filterCommon(C,b,a,u),l=this._getNodeRegistryValues(t,g),this._filterCommon(C,y,l,u),c=h._getPointerInfo(t),this._filterCommon(C,v,c,u));return 1===e.length&&(p[" ID/Path"]={name:"ID",value:e[0],valueType:"string",isCommon:!0,readOnly:!0},t=h._client.getNode(e[0]),t&&(p[" GUID"]={name:"GUID",value:t.getGuid(),valueType:"string",isCommon:!0,readOnly:!0},t.isLibraryElement()&&(p[" GUIDl"]={name:"GUID (library)",value:t.getLibraryGuid(),valueType:"string",isCommon:!0,readOnly:!0}),n=t.getMetaTypeId(),n&&(p[" Meta Type"]={name:"Meta type",value:n,isCommon:!0,widget:d.META_TYPE_WIDGET,client:h._client}))),(null===h._type||h._type===o.PROPERTY_GROUP_ATTRIBUTES)&&(p[o.PROPERTY_GROUP_ATTRIBUTES]={name:o.PROPERTY_GROUP_ATTRIBUTES,text:o.PROPERTY_GROUP_ATTRIBUTES,value:void 0,isFolder:!0},this._addItemsToResultList(m,C,I,_,o.PROPERTY_GROUP_ATTRIBUTES,p,!0,!1,!1)),(null===h._type||h._type===o.PROPERTY_GROUP_PREFERENCES)&&(p[o.PROPERTY_GROUP_PREFERENCES]={name:o.PROPERTY_GROUP_PREFERENCES,text:o.PROPERTY_GROUP_PREFERENCES,value:void 0,isFolder:!0},v.hasOwnProperty(o.POINTER_CONSTRAINED_BY)&&(b[o.POINTER_CONSTRAINED_BY]=v[o.POINTER_CONSTRAINED_BY],delete v[o.POINTER_CONSTRAINED_BY]),this._addItemsToResultList(m,C,I,b,o.PROPERTY_GROUP_PREFERENCES,p,!1,!0,!1)),(null===h._type||h._type===o.PROPERTY_GROUP_META)&&(p[o.PROPERTY_GROUP_META]={name:o.PROPERTY_GROUP_META,text:o.PROPERTY_GROUP_META,value:void 0,isFolder:!0},this._addItemsToResultList(m,C,I,y,o.PROPERTY_GROUP_META,p,!1,!0,!1)),(null===h._type||h._type===o.PROPERTY_GROUP_POINTERS)&&(p[o.PROPERTY_GROUP_POINTERS]={name:o.PROPERTY_GROUP_POINTERS,text:o.PROPERTY_GROUP_POINTERS,value:void 0,isFolder:!0},this._addItemsToResultList(m,C,I,v,o.PROPERTY_GROUP_POINTERS,p,!1,!1,!0)),p},h.prototype._addItemsToResultList=function(e,t,n,s,a,h,g,f,_){var b,y,v,C,E,D,I,T,P=1===e.length&&e[0].getId()===o.PROJECT_ROOT_ID,N=Object.keys(s);for(""!==a&&(a+="."),C=0;C<N.length;C+=1)y=N[C],y!==o.POINTER_CONSTRAINED_BY&&(g&&t.hasOwnProperty(y)===!1||P&&a===o.PROPERTY_GROUP_PREFERENCES+"."&&y!==i.TREE_ITEM_COLLAPSED_ICON&&y!==i.TREE_ITEM_EXPANDED_ICON||(E=a+y,T=y.split("."),h[E]={name:T[T.length-1],value:s[y].value,valueType:s[y].valueType,options:s[y].options},("position.x"===y||"position.y"===y)&&(h[E].minValue=0,h[E].stepValue=10),(s[y].readOnly===!1||s[y].readOnly===!0)&&(h[E].readOnly=s[y].readOnly),s[y].isCommon===!1&&(h[E].value="",h[E].options={textColor:p}),g===!0?(this._isResettableAttribute(e,T[0])&&(h[E].options=h[E].options||{},h[E].options.resetable=!0),this._isInvalidAttribute(e,T[0])?(h[E].options=h[E].options||{},h[E].options.invalid=!0):this._isInvalidAttributeValue(e,T[0])&&(h[E].options=h[E].options||{},h[E].options.invalidValue=!0),t[y]["enum"]&&t[y]["enum"].length>0&&(h[E].valueItems=t[y]["enum"].slice(0),h[E].valueItems.sort()),("float"===h[E].valueType||"integer"===h[E].valueType)&&(v=this._getAttributeRange(e,T[0]),h[E].minValue=v.min,h[E].maxValue=v.max)):f===!0?(this._isResettableRegistry(e,T[0])&&(h[E].options=h[E].options||{},h[E].options.resetable=!0),a===o.PROPERTY_GROUP_PREFERENCES+"."?y===i.DECORATOR?h[E].valueItems=n:y===i.SVG_ICON||y===i.PORT_SVG_ICON||y===i.TREE_ITEM_COLLAPSED_ICON||y===i.TREE_ITEM_EXPANDED_ICON?(h[E].widget=d.DIALOG_WIDGET,h[E].dialog=l,h[E].value=void 0===h[E].value?"":h[E].value):y===i.COLOR||y===i.BORDER_COLOR||y===i.TEXT_COLOR?h[E].widget=d.COLOR_PICKER:y===i.LINE_STYLE?(h[E].widget=d.SVG_SELECT,h[E].items=r[i.LINE_STYLE],h[E].value=h[E].value||o.LINE_STYLE.PATTERNS.SOLID):y===i.LINE_START_ARROW||y===i.LINE_END_ARROW?(h[E].widget=d.SVG_SELECT,h[E].items=r[i.LINE_END_ARROW],h[E].value=h[E].value||o.LINE_STYLE.LINE_ARROWS.NONE):y===i.LINE_WIDTH?(h[E].widget=d.SVG_SELECT,h[E].items=r[i.LINE_WIDTH],h[E].value=h[E].value||1):y===i.LINE_LABEL_PLACEMENT?(h[E].widget=d.SVG_SELECT,h[E].items=r[i.LINE_LABEL_PLACEMENT],h[E].value=h[E].value||o.LINE_STYLE.LABEL_PLACEMENTS.MIDDLE):y===i.REPLACEABLE?(h[u]={name:u,text:u,value:void 0,isFolder:!0},D=u+"."+y,h[D]=h[E],delete h[E],b=this._canBeReplaceable(e),h[D].value=h[D].value&&b!==!1?!0:!1,h[D].valueType="boolean",b===!1&&(h[D].readOnly=!0,h[D].alwaysReadOnly=!0,h[D].title="Meta nodes or inherited children cannot be templates."),N.indexOf(o.POINTER_CONSTRAINED_BY)>-1&&(I=u+"."+o.POINTER_CONSTRAINED_BY,h[I]={name:o.POINTER_CONSTRAINED_BY,value:s[o.POINTER_CONSTRAINED_BY].value,valueType:s[o.POINTER_CONSTRAINED_BY].valueType,options:s[o.POINTER_CONSTRAINED_BY].options||{},widget:d.POINTER_WIDGET,client:this._client},h[I].options.resetable=this._isResettablePointer(e,o.POINTER_CONSTRAINED_BY),h[I].options.invalid=this._isInvalidPointer(e,o.POINTER_CONSTRAINED_BY),h[D].value!==!1||h[I].options.resetable||h[I].options.invalid||delete h[I])):y===o.POINTER_CONSTRAINED_BY:a===o.PROPERTY_GROUP_META+"."&&(y===i.VALID_VISUALIZERS?(h[E].widget=d.DIALOG_WIDGET,h[E].dialog=c,h[E].value=void 0===h[E].value?"":h[E].value):y===i.VALID_PLUGINS?(h[E].value=void 0===h[E].value?"":h[E].value,h[E].valueItems=WebGMEGlobal.allPlugins,h[E].widget=d.MULTI_SELECT_WIDGET):P&&(y===i.VALID_DECORATORS?(h[E].value=void 0===h[E].value?"":h[E].value,h[E].valueItems=WebGMEGlobal.allDecorators,h[E].widget=d.MULTI_SELECT_WIDGET):y===i.USED_ADDONS&&(h[E].value=void 0===h[E].value?"":h[E].value,h[E].valueItems=WebGMEGlobal.allAddOns,h[E].widget=d.MULTI_SELECT_WIDGET)))):_===!0&&(h[E].options=h[E].options||{},h[E].options.resetable=-1===m.indexOf(T[0])&&this._isResettablePointer(e,T[0]),h[E].options.invalid=this._isInvalidPointer(e,T[0]),h[E].widget=d.POINTER_WIDGET,h[E].client=this._client),h[E]||delete h[E]))},h.prototype._getNodeAttributeValues=function(e){for(var n={},i=_.union(e.getAttributeNames()||[],e.getValidAttributeNames()||[]),o=i.length;--o>=0;)n[i[o]]=e.getAttribute(i[o]);return t.flattenObject(n)},h.prototype._getNodeRegistryValues=function(e,n){for(var i={},o=n.length;--o>=0;)i[n[o]]=e.getRegistry(n[o]);return t.flattenObject(i)},h.prototype._getPointerInfo=function(e){for(var n,i={},r=e.getPointerNames(),s=r.length;s--;)n=e.getPointer(r[s]).to,n=null===n?o.CORE.NULLPTR_RELID:n,i[r[s]]=n||"";return t.flattenObject(i)},h.prototype._isInvalidAttribute=function(e,t){for(var n,i,o=e.length;o--;)if(n=e[o],i=e[o].getValidAttributeNames(),-1!==i.indexOf(t))return!1;return!0},h.prototype._isInvalidAttributeValue=function(e,t){var n,i,o=!1;if(1===e.length&&(i=e[0])){if(n=i.getAttribute(t),"undefined"==typeof n)return!1;try{o=!i.isValidAttributeValueOf(t,n)}catch(r){if(!(r.message.indexOf("Invalid regular expression")>-1))throw r;this._logger.error('Invalid regular expression defined in the meta model for attribute "'+t+'"'),o=!0}}return o},h.prototype._getAttributeRange=function(e,t){for(var n,i,o=e.length,r={};o--;)n=e[o],i=n.getAttributeMeta(t)||{},i.hasOwnProperty("min")&&(r.hasOwnProperty("min")?r.min=i.min>r.min?i.min:r.min:r.min=i.min),i.hasOwnProperty("max")&&(r.hasOwnProperty("max")?r.max=i.max<r.max?i.max:r.max:r.max=i.max);return r},h.prototype._isInvalidPointer=function(e,t){for(var n,i,o=e.length;o--;)if(n=e[o],n&&(i=n.getValidPointerNames(),-1!==i.indexOf(t)||-1!==m.indexOf(t)))return!1;return!0},h.prototype._isResettableRegistry=function(e,t){for(var n,i,o,r,s=e.length;s--;)if(o=e[s]){if(r=this._client.getNode(o.getBaseId()),n=o.getOwnRegistryNames(),i=null===r?[]:r.getRegistryNames(),-1===n.indexOf(t))return!1;if(-1===i.indexOf(t))return!1}return!0},h.prototype._isResettableAttribute=function(e,t){for(var n,i,o,r,s,a=e.length;a--;)if(r=e[a]){if(s=this._client.getNode(r.getBaseId()),i=r.getValidAttributeNames(),o=null===s?[]:s.getValidAttributeNames(),n=r.getOwnAttributeNames(),-1===n.indexOf(t))return!1;if(-1===o.indexOf(t)&&-1!==i.indexOf(t))return!1}return!0},h.prototype._isResettablePointer=function(e,t){for(var n,i,o,r,s,a=e.length;a--;)if(i=e[a]){if(s=this._client.getNode(i.getBaseId()),n=i.getOwnPointerNames(),o=i.getValidPointerNames(),r=null===s?[]:s.getValidPointerNames(),-1===n.indexOf(t))return!1;if(-1===r.indexOf(t)&&-1!==o.indexOf(t))return!1}return!0},h.prototype._canBeReplaceable=function(e){for(var t=e.length;t--;)if(!s.canBeReplaceable(e[t].getId()))return!1;return!0},h.prototype._filterCommon=function(e,t,n,i){var o,r,s;if(i===!0)for(s=Object.keys(n),r=0;r<s.length;r+=1)o=s[r],e.hasOwnProperty(o)?t[o]={value:n[o],valueType:e[o].type,isCommon:!0}:t[o]={value:n[o],valueType:typeof n[o],isCommon:!0};else for(s=Object.keys(t),r=0;r<s.length;r+=1)o=s[r],n.hasOwnProperty(o)?t[o].isCommon&&(t[o].isCommon=t[o].value===n[o]):delete t[o]},h.prototype._buildCommonAttrMeta=function(e,t,n){var i,o,r,s,a,l,c,d,h=_.union(t.getAttributeNames()||[],t.getValidAttributeNames()||[]),p=h.length;for(r=Object.keys(e),s=0;s<r.length;s+=1)-1===h.indexOf(r[s])&&delete e[o];for(;p--;)o=h[p],i=t.getAttributeMeta(o)||{type:"string"},e.hasOwnProperty(o)?(a=!0,i&&e[o].type===i.type?(c=e[o]["enum"]&&e[o]["enum"].length>0,d=i["enum"]&&i["enum"].length>0,c&&d?(l=_.intersection(e[o]["enum"],i["enum"]),l.length!==e[o]["enum"].length&&(0===l.length?a=!1:e[o]["enum"]=l.slice(0))):(c||d)&&(a=!1)):a=!1,a||delete e[o]):n&&i&&(e[o]={},_.extend(e[o],i))},h.prototype._onPropertyChanged=function(e){var t,n,r,s,a,l,c,d=this._idList,h=d.length;if(void 0===e.newValue)return void this._onReset(e.id);for(this._client.startTransaction();--h>=0;)if(l=d[h],t=e.id.split("."),n=void 0,r=void 0,t[0]===o.PROPERTY_GROUP_ATTRIBUTES?(n="setAttribute",r="getEditableAttribute"):t[0]===o.PROPERTY_GROUP_PREFERENCES||t[0]===o.PROPERTY_GROUP_META?(n="setRegistry",r="getEditableRegistry"):t[0]===o.PROPERTY_GROUP_POINTERS?this._client.setPointer(l,t[1],e.newValue):t[0]===u&&(t[1]===i.REPLACEABLE?(n="setRegistry",r="getEditableRegistry"):t[1]===o.POINTER_CONSTRAINED_BY&&this._client.setPointer(l,t[1],e.newValue)),n&&r){if(t.splice(0,1),c=t[0],s=this._client.getNode(l)[r](c),a=s,t.splice(0,1),t.length<1)s=e.newValue;else{for(;t.length>1;)a=a[t[0]],t.splice(0,1);a[t[0]]=e.newValue}this._client[n](l,c,s)}this._client.completeTransaction()},h.prototype._onReset=function(e){var t,n,r,s,a=this._idList,l=a.length;for(this._client.startTransaction();--l>=0;)r=a[l],t=e.split("."),n=void 0,t[0]===o.PROPERTY_GROUP_ATTRIBUTES?n="delAttributes":t[0]===o.PROPERTY_GROUP_PREFERENCES||t[0]===o.PROPERTY_GROUP_META?n="delRegistry":t[0]===o.PROPERTY_GROUP_POINTERS?n="delPointer":t[0]===u&&(t[1]===i.REPLACEABLE?n="delRegistry":t[1]===o.POINTER_CONSTRAINED_BY&&(n="delPointer")),n&&(t.splice(0,1),s=t[0],this._client[n](r,s));this._client.completeTransaction()},h.prototype._initializeReadOnlyForSelection=function(e){var t,n,i=!1;if(this._client.isProjectReadOnly())i=!0;else for(t=0;t<e.length;t+=1)if(n=this._client.getNode(e[t]),n&&(n.isLibraryRoot()||n.isLibraryElement())){i=!0;break}this._propertyGrid.setReadOnly(i),this.setReadOnly(i)},h}),define("js/Panels/PropertyEditor/PropertyEditorPanel",["js/PanelBase/PanelBaseWithHeader","js/Controls/PropertyGrid/PropertyGrid","js/Constants","./PropertyEditorPanelController"],function(e,t,n,i){"use strict";var o,r=e,s="property-editor";return o=function(t,n){var i={};i[e.OPTIONS.LOGGER_INSTANCE_NAME]="PropertyEditorPanel",i[e.OPTIONS.HEADER_TITLE]=!0,r.apply(this,[i]),this._client=n.client,this._initialize(),this.logger.debug("PropertyEditorPanel ctor finished")},_.extend(o.prototype,r.prototype),o.prototype._initialize=function(){var e,o,r=this;this.$el.addClass(s),this.$el.html('<ul class="nav nav-tabs"><li class="active"><a href="#attributes" data-toggle="tab">Attributes</a></li><li class=""><a href="#pointers" data-toggle="tab">Pointers</a></li><li class=""><a href="#meta" data-toggle="tab">Meta</a></li><li class=""><a href="#preferences" data-toggle="tab">Preferences</a></li></ul><div class="tab-content"><div class="tab-pane active" id="attributes">attributes</div><div class="tab-pane" id="pointers">pointers</div><div class="tab-pane" id="meta">meta</div><div class="tab-pane" id="preferences">preferences</div></div>'),this.setTitle("Property Editor"),this.propertyGrids=[],o=new t,this.propertyGrids.push(o),this.$el.find("div#attributes").html(o.$el),e=new i(this._client,o,n.PROPERTY_GROUP_ATTRIBUTES),e.setReadOnly=function(e){r.setReadOnly(e)},o=new t,this.propertyGrids.push(o),this.$el.find("div#pointers").html(o.$el),e=new i(this._client,o,n.PROPERTY_GROUP_POINTERS),e.setReadOnly=function(e){r.setReadOnly(e)},o=new t,this.propertyGrids.push(o),this.$el.find("div#meta").html(o.$el),e=new i(this._client,o,n.PROPERTY_GROUP_META),e.setReadOnly=function(e){r.setReadOnly(e)},o=new t,this.propertyGrids.push(o),this.$el.find("div#preferences").html(o.$el),e=new i(this._client,o,n.PROPERTY_GROUP_PREFERENCES),e.setReadOnly=function(e){r.setReadOnly(e)}},o.prototype.onReadOnlyChanged=function(e){var t;for(r.prototype.onReadOnlyChanged.call(this,e),t=0;t<this.propertyGrids.length;t+=1)this.propertyGrids[t].setReadOnly(e)},o}),define("js/PanelManager/IActivePanel",[],function(){"use strict";var e,t="active-panel";return e=function(){},e.prototype.setActive=function(e){e===!0?(this.$pEl.addClass(t),this.onActivate()):(this.$pEl.removeClass(t),this.onDeactivate())},e.prototype.onActivate=function(){this.logger.warn("IActivePanel.prototype.onActivate IS NOT IMPLEMENTED!!!")},e.prototype.onDeactivate=function(){this.logger.warn("IActivePanel.prototype.onDeactivate IS NOT IMPLEMENTED!!!")},e.prototype.getNodeID=function(){return void this.logger.warn("IActivePanel.prototype.getNodeID IS NOT IMPLEMENTED!!!")},e}),define("js/DragDrop/DragHelper",["./DragConstants","./DragEffects"],function(e,t){"use strict";function n(e,t,n){var i=n;return e&&t&&e.hasOwnProperty(t)&&(i=e[t]),i}function i(t){return n(t,e.DRAG_ITEMS,[])}function o(t){return n(t,e.DRAG_EFFECTS,[])}function r(t){return n(t,e.DRAG_PARAMS,void 0)}return{getDragItems:i,getDragEffects:o,getDragParams:r,DRAG_EFFECTS:t}}),define("js/Widgets/DiagramDesigner/DiagramDesignerWidget.Constants",["js/Constants"],function(e){"use strict";return{SELF:"__SELF__",DESIGNER_ITEM_CLASS:"designer-item",DESIGNER_CONNECTION_CLASS:"designer-connection",CONNECTION_DRAGGABLE_END_CLASS:"c-d-end",CONNECTOR_CLASS:"connector",CONNECTION_END_SRC:"src",CONNECTION_END_DST:"dst",CONNECTION_CONTAINER_SVG_CLASS:"connection-container",PATH_EDIT_SEGMENT_CLASS:"path-edit-segment",PATH_EDIT_SEGMENT_NEW_SEGMENT_POINT_MARKER_CLASS:"new-segment-point-marker",CONNECTION_SEGMENT_POINT_CLASS:"segment-point",SEGMENT_POINT_MOVE_PATH_CLASS:"segment-point-move-path",CONNECTION_SEGMENT_POINT_BEZIER_CONTROL_CLASS:"segment-point-bezier-control",HIGHLIGHT_MODE_CLASS:"highlight-mode",ITEM_HIGHLIGHT_CLASS:"highlighted",DROP_REGION_CLASS:"drop-region",DROP_REGION_ACCEPT_DROPPABLE_CLASS:"accept-droppable",DROP_REGION_REJECT_DROPPABLE_CLASS:"reject-droppable",DATA_ITEM_ID:"data-oid",DATA_SUBCOMPONENT_ID:"data-sid",LINE_WIDTH:e.LINE_STYLE.WIDTH,LINE_COLOR:e.LINE_STYLE.COLOR,LINE_PATTERN:e.LINE_STYLE.PATTERN,LINE_PATTERNS:e.LINE_STYLE.PATTERNS,LINE_TYPE:e.LINE_STYLE.TYPE,LINE_TYPES:e.LINE_STYLE.TYPES,LINE_START_ARROW:e.LINE_STYLE.START_ARROW,LINE_END_ARROW:e.LINE_STYLE.END_ARROW,LINE_POINTS:e.LINE_STYLE.CUSTOM_POINTS,LINE_ARROWS:e.LINE_STYLE.LINE_ARROWS,LINE_LABEL_PLACEMENT:e.LINE_STYLE.LABEL_PLACEMENT,LINE_LABEL_PLACEMENTS:e.LINE_STYLE.LABEL_PLACEMENTS,PATH_SHADOW_ID_PREFIX:"p_",PATH_SHADOW_ARROW_END_ID_PREFIX:"p_e_",ROTATION_RESET:"reset",ROTATION_TOLEFT:"toleft",ROTATION_TORIGHT:"toright",ROTATION_CLEAR:"clear",ALIGN_HORIZON:"ALIGN_HORIZON",ALIGN_VERTICAL:"ALIGN_VERTICAL",MOVE_TO_TOP:"MOVE_TO_TOP",MOVE_TO_BOTTOM:"MOVE_TO_BOTTOM",MOVE_TO_LEFT:"MOVE_TO_LEFT",MOVE_TO_RIGHT:"MOVE_TO_RIGHT",KEY_SHORT_CUT_MOVE_TO_TOP:"shift+up",KEY_SHORT_CUT_MOVE_TO_BOTTOM:"shift+down",KEY_SHORT_CUT_MOVE_TO_LEFT:"shift+left",KEY_SHORT_CUT_MOVE_TO_RIGHT:"shift+right"}}),define("js/Widgets/DiagramDesigner/SelectionManager",["js/logger","js/util","./DiagramDesignerWidget.Constants"],function(e,t,n){"use strict";var i,o=.5,r=15,s=100,a="SelectionManager";i=function(t){var n=t&&t.loggerName||"gme:Widgets:DiagramDesigner:SelectionManager";if(this.logger=t&&t.logger||e.create(n,WebGMEGlobal.gmeConfig.client.log),this._diagramDesigner=t?t.diagramDesigner:null,void 0===this._diagramDesigner||null===this._diagramDesigner)throw this.logger.error("Trying to initialize a SelectionManager without a diagramDesigner..."),"SelectionManager can not be created";this._selectedElements=[],this._rotationEnabled=!0,this._alignEnabled=!0,this._openEnabled=!0,this.logger.debug("SelectionManager ctor finished")},i.prototype.activate=function(){this._activateMouseListeners()},i.prototype.deactivate=function(){this._deactivateMouseListeners(),this._clearSelection()},i.prototype._activateMouseListeners=function(){var e=this;this._diagramDesigner.onItemMouseDown=function(t,n,i){(e._diagramDesigner.mode===e._diagramDesigner.OPERATING_MODES.READ_ONLY||e._diagramDesigner.mode===e._diagramDesigner.OPERATING_MODES.DESIGN)&&e._setSelection([t],e._isMultiSelectionModifierKeyPressed(n),i)},this._diagramDesigner.onConnectionMouseDown=function(t,n){(e._diagramDesigner.mode===e._diagramDesigner.OPERATING_MODES.READ_ONLY||e._diagramDesigner.mode===e._diagramDesigner.OPERATING_MODES.DESIGN)&&e._setSelection([t],e._isMultiSelectionModifierKeyPressed(n))},this._diagramDesigner.onBackgroundMouseDown=function(t){(e._diagramDesigner.mode===e._diagramDesigner.OPERATING_MODES.READ_ONLY||e._diagramDesigner.mode===e._diagramDesigner.OPERATING_MODES.DESIGN)&&e._onBackgroundMouseDown(t)}},i.prototype._deactivateMouseListeners=function(){this._diagramDesigner.onItemMouseDown=void 0,this._diagramDesigner.onConnectionMouseDown=void 0,this._diagramDesigner.onBackgroundMouseDown=void 0},i.prototype.initialize=function(e){var t=this;this.$el=e,this._diagramDesigner.addEventListener(this._diagramDesigner.events.ON_COMPONENT_DELETE,function(e,n){t._onComponentDelete(n)})},i.prototype.getSelectedElements=function(){return this._selectedElements.slice(0)},i.prototype.clear=function(){this._clearSelection()},i.prototype.setSelection=function(e,t){this._setSelection(e,t)},i.prototype.onSelectionCommandClicked=function(e,t){this.logger.warn('SelectionManager.prototype.onSelectionCommandClicked IS NOT OVERRIDDEN IN HOST COMPONENT.  command: "'+e+'", selectedIds: '+t)},i.prototype.onSelectionChanged=function(e){this.logger.warn("SelectionManager.prototype.onSelectionChanged IS NOT OVERRIDDEN IN HOST COMPONENT. selectedIDs: "+e)},i.prototype._isMultiSelectionModifierKeyPressed=function(e){return e.ctrlKey||e.metaKey;
},i.prototype._onBackgroundMouseDown=function(e){var t={mX:e.mouseX,mY:e.mouseY},n=this,i=e.rightClick!==!0;this.logger.debug("SelectionManager._onBackgroundMouseDown at: "+JSON.stringify(t)),i===!0&&(this._rubberbandSelection={x:t.mX,y:t.mY,x2:t.mX,y2:t.mY,addToExistingSelection:this._isMultiSelectionModifierKeyPressed(e)},this._rubberbandSelection.addToExistingSelection!==!0&&this._clearSelection(),this.$rubberBand=this._createRubberBand(),this.$el.append(this.$rubberBand),this._diagramDesigner.trackMouseMoveMouseUp(function(e){n._onBackgroundMouseMove(e)},function(e){n._onBackgroundMouseUp(e)}))};var l=$("<div/>",{"class":"rubberband"});i.prototype._createRubberBand=function(){var e=l.clone();return e.css({display:"none",position:"absolute"}),e},i.prototype._onBackgroundMouseMove=function(e){var t={mX:e.mouseX,mY:e.mouseY};this._rubberbandSelection&&(this._rubberbandSelection.x2=t.mX,this._rubberbandSelection.y2=t.mY,this._drawSelectionRubberBand())},i.prototype._onBackgroundMouseUp=function(e){var t,n={mX:e.mouseX,mY:e.mouseY};this._rubberbandSelection&&(this._rubberbandSelection.x2=n.mX,this._rubberbandSelection.y2=n.mY,this._drawSelectionRubberBand(),t={addToExistingSelection:this._rubberbandSelection.addToExistingSelection,x:Math.min(this._rubberbandSelection.x,this._rubberbandSelection.x2),x2:Math.max(this._rubberbandSelection.x,this._rubberbandSelection.x2),y:Math.min(this._rubberbandSelection.y,this._rubberbandSelection.y2),y2:Math.max(this._rubberbandSelection.y,this._rubberbandSelection.y2)},this._selectItemsByRubberBand(t),this.$rubberBand.remove(),this.$rubberBand=null,delete this._rubberbandSelection)},i.prototype._drawSelectionRubberBand=function(){var e=2,t=Math.min(this._rubberbandSelection.x,this._rubberbandSelection.x2),n=Math.max(this._rubberbandSelection.x,this._rubberbandSelection.x2),i=Math.min(this._rubberbandSelection.y,this._rubberbandSelection.y2),o=Math.max(this._rubberbandSelection.y,this._rubberbandSelection.y2);e>n-t||e>o-i?this.$rubberBand.hide():this.$rubberBand.show(),this.$rubberBand.css({left:t,top:i,width:n-t,height:o-i})},i.prototype._selectItemsByRubberBand=function(e){var n,i,r={x:e.x,y:e.y,x2:e.x2,y2:e.y2},s=[],a=this._diagramDesigner.items,l=10;if(!(r.x2-r.x<l||r.y2-r.y<l)){this.logger.debug("Select children by rubber band: ["+r.x+","+r.y+"], ["+r.x2+","+r.y2+"]"),i=function(e){var n,i;return e&&t.overlap(r,e)&&(n={x:Math.max(e.x,r.x),y:Math.max(e.y,r.y),x2:Math.min(e.x2,r.x2),y2:Math.min(e.y2,r.y2)},i=(n.x2-n.x)*(n.y2-n.y)/((e.x2-e.x)*(e.y2-e.y)),i>o)?!0:!1};for(n in a)a.hasOwnProperty(n)&&i(a[n].getBoundingBox())&&s.push(n);this._setSelection(s,e.addToExistingSelection)}},i.prototype._clearSelection=function(){for(var e,t,n=this._selectedElements.length,i=this._diagramDesigner.items,o=!1;n--;)e=this._selectedElements[n],t=i[e],t&&$.isFunction(t.onDeselect)&&t.onDeselect(),o=!0;this._selectedElements=[],this.hideSelectionOutline(),o&&this.onSelectionChanged(this._selectedElements)},i.prototype._setSelection=function(e,t,n){var i,o,r,s=this,a=e.length,l=this._diagramDesigner.items,c=!1,d=a,h=function(t){e.indexOf(t.id)>-1&&0===--d&&s.showSelectionOutline()};if(this.logger.debug("setSelection: "+e+", addToExistingSelection: "+t),a>0&&!n)if(t===!0){for(i=this._selectedElements.length;i--;)o=l[this._selectedElements[i]],$.isFunction(o.onDeselect)&&o.onDeselect(),$.isFunction(o.onSelect)&&o.onSelect(!0,h);for(i=e.length,a=e.length+this._selectedElements.length;i--;)if(r=e[i],-1===this._selectedElements.indexOf(r))this._selectedElements.push(r),o=l[r],$.isFunction(o.onSelect)&&o.onSelect(a>1,h),c=!0;else{var p=this._selectedElements.indexOf(r);this._selectedElements.splice(p,1),o=l[r],$.isFunction(o.onDeselect)&&o.onDeselect(),c=!0}1===this._selectedElements.length&&(o=l[this._selectedElements[0]],$.isFunction(o.onSelect)&&o.onSelect(!1,h))}else if(e.length>1)for(this._clearSelection(),c=!0,i=e.length;i--;)r=e[i],o=l[r],this._selectedElements.push(r),$.isFunction(o.onSelect)&&o.onSelect(!0,h);else r=e[0],-1===this._selectedElements.indexOf(r)&&(this._clearSelection(),this._selectedElements.push(r),o=l[r],$.isFunction(o.onSelect)&&o.onSelect(!1,h),c=!0);this.logger.debug("selected elements: "+this._selectedElements),c&&this.onSelectionChanged(this._selectedElements)},i.prototype._onComponentDelete=function(e){var t,n=!1;t=this._selectedElements.indexOf(e),-1!==t&&(this._selectedElements.splice(t,1),n=!0),n&&this.onSelectionChanged(this._selectedElements)};var c=$("<div/>",{"class":"selection-outline"});i.prototype.showSelectionOutline=function(){var e=this._getSelectionBoundingBox(),t=this._diagramDesigner._actualSize.w,n=this._diagramDesigner._actualSize.h;e&&e.hasOwnProperty("x")?(e.x-=r,e.y-=r,e.x2+=r,e.y2+=r,e.x<0&&(e.x=0),e.y<0&&(e.y=0),e.x2>t&&(e.x2=t),e.y2>n&&(e.y2=n),e.w=e.x2-e.x,e.h=e.y2-e.y,e.w<s&&(e.x-=(s-e.w)/2,e.x2+=(s-e.w)/2,e.w=e.x2-e.x),this._diagramDesigner.skinParts.$selectionOutline?this._diagramDesigner.skinParts.$selectionOutline.empty():(this._diagramDesigner.skinParts.$selectionOutline=c.clone(),this._diagramDesigner.skinParts.$itemsContainer.prepend(this._diagramDesigner.skinParts.$selectionOutline)),this._diagramDesigner.skinParts.$selectionOutline.css({left:e.x,top:e.y,width:e.w,height:e.h}),this._renderSelectionActions()):this.hideSelectionOutline()},i.prototype.hideSelectionOutline=function(){this._diagramDesigner.skinParts.$selectionOutline&&(this._diagramDesigner.skinParts.$selectionOutline.empty(),this._diagramDesigner.skinParts.$selectionOutline.remove(),this._diagramDesigner.skinParts.$selectionOutline=null)},i.prototype._getSelectionBoundingBox=function(){for(var e,t,n,i=this._selectedElements.length,o=this._diagramDesigner.items;i--;)t=this._selectedElements[i],o[t]&&(e||(e={x:this._diagramDesigner._actualSize.w,y:this._diagramDesigner._actualSize.h,x2:0,y2:0}),n=o[t].getBoundingBox(),n.x<e.x&&(e.x=n.x),n.y<e.y&&(e.y=n.y),n.x2>e.x2&&(e.x2=n.x2),n.y2>e.y2&&(e.y2=n.y2));return e};var d=$("<div/>",{"class":"s-btn delete",command:"delete"});d.html('<i class="glyphicon glyphicon-remove" title="Delete"></i>');var h=$("<div/>",{"class":"s-btn contextmenu",command:"contextmenu"});h.html('<i class="glyphicon glyphicon-list" title="Action Menu"></i>');var p=$("<div/>",{"class":"s-btn move",command:"move"});p.html('<i class="glyphicon glyphicon-move"></i>');var g=$("<div/>",{"class":"s-btn open",command:"open"});g.html('<i class="glyphicon glyphicon-circle-arrow-down" title="Open"></i>');var u=$("<div/>",{"class":"s-btn align",command:"align"});u.html('<i class="glyphicon glyphicon-th" title="Align Menu"></i>'),i.prototype._renderSelectionActions=function(){var e,t,n,i,o=this;this._diagramDesigner.getIsReadOnlyMode()!==!0&&(e=d.clone(),this._diagramDesigner.skinParts.$selectionOutline.append(e),this._alignEnabled===!0&&(i=u.clone(),this._diagramDesigner.skinParts.$selectionOutline.append(i))),this._openBtnEnabled===!0&&1===this._selectedElements.length&&(t=g.clone(),this._diagramDesigner.skinParts.$selectionOutline.append(t)),n=h.clone(),this._diagramDesigner.skinParts.$selectionOutline.append(n),this._diagramDesigner.skinParts.$selectionOutline.off("mousedown").off("click",".s-btn"),this._diagramDesigner.skinParts.$selectionOutline.on("mousedown",function(e){e.stopPropagation()}).on("click",".s-btn",function(e){var t=$(this).attr("command");o.logger.debug('Selection button clicked with command: "'+t+'"'),o.onSelectionCommandClicked(t,o._selectedElements,e),e.stopPropagation(),e.preventDefault()}),this._renderRotateHandlers()};var f=$("<div/>",{"class":"s-btn rotate bottom"});f.html('<i class="glyphicon glyphicon-repeat"><div class="popover right nowrap rotate-options"><div class="arrow"></div><div class="popover-content narrow"><div class="btn-group"><a class="btn btn-small" id="rotate-left" title="Rotate left by 90°"><i class="glyphicon glyphicon-repeat flip-vertical" id="icon-rotate-left"></i></a><a class="btn  btn-small" id="rotate-right" title="Rotate right by 90°"><i class="glyphicon glyphicon-repeat" id="icon-rotate-right"></i></a><a class="btn btn-small" id="rotate-toleft" title="Rotate left to the closest multiple of 90°"><i class="glyphicon glyphicon-retweet flip-vertical" id="icon-rotate-toleft"></i></a><a class="btn  btn-small" id="rotate-toright" title="Rotate right to the closest multiple of 90°"><i class="glyphicon glyphicon-retweet" id="icon-rotate-toright"></i></a><a class="btn  btn-small" id="rotate-reset" title="Set rotation to 0°"><i class="glyphicon glyphicon-minus" id="icon-rotate-reset"></i></a><a class="btn  btn-small" id="rotate-clear" title="Clear rotation information - reset to inherited"><i class="glyphicon glyphicon-remove" id="icon-rotate-clear"></i></a></div></div></div></i>');var m=$("<div/>",{"class":"rotation-deg"});return i.prototype._renderRotateHandlers=function(){var e,t=this,i=!this._diagramDesigner.getIsReadOnlyMode()&&this._rotationEnabled;i&&(e=f.clone(),this._rotationDegree=m.clone(),this._diagramDesigner.skinParts.$selectionOutline.append(e),this._diagramDesigner.skinParts.$selectionOutline.append(this._rotationDegree),this._diagramDesigner.skinParts.$selectionOutline.off("mousedown."+a,".rotate"),this._diagramDesigner.skinParts.$selectionOutline.on("mousedown."+a,".rotate",function(e){var n=$(this);void 0===$(e.target).attr("id")&&(t.logger.debug("selection rotate button mousedown"),t._startSelectionRotate(n,e),e.stopPropagation(),e.preventDefault())}),e.hover(function(){e.find(".popover").show()},function(){e.find(".popover").hide()}),e.on("click",".btn",function(e){var i=$(this).attr("id"),o=0;switch(i.replace("rotate-","")){case"left":o=-90;break;case"right":o=90;break;case n.ROTATION_RESET:o=n.ROTATION_RESET;break;case n.ROTATION_TOLEFT:o=n.ROTATION_TOLEFT;break;case n.ROTATION_TORIGHT:o=n.ROTATION_TORIGHT;break;case n.ROTATION_CLEAR:o=n.ROTATION_CLEAR}t._rotateSelectionBy(o),e.stopPropagation(),e.preventDefault()}))},i.prototype._startSelectionRotate=function(e,t){var n=this._diagramDesigner.getAdjustedMousePos(t),i=this,o=1===t.which;o&&(this._rotateDesc={startX:n.mX,startY:n.mY,oX:parseInt(this._diagramDesigner.skinParts.$selectionOutline.css("left"),10)+parseInt(this._diagramDesigner.skinParts.$selectionOutline.css("width"),10)/2,oY:parseInt(this._diagramDesigner.skinParts.$selectionOutline.css("top"),10)+parseInt(this._diagramDesigner.skinParts.$selectionOutline.css("height"),10)/2,horizontal:e.hasClass("top")},this._rotateAngle=0,$(document).on("mousemove.rotate."+a,function(e){i._onSelectionRotate(e)}),$(document).on("mouseup.rotate."+a,function(e){$(document).off("mousemove.rotate."+a),$(document).off("mouseup.rotate."+a),i._endSelectionRotate(e)}))},i.prototype._onSelectionRotate=function(e){var t=this._diagramDesigner.getAdjustedMousePos(e),n=t.mX-this._rotateDesc.startX,i=t.mY-this._rotateDesc.startY,o=e.shiftKey?10:e.ctrlKey||e.metaKey?45:0,r=this._getRotationDegree(this._rotateDesc.horizontal?n:i,o);this._rotateAngle=r,this._rotationDegree.html((r>=0?"+":"")+r+"&deg;"),this._diagramDesigner.skinParts.$selectionOutline.css({"transform-origin":"50% 50%",transform:"rotate("+r+"deg)"})},i.prototype._endSelectionRotate=function(){this._rotationDegree.html(""),this._diagramDesigner.skinParts.$selectionOutline.css({"transform-origin":"50% 50%",transform:"rotate(0deg)"}),this._rotateSelectionBy(this._rotateAngle)},i.prototype._rotateSelectionBy=function(e){for(var t=[],n=this._selectedElements.length;n--;)-1!==this._diagramDesigner.itemIds.indexOf(this._selectedElements[n])&&t.push(this._selectedElements[n]);t.length>0&&this.onSelectionRotated(e,t)},i.prototype._getRotationDegree=function(e,t){var n=t?Math.round(e/t)*t:e;return Math.floor(n%360)},i.prototype.onSelectionRotated=function(e,t){this.logger.warn('SelectionManager.prototype.onSelectionRotated IS NOT OVERRIDDEN IN HOST COMPONENT. deg: "'+e+'"deg, selectedIds: '+t)},i.prototype.enableRotation=function(e){this._rotationEnabled!==e&&(this._rotationEnabled=e)},i.prototype.enableAlign=function(e){this._alignEnabled!==e&&(this._alignEnabled=e)},i.prototype.enableOpenButton=function(e){this._openBtnEnabled!==e&&(this._openBtnEnabled=e)},i}),define("js/Widgets/DiagramDesigner/DragScroll",["jquery","js/logger"],function(e,t){"use strict";var n;return n=function(e){this._logger=t.create("gme:Widgets:DiagramDesigner:DragScroll",WebGMEGlobal.gmeConfig.client.log),this._containerNode=e},n._SCROLL_STEP=25,n._INTERVAL=50,n.prototype.start=function(){var e=this;this._getContainerBoundaries(),this._onMouseMoveCallBack=function(t){e._onMouseMove(t)},this._onMouseUpCallBack=function(){e._onMouseUp()},$(document).on("mousemove.DragScroll",this._onMouseMoveCallBack),$(document).on("mouseup.DragScroll",this._onMouseUpCallBack)},n.prototype._onMouseUp=function(){$(document).off("mousemove.DragScroll",this._onMouseMoveCallBack),$(document).off("mouseup.DragScroll",this._onMouseUpCallBack),delete this._onMouseMoveCallBack,delete this._onMouseUpCallBack,this._stopScroll()},n.prototype._onMouseMove=function(e){this._isInContainerBounds(e.pageX,e.pageY)?(this._logger.debug("onMouseMove - INSIDE ContainerBounds"),this._stopScroll()):(this._logger.debug("onMouseMove - outside ContainerBounds"),this._scrollDelta=this._calculateScrollDelta(e.pageX,e.pageY),this._startScroll())},n.prototype._startScroll=function(){var e=this;void 0===this._timer&&(this._timer=window.setTimeout(function(){e._doScroll()},n._INTERVAL))},n.prototype._stopScroll=function(){this._timer&&(window.clearTimeout(this._timer),this._timer=void 0)},n.prototype._getContainerBoundaries=function(){var e=this._containerNode.offset();this._containerBoundaries={left:e.left,top:e.top,width:this._containerNode.width(),height:this._containerNode.height()},this._logger.debug("_containerBoundaries: "+JSON.stringify(this._containerBoundaries))},n.prototype._isInContainerBounds=function(e,t){return this._containerBoundaries.left<=e&&this._containerBoundaries.left+this._containerBoundaries.width>=e&&this._containerBoundaries.top<=t&&this._containerBoundaries.top+this._containerBoundaries.height>=t},n.prototype._calculateScrollDelta=function(e,t){var i=0,o=0;return e<this._containerBoundaries.left?i=-n._SCROLL_STEP:e>this._containerBoundaries.left+this._containerBoundaries.width&&(i=n._SCROLL_STEP),t<this._containerBoundaries.top?o=-n._SCROLL_STEP:t>this._containerBoundaries.top+this._containerBoundaries.height&&(o=n._SCROLL_STEP),{x:i,y:o}},n.prototype._doScroll=function(){var e,t;this._logger.debug("doScroll - "+JSON.stringify(this._scrollDelta)),this._timer=void 0,this._scrollDelta&&(0!==this._scrollDelta.x||0!==this._scrollDelta.y?(e=this._containerNode[0].scrollTop,t=this._containerNode[0].scrollLeft,this._containerNode[0].scrollTop+=this._scrollDelta.y,this._containerNode[0].scrollLeft+=this._scrollDelta.x,(0===this._containerNode[0].scrollTop||this._containerNode[0].scrollTop<e+this._scrollDelta.y)&&(this._scrollDelta.y=0),(0===this._containerNode[0].scrollLeft||this._containerNode[0].scrollLeft<t+this._scrollDelta.x)&&(this._scrollDelta.x=0),this._startScroll()):(this._scrollDelta=void 0,this._stopScroll()))},n}),define("js/Widgets/DiagramDesigner/DragManager.Native",["js/logger","js/Widgets/DiagramDesigner/DragScroll","js/Widgets/DiagramDesigner/DiagramDesignerWidget.Constants"],function(e,t,n){"use strict";var i,o="move",r="copy",s=10,a="DragManager",l="mousedown."+a,c="mousemove."+a,d="mouseup."+a;return i=function(t){var n=t&&t.loggerName||"gme:Widgets:DiagramDesigner:DragManager";if(this.logger=t&&t.logger||e.create(n,WebGMEGlobal.gmeConfig.client.log),this._diagramDesigner=t?t.diagramDesigner:null,void 0===this._diagramDesigner||null===this._diagramDesigner)throw this.logger.error("Trying to initialize a DragManager without a canvas..."),"DragManager can not be created";this.logger.debug("DragManager ctor finished")},i.prototype.DRAGMODE_COPY="copy",i.prototype.DRAGMODE_MOVE="move",i.prototype.initialize=function(e){var n=this;this._dragModes={},this.$el=e,this._dragModes[this.DRAGMODE_COPY]=!0,this._dragModes[this.DRAGMODE_MOVE]=!0,this._diagramDesigner.addEventListener(this._diagramDesigner.events.ITEM_POSITION_CHANGED,function(e,t){n._canvasItemPositionChanged(t)}),this._dragScroll=new t(this.$el.parent()),this._diagramDesigner.addEventListener(this._diagramDesigner.events.ON_COMPONENT_DELETE,function(e,t){n._onComponentDelete(t)})},i.prototype.activate=function(){this._activateMouseListeners()},i.prototype.deactivate=function(){this._deactivateMouseListeners()},i.prototype._activateMouseListeners=function(){var e=this;this.$el.on(l,"div."+n.DESIGNER_ITEM_CLASS,function(t){e._onItemMouseDown(t)})},i.prototype._deactivateMouseListeners=function(){this.$el.off(l,"div."+n.DESIGNER_ITEM_CLASS)},i.prototype.enableMode=function(e,t){this._dragModes[e]&&(this._dragModes[e]=t)},i.prototype._onItemMouseDown=function(e){var t=this._diagramDesigner.getAdjustedMousePos(e),n=this,i=1===e.which,o=!this._diagramDesigner.getIsReadOnlyMode();o&&i&&(this.logger.debug("DragManager._onItemMouseDown at: "+JSON.stringify(t)),this._diagramDesigner.mode===this._diagramDesigner.OPERATING_MODES.DESIGN&&(this._initDrag(t.mX,t.mY),this._onBackgroundMouseMoveCallBack=function(e){n._onBackgroundMouseMove(e)},this._onBackgroundMouseUpCallBack=function(e){n._onBackgroundMouseUp(e)},$(document).on(c,this._onBackgroundMouseMoveCallBack),$(document).on(d,this._onBackgroundMouseUpCallBack)),e.stopPropagation(),e.preventDefault())},i.prototype._initDrag=function(e,t){var n=!this._diagramDesigner.getIsReadOnlyMode();n&&this._diagramDesigner.mode===this._diagramDesigner.OPERATING_MODES.DESIGN&&(this._dragDesc={startX:e,startY:t,dX:0,dY:0,params:void 0,mode:void 0,dragging:!1})},i.prototype._onBackgroundMouseMove=function(e){var t=this._diagramDesigner.getAdjustedMousePos(e),n=t.mX-this._dragDesc.startX,i=t.mY-this._dragDesc.startY;t.mX<=0&&t.mX<=0||(this._dragDesc.dragging===!0?(this.logger.debug("already dragging, handle dragged item reposition"),this._doDrag(e)):(Math.abs(n)>=s||Math.abs(i)>=s)&&(this.logger.debug("Mouse delta reached the minimum to handle as a drag"),this._startDrag(e),this._dragScroll.start()))},i.prototype._onBackgroundMouseUp=function(e){$(document).off(c,this._onBackgroundMouseMoveCallBack),$(document).off(d,this._onBackgroundMouseUpCallBack),delete this._onBackgroundMouseMoveCallBack,delete this._onBackgroundMouseUpCallBack,this.logger.debug("DragManager._onBackgroundMouseUp"),this._dragDesc.dragging===!0&&this._endDrag(e),this._dragDesc=void 0},i.prototype._startDrag=function(e){var t=e&&(e.ctrlKey||e.metaKey),n=e&&e.shiftKey,i=this.DRAGMODE_MOVE;this.logger.debug("_startDrag called"),t&&!n&&this._dragModes[this.DRAGMODE_COPY]===!0&&(i=this.DRAGMODE_COPY),this._dragDesc.mode=i,this._dragDesc.params={draggedItemIDs:[],draggedConnectionIDs:[],minStartCoordinates:{x:void 0,y:void 0},originalPositions:[],modeSpecificData:void 0},this._dragDesc.mode===this.DRAGMODE_MOVE?this._startDragModeMove():this._dragDesc.mode===this.DRAGMODE_COPY&&this._startDragModeCopy(),this._calculateMinStartCoordinates(),this._diagramDesigner.onDesignerItemDragStart(void 0,this._dragDesc.params.draggedItemIDs),this._dragDesc.dragging=!0},i.prototype._startDragModeMove=function(){for(var e,t,n=this._diagramDesigner.selectionManager.getSelectedElements(),i=this._diagramDesigner.items,r=this._diagramDesigner.itemIds,s=n.length;s--;)e=n[s],t=i[e],-1!==r.indexOf(e)&&this._diagramDesigner.onDragStartDesignerItemDraggable(e)===!0&&(this._dragDesc.params.draggedItemIDs.push(e),this._dragDesc.params.originalPositions.push({x:t.positionX,y:t.positionY}));this.$el.css("cursor",o)},i.prototype._startDragModeCopy=function(){var e,t,n,i,o,s=this._diagramDesigner.selectionManager.getSelectedElements(),a=this._diagramDesigner.items,l=this._diagramDesigner.itemIds,c=this._diagramDesigner.connectionIds,d=s.length,h=[];for(this._dragDesc.params.modeSpecificData=o={},this._diagramDesigner.beginUpdate();d--;)e=s[d],-1!==l.indexOf(e)&&this._diagramDesigner.onDragStartDesignerItemCopyable(e)===!0&&(i={},t=a[e],i.position={x:t.positionX,y:t.positionY},i.decoratorClass=t._decoratorClass,i.control=t._decoratorInstance.getControl(),i.metaInfo=t._decoratorInstance.getMetaInfo(),n=this._diagramDesigner.createDesignerItem(i),n.moveTo(t.positionX,t.positionY),this._dragDesc.params.draggedItemIDs.push(n.id),this._dragDesc.params.originalPositions.push({x:n.positionX,y:n.positionY}),o[e]={copiedItemId:n.id},h.push(n.id));for(d=s.length;d--;)if(e=s[d],-1!==c.indexOf(e)&&this._diagramDesigner.onDragStartDesignerConnectionCopyable(e)===!0){var p=a[e],g=this._diagramDesigner.connectionEndIDs[e].srcObjId,u=this._diagramDesigner.connectionEndIDs[e].srcSubCompId,f=this._diagramDesigner.connectionEndIDs[e].dstObjId,m=this._diagramDesigner.connectionEndIDs[e].dstSubCompId;-1!==s.indexOf(g)&&(g=o[g].copiedItemId),-1!==s.indexOf(f)&&(f=o[f].copiedItemId),i=_.extend({},p.getConnectionProps()),i.srcObjId=g,i.srcSubCompId=u,i.dstObjId=f,i.dstSubCompId=m;var b=this._diagramDesigner.createConnection(i);this._dragDesc.params.draggedConnectionIDs.push(b.id),o[e]={copiedConnectionId:b.id},h.push(b.id)}this._diagramDesigner.endUpdate(),this._diagramDesigner.selectionManager._clearSelection(),this._diagramDesigner.selectionManager.setSelection(h,!1),this.$el.css("cursor",r)},i.prototype._doDrag=function(e){var t=this._griddedMouseDelta(e);this._updateDraggedItemPositions(t.dX,t.dY)},i.prototype._endDrag=function(e){var t=this._griddedMouseDelta(e);this._updateDraggedItemPositions(t.dX,t.dY),this._endDragAction()},i.prototype._endDragAction=function(){var e=this._dragDesc.params.draggedItemIDs;this._dragDesc.mode===this.DRAGMODE_MOVE?this._endDragModeMove():this._dragDesc.mode===this.DRAGMODE_COPY&&this._endDragModeCopy(),this._diagramDesigner.onDesignerItemDragStop(void 0,e),this.$el.css("cursor","")},i.prototype._endDragModeMove=function(){var e,t,n=this._dragDesc.params.draggedItemIDs,i=n.length,o=this._diagramDesigner.items,r={};if(n.length>0&&(0!==this._dragDesc.dX||0!==this._dragDesc.dY)){for(;i--;)e=n[i],t=o[e],r[e]={x:t.positionX,y:t.positionY};this._dragDesc=void 0,this._diagramDesigner.onDesignerItemsMove(r)}},i.prototype._endDragModeCopy=function(){var e,t,n=this._dragDesc.params.draggedItemIDs,i=this._dragDesc.params.modeSpecificData,o={items:{},connections:{}};if(n.length>0){for(e in i)i.hasOwnProperty(e)&&(t=i[e],t.hasOwnProperty("copiedItemId")?o.items[t.copiedItemId]={oItemId:e,posX:this._diagramDesigner.items[t.copiedItemId].positionX,posY:this._diagramDesigner.items[t.copiedItemId].positionY}:t.hasOwnProperty("copiedConnectionId")&&(o.connections[t.copiedConnectionId]={oConnectionId:e}));this._dragDesc=void 0}},i.prototype._updateDraggedItemPositions=function(e,t){var n=this._diagramDesigner.gridSize;(e!==this._dragDesc.dX||t!==this._dragDesc.dY)&&(this._dragDesc.dX=e,this._dragDesc.dY=t,this.logger.debug("DragManager._updateDraggedItemPositions [dx,dy]: "+e+","+t),this._dragDesc.params.minStartCoordinates.x+e<n&&(this.logger.debug("dX cleared out otherwise item's position would be negative"),e=n-this._dragDesc.params.minStartCoordinates.x),this._dragDesc.params.minStartCoordinates.y+t<n&&(this.logger.debug("dY cleared out otherwise item's position would be negative"),t=n-this._dragDesc.params.minStartCoordinates.y),this._moveDraggedComponentsBy(e,t),this._diagramDesigner.onDesignerItemDrag(void 0,this._dragDesc.params.draggedItemIDs))},i.prototype._moveDraggedComponentsBy=function(e,t){var n,i,o,r=this._dragDesc.params.draggedItemIDs.length;for(this._movingDraggedComponents=!0;r--;)n=this._dragDesc.params.draggedItemIDs[r],i=this._dragDesc.params.originalPositions[r].x+e,o=this._dragDesc.params.originalPositions[r].y+t,this._diagramDesigner.items[n].moveTo(i,o);this._movingDraggedComponents=!1},i.prototype._griddedMouseDelta=function(e){var t=this._diagramDesigner.getAdjustedMousePos(e),n=t.mX-this._dragDesc.startX,i=t.mY-this._dragDesc.startY,o=this._diagramDesigner.gridSize,r=n-n%o,s=i-i%o;return{dX:r,dY:s}},i.prototype._calculateMinStartCoordinates=function(){var e;if(this._dragDesc)for(e=this._dragDesc.params.originalPositions.length,this._dragDesc.params.minStartCoordinates.x=void 0,this._dragDesc.params.minStartCoordinates.y=void 0;e--;)this._dragDesc.params.minStartCoordinates.x?this._dragDesc.params.minStartCoordinates.x=Math.min(this._dragDesc.params.minStartCoordinates.x,this._dragDesc.params.originalPositions[e].x):this._dragDesc.params.minStartCoordinates.x=this._dragDesc.params.originalPositions[e].x,this._dragDesc.params.minStartCoordinates.y?this._dragDesc.params.minStartCoordinates.y=Math.min(this._dragDesc.params.minStartCoordinates.y,this._dragDesc.params.originalPositions[e].y):this._dragDesc.params.minStartCoordinates.y=this._dragDesc.params.originalPositions[e].y},i.prototype._onComponentDelete=function(e){var t,n,i,o=!1;if(this._dragDesc){switch(i=this._dragDesc.params.modeSpecificData,this._dragDesc.mode){case this.DRAGMODE_MOVE:t=this._dragDesc.params.draggedItemIDs.indexOf(e),-1!==t&&(this.logger.debug("One of the currently moved items is being deleted: "+e),this._dragDesc.params.draggedItemIDs.splice(t,1),this._dragDesc.params.originalPositions.splice(t,1),o=!0);break;case this.DRAGMODE_COPY:i.hasOwnProperty(e)&&(this.logger.debug("One of the currently copied items is being deleted: "+e),n=i[e].copiedItemId||i[e].copiedConnectionId,delete i[e],t=this._dragDesc.params.draggedItemIDs.indexOf(n),-1!==t&&(this._dragDesc.params.draggedItemIDs.splice(t,1),this._dragDesc.params.originalPositions.splice(t,1),o=!0),t=this._dragDesc.params.draggedConnectionIDs.indexOf(n),-1!==t&&this._dragDesc.params.draggedConnectionIDs.splice(t,1),this._diagramDesigner.deleteComponent(n))}o===!0&&this._calculateMinStartCoordinates(),this._dragDesc&&this._dragDesc.params&&0===this._dragDesc.params.draggedItemIDs.length&&this._cancelDrag()}},i.prototype._cancelDrag=function(){this.logger.debug("Cancelling drag artificially..."),this.$el.trigger("mouseup")},i.prototype._canvasItemPositionChanged=function(e){var t,n,i=e.ID,o=e.x,r=e.y;this._movingDraggedComponents!==!0&&this._dragDesc&&this._dragDesc.params&&this._dragDesc.params.draggedItemIDs&&(t=this._dragDesc.params.draggedItemIDs.indexOf(i),-1!==t&&(n=this._dragDesc.params.originalPositions[t],(o!==n.x+this._dragDesc.dX||r!==n.y+this._dragDesc.dY)&&(n.x=o,n.y=r,o=n.x+this._dragDesc.dX,r=n.y+this._dragDesc.dY,this._movingDraggedComponents=!0,this._diagramDesigner.items[i].moveTo(o,r),this._movingDraggedComponents=!1)))},i}),define("js/Widgets/DiagramDesigner/DiagramDesignerWidget.OperatingModes",[],function(){"use strict";var e;return e=function(){},e.prototype.OPERATING_MODES={READ_ONLY:0,DESIGN:1,HIGHLIGHT:2},e}),define("js/Decorators/WidgetDecoratorBase",["js/logger"],function(e){"use strict";var t,n="WidgetDecoratorBase";return t=function(t){this.logger=t.logger||e.create("gme:Decorators:"+this.DECORATORID,WebGMEGlobal.gmeConfig.client.log),this.preferencesHelper=t.preferencesHelper,this.decoratorParams={},_.extend(this.decoratorParams,this.DECORATOR_DEFAULT_PARAMS,t.decoratorParams)},t.prototype.DECORATORID=n,t.prototype.DECORATOR_DEFAULT_PARAMS={},t}),define("css!js/Widgets/DiagramDesigner/styles/DiagramDesignerWidget.DecoratorBase.ConnectionArea",[],function(){}),define("js/Widgets/DiagramDesigner/DiagramDesignerWidget.DecoratorBase.ConnectionArea",["js/Constants","js/RegistryKeys","raphaeljs","css!./styles/DiagramDesignerWidget.DecoratorBase.ConnectionArea.css"],function(e,t){"use strict";var n,i="DiagramDesignerWidgetDecoratorBaseConnectionArea",o="decorator-edit",r="conn-area-edit",s="conn-area-edit-bg",a="disabled",l="CONN_AREA_ID",c=8,d=t.DIAGRAM_DESIGNER_WIDGET_DECORATOR_DISABLED_CONNECTION_AREAS;return n=function(){},n.prototype._initializeConnectionAreaUserSelection=function(){var e=this;this.$el.on("mousedown."+i,function(t){var n=3===t.which;n&&e._editConnectionAreas()===!0&&(t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation())})},n.prototype._editConnectionAreas=function(){var e,t=this.$el.outerWidth(!0),n=this.$el.outerHeight(!0),d=this,h=c/2;if(this.hostDesignerItem.canvas.getIsReadOnlyMode()===!0)return!1;if(0===this.getConnectionAreas().length)return!1;this._connAreaEditBackground=$("<div/>",{"class":s}),this._connAreaEditBackground.css({left:-h+"px",top:-h+"px"}),this.$el.addClass(o),this._decoratorItem=this.$el.parent(),this._decoratorItem.append(this._connAreaEditBackground),this._connAreaEditBackground.on("mouseup mouseenter mouseleave dblclick",function(e){e.stopPropagation()}),this._connAreaEditBackground.on("mousedown",function(e){e.stopPropagation();var t=3===e.which;t&&d._endEditConnectionAreas()}),this._connAreaEditBackground.on("mousedown."+i,"path."+r,function(e){var t=$(this).attr("class");t===r?$(this).attr({"class":r+" "+a}):$(this).attr({"class":r}),e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation()}),this._svg=Raphael(this._connAreaEditBackground[0],t+c,n+c),this._svg.canvas.className.baseVal=s,this._areas=this.getConnectionAreas();var p=this._getDisabledConnectionAreas();for(e=this._areas.length;e--;){var g=this._areas[e];g.x1+=h,g.y1+=h,g.x2+=h,g.y2+=h,Math.abs(g.x2-g.x1)<c&&Math.abs(g.y2-g.y1)<c&&(g.x2>g.x1?(g.x1-=c/2,g.x2+=c/2):(g.x2-=c/2,g.x1+=c/2));var u=this._svg.path("M "+g.x1+","+g.y1+"L"+g.x2+","+g.y2);$(u.node).data(l,g.id),u.attr({"stroke-width":c}),-1!==p.indexOf(g.id)?$(u.node).attr({"class":r+" "+a}):$(u.node).attr({"class":r})}return!0},n.prototype._endEditConnectionAreas=function(){var e=this._connAreaEditBackground.find("path."+r),t=this.logger,n=[];e.each(function(e,i){i=$(i);var o=i.data(l),s=i.attr("class")===r;t.debug('Connection area: "'+o+'" enabled: '+s),s||n.push(o)}),e.length>0&&e.length!==n.length&&(this.$el.removeClass(o),this._connAreaEditBackground.remove(),this._setDisabledConnectionAreas(n))},n.prototype._getDisabledConnectionAreas=function(){var t=this._metaInfo[e.GME_ID],n=this.DECORATORID,i=[],o=d+n,r=this.preferencesHelper.getRegistry(t,o,!0)||[];return r&&(i=r.slice(0)),i},n.prototype._setDisabledConnectionAreas=function(t){var n=this._metaInfo[e.GME_ID],i=this.DECORATORID,o=d+i;0===t.length?this.preferencesHelper.delRegistry(n,o):this.preferencesHelper.setRegistry(n,o,t.slice(0))},n}),define("js/Widgets/DiagramDesigner/DiagramDesignerWidget.DecoratorBase",["js/Decorators/WidgetDecoratorBase","./DiagramDesignerWidget.Constants","./DiagramDesignerWidget.DecoratorBase.ConnectionArea"],function(e,t,n){"use strict";var i,o="DiagramDesignerWidgetDecoratorBase";return i=function(t){e.call(this,t),this.hostDesignerItem=t.host,this.skinParts={},this.$sourceConnectors=null,this.$endConnectors=null,this._initialize(),this.logger.debug("Created")},_.extend(i.prototype,e.prototype),_.extend(i.prototype,n.prototype),i.prototype.DECORATORID=o,i.prototype.setControl=function(e){this._control=e},i.prototype.getControl=function(){return this._control},i.prototype.setMetaInfo=function(e){this._metaInfo=e},i.prototype.getMetaInfo=function(){return this._metaInfo},i.prototype.$DOMBase=$(""),i.prototype._initialize=function(){this.$el=this.$DOMBase.clone(),this.initializeConnectors(),this._initializeConnectionAreaUserSelection()},i.prototype.initializeConnectors=function(){this.$sourceConnectors=this.$el.find("."+t.CONNECTOR_CLASS),this.$endConnectors=this.$sourceConnectors,this.hostDesignerItem?this.hostDesignerItem.registerConnectors(this.$sourceConnectors):this.logger.error("Decorator's hostDesignerItem is not set"),this.hideSourceConnectors()},i.prototype.showSourceConnectors=function(e){this.logger.debug("showSourceConnectors: "+JSON.stringify(e)),this.$sourceConnectors.appendTo(this.$el)},i.prototype.hideSourceConnectors=function(){this.$sourceConnectors.detach()},i.prototype.showEndConnectors=function(e){this.logger.debug("showEndConnectors: "+JSON.stringify(e)),this.$endConnectors.appendTo(this.$el)},i.prototype.hideEndConnectors=function(){this.$endConnectors.detach()},i.prototype.on_addTo=function(){},
i.prototype.onRenderGetLayoutInfo=function(){this.calculateDimension(),this.renderLayoutInfo={}},i.prototype.onRenderSetLayoutInfo=function(){delete this.renderLayoutInfo},i.prototype.calculateDimension=function(){this.hostDesignerItem&&this.hostDesignerItem.setSize(this.$el.outerWidth(!0),this.$el.outerHeight(!0))},i.prototype.getConnectionAreas=function(){var e=[];return e.push({id:"0",x1:this.hostDesignerItem.getWidth()/2,y1:this.hostDesignerItem.getHeight()/2,x2:this.hostDesignerItem.getWidth()/2,y2:this.hostDesignerItem.getHeight()/2,angle1:270,angle2:270,len:10}),e},i.prototype.destroy=function(){this.logger.debug("DiagramDesignerWidgetDecoratorBase.destroyed")},i.prototype.onMouseEnter=function(){return!1},i.prototype.onMouseLeave=function(){return!1},i.prototype.onMouseDown=function(){return!1},i.prototype.onMouseUp=function(){return!1},i.prototype.onSelect=function(){return!1},i.prototype.onDeselect=function(){return!1},i.prototype.onDoubleClick=function(){return!1},i.prototype.update=function(){},i.prototype.updateSubcomponent=function(){},i.prototype.readOnlyMode=function(){},i.prototype.getConnectorMetaInfo=function(){return void 0},i.prototype.doSearch=function(){return!1},i.prototype.getDrawnConnectionVisualStyle=function(){return null},i.prototype.getTerritoryQuery=function(){return void 0},i.prototype.notifyComponentEvent=function(e){this.logger.warn("notifyComponentEvent not overridden in decorator"+JSON.stringify(e))},i}),define("js/Widgets/DiagramDesigner/ErrorDecorator",["js/Widgets/DiagramDesigner/DiagramDesignerWidget.DecoratorBase"],function(e){"use strict";var t,n=e,i=e.prototype,o="ErrorDecorator";return t=function(e){var t=_.extend({},e);n.apply(this,[t]),this.name="",this.logger.debug("ErrorDecorator ctor")},_.extend(t.prototype,i),t.prototype.DECORATORID=o,t.prototype.$DOMBase=$('<div class="error-decorator"><i class="glyphicon glyphicon-warning-sign"></i></div>'),t.prototype.on_addTo=function(){this._renderContent(),i.on_addTo.apply(this,arguments)},t.prototype._renderContent=function(){this.$el.append(this._metaInfo.__missingdecorator__),this.$el.attr("title",'Could not initialize decorator "'+this._metaInfo.__missingdecorator__+'"')},t}),define("js/Widgets/DiagramDesigner/DesignerItem",["js/logger","./DiagramDesignerWidget.Constants","./ErrorDecorator"],function(e,t,n){"use strict";var i,o="DesignerItem",r="hover",s="selectable";return i=function(t,n){this.id=t,this.canvas=n,this.__initialize(),this.logger=e.create("gme:Widgets:DiagramDesigner:DesignerItem_"+this.id,WebGMEGlobal.gmeConfig.client.log),this.logger.debug("Created")},i.prototype.__initialize=function(){this._decoratorInstance=null,this._decoratorClass=null,this._decoratorID="",this.selected=!1,this.selectedInMultiSelection=!1,this.positionX=0,this.positionY=0,this.rotation=0,this._width=0,this._height=0,this._initializeUI()},i.prototype.__setDecorator=function(e,t,i,o,r,s,a){void 0===t&&(o=o||{},o.__missingdecorator__=e,t=n),this._decoratorID!==t.prototype.DECORATORID&&(this._decoratorInstance&&(this._callDecoratorMethod("destroy"),this.$el.empty()),this._decoratorID=t.prototype.DECORATORID,this._decoratorClass=t,this._decoratorInstance=new t({host:this,preferencesHelper:r,aspect:s,decoratorParams:a}),this._decoratorInstance.setControl(i),this._decoratorInstance.setMetaInfo(o))},i.prototype.$_DOMBase=$("<div/>").attr({"class":t.DESIGNER_ITEM_CLASS}),i.prototype._initializeUI=function(){this.$el=this.$_DOMBase.clone(),this.$el.attr({id:this.id}),this.$el.css({position:"absolute",left:this.positionX,top:this.positionY}),this._attachUserInteractions(),this.canvas._makeDraggable(this)},i.prototype._attachUserInteractions=function(){var e,t=this;this._events={mouseenter:{fn:"onMouseEnter",stopPropagation:!0,preventDefault:!0,enabledInReadOnlyMode:!0},mouseleave:{fn:"onMouseLeave",stopPropagation:!0,preventDefault:!0,enabledInReadOnlyMode:!0},dblclick:{fn:"onDoubleClick",stopPropagation:!0,preventDefault:!0,enabledInReadOnlyMode:!0}};for(e in this._events)this._events.hasOwnProperty(e)&&this.$el.on(e+"."+o,null,null,function(e){var n=t._events[e.type],i=!1,o=!0;(t.canvas.mode===t.canvas.OPERATING_MODES.READ_ONLY||t.canvas.mode===t.canvas.OPERATING_MODES.DESIGN)&&n&&(t.canvas.mode===t.canvas.OPERATING_MODES.READ_ONLY&&(o=n.enabledInReadOnlyMode),o&&(i=t._callDecoratorMethod(n.fn,e),i!==!0&&(i=t[n.fn].call(t,e)),i!==!0&&(n.stopPropagation===!0&&e.stopPropagation(),n.preventDefault===!0&&e.preventDefault())))})},i.prototype._detachUserInteractions=function(){var e;for(e in this._events)this._events.hasOwnProperty(e)&&this.$el.off(e+"."+o)},i.prototype.addToDocFragment=function(e){this._callDecoratorMethod("on_addTo"),this.$el.append(this._decoratorInstance.$el),e.appendChild(this.$el[0]),this.logger.debug('DesignerItem with id:"'+this.id+'" added to canvas.')},i.prototype.renderGetLayoutInfo=function(){this._callDecoratorMethod("onRenderGetLayoutInfo")},i.prototype.renderSetLayoutInfo=function(){this._callDecoratorMethod("onRenderSetLayoutInfo")},i.prototype._remove=function(){this._containerElement=null,this.$el.remove(),this.$el.empty(),this._detachUserInteractions(),this.$el=null},i.prototype.destroy=function(){this._destroying=!0,this.canvas._destroyDraggable(this),this._callDecoratorMethod("destroy"),this.canvas.unregisterAllSubcomponents(this.id),this._remove(),this.logger.debug("Destroyed")},i.prototype.getBoundingBox=function(){var e={x:this.positionX,y:this.positionY,width:this._width,height:this._height,x2:this.positionX+this._width,y2:this.positionY+this._height};if(0!==this.rotation){var t=this._rotatePoint(0,0),n=this._rotatePoint(this._width,0),i=this._rotatePoint(0,this._height),o=this._rotatePoint(this._width,this._height),r=Math.min(t.x,n.x,i.x,o.x),s=Math.max(t.x,n.x,i.x,o.x),a=Math.min(t.y,n.y,i.y,o.y),l=Math.max(t.y,n.y,i.y,o.y);e.x=this.positionX+r,e.y=this.positionY+a,e.x2=this.positionX+s,e.y2=this.positionY+l,e.width=e.x2-e.x,e.height=e.y2-e.y}return e},i.prototype.onMouseEnter=function(){var e=[];return this.logger.debug("onMouseEnter: "+this.id),e.push(r),e.push(s),this.$el.addClass(e.join(" ")),this.canvas.mode===this.canvas.OPERATING_MODES.DESIGN&&this.canvas.connectionDrawingManager.isDrawInProgress()===!1&&this.selectedInMultiSelection===!1&&this.showSourceConnectors(),!1},i.prototype.onMouseLeave=function(){var e=[r,s];return this.logger.debug("onMouseLeave: "+this.id),this.$el.removeClass(e.join(" ")),this.canvas.connectionDrawingManager.isDrawInProgress()!==!0&&this.hideSourceConnectors(),!1},i.prototype.onDoubleClick=function(e){this.canvas.onDesignerItemDoubleClick(this.id,e)},i.prototype.onSelect=function(e,t){this.selected=!0,this.selectedInMultiSelection=e,this.$el.addClass("selected"),e===!0&&this.hideSourceConnectors(),this._callDecoratorMethod("onSelect"),t(this)},i.prototype.onDeselect=function(){this.selected=!1,this.selectedInMultiSelection=!1,this.$el.removeClass("selected"),this._callDecoratorMethod("onDeselect")},i.prototype._callDecoratorMethod=function(e,t){var n=null;return this._decoratorInstance?_.isFunction(this._decoratorInstance[e])?n=this._decoratorInstance[e].apply(this._decoratorInstance,t):this.logger.warn('DecoratorInstance "'+$.type(this._decoratorInstance)+'" does not have a method with name "'+e+'"...'):this.logger.error("DecoratorInstance does not exist..."),n},i.prototype.update=function(e){if(e.position&&_.isNumber(e.position.x)&&_.isNumber(e.position.y)&&this.moveTo(e.position.x,e.position.y),_.isNumber(e.rotation)&&this.rotateTo(e.rotation),e.decoratorClass&&this._decoratorID!==e.decoratorClass.prototype.DECORATORID){this.logger.debug('decorator update: "'+this._decoratorID+'" --> "'+e.decoratorClass.prototype.DECORATORID+'"...');var t=this._decoratorInstance.getControl(),n=this._decoratorInstance.getMetaInfo();this.__setDecorator(e.decorator,e.decoratorClass,t,n,e.preferencesHelper,e.aspect,e.decoratorParams),this.$el.html(this._decoratorInstance.$el),this.logger.debug("DesignerItem's [\""+this.id+'"] decorator  has been updated.'),this._callDecoratorMethod("on_addTo")}else e.metaInfo&&this._decoratorInstance.setMetaInfo(e.metaInfo),this._decoratorInstance.update()},i.prototype.getConnectionAreas=function(e,t,n){for(var i,o,r,s=[],a=this._decoratorInstance.getConnectionAreas(e,t,n),l=this._decoratorInstance._getDisabledConnectionAreas(),c=a.length;c--;)o=a[c],r=!0,(void 0===e||null===e||e===this.id)&&(r=-1===l.indexOf(o.id)),r&&(0===this.rotation?(o.x1+=this.positionX,o.y1+=this.positionY,o.x2+=this.positionX,o.y2+=this.positionY):(i=this._rotatePoint(o.x1,o.y1),o.x1=i.x+this.positionX,o.y1=i.y+this.positionY,i=this._rotatePoint(o.x2,o.y2),o.x2=i.x+this.positionX,o.y2=i.y+this.positionY,o.angle1=(o.angle1+this.rotation)%360,o.angle2=(o.angle2+this.rotation)%360),s.push(o));return s},i.prototype.moveTo=function(e,t){var n=!1;_.isNumber(e)&&_.isNumber(t)&&(this.positionX!==e&&(this.positionX=e,n=!0),this.positionY!==t&&(this.positionY=t,n=!0),n&&(this.$el.css({left:this.positionX,top:this.positionY}),this.canvas.dispatchEvent(this.canvas.events.ITEM_POSITION_CHANGED,{ID:this.id,x:this.positionX,y:this.positionY})))},i.prototype.registerSubcomponent=function(e,t){this.logger.debug('registerSubcomponent - ID: "'+this.id+'", SubComponentID: "'+e+'"'),this.canvas.registerSubcomponent(this.id,e,t)},i.prototype.unregisterSubcomponent=function(e){this.logger.debug('unregisterSubcomponent - ID: "'+this.id+'", SubComponentID: "'+e+'"'),this.canvas.unregisterSubcomponent(this.id,e)},i.prototype.registerConnectors=function(e,n){e.attr(t.DATA_ITEM_ID,this.id),void 0!==n&&null!==n&&e.attr(t.DATA_SUBCOMPONENT_ID,n)},i.prototype.updateSubcomponent=function(e){this._decoratorInstance.updateSubcomponent(e)},i.prototype.readOnlyMode=function(e){this._decoratorInstance.readOnlyMode(e)},i.prototype.showSourceConnectors=function(e){this.canvas._enableConnectionDrawing===!0&&this._decoratorInstance.showSourceConnectors(e)},i.prototype.hideSourceConnectors=function(){this._decoratorInstance.hideSourceConnectors()},i.prototype.showEndConnectors=function(e){this.canvas._enableConnectionDrawing===!0&&this._decoratorInstance.showEndConnectors(e)},i.prototype.hideEndConnectors=function(){this._decoratorInstance.hideEndConnectors()},i.prototype.highlight=function(){this.$el.addClass(t.ITEM_HIGHLIGHT_CLASS)},i.prototype.unHighlight=function(){this.$el.removeClass(t.ITEM_HIGHLIGHT_CLASS)},i.prototype.rotateTo=function(e){_.isNumber(e)&&this.rotation!==e&&(this.rotation=e,this.$el.css({"transform-origin":"50% 50%",transform:"rotate("+this.rotation+"deg)"}),this.canvas.dispatchEvent(this.canvas.events.ITEM_ROTATION_CHANGED,{ID:this.id,deg:this.rotation}))},i.prototype._rotatePoint=function(e,t){var n=(this.rotation<0?360+this.rotation:this.rotation)%360,i=n*(Math.PI/180),o=Math.sin(i),r=Math.cos(i),s=e-this._width/2,a=t-this._height/2,l=s*r-a*o,c=s*o+a*r;return{x:l+this._width/2,y:c+this._height/2}},i.prototype.doSearch=function(e){return this._decoratorInstance.doSearch(e)},i.prototype.getDrawnConnectionVisualStyle=function(e){return this._decoratorInstance.getDrawnConnectionVisualStyle(e)},i.prototype.onItemComponentEvents=function(e){this._decoratorInstance.notifyComponentEvent(e)},i.prototype.getWidth=function(){return this._width},i.prototype.getHeight=function(){return this._height},i.prototype.setSize=function(e,t){var n=!1;_.isNumber(e)&&_.isNumber(t)&&(this._width!==e&&(this._width=e,n=!0),this._height!==t&&(this._height=t,n=!0),n===!0&&this.canvas.dispatchEvent(this.canvas.events.ITEM_SIZE_CHANGED,{ID:this.id,w:this._width,h:this._height}))},i}),define("js/Widgets/DiagramDesigner/DiagramDesignerWidget.DesignerItems",["js/Widgets/DiagramDesigner/DesignerItem"],function(e){"use strict";var t;return t=function(){},t.prototype.createDesignerItem=function(t){var n,i=this._getGuid("I_"),o=_.extend({},t),r=this._alignPositionToGrid(o.position.x,o.position.y);return this.logger.debug('Creating model component with id: "'+i+'"'),o.designerCanvas=this,o.position.x=r.x,o.position.y=r.y,o.guid=i,this._checkPositionOverlap(i,o),this.itemIds.push(i),this._insertedDesignerItemIDs.push(i),n=this.items[i]=new e(i,this),n.moveTo(o.position.x,o.position.y),n.rotateTo(o.rotation),n.__setDecorator(o.decorator,o.decoratorClass,o.control,o.metaInfo,o.preferencesHelper,o.aspect,o.decoratorParams),n.addToDocFragment(this._documentFragment),n},t.prototype.updateDesignerItem=function(e,t){var n;-1!==this.itemIds.indexOf(e)&&(this.logger.debug("Updating model component with parameters: "+t),t.position&&_.isNumber(t.position.x)&&_.isNumber(t.position.y)&&(n=this._alignPositionToGrid(t.position.x,t.position.y),t.position.x=n.x,t.position.y=n.y,this._checkPositionOverlap(e,t)),this._updatedDesignerItemIDs.push(e),this.items[e].update(t))},t.prototype.updateDesignerItemSubComponent=function(e,t){-1!==this.itemIds.indexOf(e)&&(this.logger.debug("Updating model component's ["+e+"] subcomponent: "+t),this._updatedDesignerItemIDs.push(e),this.items[e].updateSubcomponent(t))},t.prototype.deleteDesignerItem=function(e){var t;this.logger.debug('Deleting DesignerItem with ID: "'+e+'"'),this._deletedDesignerItemIDs.push(e),t=this.itemIds.indexOf(e),this.itemIds.splice(t,1),this.items[e].destroy(),delete this.items[e]},t.prototype.onDesignerItemDoubleClick=function(e,t){this.logger.debug('DesignerItem "'+e+'" received double click at pos: ['+t.offsetX+", "+t.offsetY+"]")},t.prototype.notifyItemComponentEvents=function(e,t){-1!==this.itemIds.indexOf(e)&&(this._updatedDesignerItemIDs.push(e),this.items[e].onItemComponentEvents(t))},t}),define("js/Widgets/DiagramDesigner/Connection.EditSegment",["js/Widgets/DiagramDesigner/DiagramDesignerWidget.Constants","raphaeljs"],function(e){"use strict";var t,n=5;return t=function(e){this.id=e.id,this.connection=e.connection,this.points=e.points,this.svgPaper=this.connection.paper,this.path=void 0,this.width=Math.max(n,this.connection.designerAttributes.width),this._render()},t.prototype.destroy=function(){this.path&&(this.path.remove(),this.path=void 0),this.circle&&(this.circle.remove(),this.circle=void 0)},t.prototype._render=function(){var t,n=this.points,i=n.length,o=[];for(t=0;i>t;t+=1)0===t?o.push("M"+n[t][0]+","+n[t][1]):this.connection.isBezier?o.push("C"+(n[t-1][0]+n[t-1][2])+","+(n[t-1][1]+n[t-1][3])+" "+(n[t][0]-n[t][2])+","+(n[t][1]-n[t][3])+" "+n[t][0]+","+n[t][1]):o.push("L"+n[t][0]+","+n[t][1]);this.pathDef=o.join(" "),this.path=this.svgPaper.path(this.pathDef),this.path.attr({"stroke-width":this.width}),this.path.node.setAttribute("class",e.PATH_EDIT_SEGMENT_CLASS),this._initMouseHandlers()},t.prototype._initMouseHandlers=function(){var t=this;this.circle=this.svgPaper.circle(0,0,this.width).hide(),this.circle.node.setAttribute("class",e.PATH_EDIT_SEGMENT_NEW_SEGMENT_POINT_MARKER_CLASS),this.path.mouseover(function(e){t.circle&&t.circle.show(),e.stopPropagation(),e.preventDefault()}),this.path.mouseout(function(e){t.circle&&t.circle.hide(),e.stopPropagation(),e.preventDefault()}),this.path.mousemove(function(e){var n=t._getMousePos(e),i=t._getSelectedPathPoint(n.mX,n.mY);i&&t.circle.attr({cx:i.x,cy:i.y}),e.stopPropagation(),e.preventDefault()}),this.path.mousedown(function(e){e.stopPropagation()}),this.path.dblclick(function(e){var n=t._getMousePos(e),i=t._getSelectedPathPoint(n.mX,n.mY);if(i)if(t.connection.isBezier){var o=Raphael.findDotsAtSegment(i.bez[0],i.bez[1],i.bez[2],i.bez[3],i.bez[4],i.bez[5],i.bez[6],i.bez[7],i.t),r=o.n.x-i.x,s=o.n.y-i.y;t.connection.addSegmentPoint(t.id,i.x,i.y,r,s)}else t.connection.addSegmentPoint(t.id,i.x,i.y,0,0);e.stopPropagation(),e.preventDefault()})},t.prototype._getMousePos=function(e){return this.connection.diagramDesigner.getAdjustedMousePos(e)},t.prototype._getSelectedPathPoint=function(e,t){var n,i=this.width+2,o=["M",e-i,t,"L",e+i,t].join(","),r=["M",e,t-i,"L",e,t+i].join(","),s=Raphael.pathIntersection(this.pathDef,o),a=Raphael.pathIntersection(this.pathDef,r),l=1e3,c=1e3;return s.length>0&&(l=Math.abs(e-s[0].x)+Math.abs(t-s[0].y)),a.length>0&&(c=Math.abs(e-a[0].x)+Math.abs(t-a[0].y)),c>l?s.length>0&&(n={x:s[0].x,y:s[0].y,t:s[0].t1,bez:s[0].bez1}):a.length>0&&(n={x:a[0].x,y:a[0].y,t:a[0].t1,bez:a[0].bez1}),n},t}),define("js/Widgets/DiagramDesigner/Connection.SegmentPoint",["js/Widgets/DiagramDesigner/DiagramDesignerWidget.Constants","raphaeljs"],function(e){"use strict";var t,n=5,i="ConnectionSegmentPoint",o="mousemove."+i,r="mouseup."+i,s="segment-point",a="control-point",l=10,c="-",d=10,h=1;return t=function(e){this.id=e.id,this.connection=e.connection,this.point=e.point,this.pointAfter=e.pointAfter,this.pointBefore=e.pointBefore,this.svgPaper=this.connection.paper,this.isBezier=this.connection.isBezier,this.width=Math.max(n,this.connection.designerAttributes.width),this._render()},t.prototype.destroy=function(){this._moving===!0&&(this._detachMouseListeners(),this._removeRedrawPath()),this.circle&&(this.circle.remove(),this.circle=void 0),this.isBezier&&(this.cpLine.remove(),this.cpLine=void 0,this.cpBeforeCircle.remove(),this.cpBeforeCircle=void 0,this.cpAfterCircle.remove(),this.cpAfterCircle=void 0)},t.prototype._render=function(){this.isBezier&&(this.cpLine=this.svgPaper.path("M"+(this.point[0]-this.point[2])+","+(this.point[1]-this.point[3])+" L"+(this.point[0]+this.point[2])+","+(this.point[1]+this.point[3]))),this.circle=this.svgPaper.circle(this.point[0],this.point[1],this.width),this.circle.node.setAttribute("class",e.CONNECTION_SEGMENT_POINT_CLASS),this.isBezier&&(this.cpBeforeCircle=this.svgPaper.circle(this.point[0]-this.point[2],this.point[1]-this.point[3],this.width-h),this.cpAfterCircle=this.svgPaper.circle(this.point[0]+this.point[2],this.point[1]+this.point[3],this.width-h),this.cpBeforeCircle.node.setAttribute("class",e.CONNECTION_SEGMENT_POINT_BEZIER_CONTROL_CLASS),this.cpAfterCircle.node.setAttribute("class",e.CONNECTION_SEGMENT_POINT_BEZIER_CONTROL_CLASS)),this._initMouseHandlers()},t.prototype._initMouseHandlers=function(){var e=this;this.circle.mousedown(function(t){var n=e._getMousePos(t);e._startSegmentPointMove(n),e._attachMouseListeners(),t.stopPropagation()}),this.circle.dblclick(function(t){e.connection.removeSegmentPoint(e.id),t.stopPropagation(),t.preventDefault()}),this.isBezier&&(this.cpBeforeCircle.mousedown(function(t){var n=e._getMousePos(t);e._startBezierControlPointMove(n,!0),e._attachBezierControlPointMouseListeners(),t.stopPropagation()}),this.cpAfterCircle.mousedown(function(t){var n=e._getMousePos(t);e._startBezierControlPointMove(n,!1),e._attachBezierControlPointMouseListeners(),t.stopPropagation()}))},t.prototype._getMousePos=function(e){return this.connection.diagramDesigner.getAdjustedMousePos(e)},t.prototype._attachMouseListeners=function(){var e=this;$(document).on(o,function(t){e._onMouseMove(t),t.stopPropagation(),t.preventDefault()}),$(document).on(r,function(t){e._onMouseUp(t),t.stopPropagation(),t.preventDefault()})},t.prototype._detachMouseListeners=function(){$(document).off(o),$(document).off(r)},t.prototype._startSegmentPointMove=function(e){this._startPos=e,this._moveType=s,this._moving=!1},t.prototype._onMouseMove=function(e){var t,n=this._getMousePos(e),i=n.mX-this._startPos.mX,o=n.mY-this._startPos.mY;this._moving!==!0&&(Math.abs(i)>=l||Math.abs(o)>=l)&&(this._moving=!0),this._moving===!0&&(t=this._snapCoordinate([n.mX,n.mY]),this.point[0]=t[0],this.point[1]=t[1],this.circle.attr({cx:this.point[0],cy:this.point[1]}),this.isBezier&&(this.cpLine.attr({path:"M"+(this.point[0]-this.point[2])+","+(this.point[1]-this.point[3])+" L"+(this.point[0]+this.point[2])+","+(this.point[1]+this.point[3])}),this.cpBeforeCircle.attr({cx:this.point[0]-this.point[2],cy:this.point[1]-this.point[3]}),this.cpAfterCircle.attr({cx:this.point[0]+this.point[2],cy:this.point[1]+this.point[3]})),this._redrawMovePath())},t.prototype._onMouseUp=function(e){var t,n=this._getMousePos(e);this._detachMouseListeners(),this._moving===!0&&(this._moveType===s?(t=this._snapCoordinate([n.mX,n.mY]),this.connection.setSegmentPoint(this.id,t[0],t[1],this.point[2],this.point[3])):this._moveType===a&&this.connection.setSegmentPoint(this.id,this.point[0],this.point[1],this.point[2],this.point[3])),this._removeRedrawPath(),this._moving=!1,this._moveType=void 0},t.prototype._removeRedrawPath=function(){this._movePath&&(this._movePath.remove(),this._movePath=void 0)},t.prototype._snapCoordinate=function(e){var t=e[0],n=e[1];return Math.abs(this.pointBefore[0]-t)<d&&(t=this.pointBefore[0]),Math.abs(this.pointBefore[1]-n)<d&&(n=this.pointBefore[1]),Math.abs(this.pointAfter[0]-t)<d&&(t=this.pointAfter[0]),Math.abs(this.pointAfter[1]-n)<d&&(n=this.pointAfter[1]),[t,n]},t.prototype._startBezierControlPointMove=function(e,t){this._startPos=e,this._moveType=a,this._bezierControlBefore=t,this._moving=!1},t.prototype._attachBezierControlPointMouseListeners=function(){var e=this;$(document).on(o,function(t){e._onBezierControlPointMouseMove(t),t.stopPropagation(),t.preventDefault()}),$(document).on(r,function(t){e._onMouseUp(t),t.stopPropagation(),t.preventDefault()})},t.prototype._onBezierControlPointMouseMove=function(e){var t=this._getMousePos(e),n=t.mX-this._startPos.mX,i=t.mY-this._startPos.mY;this._moving!==!0&&(Math.abs(n)>=l||Math.abs(i)>=l)&&(this._moving=!0),this._moving===!0&&(this._bezierControlBefore?(this.point[2]=this.point[0]-t.mX,this.point[3]=this.point[1]-t.mY):(this.point[2]=t.mX-this.point[0],this.point[3]=t.mY-this.point[1]),Math.abs(this.point[2])<d&&(this.point[2]=0),Math.abs(this.point[3])<d&&(this.point[3]=0),this.cpLine.attr({path:"M"+(this.point[0]-this.point[2])+","+(this.point[1]-this.point[3])+" L"+(this.point[0]+this.point[2])+","+(this.point[1]+this.point[3])}),this.cpBeforeCircle.attr({cx:this.point[0]-this.point[2],cy:this.point[1]-this.point[3]}),this.cpAfterCircle.attr({cx:this.point[0]+this.point[2],cy:this.point[1]+this.point[3]}),this._redrawMovePath())},t.prototype._redrawMovePath=function(){var t=[];this.isBezier?(t.push("M"+this.pointBefore[0]+","+this.pointBefore[1]),t.push("C"+(this.pointBefore[0]+this.pointBefore[2])+","+(this.pointBefore[1]+this.pointBefore[3])+" "+(this.point[0]-this.point[2])+","+(this.point[1]-this.point[3])+" "+this.point[0]+","+this.point[1]),t.push("C"+(this.point[0]+this.point[2])+","+(this.point[1]+this.point[3])+" "+(this.pointAfter[0]-this.pointAfter[2])+","+(this.pointAfter[1]-this.pointAfter[3])+" "+this.pointAfter[0]+","+this.pointAfter[1])):(t.push("M"+this.pointBefore[0]+","+this.pointBefore[1]),t.push("L"+this.point[0]+","+this.point[1]),t.push("L"+this.pointAfter[0]+","+this.pointAfter[1])),t=t.join(" "),this._movePath?this._movePath.attr({path:t}):(this._movePath=this.svgPaper.path(this.pathDef),this._movePath.attr({"stroke-width":this.connection.designerAttributes.width,"stroke-dasharray":c}),this._movePath.node.setAttribute("class",e.SEGMENT_POINT_MOVE_PATH_CLASS),this._movePath.node.parentNode.insertBefore(this._movePath.node,$(this.svgPaper.canvas).find("circle."+e.CONNECTION_SEGMENT_POINT_CLASS).first()[0]))},t}),define("js/Widgets/DiagramDesigner/Connection",["js/logger","js/util","./DiagramDesignerWidget.Constants","./DiagramDesignerWidget.OperatingModes","./Connection.EditSegment","./Connection.SegmentPoint"],function(e,t,n,i,o,r){"use strict";var s,a="t_",l=5,c=1,d="#000000",h=n.LINE_PATTERNS.SOLID,p=n.LINE_ARROWS.NONE,g=p,u=0,f=5,m=1,_="#B9DCF7",b=n.LINE_TYPES.NONE,y=3,v=1,C=2,E=3;return s=function(t){this.id=t,this.logger=e.create("gme:Widgets:DiagramDesigner:Connection_"+this.id,WebGMEGlobal.gmeConfig.client.log),this.logger.debug("Created"),this.sourceCoordinates={x:-1,y:-1},this.endCoordinates={x:-1,y:-1}},s.prototype._initialize=function(e){this.diagramDesigner=e.designerCanvas,this.paper=this.diagramDesigner.skinParts.SVGPaper,this.skinParts={},this.reconnectable=!1,this.selected=!1,this.selectedInMultiSelection=!1,this.onRenderCallback=null,this.designerAttributes={},this._segmentPointMarkers=[],this._editMode=!1,this._readOnly=!1,this._connectionEditSegments=[],this._pathPointsBBox={x:0,y:0,x2:0,y2:0,w:0,h:0},this._initializeConnectionProps(e)},s.prototype._initializeConnectionProps=function(e){if(this.reconnectable=e.reconnectable===!0,this.editable=!!e.editable,this.isBezier=(e[n.LINE_TYPE]||n.LINE_TYPES.NONE).toLowerCase()===n.LINE_TYPES.BEZIER,this.designerAttributes.arrowStart=e[n.LINE_START_ARROW]||g,this.designerAttributes.arrowEnd=e[n.LINE_END_ARROW]||g,this.designerAttributes.color=e[n.LINE_COLOR]||d,this.designerAttributes.width=parseInt(e[n.LINE_WIDTH],10)||c,this.designerAttributes.pattern=e[n.LINE_PATTERN]||h,this.designerAttributes.shadowWidth=this.designerAttributes.width+f-c,this.designerAttributes.shadowOpacity=u,this.designerAttributes.shadowOpacityWhenSelected=m,this.designerAttributes.shadowColor=_,this.designerAttributes.lineType=e[n.LINE_TYPE]||b,this.designerAttributes.shadowEndArrowWidth=this.designerAttributes.width+y,(-1!==this.designerAttributes.arrowStart.indexOf("-xx")||-1!==this.designerAttributes.arrowEnd.indexOf("-xx")||-1!==this.designerAttributes.arrowStart.indexOf("-x")||-1!==this.designerAttributes.arrowEnd.indexOf("-x"))&&(this.designerAttributes.shadowEndArrowWidth=this.designerAttributes.width+v),this.designerAttributes.shadowArrowStartAdjust=this._raphaelArrowAdjustForSizeToRefSize(this.designerAttributes.arrowStart,this.designerAttributes.shadowEndArrowWidth,this.designerAttributes.width,!1),this.designerAttributes.shadowArrowEndAdjust=this._raphaelArrowAdjustForSizeToRefSize(this.designerAttributes.arrowEnd,this.designerAttributes.shadowEndArrowWidth,this.designerAttributes.width,!0),this.srcText=e.srcText,this.dstText=e.dstText,this.name=e.name,this.nameEdit=e.nameEdit||!1,this.srcTextEdit=e.srcTextEdit||!1,this.dstTextEdit=e.dstTextEdit||!1,this.segmentPoints=[],e[n.LINE_POINTS])for(var t,i,o,r=e[n.LINE_POINTS].length,s=0;r>s;s+=1)t=this._fixXY({x:e[n.LINE_POINTS][s][0],y:e[n.LINE_POINTS][s][1]}),i=e[n.LINE_POINTS][s].length>2?e[n.LINE_POINTS][s][2]:0,o=e[n.LINE_POINTS][s].length>2?e[n.LINE_POINTS][s][3]:0,this.segmentPoints.push([t.x,t.y,i,o])},s.prototype._raphaelArrowAdjustForSizeToRefSize=function(e,t,n,i){for(var o,r=3,s=3,a=e.toLowerCase().split("-"),l="classic",c=a.length;c--;)switch(a[c]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":case"diamond2":case"inheritance":l=a[c];break;case"wide":s=5;break;case"narrow":s=2;break;case"long":r=5;break;case"short":r=2;break;case"xwide":s=9;break;case"xlong":r=9;break;case"xxwide":s=12;break;case"xxlong":r=12}return"none"===l?0:(o=r/2,i?(this.designerAttributes.endArrowMarkerSize=this.designerAttributes.width*r,this.designerAttributes.shadowEndArrowMarkerSize=this.designerAttributes.shadowEndArrowWidth*r):(this.designerAttributes.startArrowMarkerSize=this.designerAttributes.width*r,this.designerAttributes.shadowStartArrowMarkerSize=this.designerAttributes.shadowEndArrowWidth*r),o*(t-n))},s.prototype._raphaelArrowSizeToRefSize=function(e,t){for(var n,i,o=3,r=3,s=e.toLowerCase().split("-"),a="classic",l=s.length;l--;)switch(s[l]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":case"diamond2":case"inheritance":a=s[l];break;case"wide":r=5;break;case"narrow":r=2;break;case"long":o=5;break;case"short":o=2;break;case"xwide":r=9;break;case"xlong":o=9;break;case"xxwide":r=12;break;case"xxlong":o=12}return"none"===a?0:(n=o/2,i=r/2,{w:t*o,h:t*r,refX:n*t,refY:i*t})},s.prototype.getConnectionProps=function(){var e={};return e.reconnectable=this.reconnectable,e.arrowStart=this.designerAttributes.arrowStart,e.arrowEnd=this.designerAttributes.arrowEnd,e.color=this.designerAttributes.color,e.width=this.designerAttributes.width,e.shadowColor=this.designerAttributes.shadowColor,e.lineType=this.designerAttributes.lineType,e.pattern=this.designerAttributes.pattern,e},s.prototype._fixXY=function(e){var t={x:Math.floor(e.x),y:Math.floor(e.y)};return this.designerAttributes.width%2===1&&(t.x+=.5,t.y+=.5),t},s.prototype.setConnectionRenderData=function(e){var t,i,o,r,s,a,c=0,d=[],h={x:NaN,y:NaN},p=[],g=e&&e.length>1;if(this._removeEditModePath(),g)for(c=t=e.length,t--;c--;)e[t-c]&&(i=this._fixXY(e[t-c]),!h||h.x===i.x&&h.y===i.y||(p.push(i),h=i));if(this._simplifyTrivially(p),this.sourceCoordinates={x:-1,y:-1},this.endCoordinates={x:-1,y:-1},t=p.length,g=t>1){for(this._pathPoints=p,i=p[0],o=s=i.x,r=a=i.y,this.sourceCoordinates.x=i.x,this.sourceCoordinates.y=i.y,c=p.length;c--;)i=p[c],o=Math.min(o,i.x),r=Math.min(r,i.y),s=Math.max(s,i.x),a=Math.max(a,i.y);this._pathPointsBBox.x=o,this._pathPointsBBox.y=r,this._pathPointsBBox.x2=s,this._pathPointsBBox.y2=a,i=p[p.length-1],this.endCoordinates.x=i.x,this.endCoordinates.y=i.y,d=this._getPathDefFromPoints(p),d=this._jumpOnCrossings(d),d=d.join(" "),this.pathDef!==d&&(this.pathDef=d,this._calculatePathStartEndAngle(),this.skinParts.path?(this.logger.debug('Redrawing connection with ID: "'+this.id+'"'),this.skinParts.path.attr({path:d}),this.skinParts.pathShadow&&this._updatePathShadow(this._pathPoints)):(this.logger.debug('Drawing connection with ID: "'+this.id+'"'),this.skinParts.path=this.paper.path(d),$(this.skinParts.path.node).attr({id:this.id,"class":n.DESIGNER_CONNECTION_CLASS}),this.skinParts.path.attr({"arrow-start":this.designerAttributes.arrowStart,"arrow-end":this.designerAttributes.arrowEnd,stroke:this.designerAttributes.color,"stroke-width":this.designerAttributes.width,"stroke-dasharray":this.designerAttributes.pattern}),this.designerAttributes.width<l&&this._createPathShadow(this._pathPoints),this.selected&&this.onSelect(this.selectedInMultiSelection))),this._editMode===!0&&(this._drawEditModePath(p),this.showEndReconnectors()),this._showConnectionAreaMarker(),this._renderTexts()}else this.pathDef=null,this._removePath(),this._removePathShadow(),this._hideConnectionAreaMarker(),this._hideTexts()},s.prototype._calcRawBoundingBox=function(){var e,t={x:0,y:0,x2:0,y2:0,width:0,height:0};if(this._pathPoints&&this._pathPoints.length>0){for(t.x=t.x2=this._pathPoints[0].x,t.y=t.y2=this._pathPoints[0].y,e=1;e<this._pathPoints.length;e+=1)t.x=this._pathPoints[e].x<t.x?this._pathPoints[e].x:t.x,t.x2=this._pathPoints[e].x>t.x2?this._pathPoints[e].x:t.x2,t.y=this._pathPoints[e].y<t.y?this._pathPoints[e].y:t.y,t.y2=this._pathPoints[e].y>t.y2?this._pathPoints[e].y:t.y2;t.width=t.x2-t.x,t.height=t.y2-t.y}return t},s.prototype.getBoundingBox=function(){var e,t,n,i,o,r,s,a,l=0;if(r=this._calcRawBoundingBox(),this.skinParts.pathShadow?(t=this.designerAttributes.shadowWidth,l=this.designerAttributes.shadowArrowEndAdjust):this.skinParts.path&&(t=this.designerAttributes.width),e={x:r.x,y:r.y,x2:r.x2,y2:r.y2,width:r.width,height:r.height},this.designerAttributes.arrowStart!==p)for(s=this._getRaphaelArrowEndBoundingPoints(this.designerAttributes.arrowStart,t,this._pathStartAngle,!1),n=l*Math.cos(this._pathStartAngle),i=l*Math.sin(this._pathStartAngle),o={x:this.sourceCoordinates.x-n,y:this.sourceCoordinates.y-i,x2:this.sourceCoordinates.x-n,y2:this.sourceCoordinates.y-i},a=s.length;a--;)o.x=Math.min(o.x,this.sourceCoordinates.x-n-s[a].x),o.y=Math.min(o.y,this.sourceCoordinates.y-i-s[a].y),o.x2=Math.max(o.x2,this.sourceCoordinates.x-n-s[a].x),o.y2=Math.max(o.y2,this.sourceCoordinates.y-i-s[a].y);if(this.designerAttributes.arrowEnd!==p)for(s=this._getRaphaelArrowEndBoundingPoints(this.designerAttributes.arrowEnd,t,this._pathEndAngle,!0),n=l*Math.cos(this._pathEndAngle),i=l*Math.sin(this._pathEndAngle),o=o||{x:this.endCoordinates.x+n,y:this.endCoordinates.y+i,x2:this.endCoordinates.x+n,y2:this.endCoordinates.y+i},a=s.length;a--;)o.x=Math.min(o.x,this.endCoordinates.x+n+s[a].x),o.y=Math.min(o.y,this.endCoordinates.y+i+s[a].y),o.x2=Math.max(o.x2,this.endCoordinates.x+n+s[a].x),o.y2=Math.max(o.y2,this.endCoordinates.y+i+s[a].y);return 0===e.height&&0!==e.width?(e.height=t,e.y-=t/2,e.y2+=t/2):0!==e.height&&0===e.width?(e.width=t,e.x-=t/2,e.x2+=t/2):0!==e.height&&0!==e.width&&(Math.abs(e.x-this.sourceCoordinates.x)<Math.abs(e.x-this.endCoordinates.x)?(e.x-=Math.abs(Math.cos(Math.PI/2-this._pathStartAngle)*t/2),
e.x2+=Math.abs(Math.cos(Math.PI/2-this._pathEndAngle)*t/2)):(e.x-=Math.abs(Math.cos(Math.PI/2-this._pathEndAngle)*t/2),e.x2+=Math.abs(Math.cos(Math.PI/2-this._pathStartAngle)*t/2)),Math.abs(e.y-this.sourceCoordinates.y)<Math.abs(e.y-this.endCoordinates.y)?(e.y-=Math.abs(Math.sin(Math.PI/2-this._pathStartAngle)*t/2),e.y2+=Math.abs(Math.sin(Math.PI/2-this._pathEndAngle)*t/2)):(e.y-=Math.abs(Math.sin(Math.PI/2-this._pathEndAngle)*t/2),e.y2+=Math.abs(Math.sin(Math.PI/2-this._pathStartAngle)*t/2)),e.width=e.x2-e.x,e.height=e.y2-e.y),o=o||e,e.x=Math.min(e.x,o.x),e.y=Math.min(e.y,o.y),e.x2=Math.max(e.x2,o.x2),e.y2=Math.max(e.y2,o.y2),e.width=e.x2-e.x,e.height=e.y2-e.y,isNaN(e.x)&&(e.x=0),isNaN(e.y)&&(e.y=0),isNaN(e.x2)&&(e.x2=0),isNaN(e.y2)&&(e.y2=0),isNaN(e.width)&&(e.width=0),isNaN(e.height)&&(e.height=0),e},s.prototype._getRaphaelArrowEndBoundingPoints=function(e,t,n,i){for(var o,r,s,a=[],l={x:0,y:0},c={x:0,y:0},d={x:0,y:0},h={x:0,y:0},p={x:0,y:0},g=e.toLowerCase().split("-"),u="classic",f=g.length;f--;)switch(g[f]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":case"diamond2":case"inheritance":u=g[f]}switch(o=this._raphaelArrowSizeToRefSize(e,t,i),r=Math.sqrt(o.w/2*o.w/2+o.h/2*o.h/2),s=Math.atan(o.h/o.w),h.x=Math.cos(n+s)*r,h.y=Math.sin(n+s)*r,c.x=Math.cos(n-s)*r,c.y=Math.sin(n-s)*r,d.x=Math.cos(n-s+Math.PI)*r,d.y=Math.sin(n-s+Math.PI)*r,l.x=Math.cos(n+s+Math.PI)*r,l.y=Math.sin(n+s+Math.PI)*r,p.x=Math.cos(n)*o.refX,p.y=Math.sin(n)*o.refY,u){case"classic":case"block":case"inheritance":a.push({x:-p.x+l.x,y:-p.y+l.y}),a.push({x:(-p.x+c.x+(-p.x+h.x))/2,y:(-p.y+c.y+(-p.y+h.y))/2}),a.push({x:-p.x+d.x,y:-p.y+d.y});break;case"diamond":case"diamond2":a.push({x:(-p.x+l.x+(-p.x+c.x))/2,y:(-p.y+l.y+(-p.y+c.y))/2}),a.push({x:(-p.x+c.x+(-p.x+h.x))/2,y:(-p.y+c.y+(-p.y+h.y))/2}),a.push({x:(-p.x+d.x+(-p.x+h.x))/2,y:(-p.y+d.y+(-p.y+h.y))/2}),a.push({x:(-p.x+d.x+(-p.x+l.x))/2,y:(-p.y+d.y+(-p.y+l.y))/2});break;default:a.push({x:-p.x+l.x,y:-p.y+l.y}),a.push({x:-p.x+c.x,y:-p.y+c.y}),a.push({x:-p.x+h.x,y:-p.y+h.y}),a.push({x:-p.x+d.x,y:-p.y+d.y})}return a},s.prototype.destroy=function(){this._destroying=!0,this._hideSegmentPoints(),this.hideEndReconnectors(),this._removeEditModePath(),this._removePath(),this._removePathShadow(),this._hideConnectionAreaMarker(),this.hideSourceConnectors(),this.hideEndConnectors(),this._hideTexts(),this.logger.debug("Destroyed")},s.prototype.onSelect=function(e,t){this.selected=!0,this.selectedInMultiSelection=e,t=t||this.onRenderCallback,this.skinParts.path?(this._highlightPath(),this.selectedInMultiSelection===!0?this._setEditMode(!1):this.diagramDesigner.mode===this.diagramDesigner.OPERATING_MODES.DESIGN&&this._setEditMode(!0),t(this)):this.onRenderCallback=t},s.prototype.onDeselect=function(){this.selected=!1,this.selectedInMultiSelection=!1,this.onRenderCallback=null,this._unHighlightPath(),this._setEditMode(!1)},s.prototype._highlightPath=function(){this._createPathShadow(this._pathPoints),this.skinParts.pathShadow.attr({opacity:this.designerAttributes.shadowOpacityWhenSelected}),this.skinParts.pathShadowArrowStart&&this.skinParts.pathShadowArrowStart.attr({opacity:this.designerAttributes.shadowOpacityWhenSelected}),this.skinParts.pathShadowArrowEnd&&this.skinParts.pathShadowArrowEnd.attr({opacity:this.designerAttributes.shadowOpacityWhenSelected})},s.prototype._unHighlightPath=function(){this.designerAttributes.width<l?(this.skinParts.pathShadow.attr({opacity:this.designerAttributes.shadowOpacity}),this.skinParts.pathShadowArrowStart&&this.skinParts.pathShadowArrowStart.attr({opacity:this.designerAttributes.shadowOpacity}),this.skinParts.pathShadowArrowEnd&&this.skinParts.pathShadowArrowEnd.attr({opacity:this.designerAttributes.shadowOpacity})):this._removePathShadow()},s.prototype._calculatePathStartEndAngle=function(){var e,t,n;e=this._pathPoints[1].x-this._pathPoints[0].x,t=this._pathPoints[1].y-this._pathPoints[0].y,0===e&&0!==t?this._pathStartAngle=Math.PI/2*Math.abs(t)/t:(this._pathStartAngle=Math.atan(t/e),0>e&&(this._pathStartAngle+=Math.PI)),n=this._pathPoints.length,e=this._pathPoints[n-1].x-this._pathPoints[n-2].x,t=this._pathPoints[n-1].y-this._pathPoints[n-2].y,0===e&&0!==t?this._pathEndAngle=Math.PI/2*Math.abs(t)/t:(this._pathEndAngle=Math.atan(t/e),0>e&&(this._pathEndAngle+=Math.PI))},s.prototype._createPathShadow=function(e){var t,i;(void 0===this.skinParts.pathShadow||null===this.skinParts.pathShadow)&&(this.skinParts.pathShadow=this.paper.path("M0,0 L1,1"),this.skinParts.pathShadow.insertBefore(this.skinParts.path),$(this.skinParts.pathShadow.node).attr({id:n.PATH_SHADOW_ID_PREFIX+this.id,"class":n.DESIGNER_CONNECTION_CLASS}),this.skinParts.pathShadow.attr({stroke:this.designerAttributes.shadowColor,"stroke-width":this.designerAttributes.shadowWidth,opacity:this.designerAttributes.shadowOpacity}),this.designerAttributes.arrowStart!==p?(this.skinParts.pathShadowArrowStart=this.paper.path("M0,0 L1,1"),this.skinParts.pathShadowArrowStart.insertBefore(this.skinParts.path),$(this.skinParts.pathShadowArrowStart.node).attr({id:n.PATH_SHADOW_ARROW_END_ID_PREFIX+this.id,"class":n.DESIGNER_CONNECTION_CLASS})):this.skinParts.pathShadowArrowStart&&(this.skinParts.pathShadowArrowStart.remove(),this.skinParts.pathShadowArrowStart=void 0),this.designerAttributes.arrowEnd!==p?(this.skinParts.pathShadowArrowEnd=this.paper.path("M0,0 L1,1"),this.skinParts.pathShadowArrowEnd.insertBefore(this.skinParts.path),$(this.skinParts.pathShadowArrowEnd.node).attr({id:n.PATH_SHADOW_ARROW_END_ID_PREFIX+this.id,"class":n.DESIGNER_CONNECTION_CLASS})):this.skinParts.pathShadowArrowEnd&&(this.skinParts.pathShadowArrowEnd.remove(),this.skinParts.pathShadowArrowEnd=void 0),this._updatePathShadow(e),this.skinParts.pathShadowArrowStart&&(t=this.designerAttributes.arrowStart.replace("inheritance","block"),this.skinParts.pathShadowArrowStart.attr({stroke:this.designerAttributes.shadowColor,"stroke-width":this.designerAttributes.shadowEndArrowWidth,opacity:this.designerAttributes.shadowOpacity,"arrow-start":t})),this.skinParts.pathShadowArrowEnd&&(i=this.designerAttributes.arrowEnd.replace("inheritance","block"),this.skinParts.pathShadowArrowEnd.attr({stroke:this.designerAttributes.shadowColor,"stroke-width":this.designerAttributes.shadowEndArrowWidth,opacity:this.designerAttributes.shadowOpacity,"arrow-end":i})))},s.prototype._updatePathShadow=function(e){var t,n,i,o,r,s,a,l,c,d,h,g=[],u=[],f=[],m=[];for(s=function(e){return Math.abs(e)<.001?0:e},a=function(e,t,n,i){var o,r,s=t.x<n.x?t.x:n.x,a=t.y<n.y?t.y:n.y,l=t.x>n.x?t.x:n.x,c=t.y>n.y?t.y:n.y,d=[];for(i?(o=0,r=e.length-1):(o=1,r=e.length,d.push({x:e[0].x,y:e[0].y}));r>o;o+=1)e[o].x>=s&&e[o].x<=l&&e[o].y>=a&&e[o].y<=c||d.push({x:e[o].x,y:e[o].y});return i&&d.push({x:e[e.length-1].x,y:e[e.length-1].y}),d},n=e.length,t=0;n>t;t+=1)g.push({x:e[t].x,y:e[t].y}),u.push({x:e[t].x,y:e[t].y});this.designerAttributes.arrowStart!==p&&(o=this.designerAttributes.shadowArrowStartAdjust*Math.cos(this._pathStartAngle),r=this.designerAttributes.shadowArrowStartAdjust*Math.sin(this._pathStartAngle),o=s(o),r=s(r),0!==o&&(l=g[0].x,g[0].x+=this.designerAttributes.startArrowMarkerSize/2*Math.cos(this._pathStartAngle)),0!==r&&(c=g[0].y,g[0].y+=this.designerAttributes.startArrowMarkerSize/2*Math.sin(this._pathStartAngle)),u[0].x-=o,u[0].y-=r,(-1!==this.designerAttributes.arrowStart.indexOf("block")||-1!==this.designerAttributes.arrowStart.indexOf("inheritance"))&&(0!==o&&(u[0].x-=C*(o/Math.abs(o))),0!==r&&(u[0].y-=C*(r/Math.abs(r))))),this.designerAttributes.arrowEnd!==p&&(o=this.designerAttributes.shadowArrowEndAdjust*Math.cos(this._pathEndAngle),r=this.designerAttributes.shadowArrowEndAdjust*Math.sin(this._pathEndAngle),o=s(o),r=s(r),0!==o&&(d=g[n-1].x,g[n-1].x-=this.designerAttributes.endArrowMarkerSize/2*Math.cos(this._pathEndAngle)),0!==r&&(h=g[n-1].y,g[n-1].y-=this.designerAttributes.endArrowMarkerSize/2*Math.sin(this._pathEndAngle)),u[n-1].x+=o,u[n-1].y+=r,(-1!==this.designerAttributes.arrowEnd.indexOf("block")||-1!==this.designerAttributes.arrowEnd.indexOf("inheritance"))&&(0!==o&&(u[n-1].x+=C*(o/Math.abs(o))),0!==r&&(u[n-1].y+=C*(r/Math.abs(r))))),this.designerAttributes.arrowStart!==p&&(g=a(g,{x:l,y:c},{x:g[0].x,y:g[0].y},!1)),this.designerAttributes.arrowEnd!==p&&(n=g.length,g=a(g,{x:d,y:h},{x:g[n-1].x,y:g[n-1].y},!0)),f=this._getPathDefFromPoints(g),f=this._jumpOnCrossings(f),f=f.join(" "),this.skinParts.pathShadow.attr({path:f}),this.skinParts.pathShadowArrowStart&&(m=[],o=this.designerAttributes.shadowStartArrowMarkerSize*Math.cos(this._pathStartAngle),r=this.designerAttributes.shadowStartArrowMarkerSize*Math.sin(this._pathStartAngle),i=u[0],m.push("M"+i.x+","+i.y),m.push("L"+(i.x+o)+","+(i.y+r)),m=m.join(" "),this.skinParts.pathShadowArrowStart.attr({path:m})),this.skinParts.pathShadowArrowEnd&&(n=u.length,m=[],o=this.designerAttributes.shadowEndArrowMarkerSize*Math.cos(this._pathEndAngle),r=this.designerAttributes.shadowEndArrowMarkerSize*Math.sin(this._pathEndAngle),i=u[n-1],m.push("M"+(i.x-o)+","+(i.y-r)),m.push("L"+i.x+","+i.y),m=m.join(" "),this.skinParts.pathShadowArrowEnd.attr({path:m}))},s.prototype._removePath=function(){this.skinParts.path&&(this.skinParts.path.remove(),this.skinParts.path=null)},s.prototype._removePathShadow=function(){this.skinParts.pathShadow&&(this.skinParts.pathShadow.remove(),this.skinParts.pathShadow=void 0),this.skinParts.pathShadowArrowStart&&(this.skinParts.pathShadowArrowStart.remove(),this.skinParts.pathShadowArrowStart=void 0),this.skinParts.pathShadowArrowEnd&&(this.skinParts.pathShadowArrowEnd.remove(),this.skinParts.pathShadowArrowEnd=void 0)},s.prototype.showEndReconnectors=function(){if(this.reconnectable){this.skinParts.srcDragPoint=this.skinParts.srcDragPoint||$("<div/>",{"data-end":n.CONNECTION_END_SRC,"data-id":this.id,"class":n.CONNECTION_DRAGGABLE_END_CLASS+" "+n.CONNECTION_END_SRC}),this.skinParts.srcDragPoint.html("S"),this.skinParts.srcDragPoint.css({position:"absolute",top:this.sourceCoordinates.y,left:this.sourceCoordinates.x}),this.diagramDesigner.skinParts.$itemsContainer.append(this.skinParts.srcDragPoint),this.skinParts.dstDragPoint=this.skinParts.dstDragPoint||$("<div/>",{"data-end":n.CONNECTION_END_DST,"data-id":this.id,"class":n.CONNECTION_DRAGGABLE_END_CLASS+" "+n.CONNECTION_END_DST}),this.skinParts.dstDragPoint.html("D"),this.skinParts.dstDragPoint.css({position:"absolute",top:this.endCoordinates.y,left:this.endCoordinates.x}),this.diagramDesigner.skinParts.$itemsContainer.append(this.skinParts.dstDragPoint);var e=Math.max(1,this.designerAttributes.width/10);this.skinParts.srcDragPoint.css("transform","scale("+e+","+e+")"),this.skinParts.dstDragPoint.css("transform","scale("+e+","+e+")")}else this.hideEndReconnectors()},s.prototype.hideEndReconnectors=function(){this.skinParts.srcDragPoint&&(this.skinParts.srcDragPoint.empty(),this.skinParts.srcDragPoint.remove(),this.skinParts.srcDragPoint=null),this.skinParts.dstDragPoint&&(this.skinParts.dstDragPoint.empty(),this.skinParts.dstDragPoint.remove(),this.skinParts.dstDragPoint=null)},s.prototype.readOnlyMode=function(e){this._readOnly=e,e===!0&&this._setEditMode(!1)},s.prototype._setEditMode=function(e){this._readOnly===!1&&this._editMode!==e&&(this._editMode=e,this.setConnectionRenderData(this._pathPoints),this._editMode===!1&&this.hideEndReconnectors())},s.prototype._drawEditModePath=function(e){var t,n=e.length,i=this.segmentPoints.length,o=0,r=[],s=0;if(this._removeEditModePath(),this.editable===!0){for(t=0;n>t;t+=1)i>o&&this._isSamePoint(e[t],{x:this.segmentPoints[o][0],y:this.segmentPoints[o][1]})?(r.push([this.segmentPoints[o][0],this.segmentPoints[o][1],this.segmentPoints[o][2],this.segmentPoints[o][3]]),this._createEditSegment(r,s),o+=1,s+=1,r=[],r.push([this.segmentPoints[o-1][0],this.segmentPoints[o-1][1],this.segmentPoints[o-1][2],this.segmentPoints[o-1][3]])):r.push([e[t].x,e[t].y,0,0]);this._createEditSegment(r,s),this._showSegmentPoints()}},s.prototype._removeEditModePath=function(){this._hideSegmentPoints(),this._removeConnectionEditSegments()},s.prototype._isSamePoint=function(e,t){return e.x===t.x&&e.y===t.y},s.prototype._removeConnectionEditSegments=function(){for(var e=this._connectionEditSegments.length;e--;)this._connectionEditSegments[e].destroy();this._connectionEditSegments=[]},s.prototype._createEditSegment=function(e,t){var n;this.logger.debug("_createEditSegment: #"+t+", "+JSON.stringify(e)),n=new o({connection:this,id:t,points:e}),this._connectionEditSegments.push(n)},s.prototype.addSegmentPoint=function(e,t,n,i,o){var r=[t,n,i,o],s=this.segmentPoints.slice(0);s.splice(e,0,r),this.diagramDesigner.onConnectionSegmentPointsChange({connectionID:this.id,points:s})},s.prototype.removeSegmentPoint=function(e){var t=this.segmentPoints.slice(0);t.splice(e,1),this.diagramDesigner.onConnectionSegmentPointsChange({connectionID:this.id,points:t})},s.prototype.setSegmentPoint=function(e,t,n,i,o){var r=[t,n,i,o],s=this.segmentPoints.slice(0);s[e]=r,this.diagramDesigner.onConnectionSegmentPointsChange({connectionID:this.id,points:s})},s.prototype._showSegmentPoints=function(){var e,t=this.segmentPoints.length,n=t,i=this._pathPoints.length-1;for(this._hideSegmentPoints();n--;)e=new r({connection:this,id:n,point:this.segmentPoints[n],pointAfter:n===t-1?[this._pathPoints[i].x,this._pathPoints[i].y,0,0]:this.segmentPoints[n+1],pointBefore:0===n?[this._pathPoints[0].x,this._pathPoints[0].y,0,0]:this.segmentPoints[n-1]}),this._segmentPointMarkers.push(e)},s.prototype._hideSegmentPoints=function(){for(var e=this._segmentPointMarkers.length;e--;)this._segmentPointMarkers[e].destroy();this._segmentPointMarkers=[]},s.prototype.highlight=function(){var e=$(this.skinParts.path.node).attr("class").split(" ");-1===e.indexOf(n.ITEM_HIGHLIGHT_CLASS)&&(e.push(n.ITEM_HIGHLIGHT_CLASS),$(this.skinParts.path.node).attr("class",e.join(" "))),this.skinParts.textContainer&&this.skinParts.textContainer.addClass(n.ITEM_HIGHLIGHT_CLASS)},s.prototype.unHighlight=function(){var e=$(this.skinParts.path.node).attr("class").split(" "),t=e.indexOf(n.ITEM_HIGHLIGHT_CLASS);-1!==t&&(e.splice(t,1),$(this.skinParts.path.node).attr("class",e.join(" "))),this.skinParts.textContainer&&this.skinParts.textContainer.removeClass(n.ITEM_HIGHLIGHT_CLASS)},s.prototype.update=function(e){var t,n;this._initializeConnectionProps(e),this.skinParts.path&&this.skinParts.path.attr({"arrow-start":this.designerAttributes.arrowStart,"arrow-end":this.designerAttributes.arrowEnd,stroke:this.designerAttributes.color,"stroke-width":this.designerAttributes.width,"stroke-dasharray":this.designerAttributes.pattern}),this.skinParts.pathShadow&&(this._updatePathShadow(this._pathPoints),this.skinParts.pathShadow.attr({"stroke-width":this.designerAttributes.shadowWidth})),this.skinParts.pathShadowArrowStart&&(t=this.designerAttributes.arrowStart.replace("inheritance","block"),this.skinParts.pathShadowArrowStart.attr({"stroke-width":this.designerAttributes.shadowEndArrowWidth,"arrow-start":t})),this.skinParts.pathShadowArrowEnd&&(n=this.designerAttributes.arrowEnd.replace("inheritance","block"),this.skinParts.pathShadowArrowEnd.attr({"stroke-width":this.designerAttributes.shadowEndArrowWidth,"arrow-end":n})),this.skinParts.name&&this.skinParts.name.css({color:this.designerAttributes.color}),this.skinParts.srcText&&this.skinParts.srcText.css({color:this.designerAttributes.color}),this.skinParts.dstText&&this.skinParts.dstText.css({color:this.designerAttributes.color})},s.prototype.getConnectionAreas=function(){var e,t=[],n=0,i=0,o=0,r=0,s=0;return this.skinParts.path&&(e=this._getMidPoint(),this.positionX=0,this.positionY=0,0===e.alpha||180===e.alpha?(i=n,r=n/2):(90===e.alpha||270===e.alpha)&&(o=n,s=n/2),t.push({id:"0",x1:e.x-r,y1:e.y-s,x2:e.x-r+i,y2:e.y-s+o,angle1:0,angle2:360,len:0})),t},s.prototype.showSourceConnectors=function(){},s.prototype.hideSourceConnectors=function(){},s.prototype.showEndConnectors=function(){this._connectionConnector=this._connectionConnector||$("<div/>",{"class":"connector connection-connector"}),this._connectionConnector.attr(n.DATA_ITEM_ID,this.id),this.diagramDesigner.skinParts.$itemsContainer.append(this._connectionConnector);var e=this._getMidPoint();this._connectionConnector.css({left:e.x,top:e.y})},s.prototype.hideEndConnectors=function(){this._connectionConnector&&(this._connectionConnector.remove(),this._connectionConnector=void 0)},s.prototype._showConnectionAreaMarker=function(){var e=!1;if(this._hideConnectionAreaMarker(),this.diagramDesigner.connectionIDbyEndID.hasOwnProperty(this.id))for(var t in this.diagramDesigner.connectionIDbyEndID[this.id]){if(this.diagramDesigner.connectionIDbyEndID[this.id].hasOwnProperty(t))for(var n in this.diagramDesigner.connectionIDbyEndID[this.id][t])if(this.diagramDesigner.connectionIDbyEndID[this.id][t].hasOwnProperty(n)&&this.diagramDesigner.connectionIDbyEndID[this.id][t][n].length>0){e=!0;break}if(e)break}if(this.skinParts.path&&e){var i=this._getMidPoint();this._connectionAreaMarker=$("<div/>",{"class":"c-area"}),this.diagramDesigner.skinParts.$itemsContainer.append(this._connectionAreaMarker),this._connectionAreaMarker.css({top:i.y,left:i.x})}},s.prototype._hideConnectionAreaMarker=function(){this._connectionAreaMarker&&(this._connectionAreaMarker.remove(),this._connectionAreaMarker=void 0)},s.prototype._textContainer=$('<div class="c-t"></div>'),s.prototype._textNameBase=$('<div class="c-text"><span class="c-name"></span></div>'),s.prototype._textSrcBase=$('<div class="c-text"><span class="c-src"></span></div>'),s.prototype._textDstBase=$('<div class="c-text"><span class="c-dst"></span></div>'),s.prototype._getMidPoint=function(){function e(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}var t,n,i,o=0,r=[],s=0;if(this.isBezier)o=this.skinParts.path.getTotalLength(),n=this.skinParts.path.getPointAtLength(o/2);else{for(n={x:0,y:0,alpha:0},i=0;i<this._pathPoints.length-1;i+=1)o+=e(this._pathPoints[i],this._pathPoints[i+1]),r.push(o);for(s=o/2,i=0;i<r.length;i+=1)if(r[i]>=s){n.alpha=this._calculateSteep(this._pathPoints[i],this._pathPoints[i+1]),t=n.alpha*(Math.PI/180),i>0&&(s-=r[i-1]),n.x=this._pathPoints[i].x+s*Math.cos(t),n.y=this._pathPoints[i].y+s*Math.sin(t);break}}return n},s.prototype._renderTexts=function(){function e(){var e=i._getMidPoint();i.skinParts.name=i._textNameBase.clone(),i.skinParts.name.css({top:e.y-2+i.designerAttributes.width,left:e.x,color:i.designerAttributes.color}),i.skinParts.name.find("span").text(i.name),i.skinParts.textContainer.append(i.skinParts.name),$(i.diagramDesigner.skinParts.$itemsContainer.children()[0]).after(i.skinParts.textContainer),(e.alpha>=45&&e.alpha<=135||e.alpha>=225&&e.alpha<=315)&&i.skinParts.name.find("span").addClass("v"),i.skinParts.name.find("span").on("dblclick.editOnDblClick",null,function(e){i.nameEdit===!0&&i.diagramDesigner.getIsReadOnlyMode()!==!0&&$(this).editInPlace({"class":"",onChange:function(e,t){i._onNameChanged(e,t)}}),e.stopPropagation(),e.preventDefault()})}function t(){var e=i._calculateSteep(i._pathPoints[0],i._pathPoints[1]);i.skinParts.srcText=i._textSrcBase.clone(),i.skinParts.srcText.find("span").text(i.srcText),i.skinParts.textContainer.append(i.skinParts.srcText),$(i.diagramDesigner.skinParts.$itemsContainer.children()[0]).after(i.skinParts.textContainer);var t=i.designerAttributes.width,n=i.designerAttributes.width;e>=0&&45>=e?(t=o,n*=-1):e>45&&90>=e?(t=o,n=o):e>90&&135>=e?(t=-1*i.skinParts.srcText.width()-o,n=o):e>135&&180>=e?t=-1*i.skinParts.srcText.width()-o:e>180&&225>=e?(t=-1*i.skinParts.srcText.width()-o,n*=-1):e>225&&270>=e?(t=-1*i.skinParts.srcText.width()-o,n=-4*o):e>270&&315>=e?(t=o,n=-4*o):e>315&&360>=e&&(n=-4*o,t=o),i.skinParts.srcText.css({top:i._pathPoints[0].y+n,left:i._pathPoints[0].x+t,color:i.designerAttributes.color}),i.skinParts.srcText.find("span").on("dblclick.editOnDblClick",null,function(e){i.srcTextEdit===!0&&i.diagramDesigner.getIsReadOnlyMode()!==!0&&$(this).editInPlace({"class":"",onChange:function(e,t){i._onSrcTextChanged(e,t)}}),e.stopPropagation(),e.preventDefault()})}function n(){var e=i._pathPoints.length,t=i._calculateSteep(i._pathPoints[e-2],i._pathPoints[e-1]),n=i.designerAttributes.width,r=i.designerAttributes.width;i.skinParts.dstText=i._textDstBase.clone(),i.skinParts.dstText.find("span").text(i.dstText),i.skinParts.textContainer.append(i.skinParts.dstText),$(i.diagramDesigner.skinParts.$itemsContainer.children()[0]).after(i.skinParts.textContainer),0===t?(n=-1*i.skinParts.dstText.width()-o,r*=-1):t>0&&45>=t?(n=-1*i.skinParts.dstText.width()-o,r=-4*o):t>45&&90>=t?(n=-1*i.skinParts.dstText.width()-o,r=-4*o):t>90&&135>=t?(n=o,r=-4*o):t>135&&180>=t?(r=-4*o,n=o):t>180&&225>=t?(n=o,r=-4*o):t>225&&270>=t?(n=o,r*=-1):t>270&&315>=t?(r=o,n=-1*i.skinParts.dstText.width()-o):t>315&&360>=t&&(n=-1*i.skinParts.dstText.width()-o),i.skinParts.dstText.css({top:i._pathPoints[e-1].y+r,left:i._pathPoints[e-1].x+n,color:i.designerAttributes.color}),i.skinParts.dstText.find("span").on("dblclick.editOnDblClick",null,function(e){i.dstTextEdit===!0&&i.diagramDesigner.getIsReadOnlyMode()!==!0&&$(this).editInPlace({"class":"",onChange:function(e,t){i._onDstTextChanged(e,t)}}),e.stopPropagation(),e.preventDefault()})}var i=this,o=5;this._hideTexts(),(this.name||this.srcText||this.dstText)&&(this.skinParts.textContainer=this._textContainer.clone(),this.skinParts.textContainer.attr("id",a+this.id),this.name&&e(),this.srcText&&t(),this.dstText&&n())},s.prototype._hideTexts=function(){this.skinParts.textContainer&&this.skinParts.textContainer.remove()},s.prototype._calculateSteep=function(e,t){var n=0,i=t.x-e.x,o=t.y-e.y;return 0===i&&0!==o?n=Math.PI/2*Math.abs(o)/o:(n=Math.atan(o/i),0>i&&(n+=Math.PI)),0>n&&(n+=2*Math.PI),n*=180/Math.PI},s.prototype._onNameChanged=function(e,t){this.diagramDesigner.onConnectionNameChanged(this.id,e,t)},s.prototype._onSrcTextChanged=function(e,t){this.diagramDesigner.onConnectionSrcTextChanged(this.id,e,t)},s.prototype._onDstTextChanged=function(e,t){this.diagramDesigner.onConnectionDstTextChanged(this.id,e,t)},s.prototype.updateTexts=function(e){this.srcText=e.srcText||this.srcText,this.dstText=e.dstText||this.dstText,this.name=e.name||this.name,this.nameEdit=e.nameEdit||this.nameEdit,this.srcTextEdit=e.srcTextEdit||this.srcTextEdit,this.dstTextEdit=e.dstTextEdit||this.dstTextEdit,this._renderTexts()},s.prototype._jumpOnCrossings=function(e){var t,n,i,o,r,s,a,l,c,d,h,p,g,u,f,m,_,b,y,v,C=this.diagramDesigner.items,D={},I=[],T=[],P={};if(this.diagramDesigner._connectionJumpXing!==!0||this.isBezier===!0)return e;for(t=this.diagramDesigner.connectionIds.slice(0).sort(),n=t.indexOf(this.id),t.splice(n),i=t.length;i--;)if(o=C[t[i]],o.isBezier===!1&&(r=this._pathIntersect(o),r&&r.length>0))for(s=0;s<r.length;s+=1)a=r[s],D[a.segment1]=D[a.segment1]||[],D[a.segment1].push({xy:[a.x,a.y],t:a.t1,path:a.path1,length:a.segment1Length,otherWidth:o.designerAttributes.width}),-1===I.indexOf(a.segment1)&&I.push(a.segment1);for(I.sort(function(e,t){return e-t}),i=0;i<I.length;i+=1){for(f=I[i],l=D[f],s=0;s<l.length;s+=1)P[f]=P[f]||{t:[],paths:{},segmentLength:l[s].length,xings:{},sweepFlag:0},_=Math.max(this.designerAttributes.width,l[s].otherWidth)+E,c=l[s].length,d=_/c,g=l[s].t-d,0>g&&(g=0),h=this._getPointAtLength(l[s].path[0],l[s].path[1],l[s].path[2],l[s].path[3],g*c),g=l[s].t+d,g>1&&(g=1),p=this._getPointAtLength(l[s].path[0],l[s].path[1],l[s].path[2],l[s].path[3],g*c),v=l[s].path[3]-l[s].path[1],0!==v&&(v/=Math.abs(v)),y=l[s].path[2]-l[s].path[0],0!==y&&(y/=Math.abs(y)),b=y>0?1:0===y&&v>0?1:0,u="L"+h.x+","+h.y+"A"+_+","+_+" 0 0,"+b+" "+p.x+","+p.y,P[f].t.push(l[s].t),P[f].paths[l[s].t]=u,P[f].xings[l[s].t]={pointBefore:h,pointAfter:p,xRadius:_},P[f].sweepFlag=b;for(P[f].t.sort(function(e,t){return e-t}),c=P[f].segmentLength,b=P[f].sweepFlag,m=0;m<P[f].t.length-1;m+=1){var N=P[f].t[m],A=P[f].t[m+1],w=P[f].xings[N],O=P[f].xings[A];this._checkIntersect(w.pointBefore.x,w.pointBefore.y,w.pointAfter.x,w.pointAfter.y,O.pointBefore.x,O.pointBefore.y,O.pointAfter.x,O.pointAfter.y)&&(_=Math.max(w.xRadius,O.xRadius),u="L"+w.pointBefore.x+","+w.pointBefore.y+"A"+_+","+_+" 0 0,"+b+" "+O.pointAfter.x+","+O.pointAfter.y,P[f].paths[N]=u,P[f].xings[N]={pointBefore:w.pointBefore,pointAfter:O.pointAfter,xRadius:_},P[f].t.splice(m+1,1),m-=1)}}for(T.push(e[0]),i=e.length,s=1;i>s;s+=1){if(f=s.toString(),P.hasOwnProperty(f))for(P[f].t.sort(function(e,t){return e-t}),m=0;m<P[f].t.length;m+=1)T.push(P[f].paths[P[f].t[m]]);T.push(e[s])}return T},s.prototype._pathIntersect=function(e){var n,i,o,r,s,a,l,c,d=this._pathPoints,h=e._pathPoints,p=d.length,g=h.length,u=[];if(t.overlap(this._pathPointsBBox,e._pathPointsBBox))for(o=0;p-1>o;o+=1)for(n={x1:d[o].x,y1:d[o].y,x2:d[o+1].x,y2:d[o+1].y},a=Math.sqrt((n.x2-n.x1)*(n.x2-n.x1)+(n.y2-n.y1)*(n.y2-n.y1)),r=0;g-1>r;r+=1)i={x1:h[r].x,y1:h[r].y,x2:h[r+1].x,y2:h[r+1].y},l=Math.sqrt((i.x2-i.x1)*(i.x2-i.x1)+(i.y2-i.y1)*(i.y2-i.y1)),s=this._getIntersect(n.x1,n.y1,n.x2,n.y2,i.x1,i.y1,i.x2,i.y2),s&&(s.segment1=o+1,s.segment2=r+1,s.segment1Length=a,s.segment2Length=l,s.path1=[n.x1,n.y1,n.x2,n.y2],s.path2=[i.x1,i.y1,i.x2,i.y2],c=Math.sqrt((s.x-n.x1)*(s.x-n.x1)+(s.y-n.y1)*(s.y-n.y1)),s.t1=c/a,c=Math.sqrt((s.x-i.x1)*(s.x-i.x1)+(s.y-i.y1)*(s.y-i.y1)),s.t2=c/l,u.push(s));return u},s.prototype._getIntersect=function(e,t,n,i,o,r,s,a){var l=Math.max,c=Math.min;if(!(l(e,n)<c(o,s)||c(e,n)>l(o,s)||l(t,i)<c(r,a)||c(t,i)>l(r,a))){var d=(e*i-t*n)*(o-s)-(e-n)*(o*a-r*s),h=(e*i-t*n)*(r-a)-(t-i)*(o*a-r*s),p=(e-n)*(r-a)-(t-i)*(o-s);if(p){var g=d/p,u=h/p,f=+g.toFixed(2),m=+u.toFixed(2);if(!(f<+c(e,n).toFixed(2)||f>+l(e,n).toFixed(2)||f<+c(o,s).toFixed(2)||f>+l(o,s).toFixed(2)||m<+c(t,i).toFixed(2)||m>+l(t,i).toFixed(2)||m<+c(r,a).toFixed(2)||m>+l(r,a).toFixed(2)))return{x:g,y:u}}}},s.prototype._checkIntersect=function(e,t,n,i,o,r,s,a){var l=Math.max,c=Math.min;if(!(l(e,n)<c(o,s)||c(e,n)>l(o,s)||l(t,i)<c(r,a)||c(t,i)>l(r,a)))return!0},s.prototype._getPointAtLength=function(e,t,n,i,o){var r=Math.sqrt((n-e)*(n-e)+(i-t)*(i-t)),s=(n-e)/r,a=(i-t)/r;return{x:e+s*o,y:t+a*o}},s.prototype._simplifyTrivially=function(e){for(var t,n,i,o,r,s,a,l,c,d=1;d<e.length-1;)t=e[d-1],n=e[d],i=e[d+1],o=n.x-t.x,s=n.y-t.y,l=0===o?s>0?Math.PI/2:Math.PI/2*3:Math.atan(s/o),r=i.x-n.x,a=i.y-n.y,c=0===r?a>0?Math.PI/2:Math.PI/2*3:Math.atan(a/r),l===c?e.splice(d,1):d+=1},s.prototype.setMetaInfo=function(e){this._metaInfo=e},s.prototype.getMetaInfo=function(){return this._metaInfo},s.prototype._getPathDefFromPoints=function(e){var t,n,i,o,r=[],s=this.segmentPoints,a=0,l=0,c=0,d=0,h=0;for(t=e[0],r.push("M"+t.x+","+t.y),o=e[0],i=e.length,n=1;i>n;n+=1)t=e[n],this.isBezier===!1?r.push("L"+t.x+","+t.y):(s.length>0&&s.length>a&&this._isSamePoint(t,{x:s[a][0],y:s[a][1]})?(d=s[a][2],h=s[a][3],a+=1):(d=0,h=0),r.push("C"+(o.x+l)+","+(o.y+c)+" "+(t.x-d)+","+(t.y-h)+" "+t.x+","+t.y),o=t,l=d,c=h);return r},s}),define("js/Widgets/DiagramDesigner/DiagramDesignerWidget.Connections",["js/Widgets/DiagramDesigner/Connection","js/Widgets/DiagramDesigner/DiagramDesignerWidget.Constants"],function(e,t){"use strict";var n,i="connection-drawing";return n=function(){},n.prototype.createConnection=function(t){var n,i=this._getGuid("C_"),o=_.extend({},t),r=o.srcObjId,s=o.srcSubCompId,a=o.dstObjId,l=o.dstSubCompId;return this.logger.debug("Creating connection component with parameters: "+JSON.stringify(o)),o.designerCanvas=this,this.connectionIds.push(i),this._insertedConnectionIDs.push(i),this.connectionEndIDs[i]={srcObjId:r,srcSubCompId:s,dstObjId:a,dstSubCompId:l},this._saveConnectionIDbyEndID(i,r,s),this._saveConnectionIDbyEndID(i,a,l),n=this.items[i]=new e(i),n._initialize(o),n},n.prototype.updateConnection=function(e,t){var n=t.srcObjId,i=t.srcSubCompId,o=t.dstObjId,r=t.dstSubCompId;this.logger.debug('Updating connection component with ID: "'+e+'"'),this._updatedConnectionIDs.push(e),(n!==this.connectionEndIDs[e].srcObjId||i!==this.connectionEndIDs[e].srcSubCompId)&&(this._removeConnectionIDfromEnd(e,!0),this._saveConnectionIDbyEndID(e,n,i)),(o!==this.connectionEndIDs[e].dstObjId||r!==this.connectionEndIDs[e].dstSubCompId)&&(this._removeConnectionIDfromEnd(e,!1),this._saveConnectionIDbyEndID(e,o,r)),this.connectionEndIDs[e]={srcObjId:n,srcSubCompId:i,dstObjId:o,dstSubCompId:r},this.items[e].update(t)},n.prototype.updateConnectionTexts=function(e,t){this.logger.debug('Updating connection texts with ID: "'+e+'"'),this.items[e].updateTexts(t)},n.prototype.deleteConnection=function(e){var t;this.logger.debug('Deleting connection component with ID: "'+e+'"'),this._deletedConnectionIDs.push(e),this._removeConnectionIDfromEnd(e,!0),this._removeConnectionIDfromEnd(e,!1),delete this.connectionEndIDs[e],t=this.connectionIds.indexOf(e),this.connectionIds.splice(t,1),this.items[e].destroy(),delete this.items[e]},n.prototype._saveConnectionIDbyEndID=function(e,n,i){i=i||t.SELF,this.connectionIDbyEndID[n]=this.connectionIDbyEndID[n]||{},this.connectionIDbyEndID[n][i]=this.connectionIDbyEndID[n][i]||[],this.connectionIDbyEndID[n][i].push(e)},n.prototype._removeConnectionIDfromEnd=function(e,n){var i,o=n?this.connectionEndIDs[e].srcObjId:this.connectionEndIDs[e].dstObjId,r=n?this.connectionEndIDs[e].srcSubCompId:this.connectionEndIDs[e].dstSubCompId;r=r||t.SELF,i=this.connectionIDbyEndID[o][r].indexOf(e),-1!==i&&this.connectionIDbyEndID[o][r].splice(i,1)},n.prototype.onCreateNewConnection=function(e){this.logger.warn("onCreateNewConnection with parameters: "+JSON.stringify(e))},n.prototype._onModifyConnectionEnd=function(e){var n=_.extend({},this.connectionEndIDs[e.id]),i=_.extend({},this.connectionEndIDs[e.id]);this.logger.debug("Modifying connection with parameters: "+JSON.stringify(e)),e.endPoint===t.CONNECTION_END_SRC?(i.srcObjId=e.endId,i.srcSubCompId=e.endSubCompId):(i.dstObjId=e.endId,i.dstSubCompId=e.endSubCompId),_.isEqual(n,i)===!1&&this.onModifyConnectionEnd({id:e.id,old:n,"new":i})},n.prototype.onModifyConnectionEnd=function(e){this.logger.warn("onModifyConnectionEnd with parameters: "+JSON.stringify(e))},n.prototype._connectionDrawStartAddClass=function(){this.skinParts.$itemsContainer.addClass(i)},n.prototype._connectionDrawEndRemoveClass=function(){this.skinParts.$itemsContainer.removeClass(i)},n.prototype._onEndConnectionDraw=function(){var e;for(this._connectionDrawEndRemoveClass(),e=this.itemIds.length;e--;)this.items[this.itemIds[e]].hideEndConnectors();for(e=this.connectionIds.length;e--;)this.items[this.connectionIds[e]].hideEndConnectors()},n.prototype._onStartConnectionCreate=function(e){var t,n,i,o=e.srcId,r=e.srcSubCompId,s=[],a=this.items[o]._decoratorInstance?this.items[o]._decoratorInstance.getConnectorMetaInfo():void 0,l=r?this.items[o]._decoratorInstance.getConnectorMetaInfo(r):void 0;for(this.selectionManager.clear(),this.items[o].hideSourceConnectors(),t=this.itemIds.length;t--;)s.push({dstItemID:this.itemIds[t],dstSubCompID:void 0});for(n in this._itemSubcomponentsMap)if(this._itemSubcomponentsMap.hasOwnProperty(n))for(t=this._itemSubcomponentsMap[n].length;t--;)s.push({dstItemID:n,dstSubCompID:this._itemSubcomponentsMap[n][t]});if(this._connectToConnection===!0)for(t=this.connectionIds.length;t--;)s.push({dstItemID:this.connectionIds[t],dstSubCompID:void 0});e.availableConnectionEnds=s,i=this.onFilterNewConnectionDroppableEnds(e)||[],this.logger.debug("_onStartConnectionCreate filteredDroppableEnds: "+JSON.stringify(i));for(var c=[],d=[];i.length>0;){t=i.length,n=i[0].dstItemID;var h=[];for(c=[];t--;)n===i[t].dstItemID&&(c.push(t),h.push(i[t].dstSubCompID));for(d.push([n,a,l,h]),c.sort(function(e,t){return e-t}),t=c.length;t--;)i.splice(c[t],1)}for(this.logger.debug("_onStartConnectionCreate decorator update package: "+JSON.stringify(d)),t=d.length;t--;)n=d[t][0],this.items[n].showEndConnectors({srcItemMetaInfo:d[t][1],srcSubCompMetaInfo:d[t][2],connectors:d[t][3]});this._connectionDrawStartAddClass()},n.prototype.onFilterNewConnectionDroppableEnds=function(e){return this.logger.warn("DiagramDesignerWidget.prototype.onFilterNewConnectionDroppableEnds not overridden in controller. params: "+JSON.stringify(e)),
e.availableConnectionEnds},n.prototype._onStartConnectionReconnect=function(e){var n,i,o,r,s,a,l,c,d,h,p,g=e.connId,u=e.draggedEnd===t.CONNECTION_END_SRC,f=[],m=[];for(this.selectionManager.hideSelectionOutline(),u===!0?this.connectionEndIDs[g]&&(o=this.connectionEndIDs[g].dstObjId,r=this.connectionEndIDs[g].dstSubCompId,l=this.items[o]._decoratorInstance?this.items[o]._decoratorInstance.getConnectorMetaInfo():void 0,c=r?this.items[o]._decoratorInstance.getConnectorMetaInfo(r):void 0):this.connectionEndIDs[g]&&(n=this.connectionEndIDs[g].srcObjId,i=this.connectionEndIDs[g].srcSubCompId,s=this.items[n]._decoratorInstance?this.items[n]._decoratorInstance.getConnectorMetaInfo():void 0,a=i?this.items[n]._decoratorInstance.getConnectorMetaInfo(i):void 0),d=this.itemIds.length;d--;)u===!0?m.push({srcItemID:this.itemIds[d],srcSubCompID:void 0}):f.push({dstItemID:this.itemIds[d],dstSubCompID:void 0});for(h in this._itemSubcomponentsMap)if(this._itemSubcomponentsMap.hasOwnProperty(h))for(d=this._itemSubcomponentsMap[h].length;d--;)u===!0?m.push({srcItemID:h,srcSubCompID:this._itemSubcomponentsMap[h][d]}):f.push({dstItemID:h,dstSubCompID:this._itemSubcomponentsMap[h][d]});e.availableConnectionEnds=f,e.availableConnectionSources=m,e.srcItemID=n,e.srcSubCompID=i,e.dstItemID=o,e.dstSubCompID=r,p=this.onFilterReconnectionDroppableEnds(e)||[],this.logger.debug("_onStartConnectionReconnect filteredResult:"+JSON.stringify(p));for(var _=[],b=[],y=u?"src":"dst";p.length>0;){d=p.length,h=p[0][y+"ItemID"];var v=[];for(_=[];d--;)h===p[d][y+"ItemID"]&&(_.push(d),v.push(p[d][y+"SubCompID"]));for(b.push([h,u?s:l,u?a:c,v]),_.sort(function(e,t){return e-t}),d=_.length;d--;)p.splice(_[d],1)}for(this.logger.debug("_onStartConnectionReconnect decorator update package: "+JSON.stringify(b)),d=b.length;d--;)h=b[d][0],u?this.items[h].showSourceConnectors({dstItemMetaInfo:b[d][1],dstSubCompMetaInfo:b[d][2],connectors:b[d][3]}):this.items[h].showEndConnectors({srcItemMetaInfo:b[d][1],srcSubCompMetaInfo:b[d][2],connectors:b[d][3]});this._connectionDrawStartAddClass()},n.prototype.onFilterReconnectionDroppableEnds=function(e){var n=e.draggedEnd===t.CONNECTION_END_SRC;return this.logger.warn("DiagramDesignerWidget.prototype.onFilterReconnectionDroppableEnds not overridden in controller. params: "+JSON.stringify(e)),n===!0?e.availableConnectionSources:e.availableConnectionEnds},n}),define("js/Widgets/DiagramDesigner/DiagramDesignerWidget.Subcomponents",[],function(){"use strict";var e;return e=function(){},e.prototype.registerSubcomponent=function(e,t,n){this._itemSubcomponentsMap[e]=this._itemSubcomponentsMap[e]||[],this._itemSubcomponentsMap[e].push(t),_.isFunction(this.onRegisterSubcomponent)&&this.onRegisterSubcomponent(e,t,n)},e.prototype.unregisterSubcomponent=function(e,t){var n;this.dispatchEvent(this.events.ON_UNREGISTER_SUBCOMPONENT,{objectID:e,subComponentID:t}),n=this._itemSubcomponentsMap[e].indexOf(t),-1!==n&&this._itemSubcomponentsMap[e].splice(n,1),_.isFunction(this.onUnregisterSubcomponent)&&this.onUnregisterSubcomponent(e,t)},e.prototype.unregisterAllSubcomponents=function(e){var t;if(this._itemSubcomponentsMap[e]){for(t=this._itemSubcomponentsMap[e].length;t--;)this.unregisterSubcomponent(e,this._itemSubcomponentsMap[e][t]);delete this._itemSubcomponentsMap[e]}},e}),define("js/Widgets/DiagramDesigner/ConnectionRouteManagerBasic",["js/logger"],function(e){"use strict";var t,n="_x_";return t=function(t){var n=t&&t.loggerName||"gme:Widgets:DiagramDesigner:ConnectionRouteManagerBasic";if(this.logger=t&&t.logger||e.create(n,WebGMEGlobal.gmeConfig.client.log),this.diagramDesigner=t?t.diagramDesigner:null,void 0===this.diagramDesigner||null===this.diagramDesigner)throw this.logger.error("Trying to initialize a ConnectionRouteManagerBasic without a canvas..."),"ConnectionRouteManagerBasic can not be created";this.logger.debug("ConnectionRouteManagerBasic ctor finished")},t.prototype.initialize=function(){},t.prototype.destroy=function(){},t.prototype.redrawConnections=function(e){var t;for(this.logger.debug("Redraw connection request: "+e.length),e=this.diagramDesigner.connectionIds.slice(0),this._updateEndpointInfo(e),t=0;t<e.length;t+=1)this._updateConnectionCoordinates(e[t]);return e},t.prototype._updateEndpointInfo=function(e){var t,n,i,o,r,s,a=e.length,l=this.diagramDesigner;for(this.endpointConnectionAreaInfo={};a--;)t=e[a],n=l.connectionEndIDs[t].srcObjId,i=l.connectionEndIDs[t].srcSubCompId,o=l.connectionEndIDs[t].dstObjId,r=l.connectionEndIDs[t].dstSubCompId,s=l.items[t].getMetaInfo(),this._getEndpointConnectionAreas(n,i,!1,s),this._getEndpointConnectionAreas(o,r,!0,s)},t.prototype._getEndpointConnectionAreas=function(e,t,i,o){var r,s,a,l=t?e+n+t:e,c=this.diagramDesigner;if(this.endpointConnectionAreaInfo.hasOwnProperty(l)===!1&&(this.endpointConnectionAreaInfo[l]=[],void 0===t||void 0!==t&&this.diagramDesigner._itemSubcomponentsMap[e]&&-1!==this.diagramDesigner._itemSubcomponentsMap[e].indexOf(t)))for(a=c.items[e],r=a.getConnectionAreas(t,i,o)||[],s=r.length;s--;)this.endpointConnectionAreaInfo[l].push({x:r[s].x1+(r[s].x2-r[s].x1)/2,y:r[s].y1+(r[s].y2-r[s].y1)/2})},t.prototype._updateConnectionCoordinates=function(e){var t,i,o,r=this.diagramDesigner,s=r.connectionEndIDs[e].srcObjId,a=r.connectionEndIDs[e].srcSubCompId,l=r.connectionEndIDs[e].dstObjId,c=r.connectionEndIDs[e].dstSubCompId,d=a?s+n+a:s,h=c?l+n+c:l,p=r.items[e].segmentPoints,g=this.endpointConnectionAreaInfo[d]||[],u=this.endpointConnectionAreaInfo[h]||[],f=null,m=null,_=[];if(g.length>0&&u.length>0){if(s===l&&a===c?(f=g[0],m=u.length>1?u[1]:u[0]):(t=this._getClosestPoints(g,u,p),f=g[t[0]],m=u[t[1]]),_.push(f),p&&p.length>0)for(i=p.length,o=0;i>o;o+=1)_.push({x:p[o][0],y:p[o][1]});else s===l&&a===c&&(_.push({x:f.x+100,y:f.y-100}),_.push({x:f.x+200,y:f.y}),_.push({x:f.x+100,y:f.y+100}));_.push(m)}r.items[e].setConnectionRenderData(_)},t.prototype._getClosestPoints=function(e,t,n){var i,o,r,s,a,l,c,d=-1;if(n&&n.length>0)for(i=0;i<e.length;i+=1)for(o=0;o<t.length;o+=1)r={src:Math.abs(e[i].x-n[0][1]),tgt:Math.abs(t[o].x-n[n.length-1][0])},s={src:Math.abs(e[i].y-n[0][1]),tgt:Math.abs(t[o].y-n[n.length-1][1])},c=Math.sqrt(r.src*r.src+s.src*s.src)+Math.sqrt(r.tgt*r.tgt+s.tgt*s.tgt),(-1===d||d>c)&&(d=c,a=i,l=o);else for(i=0;i<e.length;i+=1)for(o=0;o<t.length;o+=1)r=Math.abs(e[i].x-t[o].x),s=Math.abs(e[i].y-t[o].y),c=Math.sqrt(r*r+s*s),(-1===d||d>c)&&(d=c,a=i,l=o);return[a,l]},t}),define("js/Widgets/DiagramDesigner/ConnectionRouteManager2",["js/logger"],function(e){"use strict";var t,n="_x_";return t=function(t){var n=t&&t.loggerName||"gme:Widgets:DiagramDesigner:ConnectionRouteManager2";if(this.logger=t&&t.logger||e.create(n,WebGMEGlobal.gmeConfig.client.log),this.diagramDesigner=t?t.diagramDesigner:null,void 0===this.diagramDesigner||null===this.diagramDesigner)throw this.logger.error("Trying to initialize a ConnectionRouteManagerBasic without a canvas..."),"ConnectionRouteManagerBasic can not be created";this.logger.debug("ConnectionRouteManagerBasic ctor finished")},t.prototype.initialize=function(){},t.prototype.destroy=function(){},t.prototype.redrawConnections=function(e){var t,n,i;for(this.logger.debug("Redraw connection request: "+e.length),t=this.diagramDesigner.connectionIds.slice(0);t.length>0;){for(this.endpointConnectionAreaInfo={},this.endpointConnectionAreaConnectionInfo={},this.connectionEndPoints={},i=this._updateEndpointInfo(t),n=t.length;n--;)this._calculateClosestEndpoints(t[n]);for(n=0;n<t.length;n+=1)this._updateConnectionCoordinates(t[n]);t=i}return t=this.diagramDesigner.connectionIds.slice(0)},t.prototype._updateEndpointInfo=function(e){for(var t,n,i,o,r,s,a=e.length,l=this.diagramDesigner,c=[];a--;)t=e[a],n=l.connectionEndIDs[t].srcObjId,i=l.connectionEndIDs[t].srcSubCompId,o=l.connectionEndIDs[t].dstObjId,r=l.connectionEndIDs[t].dstSubCompId,s=l.items[t].getMetaInfo(),this._getEndpointConnectionAreas(t,n,i,!1,s)||-1!==l.connectionIds.indexOf(n)&&c.push(t),this._getEndpointConnectionAreas(t,o,r,!0,s)||-1!==l.connectionIds.indexOf(o)&&c.push(t);return c},t.prototype._getEndPointID=function(e,t,i){var o="";return e&&(o+=e+n),o+=t,i&&(o+=n+i),o},t.prototype._getEndpointConnectionAreas=function(e,t,n,i,o){var r,s,a=this._getEndPointID(e,t,n),l=this._getEndPointID(void 0,t,n),c=[],d=this.diagramDesigner;if(this.endpointConnectionAreaInfo[a]=this.endpointConnectionAreaInfo[a]||[],this.endpointConnectionAreaConnectionInfo[l]=this.endpointConnectionAreaConnectionInfo[l]||{},void 0===n||void 0!==n&&this.diagramDesigner._itemSubcomponentsMap[t]&&-1!==this.diagramDesigner._itemSubcomponentsMap[t].indexOf(n))for(s=d.items[t],c=s.getConnectionAreas(n,i,o)||[],r=c.length;r--;)this.endpointConnectionAreaInfo[a][c[r].id]={x:c[r].x1,y:c[r].y1,angle1:c[r].angle1,angle2:c[r].angle2,len:c[r].len||10,id:c[r].id,w:c[r].x2-c[r].x1,h:c[r].y2-c[r].y1},this.endpointConnectionAreaConnectionInfo[l].hasOwnProperty(c[r].id)||(this.endpointConnectionAreaConnectionInfo[l][c[r].id]=0);return c.length>0},t.prototype._calculateClosestEndpoints=function(e){var t,n,i,o,r=this.diagramDesigner,s=r.connectionEndIDs[e].srcObjId,a=r.connectionEndIDs[e].srcSubCompId,l=r.connectionEndIDs[e].dstObjId,c=r.connectionEndIDs[e].dstSubCompId,d=this._getEndPointID(e,s,a),h=this._getEndPointID(e,l,c),p=this._getEndPointID(void 0,s,a),g=this._getEndPointID(void 0,l,c),u=r.items[e].segmentPoints,f=[],m=[],_=null,b=null;for(n in this.endpointConnectionAreaInfo[d])this.endpointConnectionAreaInfo[d].hasOwnProperty(n)&&(i=this.endpointConnectionAreaInfo[d][n],o={x:i.x+i.w/2,y:i.y+i.h/2,id:i.id},f.push(o));for(n in this.endpointConnectionAreaInfo[h])this.endpointConnectionAreaInfo[h].hasOwnProperty(n)&&(i=this.endpointConnectionAreaInfo[h][n],o={x:i.x+i.w/2,y:i.y+i.h/2,id:i.id},m.push(o));f.length>0&&m.length>0&&(s===l&&a===c?(_=f[0],b=m.length>1?m[1]:m[0]):(t=this._getClosestPoints(f,m,u),_=f[t[0]],b=m[t[1]]),this.endpointConnectionAreaConnectionInfo[p][_.id]+=1,this.endpointConnectionAreaConnectionInfo[g][b.id]+=1,this.connectionEndPoints[e]={source:[d,_.id,this.endpointConnectionAreaConnectionInfo[p][_.id]],target:[h,b.id,this.endpointConnectionAreaConnectionInfo[g][b.id]]})},t.prototype._updateConnectionCoordinates=function(e){var t,n,i,o,r,s,a,l,c,d,h,p=this.diagramDesigner,g=p.connectionEndIDs[e].srcObjId,u=p.connectionEndIDs[e].srcSubCompId,f=p.connectionEndIDs[e].dstObjId,m=p.connectionEndIDs[e].dstSubCompId,_=this._getEndPointID(void 0,g,u),b=this._getEndPointID(void 0,f,m),y=p.items[e].segmentPoints,v=this.connectionEndPoints[e]?this.connectionEndPoints[e].source:void 0,C=this.connectionEndPoints[e]?this.connectionEndPoints[e].target:void 0,E=null,D=null,I=[],T=0;if(v&&C){if(E=this.endpointConnectionAreaInfo[v[0]][v[1]],D=this.endpointConnectionAreaInfo[C[0]][C[1]],a=E.w/(this.endpointConnectionAreaConnectionInfo[_][E.id]+1),l=E.h/(this.endpointConnectionAreaConnectionInfo[_][E.id]+1),I.push({x:E.x+a*v[2],y:E.y+l*v[2]}),0!==E.len&&(s=this._getConnectorDelta(E,this.endpointConnectionAreaConnectionInfo[_][E.id]+1,v[2]),I.push({x:E.x+a*v[2]+s.dx+s.dx*T*(v[2]-1),y:E.y+l*v[2]+s.dy+s.dy*T*(v[2]-1)})),y&&y.length>0)for(i=y.length,n=0;i>n;n+=1)I.push({x:y[n][0],y:y[n][1]});a=D.w/(this.endpointConnectionAreaConnectionInfo[b][D.id]+1),l=D.h/(this.endpointConnectionAreaConnectionInfo[b][D.id]+1),0!==D.len&&(s=this._getConnectorDelta(D,this.endpointConnectionAreaConnectionInfo[b][D.id]+1,C[2]),I.push({x:D.x+a*C[2]+s.dx+s.dx*T*(C[2]-1),y:D.y+l*C[2]+s.dy+s.dy*T*(C[2]-1)})),I.push({x:D.x+a*C[2],y:D.y+l*C[2]})}for(i=I.length;i-->1;)I[i].x===I[i-1].x&&I[i].y===I[i-1].y&&I.splice(i,1);if(0===y.length)if(g===f&&u===m){var P=I.length-1;I[0].x===I[P].x?I[0].y===I[P].y?E.angle1>=0&&E.angle2<90?I.splice(2,0,{x:I[1].x+20,y:I[1].y-20},{x:I[1].x+40,y:I[1].y},{x:I[1].x+20,y:I[1].y+20},{x:I[1].x,y:I[1].y}):E.angle1>=90&&E.angle2<180?I.splice(2,0,{x:I[1].x+20,y:I[1].y+20},{x:I[1].x,y:I[1].y+40},{x:I[1].x-20,y:I[1].y+20},{x:I[1].x,y:I[1].y}):E.angle1>=180&&E.angle2<270?I.splice(2,0,{x:I[1].x-20,y:I[1].y-20},{x:I[1].x-40,y:I[1].y},{x:I[1].x-20,y:I[1].y+20},{x:I[1].x,y:I[1].y}):E.angle1>=270&&E.angle2<360&&I.splice(2,0,{x:I[1].x-20,y:I[1].y-20},{x:I[1].x,y:I[1].y-40},{x:I[1].x+20,y:I[1].y-20},{x:I[1].x,y:I[1].y}):(h=p.items[g].getBoundingBox(),I.splice(2,0,{x:I[1].x+h.width/2+20,y:I[1].y},{x:I[2].x+h.width/2+20,y:I[2].y})):I[0].y===I[P].y?(h=p.items[g].getBoundingBox(),I.splice(2,0,{x:I[1].x,y:I[1].y+h.height/2+20},{x:I[2].x,y:I[2].y+h.height/2+20})):I.splice(2,0,{x:I[2].x,y:I[1].y})}else if(t=I.slice(0),i=t.length,I=[],i>0){for(c=t[0],I.push(c),c=t[1],I.push(c),n=2;i-1>n;n+=1)c=t[n-1],d=t[n],o=d.x-c.x,r=d.y-c.y,0!==o&&0!==r&&(I.push({x:c.x,y:c.y+r/2}),I.push({x:c.x+o,y:c.y+r/2})),I.push(d);c=t[i-2],I.push(c),c=t[i-1],I.push(c)}p.items[e].setConnectionRenderData(I)},t.prototype._getConnectorDelta=function(e,t,n){var i=0,o=0,r=(e.angle1+(e.angle2-e.angle1)/t*n)*(Math.PI/180),s={dx:i,dy:o};if(0!==e.len){var a=Math.sin(r),l=Math.cos(r),c=e.len,d=0,h=c*l-d*a,p=c*a+d*l;s.dx=h,s.dy=p}return s},t.prototype._getClosestPoints=function(e,t,n){var i,o,r,s,a,l,c,d=-1;if(n&&n.length>0)for(i=0;i<e.length;i+=1)for(o=0;o<t.length;o+=1)r={src:Math.abs(e[i].x-n[0][0]),tgt:Math.abs(t[o].x-n[n.length-1][0])},s={src:Math.abs(e[i].y-n[0][1]),tgt:Math.abs(t[o].y-n[n.length-1][1])},c=Math.sqrt(r.src*r.src+s.src*s.src)+Math.sqrt(r.tgt*r.tgt+s.tgt*s.tgt),(-1===d||d>c)&&(d=c,a=i,l=o);else for(i=0;i<e.length;i+=1)for(o=0;o<t.length;o+=1)r=Math.abs(e[i].x-t[o].x),s=Math.abs(e[i].y-t[o].y),c=Math.sqrt(r*r+s*s),(-1===d||d>c)&&(d=c,a=i,l=o);return[a,l]},t}),define("js/Widgets/DiagramDesigner/ConnectionRouteManager3",["js/logger","module","AutoRouterActionApplier","./ConnectionRouteManager2","js/Utils/SaveToDisk"],function(e,t,n,i,o){"use strict";var r,s="_x_",a=!0;return r=function(o){if(window.Worker&&a){this._onItemCreateQueue={},this.workerQueue=[];var r,l=t.id.split("/");l.pop(),l=l.join("/"),r=l+"/AutoRouter.Worker.js",this.worker=new Worker(r),this.worker.postMessage([WebGMEGlobal.gmeConfig.client]),this.worker.onmessage=this._handleWorkerResponse.bind(this)}else this.readyToDownload=!1,window._.extend(this.prototype,n.prototype);this.init();var c=o&&o.loggerName||"gme:Widgets:DiagramDesigner:ConnectionRouteManager3";if(this.logger=o&&o.logger||e.create(c,WebGMEGlobal.gmeConfig.client.log),this.diagramDesigner=o?o.diagramDesigner:null,this.simpleRouter=new i(o),void 0===this.diagramDesigner||null===this.diagramDesigner)throw this.logger.error("Trying to initialize a ConnectionRouteManager3 without a canvas..."),"ConnectionRouteManager3 can not be created";this.logger.debug("ConnectionRouteManager3 ctor finished"),this._portSeparator=s},r.prototype.init=n.prototype._clearRecords,r.prototype._invokeAutoRouterMethod=function(){var e,t=Array.prototype.slice.call(arguments);switch(this.workerReady?this.worker.postMessage(t):this.workerQueue.push(t),t[0]){case"addPath":case"addBox":e=t[1][1],this._onItemCreateQueue[e]=[];break;case"clear":this.init();break;case"remove":e=t[1][1],delete this._onItemCreateQueue[e]}},r.prototype._handleWorkerResponse=function(e){var t=e.data;if("READY"===t)this._processQueue(),this.workerReady=!0;else{var n,i="_autorouterBoxes";switch(t[0]){case"getPathPoints":n=t[1][0];var o=t[2];this._renderConnection(n,o);break;case"routePaths":for(var r=t[1],s=r.length;s--;)this._renderConnection.apply(this,r[s]);break;case"addPath":i="_autorouterPaths";case"addBox":if(n=t[1][1],this[i][n]=t[2],this._onItemCreateQueue[n])for(s=0;s<this._onItemCreateQueue[n].length;s++)this._onItemCreateQueue[n][s].call(this,t[2]);this._onItemCreateQueue[n]=null;break;case"BugReplayList":DEBUG&&this.download("AR_bug_report"+(new Date).getTime()+".json",t[1]),this.readyToDownload=!1}}},r.prototype.initialize=function(){this._clearGraph();var e=this;this._onComponentUpdate=function(t,n){if(-1!==e.diagramDesigner.itemIds.indexOf(n)){if(e.diagramDesigner.items[n].rotation!==e._autorouterBoxRotation[n]){var i=e._resizeItem.bind(e,n);e._modifyItem(n,i)}}else-1!==e.diagramDesigner.connectionIds.indexOf(n)&&(void 0!==e._onItemCreateQueue[n]?(e.deleteItem(n),e.insertConnection(n)):e.logger.warn("Received update event for nonexistent path"))},this.diagramDesigner.addEventListener(this.diagramDesigner.events.ON_COMPONENT_UPDATE,this._onComponentUpdate),this._onComponentCreate=function(t,n){void 0===e._onItemCreateQueue[n]?-1!==e.diagramDesigner.itemIds.indexOf(n)?e.insertBox(n):-1!==e.diagramDesigner.connectionIds.indexOf(n)&&e.insertConnection(n):e.logger.warn("Received ON_COMPONENT_CREATE event for already created item! ("+n+")")},this.diagramDesigner.addEventListener(this.diagramDesigner.events.ON_COMPONENT_CREATE,this._onComponentCreate),this._onComponentResize=function(t,n){if(void 0!==e._onItemCreateQueue[n.ID]){var i=e._resizeItem.bind(e,n.ID);e._modifyItem(n.ID,i)}else e.logger.warn("Received ITEM_SIZE_CHANGED event for nonexistent item! ("+n.ID+")"),e.insertBox(n.ID)},this.diagramDesigner.addEventListener(this.diagramDesigner.events.ITEM_SIZE_CHANGED,this._onComponentResize),this._onComponentDelete=function(t,n){void 0!==e._onItemCreateQueue[n]?e.deleteItem(n):e.logger.warn("Received ON_COMPONENT_DELETE event for nonexistent item! ("+n+")")},this.diagramDesigner.addEventListener(this.diagramDesigner.events.ON_COMPONENT_DELETE,this._onComponentDelete),this._onItemPositionChanged=function(t,n){if(void 0!==e._onItemCreateQueue[n.ID]){var i=e.diagramDesigner.items[n.ID].getBoundingBox().x,o=e.diagramDesigner.items[n.ID].getBoundingBox().y;e._modifyItem(n.ID,e._invokeAutoRouterMethod.bind(e,"move",[n.ID,{x:i,y:o}]))}else e.logger.warn("Received ITEM_POSITION_CHANGED event for nonexistent item! ("+n.ID+")")},this.diagramDesigner.addEventListener(this.diagramDesigner.events.ITEM_POSITION_CHANGED,this._onItemPositionChanged),this._onClear=function(){e._clearGraph()},this.diagramDesigner.addEventListener(this.diagramDesigner.events.ON_CLEAR,this._onClear),this._onUnregisterSubcomponent=function(t,n){var i=n.objectID+s+n.subComponentID;void 0!==e._onItemCreateQueue[i]?e.deleteItem(i):e.logger.warn("Received UNREGISTER event for nonexistent item! ("+i+")")},this.diagramDesigner.addEventListener(this.diagramDesigner.events.ON_UNREGISTER_SUBCOMPONENT,this._onUnregisterSubcomponent)},r.prototype.destroy=function(){this.diagramDesigner.removeEventListener(this.diagramDesigner.events.ON_COMPONENT_CREATE,this._onComponentCreate),this.diagramDesigner.removeEventListener(this.diagramDesigner.events.ON_COMPONENT_UPDATE,this._onComponentUpdate),this.diagramDesigner.removeEventListener(this.diagramDesigner.events.ITEM_SIZE_CHANGED,this._onComponentResize),this.diagramDesigner.removeEventListener(this.diagramDesigner.events.ON_COMPONENT_DELETE,this._onComponentDelete),this.diagramDesigner.removeEventListener(this.diagramDesigner.events.ITEM_POSITION_CHANGED,this._onItemPositionChanged),this.diagramDesigner.removeEventListener(this.diagramDesigner.events.ON_CLEAR,this._onClear),this.diagramDesigner.removeEventListener(this.diagramDesigner.events.ON_UNREGISTER_SUBCOMPONENT,this._onUnregisterSubcomponent),this.worker&&this.worker.terminate()},r.prototype.redrawConnections=function(e){this.simpleRouter.redrawConnections(e),this._initialized||this._initializeGraph(),this._invokeAutoRouterMethod("routeAsync",[])},r.prototype.renderConnections=function(e){for(var t=e||this.diagramDesigner.connectionIds.slice(0),n=t.length;n--;)this._autorouterPaths[t[n]]&&this._invokeAutoRouterMethod("getPathPoints",[t[n]]);return t},r.prototype._renderConnection=function(e,t){this.diagramDesigner.items[e]&&this.diagramDesigner.items[e].setConnectionRenderData(t)},r.prototype._clearGraph=function(){this._invokeAutoRouterMethod("clear",[]),this._autorouterBoxRotation={},this.endpointConnectionAreaInfo={},this.initialized=!1,this.readyToDownload=!0,this._onItemCreateQueue={}},r.prototype._initializeGraph=function(){for(var e=this.diagramDesigner,t=e.connectionIds,n=e.itemIds,i=n.length;i--;)this.insertBox(n[i]);for(i=t.length;i--;)this.insertConnection(t[i]);this._initialized=!0},r.prototype._processQueue=function(){for(var e=0;e<this.workerQueue.length;e++)this.worker.postMessage(this.workerQueue[e]);this.workerQueue=[]},r.prototype.insertConnection=function(e){var t,n=this.diagramDesigner,i=n.connectionEndIDs[e].srcObjId,o=n.connectionEndIDs[e].srcSubCompId,r=n.connectionEndIDs[e].dstObjId,a=n.connectionEndIDs[e].dstSubCompId,l=o?i+s+o:i,c=a?r+s+a:r,d=n.items[e].getMetaInfo(),h=n.items[i].getConnectionAreas(o,!1,d),p=n.items[r].getConnectionAreas(a,!0,d),g={},u={};for(this._updatePort(i,o),this._updatePort(r,a),t=h.length;t--;)g[h[t].id]=l;for(t=p.length;t--;)u[p[t].id]=c;if(0!==g.length&&0!==u.length&&this._invokeAutoRouterMethod("addPath",[{src:g,dst:u},e]),n.items[e].segmentPoints.length>0){var f=n.items[e],m=f.segmentPoints.slice();this._invokeAutoRouterMethod("setPathCustomPoints",[{path:e,points:m}])}},r.prototype.insertBox=function(e){var t,n,i,o,r,s=this.diagramDesigner,a=0;for(t=s.items[e],i=t.getBoundingBox(),n=t.getConnectionAreas(e,r)||[],o={x1:i.x,y1:i.y,x2:i.x2,y2:i.y2,ports:[]};a<n.length;)o.ports.push({id:n[a].id,area:[[n[a].x1,n[a].y1],[n[a].x2,n[a].y2]],angles:[n[a].angle1,n[a].angle2]}),a++;this._invokeAutoRouterMethod("addBox",[o,e]),this._autorouterBoxRotation[e]=s.items[e].rotation},r.prototype.deleteItem=function(e){var t=this._invokeAutoRouterMethod.bind(this,"remove",[e]);this._modifyItem(e,t)},r.prototype._resizeItem=function(e){var t,n,i=this.diagramDesigner,o=!0,r=i.items[e],s=r.getBoundingBox(),a={x1:s.x,x2:s.x2,y1:s.y,y2:s.y2},l=[],c=r.getConnectionAreas(e,o,t);for(n=c.length;n--;)l.push({id:c[n].id,area:[[c[n].x1,c[n].y1],[c[n].x2,c[n].y2]],angles:[c[n].angle1,c[n].angle2]});for(this._invokeAutoRouterMethod("setBoxRect",[e,a]),n=l.length;n--;)this._invokeAutoRouterMethod("updatePort",[e,l[n]])},r.prototype._updatePort=function(e,t){var n,i,o=e+s+t;void 0!==t?void 0===this._onItemCreateQueue[o]?this._createPort(e,t):(n=this._createPortInfo(e,t),i=this._invokeAutoRouterMethod.bind(this,"setBoxRect",[o,n]),this._modifyItem(o,i)):this._modifyItem(e,this._updateBoxConnectionAreas.bind(this,e))},r.prototype._modifyItem=function(e,t){null===this._onItemCreateQueue[e]?t():this._onItemCreateQueue[e].push(t)},r.prototype._updateBoxConnectionAreas=function(e){var t,n,i=this.diagramDesigner.items[e].getConnectionAreas()||[],o={},r=[],s=this._autorouterBoxes[e];for(n=i.length;n--;)r.push({id:i[n].id,area:[[i[n].x1,i[n].y1],[i[n].x2,i[n].y2]],angles:[i[n].angle1,i[n].angle2]}),o[i[n].id]=!0;for(n=r.length;n--;)this._invokeAutoRouterMethod("updatePort",[e,r[n]]);for(n=s.ports.length;n--;)t=s.ports[n].id,o[t]||this._invokeAutoRouterMethod("removePort",[s.ports[n]])},r.prototype._createPort=function(e,t){var n=e+s+t,i=this._createPortInfo(e,t);this._invokeAutoRouterMethod("addBox",[i,n]),this._invokeAutoRouterMethod("setComponent",[e,n])},r.prototype._createPortInfo=function(e,t){for(var n=this.diagramDesigner,i=null,o=n.items[e].getConnectionAreas(t,!0,i)||[],r=o.length,s={x1:null,x2:null,y1:null,y2:null,ports:[]};r--;){var a=[o[r].angle1,o[r].angle2],l=Math.min(o[r].x1,o[r].x2),c=Math.max(o[r].x1,o[r].x2),d=Math.min(o[r].y1,o[r].y2),h=Math.max(o[r].y1,o[r].y2);if(s.ports.push({id:o[r].id,area:[[l,d],[c,h]],angles:a}),a){var p=a[0],g=a[1],u=0,f=90,m=180,_=270;(p>u||u>g)&&(c+=5),(p>m||m>g)&&(l-=5),(p>_||_>g)&&(d-=5),(p>f||f>g)&&(h+=5)}else 3>c-l&&(c+=3),3>h-d&&(h+=3);s.x2=Math.max(c+1,s.x2)||c+1,s.y1=Math.min(d-1,s.y1)||d-1,s.x1=Math.min(l-1,s.x1)||l-1,s.y2=Math.max(h+1,s.y2)||h+1}return s},r.prototype.download=function(e,t){var n=this;this.readyToDownload&&(e||(e="console.json"),o.saveJsonToDisk(e,t,n.logger,function(e,t){e&&n.logger.error("downloading resource for error handling failed",{metadata:{error:e}}),n.logger.error("Download url for auto-router debug data:",t),n.readyToDownload=!1}))},r}),define("js/Widgets/DiagramDesigner/ConnectionDrawingManager",["js/logger","js/Constants","js/Widgets/DiagramDesigner/DragScroll","./DiagramDesignerWidget.Constants"],function(e,t,n,i){"use strict";var o,r="ConnectionDrawingManager",s="mousedown."+r,a="mousemove."+r,l="mouseup."+r,c="mouseenter."+r,d="mouseleave."+r,h="#FF7800",p="-",g=2,u="none",f="none",m="create",_="reconnect",b=10;return o=function(t){var n=t&&t.loggerName||"gme:Widgets:DiagramDesigner:ConnectionDrawingManager";if(this.logger=e.create(n,WebGMEGlobal.gmeConfig.client.log),this._diagramDesigner=t?t.diagramDesigner:null,void 0===this._diagramDesigner||null===this._diagramDesigner)throw this.logger.error("Trying to initialize a ConnectionDrawingManager without a diagramDesigner..."),"ConnectionDrawingManager can not be created";this.logger.debug("ConnectionDrawingManager ctor finished")},o.prototype.initialize=function(e){var t=this;this._paper=this._diagramDesigner.skinParts.SVGPaper,this._metaInfo=null,this._connectionInDraw=!1,this._connectionPathProps={strokeWidth:g,strokeColor:h,lineType:p,arrowStart:f,arrowEnd:u},this._diagramDesigner.addEventListener(this._diagramDesigner.events.ITEM_POSITION_CHANGED,function(e,n){t._designerItemPositionChanged(n.ID)}),this._diagramDesigner.addEventListener(this._diagramDesigner.events.ITEM_SUBCOMPONENT_POSITION_CHANGED,function(e,n){t._designerItemPositionChanged(n.ItemID)}),this._diagramDesigner.addEventListener(this._diagramDesigner.events.ON_COMPONENT_DELETE,function(e,n){t._onComponentDelete(n)}),this._diagramDesigner.addEventListener(this._diagramDesigner.events.ON_UNREGISTER_SUBCOMPONENT,function(e,n){t._onComponentDelete(n.objectID,n.subComponentID)}),this._dragScroll=new n(this._diagramDesigner.skinParts.$diagramDesignerWidgetBody),this._el=e},o.prototype.activate=function(){this._activateMouseListeners()},o.prototype.deactivate=function(){this._deactivateMouseListeners()},o.prototype._activateMouseListeners=function(){var e=this;this._diagramDesigner._enableConnectionDrawing===!0&&(this._el.on(s,"."+i.CONNECTOR_CLASS,function(t){var n=$(this),o=n.attr(i.DATA_ITEM_ID),r=n.attr(i.DATA_SUBCOMPONENT_ID),s=1===t.which;e._diagramDesigner._triggerUIActivity(),s&&(void 0===o||null===o?e.logger.error('MOUSEDOWN on "connector" element but attribute "'+i.DATA_ITEM_ID+'" is not specified'):e._diagramDesigner.mode===e._diagramDesigner.OPERATING_MODES.DESIGN&&(e._startConnectionCreate(o,r,n,e._diagramDesigner.getAdjustedMousePos(t)),e._attachMouseListeners())),t.stopPropagation(),t.preventDefault()}),this._el.on(s,"."+i.CONNECTION_DRAGGABLE_END_CLASS,function(t){var n=$(this),i=n.attr("data-end"),o=n.attr("data-id"),r=1===t.which;r&&e._diagramDesigner.mode===e._diagramDesigner.OPERATING_MODES.DESIGN&&(e._startConnectionReconnect(o,i,e._diagramDesigner.getAdjustedMousePos(t)),e._attachMouseListeners()),t.stopPropagation(),t.preventDefault()}),this._el.on(l,"."+i.CONNECTOR_CLASS,function(){var t=$(this),n=t.attr(i.DATA_ITEM_ID),o=t.attr(i.DATA_SUBCOMPONENT_ID);e._connectionInDraw===!0&&(void 0===n||null===n?e.logger.error('MOUSEUP on "connector" element but attribute "'+i.DATA_ITEM_ID+'" is not specified'):e._diagramDesigner.mode===e._diagramDesigner.OPERATING_MODES.DESIGN&&e._minimalDistanceMet===!0&&e._connectionEndDrop(n,o))}))},o.prototype._deactivateMouseListeners=function(){this._el.off(s,"."+i.CONNECTOR_CLASS),this._el.off(s,"."+i.CONNECTION_DRAGGABLE_END_CLASS),this._el.off(c,"."+i.CONNECTOR_CLASS),this._el.off(d,"."+i.CONNECTOR_CLASS),this._el.off(l,"."+i.CONNECTOR_CLASS)},o.prototype.setConnectionInDrawProperties=function(e){this._connectionPathProps.strokeWidth="string"==typeof e[i.LINE_WIDTH]?e[i.LINE_WIDTH]:this._connectionPathProps.strokeWidth,this._connectionPathProps.strokeColor="string"==typeof e[i.LINE_COLOR]?e[i.LINE_COLOR]:this._connectionPathProps.strokeColor,this._connectionPathProps.arrowStart="string"==typeof e[i.LINE_START_ARROW]?e[i.LINE_START_ARROW]:this._connectionPathProps.arrowStart,this._connectionPathProps.arrowEnd="string"==typeof e[i.LINE_END_ARROW]?e[i.LINE_END_ARROW]:this._connectionPathProps.arrowEnd,this._connectionPathProps.lineType="string"==typeof e[i.LINE_PATTERN]?e[i.LINE_PATTERN]:this._connectionPathProps.lineType},o.prototype.setMetaInfo=function(e){this._metaInfo=e},o.prototype.getMetaInfo=function(){return this._metaInfo},o.prototype._attachMouseListeners=function(){var e=this;$(document).on(a,function(t){e._onBackgroundMouseMove(t),t.stopPropagation(),t.preventDefault()}),$(document).on(l,function(t){e._onBackgroundMouseUp(t),t.stopPropagation(),t.preventDefault()})},o.prototype._detachMouseListeners=function(){$(document).off(a),$(document).off(l)},o.prototype._drawConnection=function(){var e,t=this._connectionDesc.x,n=this._connectionDesc.y,i=this._connectionDesc.x2,o=this._connectionDesc.y2,r=7;if(!(Math.sqrt((i-t)*(i-t)+(o-n)*(o-n))<r)&&(e="M"+t+","+n+"L"+i+","+o,void 0===this._connectionPath?(this._connectionPath=this._paper.path(e),this._connectionPath.attr({"stroke-width":this._connectionPathProps.strokeWidth,stroke:this._connectionPathProps.strokeColor,"stroke-dasharray":this._connectionPathProps.lineType,"arrow-start":this._connectionPathProps.arrowStart,"arrow-end":this._connectionPathProps.arrowEnd})):this._connectionPath.attr({path:e}),this._connectionInDrawProps.type===_)){var s=this._diagramDesigner.items[this._connectionInDrawProps.connId].getConnectionProps();this._connectionPath.attr({"stroke-width":s.width,"arrow-start":s.arrowStart,"arrow-end":s.arrowEnd})}},o.prototype._getClosestConnectionPointCoordinates=function(e,t,n,i){var o,r,s,a,l,c,d,h=this._diagramDesigner.items[e];if(h){for(r=h.getConnectionAreas(t,!1,this._metaInfo)||[],s=r.length;s--;)this.logger.debug(JSON.stringify(r[s]));for(s=r.length,o={x:r[s-1].x1+(r[s-1].x2-r[s-1].x1)/2,y:r[s-1].y1+(r[s-1].y2-r[s-1].y1)/2},a=Math.sqrt((o.x-n)*(o.x-n)+(o.y-i)*(o.y-i)),s-=1;s--;)c=r[s].x1+(r[s].x2-r[s].x1)/2,d=r[s].y1+(r[s].y2-r[s].y1)/2,l=Math.sqrt((c-n)*(c-n)+(d-i)*(d-i)),a>l&&(a=l,o={x:c,y:d})}return o},o.prototype._connectionEndDrop=function(e,n){var o;this.logger.debug('Connection end dropped on item: "'+e+'", sCompId: "'+n+'"'),this._connectionInDrawProps.type===m?(o={src:this._connectionInDrawProps.src,srcSubCompId:this._connectionInDrawProps.sCompId,dst:e,dstSubCompId:n,visualStyle:{}},o[t.META_INFO]=this._metaInfo,this._connectionPathProps.strokeWidth!==g&&(o.visualStyle[i.LINE_WIDTH]=this._connectionPathProps.strokeWidth),this._connectionPathProps.strokeColor!==h&&(o.visualStyle[i.LINE_COLOR]=this._connectionPathProps.strokeColor),this._connectionPathProps.arrowStart!==f&&(o.visualStyle[i.LINE_START_ARROW]=this._connectionPathProps.arrowStart),this._connectionPathProps.arrowEnd!==u&&(o.visualStyle[i.LINE_END_ARROW]=this._connectionPathProps.arrowEnd),this._connectionPathProps.lineType!==p&&(o.visualStyle[i.LINE_PATTERN]=this._connectionPathProps.lineType),this.onCreateNewConnection(o)):this._connectionInDrawProps.type===_&&this.onModifyConnectionEnd({id:this._connectionInDrawProps.connId,endPoint:this._connectionInDrawProps.draggedEnd,endId:e,endSubCompId:n})},o.prototype.onCreateNewConnection=function(e){this.logger.warn("onCreateNewConnection: "+JSON.stringify(e))},o.prototype.onModifyConnectionEnd=function(e){this.logger.warn("onModifyConnectionEnd: "+JSON.stringify(e))},o.prototype._startConnectionCreate=function(e,t,n,i){var o;this.logger.debug('Start connection drawing from DesignerItem: "'+e+'", subcomponent: "'+t+'"'),this._connectionInDraw=!0,this._minimalDistanceMet=!1,this._setTempConnectionInDrawProperties(this._diagramDesigner.items[e].getDrawnConnectionVisualStyle(t)),this._connectionInDrawProps={src:e,sCompId:t,srcEl:n,type:m},o=this._getClosestConnectionPointCoordinates(e,t,i.mX,i.mY),this._connectionDesc={x:o.x,y:o.y,x2:i.mX,y2:i.mY},this._drawConnection(),this._dragScroll.start(),this.onStartConnectionCreate({srcId:e,srcSubCompId:t})},o.prototype.onStartConnectionCreate=function(e){this.logger.warn("onStartConnectionCreate with params: "+JSON.stringify(e))},o.prototype._startConnectionReconnect=function(e,t,n){this.logger.debug("_startConnectionReconnect connectionId:"+e+", draggedEnd:"+t),
this._connectionInDraw=!0,this._minimalDistanceMet=!0,this._connectionInDrawProps={connId:e,draggedEnd:t,type:_},this._connectionDesc={x:0,y:0,x2:0,y2:0},this._setConnectionRedrawCoordinates(n),this._drawConnection(),this._dragScroll.start(),this.onStartConnectionReconnect({connId:e,draggedEnd:t})},o.prototype.onStartConnectionReconnect=function(e){this.logger.warn("onStartConnectionReconnect with params: "+JSON.stringify(e))},o.prototype.isDrawInProgress=function(){return this._connectionInDraw===!0},o.prototype._setConnectionRedrawCoordinates=function(e){var t,n=this._connectionInDrawProps.connId,o=this._connectionInDrawProps.draggedEnd===i.CONNECTION_END_SRC;if(n)if(o===!0){if(this._diagramDesigner.connectionEndIDs[n]){var r=this._diagramDesigner.connectionEndIDs[n].dstObjId,s=this._diagramDesigner.connectionEndIDs[n].dstSubCompId;t=this._getClosestConnectionPointCoordinates(r,s,e.mX,e.mY),this._connectionDesc.x=e.mX,this._connectionDesc.y=e.mY,this._connectionDesc.x2=t.x,this._connectionDesc.y2=t.y}}else if(this._diagramDesigner.connectionEndIDs[n]){var a=this._diagramDesigner.connectionEndIDs[n].srcObjId,l=this._diagramDesigner.connectionEndIDs[n].srcSubCompId;t=this._getClosestConnectionPointCoordinates(a,l,e.mX,e.mY),this._connectionDesc.x2=e.mX,this._connectionDesc.y2=e.mY,this._connectionDesc.x=t.x,this._connectionDesc.y=t.y}},o.prototype._setConnectionCreateCoordinates=function(e){var t=this._getClosestConnectionPointCoordinates(this._connectionInDrawProps.src,this._connectionInDrawProps.sCompId,e.mX,e.mY);this._connectionDesc.x=t.x,this._connectionDesc.y=t.y,this._connectionDesc.x2=e.mX,this._connectionDesc.y2=e.mY},o.prototype._onBackgroundMouseMove=function(e){var t=this._diagramDesigner.getAdjustedMousePos(e);if(this._connectionInDraw===!0)if(this._minimalDistanceMet===!0)this._updateDrawnConnection(t);else{var n=t.mX-this._connectionDesc.x2,i=t.mY-this._connectionDesc.y2;(Math.abs(n)>=b||Math.abs(i)>=b)&&(this._minimalDistanceMet=!0,this._updateDrawnConnection(t))}},o.prototype._updateDrawnConnection=function(e){this._connectionInDrawProps.type===m?this._setConnectionCreateCoordinates(e):this._connectionInDrawProps.type===_&&this._setConnectionRedrawCoordinates(e),this._drawConnection()},o.prototype._onBackgroundMouseUp=function(){this.logger.debug("_onBackgroundMouseUp"),this._detachMouseListeners(),this._endConnectionDraw()},o.prototype._endConnectionDraw=function(){this._connectionInDraw=!1,this._connectionPath&&(this._connectionPath.remove(),this._connectionPath=void 0),this._connectionInDrawProps=void 0,this._resetTempConnectionInDrawProperties(),this.onEndConnectionDraw(),this.logger.debug("Stopped connection drawing")},o.prototype.onEndConnectionDraw=function(){this.logger.warn("onEndConnectionDraw NOT OVERRIDDEN")},o.prototype._designerItemPositionChanged=function(e){this._connectionInDraw!==!1&&(this._connectionInDrawProps.type===m?this._connectionInDrawProps.src===e&&(this._setConnectionCreateCoordinates({mX:this._connectionDesc.x2,mY:this._connectionDesc.y2}),this._drawConnection()):this._connectionInDrawProps.type===_&&(this._connectionInDrawProps.draggedEnd===i.CONNECTION_END_SRC?this._diagramDesigner.connectionEndIDs[this._connectionInDrawProps.connId].dstObjId===e&&(this._setConnectionRedrawCoordinates({mX:this._connectionDesc.x,mY:this._connectionDesc.y}),this._drawConnection()):this._diagramDesigner.connectionEndIDs[this._connectionInDrawProps.connId].srcObjId===e&&(this._setConnectionRedrawCoordinates({mX:this._connectionDesc.x2,mY:this._connectionDesc.y2}),this._drawConnection())))},o.prototype._onComponentDelete=function(e,t){var n=!1;this._connectionInDraw!==!1&&(this._connectionInDrawProps.type===m?void 0===t||null===t?this._connectionInDrawProps.src===e&&(n=!0,this.logger.debug('Connection source "'+e+'" is being deleted. Connection creation canceled.')):this._connectionInDrawProps.src===e&&this._connectionInDrawProps.sCompId===t&&(n=!0,this.logger.debug('Connection source "'+e+'"/"'+t+'" is being deleted. Connection creation canceled.')):this._connectionInDrawProps.type===_&&(e===this._connectionInDrawProps.connId?(n=!0,this.logger.debug('Existing connection currently being redrawn "'+e+'" is being deleted. Connection re-connect canceled.')):void 0===t||null===t?(this._diagramDesigner.connectionEndIDs[this._connectionInDrawProps.connId].srcObjId===e||this._diagramDesigner.connectionEndIDs[this._connectionInDrawProps.connId].dstObjId===e)&&(n=!0,this.logger.debug('Existing connection endpoint "'+e+'" is being deleted. Connection re-connect canceled.')):(this._diagramDesigner.connectionEndIDs[this._connectionInDrawProps.connId].srcObjId===e&&this._diagramDesigner.connectionEndIDs[this._connectionInDrawProps.connId].srcSubCompId===t||this._diagramDesigner.connectionEndIDs[this._connectionInDrawProps.connId].dstObjId===e&&this._diagramDesigner.connectionEndIDs[this._connectionInDrawProps.connId].dstSubCompId===t)&&(n=!0,this.logger.debug('Existing connection endpoint "'+e+'"/"'+t+'" is being deleted. Connection creation canceled.'))),n===!0&&(this._detachMouseListeners(),this._endConnectionDraw()))},o.prototype._setTempConnectionInDrawProperties=function(e){e&&(this._saveTempConnectionInDrawProperties(),this.setConnectionInDrawProperties(e))},o.prototype._resetTempConnectionInDrawProperties=function(){this._savedConnectionProps&&this._revertSavedConnectionInDrawProperties()},o.prototype._saveTempConnectionInDrawProperties=function(){this._savedConnectionProps={};for(var e in this._connectionPathProps)this._connectionPathProps.hasOwnProperty(e)&&(this._savedConnectionProps[e]=this._connectionPathProps[e])},o.prototype._revertSavedConnectionInDrawProperties=function(){for(var e in this._savedConnectionProps)this._savedConnectionProps.hasOwnProperty(e)&&(this._connectionPathProps[e]=this._savedConnectionProps[e]);this._savedConnectionProps=void 0},o}),define("js/Widgets/DiagramDesigner/DiagramDesignerWidget.EventDispatcher",["common/EventDispatcher"],function(e){"use strict";var t;return t=function(){},t.prototype._addEventDispatcherExtensions=function(){$.extend(this,new e),this.events={ITEM_POSITION_CHANGED:"ITEM_POSITION_CHANGED",ITEM_ROTATION_CHANGED:"ITEM_ROTATION_CHANGED",ITEM_SUBCOMPONENT_POSITION_CHANGED:"ITEM_SUBCOMPONENT_POSITION_CHANGED",ON_COMPONENT_DELETE:"ON_COMPONENT_DELETE",ON_UNREGISTER_SUBCOMPONENT:"ON_UNREGISTER_SUBCOMPONENT",ON_COMPONENT_CREATE:"ON_COMPONENT_CREATE",ON_COMPONENT_UPDATE:"ON_COMPONENT_UPDATE",ON_CLEAR:"ON_CLEAR",ITEM_SIZE_CHANGED:"ITEM_SIZE_CHANGED"}},t}),define("css!js/Widgets/ZoomWidget/styles/ZoomWidget",[],function(){}),define("js/Widgets/ZoomWidget/ZoomWidget",["jquery-csszoom","css!./styles/ZoomWidget.css"],function(){"use strict";function e(e){var t=$('<a tabindex="0" class="btn-zoom btn-zoom-in ui-corner-all ui-state-default"><i class="glyphicon glyphicon-plus"/></a>'),n=$('<a tabindex="0" class="btn-zoom btn-zoom-out ui-corner-all ui-state-default"><i class="glyphicon glyphicon-minus"/></a>'),i=$("<div/>",{"class":"zoom-widget-container "+e["class"]}),o=$("<div/>",{"class":e.sliderClass}),r=$("<label/>",{"class":"zoom-widget-label"});e.zoomValues=e.zoomValues||[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.2,1.4,1.6,1.8,2,2.5,3,3.5,4],i.append(t),i.append(o),i.append(n),i.append(r),o.csszoom({zoomTarget:e.zoomTarget,zoomLevels:e.zoomValues,onZoom:function(t){r.text(t+"x"),"function"==typeof e.onZoom&&e.onZoom(t)}}),e.showSliderAtStart||o.addClass("hidden"),t.on("click",function(){$(this).popover("hide"),o.csszoom("zoomIn")}),n.on("click",function(){$(this).popover("hide"),o.csszoom("zoomOut")}),i.find(".btn-zoom").popover({delay:{show:500,hide:2e3},animation:!1,trigger:"hover",title:"Zoom",content:'<a class="slider-toggle" href=#>slider</a>',html:!0}).on("show.bs.popover",function(){var e=$(this);e.hasClass("btn-zoom-in")?n.popover("hide"):t.popover("hide")}).on("shown.bs.popover",function(){var e=$(this),t=e.width()/2+1,n=o.hasClass("hidden")?"Show slider":"Hide slider",r=i.find("[id="+e.attr("aria-describedby")+"]");e.hasClass("btn-zoom-in")?r.css("top",parseFloat(r.css("top"))+t+"px"):r.css("top",parseFloat(r.css("top"))-t+"px"),i.find("a.slider-toggle").text(n),i.find("a.slider-toggle").on("click",function(){e.popover("hide"),o.hasClass("hidden")?o.removeClass("hidden"):o.addClass("hidden")})}),this.$zoomContainer=i,this.$zoomSlider=o}return e}),define("js/Widgets/DiagramDesigner/DiagramDesignerWidget.Zoom",["js/Widgets/ZoomWidget/ZoomWidget"],function(e){"use strict";var t;return t=function(){},t.prototype._initZoom=function(t){var n=this,i=t.zoomValues,o=new e({"class":"diagram-designer-zoom-container",sliderClass:"diagram-designer-zoom-slider",zoomTarget:this.skinParts.$itemsContainer,zoomValues:i,onZoom:function(e){n._zoomRatio=e,n._resizeItemContainer()}});this._zoomSlider=o.$zoomSlider,this.$el.parent().append(o.$zoomContainer),this._addZoomMouseHandler(this.$el)},t.prototype._addZoomMouseHandler=function(e){var t=this;e.on("mousewheel",function(e){var n=e.originalEvent;n&&(n.ctrlKey||n.metaKey||n.altKey)&&(n.wheelDelta<0?t._zoomSlider.csszoom("zoomOut"):t._zoomSlider.csszoom("zoomIn"),e.stopPropagation(),e.preventDefault())}),e.on("DOMMouseScroll",function(e){var n=e.originalEvent;n&&(n.ctrlKey||n.metaKey||n.altKey)&&(n.detail>0?t._zoomSlider.csszoom("zoomOut"):t._zoomSlider.csszoom("zoomIn"),e.stopPropagation(),e.preventDefault())})},t}),define("js/Widgets/DiagramDesigner/DiagramDesignerWidget.Keyboard",["js/KeyboardManager/IKeyTarget"],function(e){"use strict";var t;return t=function(){},_.extend(t.prototype,e.prototype),t.prototype.onKeyDown=function(e){var t=!0;switch(e.combo){case"del":this.onSelectionDelete(this.selectionManager.getSelectedElements()),t=!1;break;case"ctrl+a":this.selectAll(),t=!1;break;case"ctrl+q":this.selectNone(),t=!1;break;case"ctrl+i":this.selectItems(),t=!1;break;case"ctrl+u":this.selectConnections(),t=!1;break;case"ctrl+l":this.selectInvert(),t=!1;break;case"up":this._moveSelection(0,-this.gridSize),t=!1;break;case"down":this._moveSelection(0,this.gridSize),t=!1;break;case"left":this._moveSelection(-this.gridSize,0),t=!1;break;case"right":this._moveSelection(this.gridSize,0),t=!1;break;case this.CONSTANTS.KEY_SHORT_CUT_MOVE_TO_TOP:this.onAlignSelection(this.selectionManager.getSelectedElements(),this.CONSTANTS.MOVE_TO_TOP),t=!1;break;case this.CONSTANTS.KEY_SHORT_CUT_MOVE_TO_BOTTOM:this.onAlignSelection(this.selectionManager.getSelectedElements(),this.CONSTANTS.MOVE_TO_BOTTOM),t=!1;break;case this.CONSTANTS.KEY_SHORT_CUT_MOVE_TO_LEFT:this.onAlignSelection(this.selectionManager.getSelectedElements(),this.CONSTANTS.MOVE_TO_LEFT),t=!1;break;case this.CONSTANTS.KEY_SHORT_CUT_MOVE_TO_RIGHT:this.onAlignSelection(this.selectionManager.getSelectedElements(),this.CONSTANTS.MOVE_TO_RIGHT),t=!1}return t},t.prototype.onKeyUp=function(e){var t=!0;switch(e.combo){case"up":this._endMoveSelection(),t=!1;break;case"down":this._endMoveSelection(),t=!1;break;case"left":this._endMoveSelection(),t=!1;break;case"right":this._endMoveSelection(),t=!1}return t},t.prototype._moveSelection=function(e,t){this._keyMoveDelta||(this._keyMoveDelta={x:0,y:0},this.dragManager._initDrag(0,0),this.dragManager._startDrag(void 0)),this._keyMoveDelta.x+=e,this._keyMoveDelta.y+=t,this.dragManager._updateDraggedItemPositions(this._keyMoveDelta.x,this._keyMoveDelta.y)},t.prototype._endMoveSelection=function(){this._keyMoveDelta&&(this._keyMoveDelta=void 0,this.dragManager._endDragAction())},t}),define("js/Widgets/DiagramDesigner/HighlightManager",["js/logger","js/Widgets/DiagramDesigner/DiagramDesignerWidget.Constants"],function(e,t){"use strict";var n;return n=function(t){var n=t&&t.loggerName||"gme:Widgets:DiagramDesigner:HighlightManager";if(this.logger=t&&t.logger||e.create(n,WebGMEGlobal.gmeConfig.client.log),this._diagramDesigner=t?t.diagramDesigner:null,void 0===this._diagramDesigner||null===this._diagramDesigner)throw this.logger.error("Trying to initialize a HighlightManager without a diagramDesigner..."),"HighlightManager can not be created";this._highlightedElements=[],this.logger.debug("HighlightManager ctor finished")},n.prototype.initialize=function(e){var t=this;this.$el=e,this._diagramDesigner.addEventListener(this._diagramDesigner.events.ON_COMPONENT_DELETE,function(e,n){t._onComponentDelete(n)})},n.prototype.activate=function(){this.$el.addClass(t.HIGHLIGHT_MODE_CLASS),this._activateMouseListeners()},n.prototype.deactivate=function(){this._deactivateMouseListeners(),this.$el.removeClass(t.HIGHLIGHT_MODE_CLASS),this._clear()},n.prototype._activateMouseListeners=function(){var e=this;this._diagramDesigner.onItemMouseDown=function(t,n){e._diagramDesigner.mode===e._diagramDesigner.OPERATING_MODES.HIGHLIGHT&&e._highLight(t,n.rightClick)},this._diagramDesigner.onConnectionMouseDown=function(t){e._diagramDesigner.mode===e._diagramDesigner.OPERATING_MODES.HIGHLIGHT&&e._highLight(t,!0)},this._diagramDesigner.onBackgroundDblClick=function(){e._diagramDesigner.mode===e._diagramDesigner.OPERATING_MODES.HIGHLIGHT&&e._clear()}},n.prototype._deactivateMouseListeners=function(){this._diagramDesigner.onItemMouseDown=void 0,this._diagramDesigner.onConnectionMouseDown=void 0,this._diagramDesigner.onBackgroundDblClick=void 0},n.prototype._highLight=function(e,t){var n,i,o=this._highlightedElements.indexOf(e),r=[];if(this.logger.debug('_highLight, ID: "'+e+'", highlightAssociated: '+t),-1===o){if(r.push(e),t)if(-1!==this._diagramDesigner.itemIds.indexOf(e))for(n=this._diagramDesigner._getConnectionsForItem(e),r=_.union(r,n),i=n.length;i--;)r=_.union(r,this._diagramDesigner._getItemsForConnection(n[i]));else-1!==this._diagramDesigner.connectionIds.indexOf(e)&&(n=this._diagramDesigner._getItemsForConnection(e),r=_.union(r,n));for(i=r.length;i--;)this._highlightedElements.push(r[i]),this._diagramDesigner.items[r[i]].highlight();this.onHighlight(r)}else{if(r.push(e),t)if(-1!==this._diagramDesigner.itemIds.indexOf(e))for(n=this._diagramDesigner._getConnectionsForItem(e),r=_.union(r,n),i=n.length;i--;)r=_.union(r,this._diagramDesigner._getItemsForConnection(n[i]));else-1!==this._diagramDesigner.connectionIds.indexOf(e)&&(n=this._diagramDesigner._getItemsForConnection(e),r=_.union(r,n));for(i=r.length;i--;)o=this._highlightedElements.indexOf(r[i]),this._highlightedElements.splice(o,1),this._diagramDesigner.items[r[i]].unHighlight();this.onUnhighlight(r)}},n.prototype._onComponentDelete=function(e){var t=this._highlightedElements.indexOf(e);-1!==t&&this._highLight(e,!1)},n.prototype._clear=function(){for(var e=this._highlightedElements.length,t=this._highlightedElements.slice(0);e--;)this._diagramDesigner.items[this._highlightedElements[e]].unHighlight();this._highlightedElements=[],this.onUnhighlight(t)},n.prototype.onHighlight=function(e){this.logger.debug("onHighlight idList: "+e)},n.prototype.onUnhighlight=function(e){this.logger.debug("onUnhighlight idList: "+e)},n}),define("js/Widgets/DiagramDesigner/SearchManager",["js/logger","js/Widgets/DiagramDesigner/DiagramDesignerWidget.Constants"],function(e,t){"use strict";var n;return n=function(t){var n=t&&t.loggerName||"gme:Widgets:DiagramDesigner:SearchManager";if(this.logger=t&&t.logger||e.create(n,WebGMEGlobal.gmeConfig.client.log),this._diagramDesigner=t?t.diagramDesigner:null,void 0===this._diagramDesigner||null===this._diagramDesigner)throw this.logger.error("Trying to initialize a SearchManager without a diagramDesigner..."),"SearchManager can not be created";this._highlightedElements=[],this._lastSearchDesc="",this.logger.debug("SearchManager ctor finished")},n.prototype.initialize=function(e){var t=this;this.$el=e,this._diagramDesigner.addEventListener(this._diagramDesigner.events.ON_COMPONENT_DELETE,function(e,n){t._onComponentDelete(n)})},n.prototype.activate=function(){this._diagramDesigner.toolbarItems&&this._diagramDesigner.toolbarItems.filterBox&&(this._diagramDesigner.toolbarItems.filterBox.enabled(!0),this._diagramDesigner.toolbarItems.filterBox.setText("")),this.filterItems("")},n.prototype.deactivate=function(){this._diagramDesigner.toolbarItems&&this._diagramDesigner.toolbarItems.filterBox&&(this._diagramDesigner.toolbarItems.filterBox.setText(""),this._diagramDesigner.toolbarItems.filterBox.enabled(!1)),this.filterItems("")},n.prototype.filterItems=function(e){e&&""!==e?(this.$el.addClass(t.HIGHLIGHT_MODE_CLASS),this._doSearch(e)):(this.$el.removeClass(t.HIGHLIGHT_MODE_CLASS),this._clear())},n.prototype.applyLastSearch=function(){var e=this._lastSearchDesc;this._clear(),this.filterItems(e)},n.prototype._doSearch=function(e){var t,n,i,o,r=[],s=this._diagramDesigner.itemIds,a=this._diagramDesigner.items;for(this._lastSearchDesc=e,t=s.length;t--;)n=s[t],a[n].doSearch(e)&&r.push(n);for(i=_.difference(this._highlightedElements,r),t=i.length;t--;)n=i[t],a[n]&&a[n].unHighlight(),o=this._highlightedElements.indexOf(n),this._highlightedElements.splice(o,1);for(i=_.difference(r,this._highlightedElements),t=i.length;t--;)n=i[t],a[n]&&a[n].highlight(),this._highlightedElements.push(n)},n.prototype._onComponentDelete=function(e){var t=this._highlightedElements.indexOf(e);-1!==t&&this._highlightedElements.splice(t,1)},n.prototype._clear=function(){for(var e=this._highlightedElements.length;e--;)this._diagramDesigner.items.hasOwnProperty(this._highlightedElements[e])&&this._diagramDesigner.items[this._highlightedElements[e]].unHighlight();this._highlightedElements=[],this._lastSearchDesc=""},n}),define("css!js/Controls/styles/ContextMenu",[],function(){}),define("js/Controls/ContextMenu",["jquery","css!./styles/ContextMenu.css"],function(){"use strict";var e,t="context-menu",n="context-menu-layer",i=$('<div id="'+t+'"><div class="dropdown"><ul class="dropdown-menu"></ul></div></div>'),o=$('<div id="'+n+'"></div>'),r=$("body"),s=$('<li><a tabindex="-1" href="#"></a></li>'),a="key",l="doNotHide",c=200,d=100;return e=function(e){this._menuDiv=i.clone(),this._backgroundDiv=o.clone(),this._menuUL=this._menuDiv.find("ul").first(),e&&e.hasOwnProperty("items")&&this.createMenu(e.items),e&&e.callback&&(this._callback=e.callback)},e.prototype.show=function(e){var t,n,i=this,o=this._callback,s=$(window).height(),h=$(window).width();this.hide(),r.append(this._backgroundDiv).append(this._menuDiv),e||(e={x:100,y:100}),t=s-e.y,n=h-e.x,this._menuUL.css({"max-height":t>d?t:d,"max-width":n>c?n:c}),this._menuDiv.css({display:"block",left:n>c?e.x:h-c,top:t>d?e.y:s-d}),o&&(this._menuUL.off("click"),this._menuUL.on("click","li",function(e){var t=$(this),n=t.data(a);e.stopPropagation(),e.preventDefault(),"true"!==t.attr(l)&&i.hide(),o(n)})),this._backgroundDiv.off("mousedown"),this._backgroundDiv.on("mousedown",function(e){e.stopPropagation(),e.preventDefault(),i.hide()})},e.prototype.createMenu=function(e){var t,n;this._menuUL.empty();for(var i in e)e.hasOwnProperty(i)&&(t=s.clone(),t.data(a,i),t.find("a").text(e[i].name),e[i].icon&&(t.find("a").prepend(" "),"string"==typeof e[i].icon?(n=$("<i/>",{"class":e[i].icon}),t.find("a").prepend(n)):t.find("a").prepend($(e[i].icon))),e[i].doNotHide&&t.attr(l,"true"),this._menuUL.append(t))},e.prototype.destroy=function(){this.hide(),this._menuUL.empty()},e.prototype.hide=function(){this._backgroundDiv.detach(),this._menuDiv.detach()},e}),define("js/Widgets/DiagramDesigner/DiagramDesignerWidget.ContextMenu",["js/Controls/ContextMenu"],function(e){"use strict";var t;return t=function(){},t.prototype.createMenu=function(t,n,i){var o,r=this.logger;o=new e({items:t,callback:function(e){r.debug("DiagramDesignerWidgetContextMenu_clicked: "+e),n&&n(e)}}),i=i||{x:200,y:200},o.show(i)},t}),define("js/Widgets/DiagramDesigner/DiagramDesignerWidget.Droppable",["js/DragDrop/DropTarget","./DiagramDesignerWidget.Constants"],function(e,t){"use strict";var n,i=0;return n=function(){},n.prototype._initDroppable=function(){var n=this;this._acceptDroppable=!1,this.acceptDropTempDisabled=!1,this.skinParts.$dropRegion=$("<div/>",{"class":t.DROP_REGION_CLASS}),this.skinParts.$dropRegion.insertBefore(this.skinParts.$itemsContainer),e.makeDroppable(this.skinParts.$dropRegion,{over:function(e,t){n._onDroppableOver(e,t)},out:function(){n._onDroppableOut()},drop:function(e,t){n._onBackgroundDrop(e,t)},activate:function(){n._onDroppableActivate()},deactivate:function(){n._onDroppableDeactivate()}})},n.prototype._onDroppableActivate=function(){this.mode===this.OPERATING_MODES.DESIGN&&this.skinParts.$dropRegion.css({width:"100%",height:"100%",top:this._scrollPos.top+i,left:this._scrollPos.left+i})},n.prototype._onDroppableDeactivate=function(){this.skinParts.$dropRegion.css({width:"0px",height:"0px",top:"0px",left:"0px"})},n.prototype._onDroppableOver=function(e,t){this.logger.debug("_onDroppableOver: "+JSON.stringify(t)),t?(this._doAcceptDroppable(this.onBackgroundDroppableAccept(e,t),!0),this._savedAcceptDroppable=this._acceptDroppable):this._doAcceptDroppable(!1,!1)},n.prototype._onDroppableOut=function(){this._doAcceptDroppable(!1,!1)},n.prototype._onBackgroundDrop=function(e,t){var n=this.getAdjustedMousePos(e),i=n.mX,o=n.mY;this.logger.debug("_onBackgroundDrop: "+JSON.stringify(t)),this._acceptDroppable===!0&&(this.acceptDropTempDisabled===!0?this.acceptDropTempDisabled=!1:this.onBackgroundDrop(e,t,{x:i,y:o})),this._doAcceptDroppable(!1,!1)},n.prototype._doAcceptDroppable=function(e,n){this.skinParts.$dropRegion.removeClass(t.DROP_REGION_ACCEPT_DROPPABLE_CLASS),this.skinParts.$dropRegion.removeClass(t.DROP_REGION_REJECT_DROPPABLE_CLASS),e===!0?(this._acceptDroppable=!0,n&&this.skinParts.$dropRegion.addClass(t.DROP_REGION_ACCEPT_DROPPABLE_CLASS)):(this._acceptDroppable=!1,n&&this.skinParts.$dropRegion.addClass(t.DROP_REGION_REJECT_DROPPABLE_CLASS))},n.prototype.onBackgroundDroppableAccept=function(e,t){return this.logger.warn("DiagramDesignerWidget.prototype.onBackgroundDroppableAccept(event, dragInfo) not overridden in controller!!! dragInfo:"+JSON.stringify(t)),!1},n.prototype.onBackgroundDrop=function(e,t,n){this.logger.warn("DiagramDesignerWidget.prototype.onBackgroundDrop(event, dragInfo) not overridden in controller!!! dragInfo:"+JSON.stringify(t)+' , position: "'+JSON.stringify(n)+'"')},n.prototype._enableDroppable=function(t){this.skinParts.$dropRegion&&(t===!0?(e.enableDroppable(this.skinParts.$dropRegion,!0),void 0!==this._savedAcceptDroppable&&this._doAcceptDroppable(this._savedAcceptDroppable,!0)):(e.enableDroppable(this.skinParts.$dropRegion,!1),this._doAcceptDroppable(!1,!1)))},n}),define("js/Widgets/DiagramDesigner/DiagramDesignerWidget.Draggable",["js/DragDrop/DragSource","js/DragDrop/DragHelper","./DiagramDesignerWidget.Constants"],function(e,t,n){"use strict";var i,o="diagram-designer-drag-outline",r=$("<div/>",{"class":o}),s=$('<i class="glyphicon glyphicon-move"></i>'),a=$('<i class="glyphicon glyphicon-plus"></i>');return i=function(){},i.prototype._makeDraggable=function(t){var i=this;e.makeDraggable(t.$el,{helper:function(e,t){return i._dragHelper(this,e,t)},dragItems:function(){return i.getDragItems(i.selectionManager.getSelectedElements())},dragEffects:function(e,t){return i.getDragEffects(i.selectionManager.getSelectedElements(),t)},dragParams:function(e,t){return i.getDragParams(i.selectionManager.getSelectedElements(),t)},start:function(e){var t=!1;if(i.mode===i.OPERATING_MODES.DESIGN)if(e.originalEvent.target instanceof SVGElement){var o=e.originalEvent.target.getAttribute("class");t=o?-1===o.split(" ").indexOf(n.CONNECTOR_CLASS):!0}else t=!$(e.originalEvent.target).hasClass(n.CONNECTOR_CLASS);return t}})},i.prototype._destroyDraggable=function(t){e.destroyDraggable(t.$el)},i.prototype._dragHelper=function(n,i,o){var l=r.clone(),c=this.selectionManager._getSelectionBoundingBox(),d=this.getAdjustedMousePos(i),h=t.getDragEffects(o);return this.logger.debug("_dragHelper's dragInfo: "+JSON.stringify(o)),c&&(l.css({width:(c.x2-c.x)*this._zoomRatio,height:(c.y2-c.y)*this._zoomRatio,"line-height":(c.y2-c.y)*this._zoomRatio+"px","text-align":"center",border:"2px dashed #666","background-color":"rgba(100, 100, 100, 0.1)","margin-top":(c.y-d.mY+e.DEFAULT_CURSOR_AT.top)*this._zoomRatio,"margin-left":(c.x-d.mX+e.DEFAULT_CURSOR_AT.left)*this._zoomRatio}),1===h.length&&(h[0]===e.DRAG_EFFECTS.DRAG_MOVE?l.append(s.clone()).append(" Move..."):h[0]===e.DRAG_EFFECTS.DRAG_COPY&&l.append(a.clone()).append(" Copy..."))),l},i.prototype.getDragItems=function(e){return this.logger.warn("DiagramDesignerWidgetDraggable.getDragItems is not overridden in the controller!!!selectedElements: "+e),[]},i.prototype.getDragEffects=function(t,n){var i=n.ctrlKey||n.metaKey,o=[e.DRAG_EFFECTS.DRAG_MOVE];return i&&(o=[e.DRAG_EFFECTS.DRAG_COPY]),o},i.prototype.getDragParams=function(e,t){for(var n,i={positions:{}},o=e.length,r=this.getAdjustedMousePos(t);o--;)n=e[o],-1!==this.itemIds.indexOf(n)&&(i.positions[n]={x:this.items[n].positionX-r.mX,y:this.items[n].positionY-r.mY});return i},i.prototype.DRAG_EFFECTS=e.DRAG_EFFECTS,i}),define("js/Widgets/DiagramDesigner/DiagramDesignerWidget.Clipboard",[],function(){"use strict";var e;return e=function(){},e.prototype.onCopy=function(){return void this.logger.warn("DiagramDesignerWidget.onCopy is not overridden in the controller!!!")},e.prototype.onPaste=function(e){this.logger.warn("DiagramDesignerWidget.onPaste is not overridden in the controller!!! data: "+e)},e}),define("js/Widgets/DiagramDesigner/DiagramDesignerWidget.Toolbar",["./DiagramDesignerWidget.OperatingModes","./DiagramDesignerWidget.Constants"],function(e,t){"use strict";var n;return n=function(){},n.prototype._initializeToolbar=function(){var n=WebGMEGlobal.Toolbar,i=this,o=$("<i/>");if(this.toolbarItems={},n){if(this.toolbarItems.beginSeparator=n.addSeparator(),this.toolbarItems.btnGridLayout=n.addButton({title:"Compact Grid Layout",icon:"glyphicon glyphicon-th",data:{mode:"grid"},clickFn:function(e){i.itemAutoLayout(e.mode)}}),this.toolbarItems.btnCozyGridLayout=n.addButton({title:"Sparse Grid Layout",icon:"glyphicon glyphicon-th-large",data:{mode:"cozygrid"},clickFn:function(e){i.itemAutoLayout(e.mode)}}),DEBUG===!0&&(this.toolbarItems.progressText=n.addLabel()),this.toolbarItems.gridSeparator=n.addSeparator(),this._disableConnectionRendering||(this.toolbarItems.radioButtonGroupRouteManager=n.addRadioButtonGroup(function(e){i._onConnectionRouteManagerChanged(e.type)}),this.toolbarItems.radioButtonGroupRouteManager.addButton({title:"Basic route manager",icon:o.clone().addClass("gme icon-gme_diagonal-arrow"),selected:"basic"===this._defaultConnectionRouteManagerType,data:{type:"basic"}}),this.toolbarItems.radioButtonGroupRouteManager.addButton({title:"Basic+ route manager",icon:o.clone().addClass("gme icon-gme_broken-arow"),selected:"basic2"===this._defaultConnectionRouteManagerType,data:{type:"basic2"}}),this._disableAutoRouterOption||this.toolbarItems.radioButtonGroupRouteManager.addButton({title:"AutoRouter",icon:o.clone().addClass("gme icon-gme_broken-arrow-with-box"),selected:"basic3"===this._defaultConnectionRouteManagerType,data:{type:"basic3"}}),this.toolbarItems.routingManagerSeparator=n.addSeparator()),this.toolbarItems.radioButtonGroupOperatingMode=n.addRadioButtonGroup(function(e){i.setOperatingMode(e.mode)}),this.toolbarItems.radioButtonGroupOperatingMode.addButton({icon:"glyphicon glyphicon-lock",title:"Read-only mode",data:{mode:e.prototype.OPERATING_MODES.READ_ONLY}}),this.toolbarItems.radioButtonGroupOperatingMode.addButton({icon:"glyphicon glyphicon-move",title:"Design mode",selected:!0,data:{mode:e.prototype.OPERATING_MODES.DESIGN}}),this.toolbarItems.radioButtonGroupOperatingMode.addButton({icon:"glyphicon glyphicon-eye-open",title:"Highlight mode",data:{mode:e.prototype.OPERATING_MODES.HIGHLIGHT}}),this.toolbarItems.modeSeparator=n.addSeparator(),DEBUG===!0&&(this.toolbarItems.btnXing=n.addToggleButton({icon:o.clone().addClass("gme icon-gme_crossing-lines"),title:"Connection crossing bumps ON/OFF",clickFn:function(e,t){i._setConnectionXingJumpMode(t)}}),this.toolbarItems.crossingLinesSeparator=n.addSeparator()),this._lineStyleControls===!0){this.toolbarItems.ddbtnConnectionArrowStart=n.addDropDownButton({title:"Line start marker",icon:"glyphicon glyphicon-arrow-left",menuClass:"no-min-width"}),this.toolbarItems.ddbtnConnectionPattern=n.addDropDownButton({title:"Line pattern",icon:"glyphicon glyphicon-minus",menuClass:"no-min-width"}),this.toolbarItems.ddbtnConnectionArrowEnd=n.addDropDownButton({title:"Line end marker",icon:"glyphicon glyphicon-arrow-right",menuClass:"no-min-width"}),this.toolbarItems.ddbtnConnectionLabelPlacement=n.addDropDownButton({title:"Line label placement",icon:"fa fa-sliders fa-rotate-90",menuClass:"no-min-width"}),this.toolbarItems.ddbtnConnectionLineWidth=n.addDropDownButton({title:"Line width",icon:o.clone().addClass("gme icon-gme_lines"),menuClass:"no-min-width"}),this.toolbarItems.ddbtnConnectionLineType=n.addDropDownButton({title:"Line type",icon:o.clone().addClass("gme  icon-gme_curvy-line"),menuClass:"no-min-width"});var r,s=function(e,n){var o=e===t.LINE_ARROWS.NONE?"":"-xwide-xlong",r=n?null:e+o,s=n?e+o:null;return{title:e,icon:i._createLineStyleMenuItem(null,null,null,r,s),data:{endArrow:s,startArrow:r},clickFn:function(e){var n={};e.endArrow&&(n[t.LINE_END_ARROW]=e.endArrow),e.startArrow&&(n[t.LINE_START_ARROW]=e.startArrow),i._setConnectionProperty(n)}}},a=function(e){return{title:e,icon:i._createLineStyleMenuItem(null,null,t.LINE_PATTERNS[e],null,null),data:{pattern:e},clickFn:function(e){var n={};n[t.LINE_PATTERN]=t.LINE_PATTERNS[e.pattern],i._setConnectionProperty(n)}}};for(r in t.LINE_ARROWS)t.LINE_ARROWS.hasOwnProperty(r)&&(this.toolbarItems.ddbtnConnectionArrowStart.addButton(s(t.LINE_ARROWS[r],!1)),this.toolbarItems.ddbtnConnectionArrowEnd.addButton(s(t.LINE_ARROWS[r],!0)));for(r in t.LINE_PATTERNS)t.LINE_PATTERNS.hasOwnProperty(r)&&this.toolbarItems.ddbtnConnectionPattern.addButton(a(r));this.toolbarItems.ddbtnConnectionLabelPlacement.addButton({title:"In the middle",icon:i._createLineStyleMenuItem(null,null,null,null,null,null,t.LINE_LABEL_PLACEMENTS.MIDDLE),clickFn:function(){var e={};e[t.LINE_LABEL_PLACEMENT]=t.LINE_LABEL_PLACEMENTS.MIDDLE,i._setConnectionProperty(e)}}),this.toolbarItems.ddbtnConnectionLabelPlacement.addButton({title:"Next to source",icon:i._createLineStyleMenuItem(null,null,null,null,null,null,t.LINE_LABEL_PLACEMENTS.SRC),clickFn:function(){var e={};e[t.LINE_LABEL_PLACEMENT]=t.LINE_LABEL_PLACEMENTS.SRC,i._setConnectionProperty(e)}}),this.toolbarItems.ddbtnConnectionLabelPlacement.addButton({title:"Next to destination",icon:i._createLineStyleMenuItem(null,null,null,null,null,null,t.LINE_LABEL_PLACEMENTS.DST),clickFn:function(){var e={};e[t.LINE_LABEL_PLACEMENT]=t.LINE_LABEL_PLACEMENTS.DST,i._setConnectionProperty(e)}}),this.toolbarItems.ddbtnConnectionLineType.addButton({title:"Straight",icon:i._createLineStyleMenuItem(),clickFn:function(){var e={};e[t.LINE_TYPE]=t.LINE_TYPES.NONE,i._setConnectionProperty(e)}}),this.toolbarItems.ddbtnConnectionLineType.addButton({title:"Bezier",icon:i._createLineStyleMenuItem(null,null,null,null,null,t.LINE_TYPES.BEZIER),clickFn:function(){var e={};e[t.LINE_TYPE]=t.LINE_TYPES.BEZIER,i._setConnectionProperty(e)}});var l=function(e){return{title:e,icon:i._createLineStyleMenuItem(e,null,t.LINE_PATTERNS.SOLID,null,null),data:{width:e},clickFn:function(e){var n={};n[t.LINE_WIDTH]=e.width,i._setConnectionProperty(n)}}};for(r=1;10>r;r+=1)this.toolbarItems.ddbtnConnectionLineWidth.addButton(l(r));this.toolbarItems.ddbtnConnectionArrowStart.enabled(!1),this.toolbarItems.ddbtnConnectionPattern.enabled(!1),this.toolbarItems.ddbtnConnectionArrowEnd.enabled(!1),this.toolbarItems.ddbtnConnectionLineType.enabled(!1),this.toolbarItems.ddbtnConnectionLineWidth.enabled(!1),this.toolbarItems.ddbtnConnectionLabelPlacement.enabled(!1)}this.toolbarItems.cpFillColor=n.addColorPicker({icon:"glyphicon glyphicon-tint",title:"Fill color",colorChangedFn:function(e){i.onSelectionFillColorChanged(i.selectionManager.getSelectedElements(),e)}}),this.toolbarItems.cpBorderColor=n.addColorPicker({icon:o.clone().addClass("gme icon-gme_pen"),
title:"Border color",colorChangedFn:function(e){i.onSelectionBorderColorChanged(i.selectionManager.getSelectedElements(),e)}}),this.toolbarItems.cpTextColor=n.addColorPicker({icon:"glyphicon glyphicon-font",title:"Text color",colorChangedFn:function(e){i.onSelectionTextColorChanged(i.selectionManager.getSelectedElements(),e)}}),this.toolbarItems.cpFillColor.enabled(!1),this.toolbarItems.cpBorderColor.enabled(!1),this.toolbarItems.cpTextColor.enabled(!1),this._defaultSearchUI===!0&&(this.toolbarItems.filterBox=n.addTextBox({prependContent:'<i class="glyphicon glyphicon-search"></i>&nbsp;',placeholder:"Find...",textChangedFn:function(e,t){i.searchManager.filterItems(t)}}))}this._toolbarInitialized=!0},n.prototype._displayToolbarItems=function(e){if(this._toolbarInitialized!==!0)this._initializeToolbar(e);else for(var t in this.toolbarItems)this.toolbarItems.hasOwnProperty(t)&&this.toolbarItems[t].show()},n.prototype._hideToolbarItems=function(){for(var e in this.toolbarItems)this.toolbarItems.hasOwnProperty(e)&&this.toolbarItems[e].hide()},n.prototype._removeToolbarItems=function(){for(var e in this.toolbarItems)this.toolbarItems.hasOwnProperty(e)&&this.toolbarItems[e].destroy()},n}),define("js/Widgets/DiagramDesigner/DiagramDesignerWidget.Mouse",["./DiagramDesignerWidget.Constants"],function(e){"use strict";var t,n="DiagramDesignerWidget";return t=function(){},t.prototype.initialize=function(e){this.$el=e,this._activateMouseListeners()},t.prototype._activateMouseListeners=function(){var t=this,i=this.logger;this.$el.on("mousedown."+n,"div."+e.DESIGNER_ITEM_CLASS,function(e){var o=$(this).attr("id"),r=t._processMouseEvent(e,!0,!0,!0,!0),s=!1,a=t.selectionManager.getSelectedElements(),l=-1===a.indexOf(o);l&&t.onItemMouseDown&&t.onItemMouseDown(o,r,s),i.debug("mousedown.item, ItemID: "+o+" eventDetails: "+JSON.stringify(r)),t.$el.on("mousemove."+n,function(){s=!0}),t.$el.on("mouseup."+n,function(){t.$el.off("mousemove."+n),t.$el.off("mouseup."+n),t.onItemMouseDown&&!l?t.onItemMouseDown.call(t,o,r,s):i.warn("onItemMouseDown(itemId, eventDetails) is undefined, ItemID: "+o+" eventDetails: "+JSON.stringify(r)+" mouseMoved: "+s)})}),this.$el.on("mousedown."+n,'path[class~="'+e.DESIGNER_CONNECTION_CLASS+'"]',function(n){var o=$(this).attr("id").replace(e.PATH_SHADOW_ARROW_END_ID_PREFIX,"").replace(e.PATH_SHADOW_ID_PREFIX,""),r=t._processMouseEvent(n,!0,!0,!0,!0);i.debug("mousedown.connection, connId: "+o+" eventDetails: "+JSON.stringify(r)),t.onConnectionMouseDown?t.onConnectionMouseDown.call(t,o,r):i.warn("onConnectionMouseDown(connId, eventDetails) is undefined, connId: "+o+" eventDetails: "+JSON.stringify(r))}),this.$el.on("mousedown."+n,function(e){var n=t._processMouseEvent(e,!0,!0,!0,!0);i.debug("mousedown.background, eventDetails: "+JSON.stringify(n)),t.onBackgroundMouseDown?t.onBackgroundMouseDown.call(t,n):i.warn("onBackgroundMouseDown(eventDetails) is undefined, eventDetails: "+JSON.stringify(n))}),this.$el.on("dblclick."+n,function(e){var n=t._processMouseEvent(e,!0,!0,!0,!0);t.onBackgroundDblClick?t.onBackgroundDblClick.call(t,n):i.warn("onBackgroundDblClick(eventDetails) is undefined, eventDetails: "+JSON.stringify(n)),i.warn("dblclick.background, eventDetails: "+JSON.stringify(n))}),this.$el.on("contextmenu."+n,function(e){e.preventDefault(),e.stopImmediatePropagation()})},t.prototype._processMouseEvent=function(e,t,n,i,o){return t===!0&&this._triggerUIActivity(),n===!0&&e.preventDefault(),i===!0&&e.stopPropagation(),o===!0&&e.stopImmediatePropagation(),this._getMouseEventDetails(e)},t.prototype._getMouseEventDetails=function(e){var t=this.getAdjustedMousePos(e),n={rightClick:3===e.which,ctrlKey:e.ctrlKey,metaKey:e.metaKey,altKey:e.altKey,shiftKey:e.shiftKey,mouseX:t.mX,mouseY:t.mY};return n},t.prototype.trackMouseMoveMouseUp=function(e,t){var i=this;$(document).on("mousemove."+n,function(t){var n=i._processMouseEvent(t,!1,!0,!0,!0);e&&e.call(i,n)}),$(document).on("mouseup."+n,function(e){var o=i._processMouseEvent(e,!1,!0,!0,!0);$(document).off("mousemove."+n),$(document).off("mouseup."+n),t&&t.call(i,o)})},t}),define("js/Widgets/DiagramDesigner/DiagramDesignerWidget.Tabs",["js/Toolbar/ToolbarButton","js/Toolbar/ToolbarDropDownButton"],function(e,t){"use strict";var n,i="diagram-designer-tabs-container",o="add-tab-container",r="tab-list-container",s=200,a="TAB_ID",l="TAB_RENAME",c="w-tabs",d="icon-ok",h=$('<i class="'+d+' glyphicon glyphicon-ok" />'),p=$('<li class=""><a href="#" data-toggle="tab"><div class="tab-title"></div></a></li>'),g=$('<i class="glyphicon glyphicon-remove-circle delete-tab-btn hidden"/>');return n=function(){},n.prototype._initializeTabs=function(){var n=this;this.$tabsContainer=$("<div/>",{"class":i}),this.$el.parent().append(this.$tabsContainer),this.$el.parent().addClass(c),this._tabCounter=0,this._selectedTab=void 0,this.$divAddTab=$("<div/>",{"class":o}),this._addTabs===!0&&(this.$btnAddTab=new e({title:"Add new tab...",icon:"glyphicon glyphicon-plus",clickFn:function(){n.getIsReadOnlyMode()!==!0&&n.onTabAddClicked()}}),this.$divAddTab.append(this.$btnAddTab.el)),this.$ddlTabsList=new t({title:"Tab list",icon:"glyphicon glyphicon-list"}),this.$divAddTab.append(this.$ddlTabsList.el),this.$btnScrollLeft=new e({title:"Scroll left",icon:"glyphicon glyphicon-chevron-left",clickFn:function(){n._tabsScrollLeft()}}),this.$divAddTab.append(this.$btnScrollLeft.el),this.$btnScrollRight=new e({title:"Scroll right",icon:"glyphicon glyphicon-chevron-right",clickFn:function(){n._tabsScrollRight()}}),this.$divAddTab.append(this.$btnScrollRight.el),this.$divTabList=$("<div/>",{"class":r}),this.$ulTabTab=$("<ul/>",{"class":"nav nav-tabs"}),this.$divTabList.append(this.$ulTabTab),this._makeTabsSortable(),this.$tabsContainer.append(this.$divAddTab),this.$tabsContainer.append(this.$divTabList),this._tabScrollValue=0,this.$ulTabTab.on("dblclick.editOnDblClick",".tab-title",function(e){if(n.getIsReadOnlyMode()!==!0){var t=$(this).parentsUntil("li").parent();t.data(l)===!0&&$(this).editInPlace({"class":"",onChange:function(e,t){var i=$(this).parent().parent();n.onTabTitleChanged(i.data(a),e,t)}})}e.stopPropagation(),e.preventDefault()}),this.$ulTabTab.on("click.deleteTabClick","a > i",function(e){var t=$(this).parent().parent();n.getIsReadOnlyMode()!==!0&&t.hasClass("active")&&n.onTabDeleteClicked(t.data(a)),e.stopPropagation(),e.preventDefault()}),this.$ulTabTab.on("click.selectTabClick","li",function(e){n.selectTab($(this).data(a)),e.stopPropagation(),e.preventDefault()})},n.prototype._addTabsButtonEnabled=function(e){this.$btnAddTab&&this.$btnAddTab.enabled(e)},n.prototype.clearTabs=function(){this._destroyTabsSortable(),this.$ulTabTab.empty(),this._makeTabsSortable(),this.$ddlTabsList.clear(),this._tabCounter=0,this._selectedTab=void 0,this._scrollTabListBy(0-this._tabScrollValue)},n.prototype._makeTabsSortable=function(){var e=this;this.getIsReadOnlyMode()!==!0&&this._reorderTabs===!0&&(this.$ulTabTab.hasClass("ui-sortable")||this.$ulTabTab.sortable({dropBehaviour:!0,stop:function(){e._onTabsSortStop()}}))},n.prototype._destroyTabsSortable=function(){this.$ulTabTab&&this.$ulTabTab.hasClass("ui-sortable")&&this.$ulTabTab.sortable("destroy")},n.prototype._addTabDeleteBtn=function(e){var t=g.clone();t.attr("title","Delete tab"),e.find("a").append(t)},n.prototype.addTab=function(e,t,n){var i=this,o=p.clone();return o.find(".tab-title").attr("title",e).text(e),o.data(a,this._tabCounter+""),this._tabCounter+=1,this._deleteTabs===!0&&t===!0&&this._addTabDeleteBtn(o),o.data(l,n),this.$ulTabTab.append(o),this.$ddlTabsList.addButton({title:e,text:e,data:{TAB_ID:o.data(a)},clickFn:function(e){i.selectTab(e.TAB_ID)}}),this._addingMultipleTabs!==!0&&this._refreshTabScrollButtons(),o.data(a)},n.prototype.addMultipleTabsBegin=function(){this._addingMultipleTabs=!0,this.$ulTabTab.hide()},n.prototype.addMultipleTabsEnd=function(){this.$ulTabTab.show(),this._refreshTabScrollButtons(),this._addingMultipleTabs=!1},n.prototype._tabsScrollLeft=function(){this._tabScrollValue<0&&this._scrollTabListBy(Math.min(Math.abs(this._tabScrollValue),s))},n.prototype._tabsScrollRight=function(){var e=this.$ulTabTab.width()-this.$tabsContainer.width()+this.$divAddTab.outerWidth(!0)+this._tabScrollValue;e>0&&(e=Math.min(e,s),this._scrollTabListBy(-e))},n.prototype._scrollTabListBy=function(e){this._tabScrollValue+=e,this.$ulTabTab.css("left",this._tabScrollValue),this._refreshTabScrollButtons()},n.prototype.selectTab=function(e){var t,n,i,o,r=this.$ulTabTab.find("li"),s=this.$ddlTabsList.el.find("li");if(this._selectedTab!==e){for(i=0;i<r.length;i+=1)if(o=$(r[i]),o&&o.data(a)===e){t=o;break}for(t&&(n=this.$ulTabTab.find("li.active"),n.removeClass("active"),n.find(".delete-tab-btn").addClass("hidden"),t.addClass("active"),t.find(".delete-tab-btn").removeClass("hidden"),this._selectedTab=t.data(a),this.setBackgroundText(this.$ulTabTab.find("li.active").first().find(".tab-title").text().toUpperCase())),t=void 0,i=0;i<s.length;i+=1)if(o=$(s[i]).find("a").first(),o&&o.data(a)===e){t=$(s[i]);break}t&&(this.$ddlTabsList.el.find("i."+d).remove(),t.find("a").prepend(h.clone())),this._scrollSelectedTabIntoView(),this.onSelectedTabChanged(this._selectedTab)}},n.prototype._scrollSelectedTabIntoView=function(){var e=this.$ulTabTab.find("li.active").first(),t=e.position(),n=this.$tabsContainer.width()-this.$divAddTab.outerWidth(!0),i=-this._tabScrollValue,o=-this._tabScrollValue+n;t&&(t.left<i?this._scrollTabListBy(i-t.left):t.left+e.width()>o&&this._scrollTabListBy(o-(t.left+e.width())))},n.prototype._refreshTabScrollButtons=function(){var e=this.$ulTabTab.width()-this.$tabsContainer.width()+this.$divAddTab.outerWidth(!0)+this._tabScrollValue;this.$btnScrollLeft.enabled(this._tabScrollValue<0),this.$btnScrollRight.enabled(e>0)},n.prototype._onTabsSortStop=function(){var e,t,n=this.$ulTabTab,i=n.find("li"),o=[];for(e=0;e<i.length;e+=1)t=$(i[e]),o.push(t.data(a));o.length>0&&this.onTabsSorted(o)},n.prototype._refreshTabTabsScrollOnResize=function(){if(this._tabsEnabled===!0){var e=this.$ulTabTab.width()-this.$tabsContainer.width()+this.$divAddTab.outerWidth(!0)+this._tabScrollValue;0>e&&this._scrollTabListBy(-e),this._scrollSelectedTabIntoView(),this._refreshTabScrollButtons()}},n.prototype.onTabDeleteClicked=function(e){this.logger.warn('onTabDeleteClicked not implemented: "'+e+'"')},n.prototype.onTabAddClicked=function(){var e=this.addTab("New tab",!0);this.logger.warn('onTabAddClicked not implemented: "'+e+'"')},n.prototype.onTabTitleChanged=function(e,t,n){this.logger.warn("onTabTitleChanged not implemented: ID: "+e+' "'+t+'" --> "'+n+'"')},n.prototype.onSelectedTabChanged=function(e){this.logger.warn('onSelectedTabChanged not implemented: "'+e+'"')},n.prototype.onTabsSorted=function(e){this.logger.warn('onTabsSorted not implemented: "'+e+'"')},n}),define("css!js/Widgets/DiagramDesigner/styles/DiagramDesignerWidget",[],function(){}),define("js/Widgets/DiagramDesigner/DiagramDesignerWidget",["js/logger","js/Constants","raphaeljs","js/Loader/LoaderCircles","js/Widgets/DiagramDesigner/SelectionManager","js/Widgets/DiagramDesigner/DragManager.Native","js/Widgets/DiagramDesigner/DiagramDesignerWidget.Constants","js/Widgets/DiagramDesigner/DiagramDesignerWidget.OperatingModes","js/Widgets/DiagramDesigner/DiagramDesignerWidget.DesignerItems","js/Widgets/DiagramDesigner/DiagramDesignerWidget.Connections","js/Widgets/DiagramDesigner/DiagramDesignerWidget.Subcomponents","js/Widgets/DiagramDesigner/ConnectionRouteManagerBasic","js/Widgets/DiagramDesigner/ConnectionRouteManager2","js/Widgets/DiagramDesigner/ConnectionRouteManager3","js/Widgets/DiagramDesigner/ConnectionDrawingManager","js/Widgets/DiagramDesigner/DiagramDesignerWidget.EventDispatcher","js/Widgets/DiagramDesigner/DiagramDesignerWidget.Zoom","js/Widgets/DiagramDesigner/DiagramDesignerWidget.Keyboard","js/Widgets/DiagramDesigner/HighlightManager","js/Widgets/DiagramDesigner/SearchManager","js/Widgets/DiagramDesigner/DiagramDesignerWidget.ContextMenu","js/Widgets/DiagramDesigner/DiagramDesignerWidget.Droppable","./DiagramDesignerWidget.Draggable","./DiagramDesignerWidget.Clipboard","./DiagramDesignerWidget.Toolbar","./DiagramDesignerWidget.Mouse","./DiagramDesignerWidget.Tabs","js/Utils/ComponentSettings","css!./styles/DiagramDesignerWidget.css"],function(e,t,n,i,o,r,s,a,l,c,d,h,p,g,u,f,m,_,b,y,v,C,E,D,I,T,P,N){"use strict";var A,w=100,O="diagram-designer",S=6,x="#DEDEDE",M=30,R=window.DEBUG,L=window._,k={loggerName:"gme:Widgets:DiagramDesigner:DiagramDesignerWidget",gridSize:10,droppable:!0,zoomUIControls:!0,defaultConnectionRouteManagerType:WebGMEGlobal.gmeConfig.client.defaultConnectionRouter};return A=function(t,n){var i=this,l=A.getDefaultConfig(),c={};this.CONSTANTS=s,N.resolveWithWebGMEGlobal(l,A.getComponentId()),L.extend(c,k,n),c.zoomValues=c.zoomValues||l.zoomValues,this.gmeConfig=WebGMEGlobal.gmeConfig,this.logger=e.create(c.loggerName,this.gmeConfig.client.log),this.$el=t,this._addEventDispatcherExtensions(),this.gridSize=c.gridSize,this._droppable=c.droppable,this._defaultSearchUI=!0,c.hasOwnProperty("defaultSearchUI")&&(this._defaultSearchUI=c.defaultSearchUI),this._lineStyleControls=!0,c.hasOwnProperty("lineStyleControls")&&(this._lineStyleControls=c.lineStyleControls),this._disableConnectionRendering=c.disableConnectionRendering,this._disableAutoRouterOption=c.disableAutoRouterOption,this._tabsEnabled=!1,this._addTabs=!1,this._deleteTabs=!1,this._reorderTabs=!1,c&&c.hasOwnProperty("tabsEnabled")&&(this._tabsEnabled=c.tabsEnabled&&!0),c&&c.hasOwnProperty("addTabs")&&(this._addTabs=c.addTabs&&!0),c&&c.hasOwnProperty("deleteTabs")&&(this._deleteTabs=c.deleteTabs&&!0),c&&c.hasOwnProperty("reorderTabs")&&(this._reorderTabs=c.reorderTabs&&!0),this._enableConnectionDrawing=!0,c&&c.hasOwnProperty("enableConnectionDrawing")&&(this._enableConnectionDrawing=c.enableConnectionDrawing&&!0),this._actualSize={w:0,h:0},this._containerSize={w:0,h:0},this._itemIDCounter=0,this._documentFragment=document.createDocumentFragment(),this._offset={left:0,top:0},this._scrollPos={left:0,top:0},this.mode=this.OPERATING_MODES.READ_ONLY,this._updating=!1,this._initializeCollections(),this._zoomRatio=1,this._connectToConnection=!0,this._connectionJumpXing=!1,this._initializeUI(),this._initZoom(c),this.selectionManager=c.selectionManager||new o({diagramDesigner:this}),this.selectionManager.initialize(this.skinParts.$itemsContainer),this.selectionManager.onSelectionCommandClicked=function(e,t,n){i._onSelectionCommandClicked(e,t,n)},this.selectionManager.onSelectionRotated=function(e,t){i.onSelectionRotated(e,t)},this.selectionManager.onSelectionChanged=function(e){i._onSelectionChanged(e)},this.dragManager=new r({diagramDesigner:this}),this.dragManager.initialize(this.skinParts.$itemsContainer),this._defaultConnectionRouteManagerType=c.defaultConnectionRouteManagerType,c.connectionRouteManager?this.connectionRouteManager=c.connectionRouteManager:"basic"===c.defaultConnectionRouteManagerType?this.connectionRouteManager=new h({diagramDesigner:this}):"basic2"===c.defaultConnectionRouteManagerType?this.connectionRouteManager=new p({diagramDesigner:this}):"basic3"===c.defaultConnectionRouteManagerType&&(this.connectionRouteManager=new g({diagramDesigner:this})),this.connectionRouteManager.initialize(),this.connectionDrawingManager=new u({diagramDesigner:this}),this.connectionDrawingManager.initialize(this.skinParts.$itemsContainer),this.connectionDrawingManager.onStartConnectionCreate=function(e){i._onStartConnectionCreate(e)},this.connectionDrawingManager.onStartConnectionReconnect=function(e){i._onStartConnectionReconnect(e)},this.connectionDrawingManager.onEndConnectionDraw=function(){i._onEndConnectionDraw()},this.connectionDrawingManager.onCreateNewConnection=function(e){i.onCreateNewConnection(e)},this.connectionDrawingManager.onModifyConnectionEnd=function(e){i._onModifyConnectionEnd(e)},this.highlightManager=new b({diagramDesigner:this}),this.highlightManager.initialize(this.skinParts.$itemsContainer),this.highlightManager.onHighlight=function(e){i.onHighlight(e)},this.highlightManager.onUnhighlight=function(e){i.onUnhighlight(e)},this.searchManager=new y({diagramDesigner:this}),this.searchManager.initialize(this.skinParts.$itemsContainer),this._afterManagersInitialized(),this.setOperatingMode(a.prototype.OPERATING_MODES.DESIGN),this._activateMouseListeners(),this.logger.debug("DiagramDesignerWidget ctor finished")},A.prototype._afterManagersInitialized=function(){},A.prototype._initializeCollections=function(){this.items={},this.itemIds=[],this.connectionIds=[],this.connectionEndIDs={},this.connectionIDbyEndID={},this._updating=!1,this._insertedDesignerItemIDs=[],this._updatedDesignerItemIDs=[],this._deletedDesignerItemIDs=[],this._insertedConnectionIDs=[],this._updatedConnectionIDs=[],this._deletedConnectionIDs=[],this._itemSubcomponentsMap={},this._itemIDCounter=0},A.prototype._getGuid=function(e){var t,n=this._itemIDCounter++ +"";for(t=S-n.length;t--;)n="0"+n;return e&&(n=e+n),n},A.prototype.setReadOnly=function(e){this._setReadOnlyMode(e),this.toolbarItems&&(this.toolbarItems.radioButtonGroupOperatingMode&&this.toolbarItems.radioButtonGroupOperatingMode.enabled(!e),this.toolbarItems.btnGridLayout&&this.toolbarItems.btnGridLayout.enabled(!e),this.toolbarItems.btnCozyGridLayout&&this.toolbarItems.btnCozyGridLayout.enabled(!e))},A.prototype.getIsReadOnlyMode=function(){return this.mode!==this.OPERATING_MODES.DESIGN},A.prototype._setReadOnlyMode=function(e){e===!0&&this.mode!==this.OPERATING_MODES.READ_ONLY?this.setOperatingMode(this.OPERATING_MODES.READ_ONLY):e===!1&&this.mode===this.OPERATING_MODES.READ_ONLY&&this.setOperatingMode(this.OPERATING_MODES.DESIGN)},A.prototype.onWidgetContainerResize=function(e,t){this._containerSize.w=e,this._containerSize.h=t,this._resizeItemContainer(),this._refreshTabTabsScrollOnResize()},A.prototype.destroy=function(){this.__loader.destroy(),this._removeToolbarItems(),this.connectionRouteManager.destroy()},A.prototype._initializeUI=function(){this.logger.debug("DiagramDesignerWidget._initializeUI"),this.$el.empty(),this.$el.addClass(O),this._attachScrollHandler(this.$el),this.skinParts={},this.skinParts.$diagramDesignerWidgetBody=this.$el,this.skinParts.$itemsContainer=$("<div/>",{"class":"items"}),this.skinParts.$diagramDesignerWidgetBody.append(this.skinParts.$itemsContainer),this.skinParts.SVGPaper=Raphael(this.skinParts.$itemsContainer[0]),this.skinParts.SVGPaper.canvas.style.pointerEvents="visiblePainted",this.skinParts.SVGPaper.canvas.className.baseVal=s.CONNECTION_CONTAINER_SVG_CLASS,this._containerSize.w=this.$el.width(),this._containerSize.h=this.$el.height(),this._resizeItemContainer(),this._droppable===!0&&this._initDroppable(),this.__loader=new i({containerElement:this.$el.parent()}),this._tabsEnabled===!0&&this._initializeTabs()},A.prototype._createLineStyleMenuItem=function(e,t,n,i,o,r,a){var l,c,d,h=$("<div/>"),p=50,g=20,u=Raphael(h[0],p,g),f=10;return e=e||1,t=t||"#000000",n=n||s.LINE_PATTERNS.SOLID,i=i||s.LINE_ARROWS.NONE,o=o||s.LINE_ARROWS.NONE,r=(r||s.LINE_TYPES.NONE).toLowerCase(),h.attr({style:"height: "+g+"px; width: "+p+"px;"}),l=r===s.LINE_TYPES.BEZIER?u.path("M 5,"+(Math.round(g/2)+.5)+" C"+(5+f)+","+(Math.round(g/2)+.5-2*f)+" "+(p-f)+","+(Math.round(g/2)+.5+2*f)+" "+(p-5)+","+(Math.round(g/2)+.5)):u.path("M 5,"+(Math.round(g/2)+.5)+" L"+(p-5)+","+(Math.round(g/2)+.5)),a&&(c=l.getBBox(),d=a===s.LINE_LABEL_PLACEMENTS.SRC?c.x+2:a===s.LINE_LABEL_PLACEMENTS.DST?c.x+c.width-2:c.x+c.width/2,u.text(d,c.y-1.5,"$").attr({"font-size":8,fill:t})),l.attr({"arrow-start":i,"arrow-end":o,stroke:t,"stroke-width":e,"stroke-dasharray":n}),h},A.prototype._attachScrollHandler=function(e){var t=this;e.on("scroll",function(){t._scrollPos.left=e.scrollLeft(),t._scrollPos.top=e.scrollTop()})},A.prototype._resizeItemContainer=function(){var e,t,n,i=this._containerSize.w/this._zoomRatio,o=this._containerSize.h/this._zoomRatio;this.logger.debug("MinZoomedSize: "+i+", "+o),this.logger.debug("this._actualSize: "+this._actualSize.w+", "+this._actualSize.h),i=Math.max(i,this._actualSize.w),o=Math.max(o,this._actualSize.h),this.skinParts.$itemsContainer.css({width:i,height:o}),this.skinParts.SVGPaper.setSize(i,o),this.skinParts.SVGPaper.setViewBox(0,0,i,o,!1),this._svgPaperSize={w:i,h:o},this._centerBackgroundText(),n=this.skinParts.$diagramDesignerWidgetBody.offset(),t=parseInt(this.skinParts.$diagramDesignerWidgetBody.css("padding-top").replace("px","")),e=parseInt(this.skinParts.$diagramDesignerWidgetBody.css("padding-left").replace("px","")),n.left+=e,n.top+=t,this._offset=n},A.prototype.getAdjustedMousePos=function(e){var t,n=this._offset,i=this._scrollPos,o=e.pageX-n.left+i.left,r=e.pageY-n.top+i.top;return o/=this._zoomRatio,r/=this._zoomRatio,t={mX:o>0?o:0,mY:r>0?r:0}},A.prototype.getAdjustedOffset=function(e){var t=this._offset,n=(e.left-t.left)/this._zoomRatio+t.left,i=(e.top-t.top)/this._zoomRatio+t.top;return{left:n,top:i}},A.prototype.posToPageXY=function(e,t){var n=this._offset,i=this._scrollPos,o=e*this._zoomRatio,r=t*this._zoomRatio;return o+=n.left-i.left,r+=n.top-i.top,{x:o>0?o:0,y:r>0?r:0}},A.prototype.clear=function(){var e;this.setTitle(""),this.selectionManager.clear();for(e in this.items)this.items.hasOwnProperty(e)&&this.items[e].destroy();this._initializeCollections(),this._actualSize={w:0,h:0},this._resizeItemContainer(),this.dispatchEvent(this.events.ON_CLEAR)},A.prototype.deleteComponent=function(e){this.dispatchEvent(this.events.ON_COMPONENT_DELETE,e),-1!==this.itemIds.indexOf(e)?this.deleteDesignerItem(e):-1!==this.connectionIds.indexOf(e)&&this.deleteConnection(e)},A.prototype.beginUpdate=function(){this.logger.debug("beginUpdate"),this._updating=!0,this._insertedDesignerItemIDs=[],this._updatedDesignerItemIDs=[],this._deletedDesignerItemIDs=[],this._insertedConnectionIDs=[],this._updatedConnectionIDs=[],this._deletedConnectionIDs=[]},A.prototype.endUpdate=function(){this.logger.debug("endUpdate"),this._updating=!1,this._tryRefreshScreen(),this.searchManager.applyLastSearch()},A.prototype._tryRefreshScreen=function(){var e=0,t=0,n=0,i="";this._updating!==!0&&(e+=this._insertedDesignerItemIDs?this._insertedDesignerItemIDs.length:0,e+=this._insertedConnectionIDs?this._insertedConnectionIDs.length:0,t+=this._updatedDesignerItemIDs?this._updatedDesignerItemIDs.length:0,t+=this._updatedConnectionIDs?this._updatedConnectionIDs.length:0,n+=this._deletedDesignerItemIDs?this._deletedDesignerItemIDs.length:0,n+=this._deletedConnectionIDs?this._deletedConnectionIDs.length:0,i+="I: "+e,i+=" U: "+t,i+=" D: "+n,this.logger.debug(i),R===!0&&this.toolbarItems&&this.toolbarItems.progressText&&this.toolbarItems.progressText.text(i,!0),this._refreshScreen())},A.prototype._refreshScreen=function(){var e,t,n,i,o,r,s,a=0,l=0,c=this.items,d=[],h=this;for(this.logger.debug("_refreshScreen START"),this.skinParts.$itemsContainer[0].appendChild(this._documentFragment),this._documentFragment=document.createDocumentFragment(),o=function(e){for(var t,n,i=e.length;i--;)n=c[e[i]],n.renderGetLayoutInfo(),t=n.getBoundingBox(),a=Math.max(a,t.x2),l=Math.max(l,t.y2)},o(this._insertedDesignerItemIDs),o(this._updatedDesignerItemIDs),r=function(e){for(var t,n=e.length;n--;)t=c[e[n]],t.renderSetLayoutInfo()},r(this._insertedDesignerItemIDs),r(this._updatedDesignerItemIDs),s=function(e,t){for(var n=e.length;n--;)h.dispatchEvent(t,e[n])},s(this._insertedDesignerItemIDs,this.events.ON_COMPONENT_CREATE),s(this._insertedConnectionIDs,this.events.ON_COMPONENT_CREATE),s(this._updatedDesignerItemIDs,this.events.ON_COMPONENT_UPDATE),s(this._updatedConnectionIDs,this.events.ON_COMPONENT_UPDATE),d=this._insertedDesignerItemIDs.concat(this._updatedDesignerItemIDs,this._deletedDesignerItemIDs),t=this._insertedConnectionIDs.concat(this._updatedConnectionIDs,this._getAssociatedConnectionsForItems(d)),t=L.uniq(t).sort(),this.logger.debug("Redraw connection request: "+t.length+"/"+this.connectionIds.length),i=this._redrawConnections(t),this.logger.debug("Redrawn/Requested: "+i.length+"/"+t.length),e=i.length;e--;)n=c[i[e]].getBoundingBox(),a=Math.max(a,n.x2),l=Math.max(l,n.y2);this._actualSize.w=Math.max(this._actualSize.w,a+w),this._actualSize.h=Math.max(this._actualSize.h,l+w),this._resizeItemContainer(),this._insertedDesignerItemIDs=[],this._updatedDesignerItemIDs=[],this._deletedDesignerItemIDs=[],this._insertedConnectionIDs=[],this._updatedConnectionIDs=[],this._deletedConnectionIDs=[],(this.mode===this.OPERATING_MODES.DESIGN||this.mode===this.OPERATING_MODES.READ_ONLY)&&this.selectionManager.showSelectionOutline(),this.logger.debug("_refreshScreen END")},A.prototype._alignPositionToGrid=function(e,t){var n,i;return e<this.gridSize&&(e=this.gridSize),t<this.gridSize&&(t=this.gridSize),this.gridSize>1&&(n=e%this.gridSize,i=t%this.gridSize,(0!==n||0!==i)&&(e+=n<Math.floor(this.gridSize/2)+1?-1*n:this.gridSize-n,t+=i<Math.floor(this.gridSize/2)+1?-1*i:this.gridSize-i)),{x:e,y:t}},A.prototype._checkPositionOverlap=function(e,t){for(var n,i,o,r=!0;r===!0;)for(r=!1,n=this.itemIds.length;n--;)i=this.itemIds[n],i!==e&&(o=this.items[i],t.position.x===o.positionX&&t.position.y===o.positionY&&(t.position.x+=2*this.gridSize,t.position.y+=2*this.gridSize,r=!0))},A.prototype.onDesignerItemDragStart=function(e,t){this.selectionManager.hideSelectionOutline(),this._preDragActualSize={w:this._actualSize.w,h:this._actualSize.h};for(var n=t.length;n--;)this.items[t[n]].hideSourceConnectors()},A.prototype.onDesignerItemDrag=function(e,t){for(var n,i,o,r=t.length,s=0,a=0,l=this.items;r--;)o=l[t[r]].getBoundingBox(),s=Math.max(s,o.x2),a=Math.max(a,o.y2);this._actualSize.w=Math.max(this._preDragActualSize.w,s),this._actualSize.h=Math.max(this._preDragActualSize.h,a),this._resizeItemContainer(),n=this._getAssociatedConnectionsForItems(t).sort(),this.logger.debug("Redraw connection request: "+n.length+"/"+this.connectionIds.length),i=this._redrawConnections(n)||[],this.logger.debug("Redrawn/Requested: "+i.length+"/"+n.length),r=i.len},A.prototype.onDesignerItemDragStop=function(){this.selectionManager.showSelectionOutline(),delete this._preDragActualSize},A.prototype._onSelectionCommandClicked=function(e,t,n){switch(e){case"delete":this.onSelectionDelete(t);break;case"contextmenu":this.onSelectionContextMenu(t,this.getAdjustedMousePos(n));break;case"align":this.onSelectionAlignMenu(t,this.getAdjustedMousePos(n));break;case"open":this.onDesignerItemDoubleClick(t[0])}},A.prototype.onSelectionDelete=function(e){this.logger.warn('DiagramDesignerWidget.onSelectionDelete IS NOT OVERRIDDEN IN A CONTROLLER. ID: "'+e+'"')},A.prototype.onSelectionContextMenu=function(e,t){this.logger.warn('DiagramDesignerWidget.onSelectionContextMenu IS NOT OVERRIDDEN IN A CONTROLLER. ID: "'+e+'", mousePos: '+JSON.stringify(t))},A.prototype.onSelectionAlignMenu=function(e,t){this.logger.warn('DiagramDesignerWidget.onSelectionAlignMenu IS NOT OVERRIDDEN IN A CONTROLLER. ID: "'+e+'", mousePos: '+JSON.stringify(t))},A.prototype.onAlignSelection=function(e,t){this.logger.warn('DiagramDesignerWidget.onAlignSelection IS NOT OVERRIDDEN IN A CONTROLLER. ID: "'+e+'", type: "'+t+'".')},A.prototype._onSelectionChanged=function(e){for(var t=e.length,n=!1;t--;)if(-1!==this.connectionIds.indexOf(e[t])){n=!0;break}this.toolbarItems&&(this.toolbarItems.ddbtnConnectionArrowEnd&&this.toolbarItems.ddbtnConnectionArrowEnd.enabled(n),this.toolbarItems.ddbtnConnectionArrowStart&&this.toolbarItems.ddbtnConnectionArrowStart.enabled(n),this.toolbarItems.ddbtnConnectionPattern&&this.toolbarItems.ddbtnConnectionPattern.enabled(n),this.toolbarItems.ddbtnConnectionLineType&&this.toolbarItems.ddbtnConnectionLineType.enabled(n),this.toolbarItems.ddbtnConnectionLabelPlacement&&this.toolbarItems.ddbtnConnectionLabelPlacement.enabled(n),this.toolbarItems.ddbtnConnectionLineWidth&&this.toolbarItems.ddbtnConnectionLineWidth.enabled(n),e.length>0?(this.toolbarItems.cpFillColor&&this.toolbarItems.cpFillColor.enabled(!0),this.toolbarItems.cpBorderColor&&this.toolbarItems.cpBorderColor.enabled(!n),this.toolbarItems.cpTextColor&&this.toolbarItems.cpTextColor.enabled(!0)):(this.toolbarItems.cpFillColor&&this.toolbarItems.cpFillColor.enabled(!1),this.toolbarItems.cpBorderColor&&this.toolbarItems.cpBorderColor.enabled(!1),this.toolbarItems.cpTextColor&&this.toolbarItems.cpTextColor.enabled(!1))),this.onSelectionChanged(e)},A.prototype.onSelectionChanged=function(){this.logger.debug("DiagramDesignerWidget.onSelectionChanged IS NOT OVERRIDDEN IN A CONTROLLER...")},A.prototype.itemAutoLayout=function(e){var t,n=this.itemIds.length,i=40,o=80,r=20,s=20,a=0,l={};switch(this.beginUpdate(),e){case"diagonal":for(;n--;)t=this.items[this.itemIds[n]].getWidth(),a=Math.max(a,this.items[this.itemIds[n]].getHeight()),this.updateDesignerItem(this.itemIds[n],{position:{x:i,y:o}}),l[this.itemIds[n]]={x:this.items[this.itemIds[n]].positionX,y:this.items[this.itemIds[n]].positionY},i+=t+r,o+=a+s;break;default:for(r=20,s=20,"cozygrid"===e&&(r=100,s=100);n--;)t=this.items[this.itemIds[n]].getWidth(),a=Math.max(a,this.items[this.itemIds[n]].getHeight()),this.updateDesignerItem(this.itemIds[n],{position:{x:i,y:o}}),l[this.itemIds[n]]={x:this.items[this.itemIds[n]].positionX,y:this.items[this.itemIds[n]].positionY},i+=t+r,i>=1e3&&(i=40,o+=a+s,a=0)}this.endUpdate(),this.onDesignerItemsMove(l)},A.prototype._onConnectionRouteManagerChanged=function(e){switch(this.connectionRouteManager&&this.connectionRouteManager.destroy(),e){case"basic":this.connectionRouteManager=new h({diagramDesigner:this});break;case"basic2":this.connectionRouteManager=new p({diagramDesigner:this});break;case"basic3":this.connectionRouteManager=new g({diagramDesigner:this});break;default:this.connectionRouteManager=new h({diagramDesigner:this})}this.connectionRouteManager.initialize(),this._redrawConnections(this.connectionIds.slice(0).sort()||[]),this.selectionManager.showSelectionOutline()},A.prototype._getAssociatedConnectionsForItems=function(e){for(var t=[],n=e.length;n--;)t=t.concat(this._getConnectionsForItem(e[n]));return t=L.uniq(t)},A.prototype._getConnectionsForItem=function(e){var t,n=[];for(t in this.connectionIDbyEndID[e])this.connectionIDbyEndID[e].hasOwnProperty(t)&&(n=n.concat(this.connectionIDbyEndID[e][t]));return n=L.uniq(n)},A.prototype._getItemsForConnection=function(e){var t=[];return this.connectionEndIDs[e]&&(t.push(this.connectionEndIDs[e].srcObjId),t.push(this.connectionEndIDs[e].dstObjId)),t},A.prototype.showProgressbar=function(){this.__loader.start()},A.prototype.hideProgressbar=function(){this.__loader.stop()},A.prototype.setBackgroundText=function(e,t){var n,i={};this._backGroundText?(i.text=e,i.x=this._svgPaperSize.w/2,i.y=this._svgPaperSize.h/2):e?this._backGroundText=this.skinParts.SVGPaper.text(this._svgPaperSize.w/2,this._svgPaperSize.h/2,e):this.logger.error('Invalid parameter "text" for method "setBackgroundText"'),this._backGroundText&&(n=function(e){for(var n=e.length;n--;)t.hasOwnProperty(e[n][0])&&(i[e[n][1]]=t[e[n][0]])},t=t||{},t["font-size"]=t["font-size"]||M,t.color=t.color||x,t&&n([["color","fill"],["font-size","font-size"]]),this._backGroundText.attr(i))},A.prototype._centerBackgroundText=function(){this._backGroundText&&this._backGroundText.attr({x:this._svgPaperSize.w/2,y:this._svgPaperSize.h/2})},A.prototype.setTitle=function(){},A.prototype.enableDragCopy=function(){},A.prototype.enableRotate=function(e){this.selectionManager.enableRotation(e)},A.prototype.enableAlign=function(e){this.selectionManager.enableAlign(e)},A.prototype.enableOpenButton=function(e){this.selectionManager.enableOpenButton(e)},A.prototype.selectAll=function(){this.selectionManager.clear(),this.selectionManager.setSelection(this.itemIds.concat(this.connectionIds),!1)},A.prototype.selectNone=function(){this.selectionManager.clear()},A.prototype.selectInvert=function(){var e=L.difference(this.itemIds.concat(this.connectionIds),this.selectionManager.getSelectedElements());this.selectionManager.clear(),
this.selectionManager.setSelection(e,!1)},A.prototype.selectItems=function(){this.selectionManager.clear(),this.selectionManager.setSelection(this.itemIds,!1)},A.prototype.selectConnections=function(){this.selectionManager.clear(),this.selectionManager.setSelection(this.connectionIds,!1)},A.prototype.select=function(e){this.selectionManager.clear(),this.selectionManager.setSelection(e,!1)},A.prototype.onClipboardCopy=function(e){this.logger.warn('DiagramDesignerWidget.prototype.onClipboardCopy not overridden in controller!!!selectedIds: "'+e+'"')},A.prototype.onClipboardPaste=function(){this.logger.warn("DiagramDesignerWidget.prototype.onClipboardPaste not overridden in controller!!!")},A.prototype.onConnectionSegmentPointsChange=function(e){this.logger.warn("DiagramDesignerWidget.prototype.onConnectionSegmentPointsChange not overridden in controller. params: "+JSON.stringify(e))},A.prototype.setOperatingMode=function(e){if(this.mode!==e)switch(this.highlightManager.deactivate(),this.selectionManager.deactivate(),this.connectionDrawingManager.deactivate(),this.searchManager.deactivate(),this._setComponentsReadOnly(!0),this._addTabsButtonEnabled(!1),this._destroyTabsSortable(),e){case a.prototype.OPERATING_MODES.READ_ONLY:this.mode=this.OPERATING_MODES.READ_ONLY,this.selectionManager.activate(),this.searchManager.activate();break;case a.prototype.OPERATING_MODES.DESIGN:this.mode=this.OPERATING_MODES.DESIGN,this.selectionManager.activate(),this.connectionDrawingManager.activate(),this.searchManager.activate(),this._setComponentsReadOnly(!1),this._addTabsButtonEnabled(!0),this._makeTabsSortable();break;case a.prototype.OPERATING_MODES.HIGHLIGHT:this.mode=this.OPERATING_MODES.HIGHLIGHT,this.highlightManager.activate();break;default:this.mode=this.OPERATING_MODES.READ_ONLY,this.selectionManager.activate(),this.searchManager.activate()}},A.prototype._setComponentsReadOnly=function(e){for(var t=this.itemIds.length;t--;)this.items[this.itemIds[t]].readOnlyMode(e);for(t=this.itemIds.length;t--;)this.items[this.itemIds[t]].renderGetLayoutInfo();for(t=this.itemIds.length;t--;)this.items[this.itemIds[t]].renderSetLayoutInfo();for(this._redrawConnections(this.connectionIds.slice(0).sort()||[]),t=this.connectionIds.length;t--;)this.items[this.connectionIds[t]].readOnlyMode(e)},A.prototype.onDragStartDesignerItemDraggable=function(e){return this.logger.warn("DiagramDesignerWidget.prototype.onDesignerItemDraggable not overridden in controller. itemID: "+e),!0},A.prototype.onDragStartDesignerItemCopyable=function(e){return this.logger.warn("DiagramDesignerWidget.prototype.onDragStartDesignerItemCopyable not overridden in controller. itemID: "+e),!0},A.prototype.onDragStartDesignerConnectionCopyable=function(e){return this.logger.warn("DiagramDesignerWidget.prototype.onDragStartDesignerConnectionCopyable not overridden in controller. connectionID: "+e),!0},A.prototype.onHighlight=function(e){this.logger.warn("DiagramDesignerWidget.prototype.onHighlight not overridden in controller. idList: "+e)},A.prototype.onUnhighlight=function(e){this.logger.warn("DiagramDesignerWidget.prototype.onUnhighlight not overridden in controller. idList: "+e)},A.prototype.onSelectionRotated=function(e,t){this.logger.warn('DiagramDesignerWidget.prototype.onSelectionRotated IS NOT OVERRIDDEN IN CONTROLLER. deg: "'+e+'", selectedIds: '+t)},A.prototype.onConnectionNameChanged=function(e,t,n){this.logger.warn('DiagramDesignerWidget.prototype.onConnectionNameChanged IS NOT OVERRIDDEN IN CONTROLLER. connId: "'+e+'", oldValue: "'+t+'", newValue: "'+n+'"')},A.prototype.onConnectionSrcTextChanged=function(e,t,n){this.logger.warn('DiagramDesignerWidget.prototype.onConnectionSrcTextChanged IS NOT OVERRIDDEN IN CONTROLLER.connId: "'+e+'", oldValue: "'+t+'", newValue: "'+n+'"')},A.prototype.onConnectionDstTextChanged=function(e,t,n){this.logger.warn('DiagramDesignerWidget.prototype.onConnectionDstTextChanged IS NOT OVERRIDDEN IN CONTROLLER. connId: "'+e+'", oldValue: "'+t+'", newValue: "'+n+'"')},A.prototype.connectToConnectionEnabled=function(e){this._connectToConnection=e},A.prototype._setConnectionXingJumpMode=function(e){this._connectionJumpXing!==e&&(this._connectionJumpXing=e,this._redrawConnections(this.connectionIds.slice(0).sort()||[]))},A.prototype._setConnectionProperty=function(e){var t=this.selectionManager.getSelectedElements();t.length>0&&this.onSetConnectionProperty({items:t,params:e})},A.prototype.onSetConnectionProperty=function(e){this.logger.warn("DiagramDesignerWidget.prototype.onSetConnectionProperty IS NOT OVERRIDDEN IN CONTROLLER.params: "+JSON.stringify(e))},A.prototype._triggerUIActivity=function(){this.onUIActivity()},A.prototype.onUIActivity=function(){this.logger.warn("DiagramDesignerWidget.prototype.onUIActivity IS NOT OVERRIDDEN...")},A.prototype._redrawConnections=function(e){var t;try{t=this.connectionRouteManager.redrawConnections(e)||[]}catch(n){t=[],this.logger.error("connectionRouteManager.redrawConnections failed with error: "+n.stack)}return t},A.prototype.onActivate=function(){this._displayToolbarItems()},A.prototype.onDeactivate=function(){this._hideToolbarItems()},A.prototype.onSelectionFillColorChanged=function(e,t){this.logger.warn("DiagramDesignerWidget.prototype.onSelectionFillColorChanged(selectedElements, color) IS NOT OVERRIDDEN IN CONTROLLER. color: "+t)},A.prototype.onSelectionBorderColorChanged=function(e,t){this.logger.warn("DiagramDesignerWidget.prototype.onSelectionBorderColorChanged(selectedElements, color) IS NOT OVERRIDDEN IN CONTROLLER. color: "+t)},A.prototype.onSelectionTextColorChanged=function(e,t){this.logger.warn("DiagramDesignerWidget.prototype.onSelectionTextColorChanged(selectedElements, color) IS NOT OVERRIDDEN IN CONTROLLER. color: "+t)},L.extend(A.prototype,a.prototype),L.extend(A.prototype,l.prototype),L.extend(A.prototype,c.prototype),L.extend(A.prototype,d.prototype),L.extend(A.prototype,f.prototype),L.extend(A.prototype,m.prototype),L.extend(A.prototype,_.prototype),L.extend(A.prototype,v.prototype),L.extend(A.prototype,C.prototype),L.extend(A.prototype,D.prototype),L.extend(A.prototype,E.prototype),L.extend(A.prototype,I.prototype),L.extend(A.prototype,T.prototype),L.extend(A.prototype,P.prototype),A.getDefaultConfig=function(){return{zoomValues:[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.2,1.4,1.6,1.8,2,2.5,3,3.5,4]}},A.getComponentId=function(){return"GenericUIDiagramDesignerWidget"},A}),define("text!js/Widgets/MetaEditor/templates/MetaEditorPointerNamesDialog.html",[],function(){return'<div class="meta-editor-pointer-names-dialog modal fade" tabindex="-1" role="dialog">\r\n    <div class="modal-dialog modal-lg">\r\n        <div class="modal-content">\r\n            <div class="modal-header">\r\n                <button type="button" class="close" data-dismiss="modal">×</button>\r\n                <h3>Create new pointer</h3>\r\n            </div>\r\n            <form class="modal-body" role="form">\r\n                <div class="row">\r\n                    <label class="col-sm-4 control-label pick-existing-label">\r\n                        Pick one of the existing pointers:\r\n                    </label>\r\n\r\n                    <div class="col-sm-4 controls btn-group-existing btn-group btn-group-vertical">\r\n                    </div>\r\n                </div>\r\n                <div class="panel-popular row">\r\n                    <label class="col-sm-4 control-label">\r\n                        Or pick a popular one:\r\n                    </label>\r\n\r\n                    <div class="col-sm-4 controls btn-group-popular btn-group btn-group-vertical">\r\n                    </div>\r\n                </div>\r\n            </form>\r\n            <div class="modal-footer">\r\n                <div class="panel-create-new form-group">\r\n                    <label class="col-sm-4 control-label create-new-label">\r\n                        Or create a new pointer:\r\n                    </label>\r\n\r\n                    <div class="col-sm-8 input-group">\r\n                        <input type="text" class="txt-pointer-name form-control" placeholder="New pointer name..."/>\r\n\r\n                        <div class="input-group-btn">\r\n                            <button href="#" class="btn btn-primary btn-create">Create</button>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>'}),define("css!js/Widgets/MetaEditor/styles/MetaEditorPointerNamesDialog",[],function(){}),define("js/Widgets/MetaEditor/MetaEditorPointerNamesDialog",["js/util","js/Constants","text!./templates/MetaEditorPointerNamesDialog.html","css!./styles/MetaEditorPointerNamesDialog.css"],function(e,t,n){"use strict";var i,o=[t.POINTER_SOURCE,t.POINTER_TARGET,t.POINTER_CONSTRAINED_BY];return i=function(){},i.prototype.show=function(e,t,n,i){var o=this;n&&(t.push("src"),t.push("dst")),this._initDialog(e,t,n,i),this._dialog.modal("show"),this._dialog.on("shown.bs.modal",function(){0===e.length&&o._txtNewPointerName.focus()}),this._dialog.on("hidden.bs.modal",function(){o._dialog.remove(),o._dialog.empty(),o._dialog=void 0})},i.prototype._initDialog=function(t,i,r,s){var a,l,c,d,h=this,p=t.length;if(l=function(e){h._dialog.modal("hide"),s&&s.call(h,e)},d=function(e){return!(""===e||-1!==t.indexOf(e)||-1!==i.indexOf(e))},this._dialog=$(n),r===!0&&(this._dialog.find(".modal-header > h3").text("Create new set"),this._dialog.find(".pick-existing-label").text("Pick one of the existing sets:"),this._dialog.find(".create-new-label").text("Or create a new set:"),this._dialog.find(".txt-pointer-name").attr("placeholder","New set name...")),this._el=this._dialog.find(".modal-body").first(),this._btnGroup=this._el.find(".btn-group-existing").first(),this._btnGroupPopular=this._dialog.find(".btn-group-popular").first(),t.sort(),p)for(this._btnGroup.empty(),a=0;p>a;a+=1)this._btnGroup.append($('<button class="btn btn-default">'+e.toSafeString(t[a])+"</button>"));else r===!0?this._btnGroup.html('<span class="empty-message">No exisiting sets defined yet...</i>'):this._btnGroup.html('<span class="empty-message">No exisiting pointers defined yet...</i>');if(c=!1,r!==!0)for(p=o.length,a=0;p>a;a+=1)-1===t.indexOf(o[a])&&(this._btnGroupPopular.append($('<button class="btn btn-default">'+o[a]+"</button>")),c=!0);c||this._dialog.find(".panel-popular").remove(),this._txtNewPointerName=this._dialog.find(".txt-pointer-name"),this._btnCreateNew=this._dialog.find(".btn-create").disable(!0),this._panelCreateNew=this._dialog.find(".panel-create-new"),this._btnGroup.on("click",".btn",function(e){var t=$(this).text();e.stopPropagation(),e.preventDefault(),l(t)}),this._btnGroupPopular.on("click",".btn",function(e){var t=$(this).text();e.stopPropagation(),e.preventDefault(),l(t)}),this._txtNewPointerName.on("keyup",function(){var e=h._txtNewPointerName.val();d(e)?(h._panelCreateNew.removeClass("has-error"),h._btnCreateNew.disable(!1)):(h._panelCreateNew.addClass("has-error"),h._btnCreateNew.disable(!0))}),this._txtNewPointerName.on("keydown",function(e){var t=13===e.which,n=h._txtNewPointerName.val();t&&d(n)&&(l(n),e.stopPropagation(),e.preventDefault())}),this._btnCreateNew.on("click",function(e){var t=h._txtNewPointerName.val();e.stopPropagation(),e.preventDefault(),$(this).hasClass("disabled")||l(t)})},i}),define("css!js/Widgets/MetaEditor/styles/MetaEditorWidget",[],function(){}),define("js/Widgets/MetaEditor/MetaEditorWidget",["js/logger","js/util","js/DragDrop/DragHelper","js/Widgets/DiagramDesigner/DiagramDesignerWidget","js/Controls/iCheckBox","./MetaEditorPointerNamesDialog","css!./styles/MetaEditorWidget.css"],function(e,t,n,i,o,r){"use strict";var s,a=i,l=i.prototype;return s=function(e,t){t=t||{},t.loggerName="gme:Widgets:MetaEditor:MetaEditorWidget",t.lineStyleControls=!1,t.tabsEnabled=!0,t.addTabs=!0,t.deleteTabs=!0,t.reorderTabs=!0,a.call(this,e,t),this.logger.debug("MetaEditorWidget ctor")},_.extend(s.prototype,i.prototype),s.prototype._initializeUI=function(){l._initializeUI.apply(this,arguments),this.logger.debug("MetaEditorWidget._initializeUI"),this._connectToConnection=!1,this._initializeFilterPanel()},s.prototype._afterManagersInitialized=function(){this.enableRotate(!1)},s.prototype._initializeFilterPanel=function(){this.$filterPanel=$("<div/>",{"class":"filterPanel"}),this.$filterPanel.html('<div class="header">FILTER</div><ul class="body"></ul>'),this.$filterHeader=this.$filterPanel.find(".header"),this.$filterUl=this.$filterPanel.find("ul.body"),this.$el.parent().append(this.$filterPanel),this.$el.parent().addClass("meta-editor-widget"),this._filterCheckboxes={}},s.prototype._checkChanged=function(e,t){this._refreshHeaderText(),this.logger.debug("CheckBox checkChanged: "+e+", checked: "+t),this.onCheckChanged(e,t)},s.prototype.onCheckChanged=function(){this.logger.warn("MetaEditorWidget.onCheckChanged(value, isChecked) is not overridden!")},s.prototype.addFilterItem=function(e,t,n){var i,r=$("<li/>",{"class":"filterItem"}),s=this;return i=new o({checkChangedFn:function(e,n){s._checkChanged(t,n)}}),r.append(n.addClass("inline")),r.append(e),r.append(i.el),this.$filterUl.append(r),this._refreshHeaderText(),this._filterCheckboxes[t]=i,r},s.prototype._refreshHeaderText=function(){var e=this.$filterUl.find(".iCheckBox").length,t=this.$filterUl.find(".iCheckBox.checked").length;this.$filterHeader.html("FILTER"+(e===t?"":" *"))},s.prototype.selectNewPointerName=function(e,t,n,i){(new r).show(e,t,n,i)},s.prototype.setFilterChecked=function(e){this._filterCheckboxes[e]&&!this._filterCheckboxes[e].isChecked()&&this._filterCheckboxes[e].setChecked(!0)},s.prototype.getDragEffects=function(){return[n.DRAG_EFFECTS.DRAG_MOVE]},s.prototype._dragHelper=function(e,t,n){var o=i.prototype._dragHelper.apply(this,[e,t,n]);return o.empty(),o},s}),define("js/Panels/MetaEditor/MetaRelations",["js/Constants","js/Widgets/DiagramDesigner/DiagramDesignerWidget.Constants"],function(e,t){"use strict";function n(e){var n={};switch(n[t.LINE_WIDTH]=1,n[t.LINE_START_ARROW]=h,n[t.LINE_END_ARROW]=h,n[t.LINE_COLOR]="#AAAAAA",n[t.LINE_PATTERN]=t.LINE_PATTERNS.SOLID,e){case p.CONTAINMENT:n[t.LINE_START_ARROW]=r,n[t.LINE_END_ARROW]=h,n[t.LINE_COLOR]="#000000";break;case p.POINTER:n[t.LINE_START_ARROW]=h,n[t.LINE_END_ARROW]=s,n[t.LINE_COLOR]="#0000FF";break;case p.INHERITANCE:n[t.LINE_START_ARROW]=h,n[t.LINE_END_ARROW]=a,n[t.LINE_COLOR]="#FF0000";break;case p.MIXIN:n[t.LINE_START_ARROW]=h,n[t.LINE_END_ARROW]=l,n[t.LINE_COLOR]="#FF0000",n[t.LINE_PATTERN]=t.LINE_PATTERNS.LONGDASH;break;case p.SET:n[t.LINE_START_ARROW]=d,n[t.LINE_END_ARROW]=c,n[t.LINE_COLOR]="#FF00FF"}return n}function i(e){return e===a?e.replace("xwide","wide").replace("xlong","long"):e}function o(e){var o,r,s=$("<div/>"),a=16,l=Raphael(s[0],a,a),c=n(e);return e===p.CONTAINMENT?(c[t.LINE_START_ARROW]=i(c[t.LINE_START_ARROW]),c[t.LINE_END_ARROW]=i(c[t.LINE_END_ARROW])):(r=c[t.LINE_START_ARROW],c[t.LINE_START_ARROW]=c[t.LINE_END_ARROW],c[t.LINE_END_ARROW]=r,e===p.MIXIN&&(c[t.LINE_START_ARROW]=i(c[t.LINE_START_ARROW]))),s.attr({style:"height: "+a+"px; margin-top: 2px; margin-bottom: 2px;"}),o=l.path("M"+(Math.round(a/2)+.5)+",0, L"+(Math.round(a/2)+.5)+","+a),o.attr({"arrow-start":c[t.LINE_START_ARROW],"arrow-end":c[t.LINE_END_ARROW],stroke:c[t.LINE_COLOR],"stroke-width":c[t.LINE_WIDTH],"stroke-dasharray":c[t.LINE_PATTERN]}),s}var r="diamond2-xxwide-xxlong",s="open-xwide-xlong",a="inheritance-xxwide-xxlong",l="open-xxwide-xxlong",c="classic-xwide-xlong",d="oval-wide-long",h="none",p={CONTAINMENT:"containment",POINTER:"pointer",INHERITANCE:"inheritance",MIXIN:"mixin",SET:"set"},g={TYPE:"type"};return{META_RELATIONS:p,getLineVisualDescriptor:n,createButtonIcon:o,CONNECTION_META_INFO:g}}),define("js/Panels/MetaEditor/MetaDocItem",["./MetaEditorConstants","common/util/random"],function(e,t){"use strict";function n(e,t,n,i){this._id=i,this._setName=n,this._nodeId=t,this._client=e,this.update()}var i="Documentation",o="#ececec",r="Edit documentation ...";return n.addNew=function(n,s,a,l){var c,d=n.getNode(s),h=d.getSetRegistryNames(a),p={};h.forEach(function(t){0===t.indexOf(e.META_DOC_REGISTRY_PREFIX)&&(p[t.replace(e.META_DOC_REGISTRY_PREFIX,"")]=!0)}),c=e.META_DOC_REGISTRY_PREFIX+t.generateRelid(p),l=l||{},l.x="number"==typeof l.x?l.x:100,l.y="number"==typeof l.y?l.y:100,n.setSetRegistry(s,a,c,{name:i,position:l,color:o,documentation:r})},n["delete"]=function(e,t,n,i){e.delSetRegistry(t,n,i)},n.prototype.update=function(){var e=this._client.getNode(this._nodeId),t=e.getSetRegistry(this._setName,this._id);this.name=t.name,this.documentation=t.documentation,this.position={},this.position.x=t.position&&"number"==typeof t.position.x?t.position.x:100,this.position.y=t.position&&"number"==typeof t.position.y?t.position.y:100,this.color=t.color,this.borderColor=t.borderColor,this.textColor=t.textColor},n.prototype.getObjectDescriptor=function(e){var t=this,n={position:this.position,decoratorClass:e,metaInfo:{},control:{_client:{getNode:function(){return{getAttribute:function(e){return t[e]},getRegistry:function(e){return t[e]}}},setAttribute:function(e,n,i){("documentation"===n||"name"===n)&&t.setProperty(n,i)}}},preferencesHelper:{getRegistry:function(e,n){return t[n]},setRegistry:function(){},delRegistry:function(){}}};return n},n.prototype.getPersistEntry=function(){var e,t={};for(e in this)this.hasOwnProperty(e)&&0!==e.indexOf("_")&&"undefined"!=typeof this[e]&&(t[e]=this[e]);return t},n.prototype.setProperty=function(e,t){this[e]=t;var n=this.getPersistEntry();this._client.setSetRegistry(this._nodeId,this._setName,this._id,n)},n.prototype.deleteProperty=function(e){delete this[e];var t=this.getPersistEntry();this._client.setSetRegistry(this._nodeId,this._setName,this._id,t)},n.prototype.deleteItem=function(){this._client.delSetRegistry(this._nodeId,this._setName,this._id)},n}),define("text!js/Controls/templates/Dialog.html",[],function(){return'<div class="commit-dialog modal fade" tabindex="-1" role="dialog">\r\n    <div class="modal-dialog modal-lg">\r\n        <div class="modal-content">\r\n            <div class="modal-header">\r\n                <button type="button" class="close" data-dismiss="modal">×</button>\r\n                <h3></h3>\r\n            </div>\r\n            <div class="modal-body">\r\n            </div>\r\n            <div class="modal-footer">\r\n                <a href="#" class="btn btn-ok btn-primary">OK</a>\r\n                <a href="#" class="btn btn-cancel btn-default" data-dismiss="modal">Cancel</a>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>'}),define("js/Controls/Dialog",["text!./templates/Dialog.html"],function(e){"use strict";function t(e,t,n,i){var r=!1,s=o.clone(),a=s.find(".modal-header > h3"),l=s.find(".modal-body"),c=s.find(".modal-footer > .btn-ok");a.text(e),l.html(t),i!==!0&&(s.find(".modal-footer > .btn-cancel").remove(),s.find(".modal-header > .close").remove()),s.on("shown.bs.modal",function(){c.focus()}),s.on("hidden.bs.modal",function(){s.remove(),s.empty(),s=void 0,r===!0&&n&&n()}),c.on("click",function(){r=!0,s.modal("hide")}),s.modal("show")}function n(e,n,i){t(e,n,i,!1)}function i(e,n,i){t(e,n,i,!0)}var o=$(e);return{alert:n,confirm:i}}),define("js/Panels/MetaEditor/MetaEditorControl.DiagramDesignerWidgetEventHandlers",["js/logger","js/util","common/util/guid","js/Constants","js/NodePropertyNames","js/RegistryKeys","js/Utils/GMEConcepts","./MetaRelations","./MetaEditorConstants","./MetaDocItem","js/DragDrop/DragHelper","js/Controls/Dialog"],function(e,t,n,i,o,r,s,a,l,c,d,h){"use strict";var p,g="metaContainerID",u="DRAG_PARAMS_ACTIVE_META_ASPECT";return p=function(){this.logger=e.create("gme:Panels:MetaEditor:MetaEditorControl.DiagramDesignerWidgetEventHandlers",WebGMEGlobal.gmeConfig.client.log)},p.prototype.attachDiagramDesignerWidgetEventHandlers=function(){var e=this;this.diagramDesigner.onDesignerItemsMove=function(t){e._onDesignerItemsMove(t)},this.diagramDesigner.onCreateNewConnection=function(t){var n,i,o,r,s=e._ComponentID2GMEID[t.src],l=e._ComponentID2GMEID[t.dst];if(e._connType!==a.META_RELATIONS.INHERITANCE){if(e._connType===a.META_RELATIONS.MIXIN)if(i=e._client.getNode(s)){if(n=i.canSetAsMixin(l),n.isOk===!1)return e.logger.warn("cannot set ["+l+"] as mixin for ["+s+"]",n),void h.alert("Invalid mixin target",n.reason,function(){})}else e.logger.error("cannot edit mixin of an unknown node ["+s+"]");e._onCreateNewConnection(t)}else if(i=e._client.getNode(s)){if(s===l)return void h.alert("Invalid base modification","The base of an object cannot be itself!",function(){});if(l!==i.getBaseId())if(o=e._client.getNode(l),r=e._client.getNode(i.getBaseId()),o&&r){if(o.getChildrenIds().length>0||r.getChildrenIds().length>0)return void h.alert("Invalid base modification","Currently, modification from or to a base which has children is not allowed!",function(){});do{if(o.getId()===s)return void h.alert("Invalid base modification","Change of base node would create circular inheritance!",function(){});o=e._client.getNode(o.getBaseId())}while(o);h.confirm("Confirm base change","Changing a base can cause invalid data in the target node and its descendants!",function(){e._onCreateNewConnection(t)})}else r||h.alert("Invalid base modification","Cannot change the base of the FCO!",function(){});else h.alert("Invalid base modification","Base already set to the new base!",function(){})}else e.logger.error("cannot edit base of an unknown node ["+s+"]")},this.diagramDesigner.onSelectionDelete=function(t){e._onSelectionDelete(t)},this.diagramDesigner.onBackgroundDroppableAccept=function(t,n){return e._onBackgroundDroppableAccept(t,n)},this.diagramDesigner.onBackgroundDrop=function(t,n,i){e._onBackgroundDrop(t,n,i)},this.diagramDesigner.onCheckChanged=function(t,n){e._onConnectionTypeFilterCheckChanged(t,n)},this.diagramDesigner.onConnectionDstTextChanged=function(t,n,i){e._onConnectionDstTextChanged(t,n,i)},this._oGetDragParams=this.diagramDesigner.getDragParams,this.diagramDesigner.getDragParams=function(t,n){return e._getDragParams(t,n)},this.diagramDesigner.getDragItems=function(t){return e._getDragItems(t)},this.diagramDesigner.onSelectionChanged=function(t){e._onSelectionChanged(t)},this.diagramDesigner.onFilterNewConnectionDroppableEnds=function(e){return e.availableConnectionEnds},this.diagramDesigner.onTabAddClicked=function(){e._onTabAddClicked()},this.diagramDesigner.onTabTitleChanged=function(t,n,i){e._onTabTitleChanged(t,n,i)},this.diagramDesigner.onSelectedTabChanged=function(t){e._onSelectedTabChanged(t)},this.diagramDesigner.onTabDeleteClicked=function(t){e._onTabDeleteClicked(t)},this.diagramDesigner.onTabsSorted=function(t){e._onTabsSorted(t)},this.diagramDesigner.onSelectionFillColorChanged=function(t,n){e._onSelectionFillColorChanged(t,n)},this.diagramDesigner.onSelectionBorderColorChanged=function(t,n){e._onSelectionBorderColorChanged(t,n)},this.diagramDesigner.onSelectionTextColorChanged=function(t,n){e._onSelectionTextColorChanged(t,n)},this.diagramDesigner.onSelectionAlignMenu=function(t,n){e._onSelectionAlignMenu(t,n)},this.diagramDesigner.onAlignSelection=function(t,n){e._onAlignSelection(t,n)},this.logger.debug("attachDesignerCanvasEventHandlers finished")},p.prototype.__getDocItem=function(e){return this._metaDocItemsPerSheet[this._selectedMetaAspectSet][e]},p.prototype._onDesignerItemsMove=function(e){var t,n,i,o;this._client.startTransaction();for(t in e)n=e[t].x,i=e[t].y,this._ComponentID2GMEID[t]?this._client.setMemberRegistry(this.metaAspectContainerNodeID,this._ComponentID2GMEID[t],this._selectedMetaAspectSet,r.POSITION,{x:n,y:i}):this._ComponentID2DocItemID[t]&&(o=this.__getDocItem(this._ComponentID2DocItemID[t]),o.setProperty("position",{x:n,y:i}));this._client.completeTransaction()},p.prototype._onBackgroundDroppableAccept=function(e,t){var n,o=d.getDragItems(t),r=d.getDragParams(t),s=d.getDragEffects(t),a=!1;if(this._selectedMetaAspectSet)if(r&&r.hasOwnProperty(g))a=!0;else if(r===l.CREATE_META_DOC)a=!0;else if(1===s.length&&s[0]===d.DRAG_EFFECTS.DRAG_CREATE_INSTANCE)a=!0;else if(o.length>0&&-1===o.indexOf(i.PROJECT_ROOT_ID))for(n=0;n<o.length;n+=1)if(-1===this._metaAspectMembersPerSheet[this._selectedMetaAspectSet].indexOf(o[n])){a=!0;break}return a},p.prototype._onBackgroundDrop=function(e,t,n){var i,s,a,h,p,f,m,_,b,y,v=this._client,C=this.metaAspectContainerNodeID,E=d.getDragItems(t),D=d.getDragParams(t),I=d.getDragEffects(t),T=[];if(D===l.CREATE_META_DOC)this._selectedMetaAspectSet&&(v.startTransaction(),c.addNew(v,C,this._selectedMetaAspectSet,n),setTimeout(function(){v.completeTransaction()},10));else if(D&&D.hasOwnProperty(g)&&D[g]===C&&D[u]===this._selectedMetaAspectSet){v.startTransaction(),this.diagramDesigner.beginUpdate();for(i in D.positions)D.positions.hasOwnProperty(i)&&(h=n.x+D.positions[i].x,p=n.y+D.positions[i].y,this._GMEID2ComponentID[i]?(a=this._GMEID2ComponentID[i],v.setMemberRegistry(C,i,this._selectedMetaAspectSet,r.POSITION,{x:h,y:p})):this._DocItemID2ComponentID[i]&&(a=this._DocItemID2ComponentID[i],m=this.__getDocItem(i),m.setProperty("position",{x:h,y:p})),a&&(T.push(a),this.diagramDesigner.updateDesignerItem(a,{position:{x:h,y:p}})));this.diagramDesigner.endUpdate(),this.diagramDesigner.select(T),setTimeout(function(){v.completeTransaction()},10)}else if(1===I.length&&I[0]===d.DRAG_EFFECTS.DRAG_CREATE_INSTANCE&&1===E.length)v.startTransaction(),a=E[0],f={parentId:C,baseId:a},_=v.createChild(f),_&&(v.setRegistry(_,r.POSITION,{x:n.x,y:n.y}),b=v.getNode(a),b&&(y=b.getAttribute(o.Attributes.name)+"_instance",v.setAttribute(_,o.Attributes.name,y)),v.addMember(C,_,this._selectedMetaAspectSet),v.setMemberRegistry(C,_,this._selectedMetaAspectSet,r.POSITION,{x:n.x,y:n.y}),v.addMember(C,_,l.META_ASPECT_SET_NAME),v.setMemberRegistry(C,_,l.META_ASPECT_SET_NAME,r.POSITION,{x:n.x,y:n.y})),v.completeTransaction();else{if(v.startTransaction(),E.length>0)for(s=0;s<E.length;s+=1)a=E[s],-1===this._metaAspectMembersPerSheet[this._selectedMetaAspectSet].indexOf(a)&&(h=n.x,p=n.y,D&&D.hasOwnProperty(g)&&D[g]===C&&D[u]!==this._selectedMetaAspectSet?(D&&D.positions&&D.positions[a]&&(h+=D.positions[a].x),D&&D.positions&&D.positions[a]&&(p+=D.positions[a].y)):(n.x+=20,n.y+=20),v.addMember(C,a,this._selectedMetaAspectSet),v.setMemberRegistry(C,a,this._selectedMetaAspectSet,r.POSITION,{x:h,y:p}),-1===this._metaAspectMembersAll.indexOf(a)&&(v.addMember(C,a,l.META_ASPECT_SET_NAME),v.setMemberRegistry(C,a,l.META_ASPECT_SET_NAME,r.POSITION,{x:h,y:p})));setTimeout(function(){v.completeTransaction()},10)}},p.prototype._onSelectionDelete=function(e){var t,n,i,r,s,d,p,g,u=this._client,f=this.metaAspectContainerNodeID,m=this,_=[];for(this.logger.debug("_onSelectionDelete",e),r=function(e){var t=m._connectionListByID[e];t.type===a.META_RELATIONS.CONTAINMENT?m._deleteContainmentRelationship(t.GMESrcId,t.GMEDstId):t.type===a.META_RELATIONS.POINTER?m._deletePointerRelationship(t.GMESrcId,t.GMEDstId,t.name,!1):t.type===a.META_RELATIONS.INHERITANCE?m._deleteInheritanceRelationship(t.GMESrcId,t.GMEDstId):t.type===a.META_RELATIONS.MIXIN?m._deleteMixinRelationship(t.GMESrcId,t.GMEDstId):t.type===a.META_RELATIONS.SET&&m._deletePointerRelationship(t.GMESrcId,t.GMEDstId,t.name,!0)},s=function(e){for(u.startTransaction(),t=e.length;t--;)n=m._ComponentID2GMEID[e[t]],!n&&m._ComponentID2DocItemID[e[t]]&&m._selectedMetaAspectSet?c["delete"](u,f,m._selectedMetaAspectSet,m._ComponentID2DocItemID[e[t]]):(i=m._GMENodes.indexOf(n),-1!==i?(u.removeMember(f,n,m._selectedMetaAspectSet),1===m._metaAspectSheetsPerMember[n].length&&(g=u.getNode(n),g&&(g.isLibraryElement()||g.isLibraryRoot())||(u.removeMember(f,n,l.META_ASPECT_SET_NAME),u.setMeta(n,{})))):m._connectionListByID.hasOwnProperty(e[t])&&r(e[t]));u.completeTransaction()},t=e.length;t--;)n=this._ComponentID2GMEID[e[t]],i=this._GMENodes.indexOf(n),-1!==i&&1===this._metaAspectSheetsPerMember[n].length&&(g=u.getNode(n),g&&(g.isLibraryElement()||g.isLibraryRoot())||_.push(n));if(_.length>0){for(d="The following items you are about to delete are not present on any other sheet and will be permanently removed from the META aspect:<br><br>",p=[],t=_.length;t--;)n=_[t],g=u.getNode(n),g?p.push(g.getAttribute(o.Attributes.name)):p.push(n);for(p.sort(),t=0;t<p.length;t+=1)d+="- <b>"+p[t]+"</b>  (all associated meta rules will be deleted for this element)<br>";d+="<br>Are you sure you want to delete?",h.confirm("Confirm delete",d,function(){s(e)})}else s(e)},p.prototype._getDragParams=function(e,t){var n,i=this._oGetDragParams.call(this.diagramDesigner,e,t),o={positions:{}};o[g]=this.metaAspectContainerNodeID,o[u]=this._selectedMetaAspectSet;for(n in i.positions)i.positions.hasOwnProperty(n)&&(o.positions[this._ComponentID2GMEID[n]||this._ComponentID2DocItemID[n]]=i.positions[n]);return o},p.prototype._getDragItems=function(e){var t,n,i=[];for(t=e.length;t--;)n=this._ComponentID2GMEID[e[t]],-1!==this._GMENodes.indexOf(n)?i.push(n):this._ComponentID2DocItemID[e[t]]&&i.push(this._ComponentID2DocItemID[e[t]]);return i},p.prototype._onSelectionChanged=function(e){for(var t,n=[],i=e.length,o=e.length>0;i--;)t=this._ComponentID2GMEID[e[i]],t&&-1!==this.diagramDesigner.itemIds.indexOf(e[i])?(n.push(t),o=o&&s.isConnectionType(t)):o=!1;this._settingActiveSelection=!0,WebGMEGlobal.State.registerActiveSelection(n),this._settingActiveSelection=!1},p.prototype._onTabAddClicked=function(){var e,t,i,o,s,a,c=this.metaAspectContainerNodeID,d=this._client.getNode(c),h=d.getEditableRegistry(r.META_SHEETS)||[];for(h.sort(function(e,t){return e.order<t.order?-1:1}),t=h.length,e=0;t>e;e+=1)h[e].order=e;if(this._client.startTransaction(),i=l.META_ASPECT_SHEET_NAME_PREFIX+n(),this._client.createSet(c,i),a={SetID:i,order:h.length,title:"New sheet"},h.push(a),1===h.length)for(t=this._metaAspectMembersAll.length,s=100;t--;)o=this._metaAspectMembersAll[t],this._client.addMember(c,o,i),this._metaAspectMembersCoordinatesGlobal[o]?this._client.setMemberRegistry(c,o,i,r.POSITION,{x:this._metaAspectMembersCoordinatesGlobal[o].x,y:this._metaAspectMembersCoordinatesGlobal[o].y}):(this._client.setMemberRegistry(c,o,i,r.POSITION,{x:s,y:s}),s+=30);this._client.setRegistry(c,r.META_SHEETS,h),this._selectedMetaAspectSet=i,this._client.completeTransaction()},p.prototype._onTabTitleChanged=function(e,t,n){var i,o,s,a=this.metaAspectContainerNodeID,l=this._client.getNode(a),c=l.getEditableRegistry(r.META_SHEETS)||[];if(this._sheets[e]){for(s=this._sheets[e],o=c.length,i=0;o>i;i+=1)if(c[i].SetID===s){c[i].title=n;break}this._client.setRegistry(a,r.META_SHEETS,c)}},p.prototype._onSelectedTabChanged=function(e){this._sheets&&e&&this._selectedMetaAspectSet!==this._sheets[e]&&(this._selectedMetaAspectSet=this._sheets[e],this._selectedSheetID=e.toString(),this.logger.debug("selectedAspectChanged: "+this._selectedMetaAspectSet),WebGMEGlobal.State.registerActiveTab(e),this._initializeSelectedSheet(),this.diagramDesigner.selectTab(this._selectedSheetID))},p.prototype._onTabDeleteClicked=function(e){var t,n,i,s,a,c,d,p,g=this._sheets[e],u=this._metaAspectMembersPerSheet[g],f=this.metaAspectContainerNodeID,m=this._client.getNode(f),_=m.getEditableRegistry(r.META_SHEETS)||[],b=[],y=this._client;for(this.logger.debug("_onTabDeleteClicked",e),s=function(){for(y.startTransaction(),t=b.length;t--;)n=b[t],y.removeMember(f,n,l.META_ASPECT_SET_NAME),y.setMeta(n,{});for(t=_.length;t--;)if(_[t].SetID===g){_.splice(t,1);break}for(_.sort(function(e,t){return e.order<t.order?-1:1}),t=_.length,a=0;t>a;a+=1)_[a].order=a;y.setRegistry(f,r.META_SHEETS,_),y.deleteSet(f,g),y.completeTransaction()},t=u.length;t--;)n=u[t],i=this._GMENodes.indexOf(n),-1!==i&&1===this._metaAspectSheetsPerMember[n].length&&(p=y.getNode(n),p&&(p.isLibraryElement()||p.isLibraryRoot())||b.push(n));if(b.length>0){for(c="You are about to delete a sheet that contains the following items that are not present on any other sheet and will be permanently removed from the META aspect:<br><br>",
d=[],t=b.length;t--;)n=b[t],p=y.getNode(n),p?d.push(p.getAttribute(o.Attributes.name)):d.push(n);for(d.sort(),t=0;t<d.length;t+=1)c+="- <b>"+d[t]+"</b> (all associated meta rules will be deleted for this element)<br>";c+="<br>Are you sure you want to delete the sheet anyway?",h.confirm("Confirm delete",c,function(){s()})}else c="Are you sure you want to delete this sheet?",h.confirm("Confirm delete",c,function(){s()})},p.prototype._onTabsSorted=function(e){var t,n,i,o=this.metaAspectContainerNodeID,s=this._client.getNode(o),a=s.getEditableRegistry(r.META_SHEETS)||[],l=WebGMEGlobal.State.getActiveTab();for(t=0;t<e.length;t+=1)for(l===e[t]&&WebGMEGlobal.State.registerActiveTab(t),i=this._sheets[e[t]],n=0;n<a.length;n+=1)if(a[n].SetID===i){a[n].order=t;break}a.sort(function(e,t){return e.order<t.order?-1:1}),this._client.setRegistry(o,r.META_SHEETS,a)},p.prototype._onSelectionFillColorChanged=function(e,t){this._onSelectionSetColor(e,t,r.COLOR)},p.prototype._onSelectionBorderColorChanged=function(e,t){this._onSelectionSetColor(e,t,r.BORDER_COLOR)},p.prototype._onSelectionTextColorChanged=function(e,t){this._onSelectionSetColor(e,t,r.TEXT_COLOR)},p.prototype._onSelectionSetColor=function(e,t,n){var i,o,r=e.length;for(this._client.startTransaction();r--;)o=this._ComponentID2GMEID[e[r]],o?t?this._client.setMemberRegistry(this.metaAspectContainerNodeID,o,l.META_ASPECT_SET_NAME,n,t):this._client.delMemberRegistry(this.metaAspectContainerNodeID,o,l.META_ASPECT_SET_NAME,n):this._ComponentID2DocItemID[e[r]]&&(i=this.__getDocItem(this._ComponentID2DocItemID[e[r]]),t?i.setProperty(n,t):i.deleteProperty(n));this._client.completeTransaction()},p.prototype._onSelectionAlignMenu=function(e,t){var n=this.diagramDesigner.posToPageXY(t.mX,t.mY),i=this;this._alignMenu.show(e,n,function(t){i._onAlignSelection(e,t)})},p.prototype._onAlignSelection=function(e,t){var n={client:this._client,modelId:this.metaAspectContainerNodeID,idMap:this._ComponentID2GMEID,setName:this._selectedMetaAspectSet,coordinates:this._metaAspectMembersCoordinatesPerSheet[this._selectedMetaAspectSet]};n.coordinates&&this._alignMenu.alignSetSelection(n,e,t)},p}),define("js/Controls/AlignMenu",["./ContextMenu"],function(e){"use strict";function t(t,n){n=n||{},this.isXAxisType=function(e){return e===t.MOVE_TO_LEFT||e===t.MOVE_TO_RIGHT||e===t.ALIGN_VERTICAL},this.getExtremePosition=function(e,n){var i,o,r={position:null,id:null};for(i=0;i<e.length;i+=1)o=e[i].position,n===t.MOVE_TO_TOP?(null===r.position||r.position.y>o.y)&&(r=e[i]):n===t.MOVE_TO_BOTTOM?(null===r.position||r.position.y<o.y)&&(r=e[i]):n===t.MOVE_TO_RIGHT?(null===r.position||r.position.x<o.x)&&(r=e[i]):n===t.MOVE_TO_LEFT&&(null===r.position||r.position.x>o.x)&&(r=e[i]);return null!==r.position?r:null},this.show=function(n,i,o){var r={};r[t.MOVE_TO_TOP]={name:"Move to top ["+t.KEY_SHORT_CUT_MOVE_TO_TOP+"]",icon:"glyphicon glyphicon-arrow-up"},r[t.MOVE_TO_BOTTOM]={name:"Move to bottom ["+t.KEY_SHORT_CUT_MOVE_TO_BOTTOM+"]",icon:"glyphicon glyphicon-arrow-down"},r[t.MOVE_TO_LEFT]={name:"Move to left ["+t.KEY_SHORT_CUT_MOVE_TO_LEFT+"]",icon:"glyphicon glyphicon-arrow-left"},r[t.MOVE_TO_RIGHT]={name:"Move to right ["+t.KEY_SHORT_CUT_MOVE_TO_RIGHT+"]",icon:"glyphicon glyphicon-arrow-right"},n.length>1&&(r[t.ALIGN_HORIZON]={name:"Align selection horizontally",icon:"fa fa-ellipsis-h"},r[t.ALIGN_VERTICAL]={name:"Align selection vertically",icon:"fa fa-ellipsis-v"});var s=new e({items:r,callback:o});i=i||{x:200,y:200},s.show(i)},this.alignSetSelection=function(e,t,n){var i,o,r=[],s=[],a=e.client,l=e.modelId,c=e.idMap,d=e.coordinates,h=e.setName;t.forEach(function(e){var t=c[e];t&&d[t]&&r.push({id:t,position:{x:d[t].x,y:d[t].y}})}),0!==r.length&&(0===n.indexOf("MOVE_TO_")?(Object.keys(d).forEach(function(e){s.push({id:e,position:{x:d[e].x,y:d[e].y}})}),i=this.getExtremePosition(s,n)):i=r[0],i&&(o=this.isXAxisType(n),a.startTransaction(),r.forEach(function(e){var t=e.position;i.id!==e.id&&(o===!0?t.x=i.position.x:t.y=i.position.y,a.setMemberRegistry(l,e.id,h,"position",t))}),a.completeTransaction()))}}return t}),define("js/Panels/MetaEditor/MetaEditorControl",["js/logger","js/util","js/Constants","js/Utils/GMEConcepts","js/NodePropertyNames","js/RegistryKeys","js/Widgets/DiagramDesigner/DiagramDesignerWidget.Constants","./MetaEditorControl.DiagramDesignerWidgetEventHandlers","./MetaRelations","./MetaEditorConstants","./MetaDocItem","js/Utils/PreferencesHelper","js/Controls/AlignMenu"],function(e,t,n,i,o,r,s,a,l,c,d,h,p){"use strict";var g,u="MetaDecorator",f="DocumentDecorator",m="DiagramDesigner",b=c.META_ASPECT_CONTAINER_ID;return g=function(t){var n=this;if(this.logger=t.logger||e.create(t.loggerName||"gme:Panels:MetaEditor:MetaEditorControl",WebGMEGlobal.gmeConfig.client.log),this._client=t.client,this.diagramDesigner=t.widget,this._alignMenu=new p(this.diagramDesigner.CONSTANTS,{}),void 0===this._client)throw this.logger.error("MetaEditorControl's client is not specified..."),"MetaEditorControl can not be created";if(void 0===this.diagramDesigner)throw this.logger.error("MetaEditorControl's DiagramDesigner is not specified..."),"MetaEditorControl can not be created";this.diagramDesigner.enableDragCopy(!1),this._metaAspectMemberPatterns={},this._filteredOutConnTypes=[],this._filteredOutConnectionDescriptors={},this.currentNodeInfo={id:null,members:[]},this._metaAspectMembersAll=[],this._metaAspectMembersPerSheet={},this._metaAspectMembersCoordinatesGlobal={},this._metaAspectMembersCoordinatesPerSheet={},this._selectedMetaAspectSheetMembers=[],this._selectedSheetID=null,this._metaDocItemsPerSheet={},this._ComponentID2DocItemID={},this._DocItemID2ComponentID={},this._GMEID2ComponentID={},this._ComponentID2GMEID={},this._setNewConnectionType(l.META_RELATIONS.CONTAINMENT),this._initFilterPanel(),this.attachDiagramDesignerWidgetEventHandlers(),this._client.decoratorManager.download([u],m,function(){n.logger.debug("MetaEditorControl ctor finished"),setTimeout(function(){n._loadMetaAspectContainerNode()},10)})},g.prototype._loadMetaAspectContainerNode=function(){var e=this;this.metaAspectContainerNodeID=b,this.logger.debug('_loadMetaAspectContainerNode: "'+this.metaAspectContainerNodeID+'"'),this._initializeSelectedSheet(),this._territoryId&&this._client.removeUI(this._territoryId),this._selfPatterns={},this._selfPatterns[this.metaAspectContainerNodeID]={children:0},this._territoryId=this._client.addUI(this,function(t){e._eventCallback(t)}),this._client.updateTerritory(this._territoryId,this._selfPatterns)},g.prototype._eventCallback=function(e){var t,i=e?e.length:0;for(this.logger.debug('_eventCallback "'+i+'" items'),this.diagramDesigner.beginUpdate();i--;)switch(t=e[i],t.etype){case n.TERRITORY_EVENT_LOAD:this._onLoad(t.eid);break;case n.TERRITORY_EVENT_UPDATE:this._onUpdate(t.eid);break;case n.TERRITORY_EVENT_UNLOAD:this._onUnload(t.eid)}this.diagramDesigner.endUpdate(),this.diagramDesigner.hideProgressbar(),this.logger.debug('_eventCallback "'+e.length+'" items - DONE')},g.prototype.destroy=function(){this._detachClientEventListeners(),this._client.removeUI(this._territoryId),this._client.removeUI(this._metaAspectMembersTerritoryId),this.diagramDesigner.clear()},g.prototype._onLoad=function(e){e===this.metaAspectContainerNodeID?this._processMetaAspectContainerNode():this._processNodeLoad(e)},g.prototype._onUpdate=function(e){e===this.metaAspectContainerNodeID?this._processMetaAspectContainerNode():this._processNodeUpdate(e)},g.prototype._onUnload=function(e){var t=this;e===this.metaAspectContainerNodeID?(this.logger.debug('The currently opened aspect has been deleted --- GMEID: "'+this.metaAspectContainerNodeID+'"'),setTimeout(function(){t._loadMetaAspectContainerNode()},10)):this._processNodeUnload(e)},g.prototype._printNodeData=function(){},g.prototype._processMetaAspectContainerNode=function(){var e,t,n,i,o,s,a,l=this.metaAspectContainerNodeID,d=this._client.getNode(l),h=d.getMemberIds(c.META_ASPECT_SET_NAME),p=!1;for(this._metaAspectMembersAll=h.slice(0),e=this._metaAspectMembersAll.length,this._metaAspectMembersCoordinatesGlobal={};e--;)o=this._metaAspectMembersAll[e],this._metaAspectMembersCoordinatesGlobal[o]=d.getMemberRegistry(c.META_ASPECT_SET_NAME,o,r.POSITION);for(a=this._processMetaAspectSheetsRegistry(),s=this._metaAspectMembersPerSheet[this._selectedMetaAspectSet]||[],t=_.difference(this._selectedMetaAspectSheetMembers,s),e=t.length;e--;)delete this._metaAspectMemberPatterns[t[e]],p=!0;for(t=_.difference(s,this._selectedMetaAspectSheetMembers),e=t.length;e--;)this._metaAspectMemberPatterns[t[e]]={children:0},p=!0;for(t=_.intersection(this._selectedMetaAspectSheetMembers,s),e=t.length;e--;)o=t[e],n={position:{x:100,y:100}},this._metaAspectMembersCoordinatesPerSheet[this._selectedMetaAspectSet][o]&&(n.position.x=this._metaAspectMembersCoordinatesPerSheet[this._selectedMetaAspectSet][o].x,n.position.y=this._metaAspectMembersCoordinatesPerSheet[this._selectedMetaAspectSet][o].y),this._GMEID2ComponentID.hasOwnProperty(o)&&(i=this._GMEID2ComponentID[o],this.diagramDesigner.updateDesignerItem(i,n));this._selectedMetaAspectSheetMembers=s.slice(0),this._processMetaDocItems(),p===!0&&this._client.updateTerritory(this._metaAspectMembersTerritoryId,this._metaAspectMemberPatterns)},g.prototype._processMetaDocItems=function(){var e,t,n,i,o,r;this.diagramDesigner.beginUpdate(),e=this._selectedMetaAspectSet&&this._metaDocItemsPerSheet[this._selectedMetaAspectSet]?this._metaDocItemsPerSheet[this._selectedMetaAspectSet]:{};for(t in this._DocItemID2ComponentID)e.hasOwnProperty(t)===!1&&(this.diagramDesigner.deleteComponent(this._DocItemID2ComponentID[t]),o=this._DocItemID2ComponentID[t],delete this._ComponentID2DocItemID[o],delete this._DocItemID2ComponentID[t]);for(t in e)this._DocItemID2ComponentID.hasOwnProperty(t)?(r={},r.position=e[t].position,o=this._DocItemID2ComponentID[t],this.diagramDesigner.updateDesignerItem(o,r)):(n=this._client.decoratorManager.getDecoratorForWidget(f,m),r=e[t].getObjectDescriptor(n),i=this.diagramDesigner.createDesignerItem(r),this._DocItemID2ComponentID[t]=i.id,this._ComponentID2DocItemID[i.id]=t);this.diagramDesigner.endUpdate()},g.prototype._processNodeLoad=function(e){var t,i,o;-1===this._GMENodes.indexOf(e)&&(o={position:{x:100,y:100}},this._metaAspectMembersCoordinatesPerSheet[this._selectedMetaAspectSet][e]&&(o.position.x=this._metaAspectMembersCoordinatesPerSheet[this._selectedMetaAspectSet][e].x,o.position.y=this._metaAspectMembersCoordinatesPerSheet[this._selectedMetaAspectSet][e].y),i=this._client.decoratorManager.getDecoratorForWidget(u,m),o.decoratorClass=i,o.control=this,o.metaInfo={},o.metaInfo[n.GME_ID]=e,o.preferencesHelper=h.getPreferences([{containerID:this.metaAspectContainerNodeID,setID:c.META_ASPECT_SET_NAME}]),t=this.diagramDesigner.createDesignerItem(o),this._GMENodes.push(e),this._GMEID2ComponentID[e]=t.id,this._ComponentID2GMEID[t.id]=e,this._processNodeMetaContainment(e),this._processNodeMetaPointers(e,!1),this._processNodeMetaInheritance(e),this._processNodeMixins(e),this._processNodeMetaPointers(e,!0),this._processConnectionWaitingList(e))},g.prototype._processConnectionWaitingList=function(e){var t,n,i,o,r,s=[];if(i=e,this._connectionWaitingListByDstGMEID&&this._connectionWaitingListByDstGMEID.hasOwnProperty(i)){for(n in this._connectionWaitingListByDstGMEID[i])if(this._connectionWaitingListByDstGMEID[i].hasOwnProperty(n))for(t=this._connectionWaitingListByDstGMEID[i][n].length;t--;)o=this._connectionWaitingListByDstGMEID[i][n][t][0],r=this._connectionWaitingListByDstGMEID[i][n][t][1],s.push({gmeSrcID:n,gmeDstID:i,connType:o,connTexts:r});delete this._connectionWaitingListByDstGMEID[i]}if(n=e,this._connectionWaitingListBySrcGMEID&&this._connectionWaitingListBySrcGMEID.hasOwnProperty(n)){for(i in this._connectionWaitingListBySrcGMEID[n])if(this._connectionWaitingListBySrcGMEID[n].hasOwnProperty(i))for(t=this._connectionWaitingListBySrcGMEID[n][i].length;t--;)o=this._connectionWaitingListBySrcGMEID[n][i][t][0],r=this._connectionWaitingListBySrcGMEID[n][i][t][1],s.push({gmeSrcID:n,gmeDstID:i,connType:o,connTexts:r});delete this._connectionWaitingListBySrcGMEID[n]}for(t=s.length;t--;)n=s[t].gmeSrcID,i=s[t].gmeDstID,o=s[t].connType,r=s[t].connTexts,this._createConnection(n,i,o,r)},g.prototype._processNodeUnload=function(e){var t,n,i,o,r,s,a,c;if(this._GMEID2ComponentID.hasOwnProperty(e)){for(t=this._GMEID2ComponentID[e],i=this._nodeMetaContainment[e].targets.length;i--;)r=this._nodeMetaContainment[e].targets[i],this._removeConnection(e,r,l.META_RELATIONS.CONTAINMENT);for(i=this._nodeMetaPointers[e].combinedNames.length;i--;)s=this._nodeMetaPointers[e].combinedNames[i],r=this._nodeMetaPointers[e][s].target,s=this._nodeMetaPointers[e][s].name,this._removeConnection(e,r,l.META_RELATIONS.POINTER,s);for(this._nodeMetaInheritance[e]&&!_.isEmpty(this._nodeMetaInheritance[e])&&this._removeConnection(this._nodeMetaInheritance[e],e,l.META_RELATIONS.INHERITANCE),o=0;o<this._nodeMixins[e].length;o+=1)this._removeConnection(e,this._nodeMixins[e][o],l.META_RELATIONS.MIXIN);for(i=this._nodeMetaSets[e].combinedNames.length;i--;)s=this._nodeMetaSets[e].combinedNames[i],r=this._nodeMetaSets[e][s].target,s=this._nodeMetaSets[e][s].name,this._removeConnection(e,r,l.META_RELATIONS.SET,s);for(this.diagramDesigner.deleteComponent(t),delete this._ComponentID2GMEID[t],delete this._GMEID2ComponentID[e],n=this._GMENodes.indexOf(e),this._GMENodes.splice(n,1),a=this._getAssociatedConnections(e),i=a.src.length;i--;)c=a.src[i],this._saveConnectionToWaitingList(this._connectionListByID[c].GMESrcId,this._connectionListByID[c].GMEDstId,this._connectionListByID[c].type,this._connectionListByID[c].connTexts),this._removeConnection(this._connectionListByID[c].GMESrcId,this._connectionListByID[c].GMEDstId,this._connectionListByID[c].type);for(i=a.dst.length;i--;)c=a.dst[i],this._connectionListByID[c]&&(this._saveConnectionToWaitingList(this._connectionListByID[c].GMESrcId,this._connectionListByID[c].GMEDstId,this._connectionListByID[c].type,this._connectionListByID[c].connTexts),this._removeConnection(this._connectionListByID[c].GMESrcId,this._connectionListByID[c].GMEDstId,this._connectionListByID[c].type));for(r in this._connectionWaitingListBySrcGMEID)this._connectionWaitingListBySrcGMEID.hasOwnProperty(r)&&(delete this._connectionWaitingListBySrcGMEID[r][e],_.isEmpty(this._connectionWaitingListBySrcGMEID[r])&&delete this._connectionWaitingListBySrcGMEID[r]);for(r in this._connectionWaitingListByDstGMEID)this._connectionWaitingListByDstGMEID.hasOwnProperty(r)&&(delete this._connectionWaitingListByDstGMEID[r][e],_.isEmpty(this._connectionWaitingListByDstGMEID[r])&&delete this._connectionWaitingListByDstGMEID[r]);delete this._nodeMetaContainment[e],delete this._nodeMetaPointers[e],delete this._nodeMetaInheritance[e],delete this._nodeMixins[e],delete this._nodeMetaSets[e]}},g.prototype._createConnection=function(e,t,n,i){var o,r,s;-1!==this._GMENodes.indexOf(e)&&-1!==this._GMENodes.indexOf(t)?-1===this._filteredOutConnTypes.indexOf(n)?(o={srcObjId:this._GMEID2ComponentID[e],srcSubCompId:void 0,dstObjId:this._GMEID2ComponentID[t],dstSubCompId:void 0,reconnectable:!1,name:"",nameEdit:!1},_.extend(o,l.getLineVisualDescriptor(n)),i&&_.extend(o,i),r=this.diagramDesigner.createConnection(o),s={},s[l.CONNECTION_META_INFO.TYPE]=n,r.setMetaInfo(s),this._saveConnection(e,t,n,r.id,i)):this._filteredOutConnectionDescriptors[n].push([e,t,i]):this._saveConnectionToWaitingList(e,t,n,i)},g.prototype._saveConnectionToWaitingList=function(e,t,n,i){-1!==this._GMENodes.indexOf(e)&&-1===this._GMENodes.indexOf(t)?(this._connectionWaitingListByDstGMEID[t]=this._connectionWaitingListByDstGMEID[t]||{},this._connectionWaitingListByDstGMEID[t][e]=this._connectionWaitingListByDstGMEID[t][e]||[],this._connectionWaitingListByDstGMEID[t][e].push([n,i])):-1===this._GMENodes.indexOf(e)&&-1!==this._GMENodes.indexOf(t)?(this._connectionWaitingListBySrcGMEID[e]=this._connectionWaitingListBySrcGMEID[e]||{},this._connectionWaitingListBySrcGMEID[e][t]=this._connectionWaitingListBySrcGMEID[e][t]||[],this._connectionWaitingListBySrcGMEID[e][t].push([n,i])):this.logger.error("_saveConnectionToWaitingList both gmeSrcId and gmeDstId is undefined...")},g.prototype._saveConnection=function(e,t,n,i,o){this._connectionListBySrcGMEID[e]=this._connectionListBySrcGMEID[e]||{},this._connectionListBySrcGMEID[e][t]=this._connectionListBySrcGMEID[e][t]||{},this._connectionListBySrcGMEID[e][t][n]=this._connectionListBySrcGMEID[e][t][n]||[],this._connectionListBySrcGMEID[e][t][n].push(i),this._connectionListByDstGMEID[t]=this._connectionListByDstGMEID[t]||{},this._connectionListByDstGMEID[t][e]=this._connectionListByDstGMEID[t][e]||{},this._connectionListByDstGMEID[t][e][n]=this._connectionListByDstGMEID[t][e][n]||[],this._connectionListByDstGMEID[t][e][n].push(i),this._connectionListByType[n]=this._connectionListByType[n]||[],this._connectionListByType[n].push(i),this._connectionListByID[i]={GMESrcId:e,GMEDstId:t,type:n,name:o&&o.name?o.name:void 0,connTexts:o}},g.prototype._isPointerOrSetAndConnDescDoesNotMatchName=function(e,t,n){return(t===l.META_RELATIONS.POINTER||t===l.META_RELATIONS.SET)&&n&&""!==n&&e.name!==n},g.prototype._removeConnection=function(e,t,n,i){var o,r,s,a=!1;if(this._connectionListBySrcGMEID[e]&&this._connectionListBySrcGMEID[e][t]&&this._connectionListBySrcGMEID[e][t][n]&&(a=!0),a)for(s=this._connectionListBySrcGMEID[e][t][n].length;s--;)o=this._connectionListBySrcGMEID[e][t][n][s],this._isPointerOrSetAndConnDescDoesNotMatchName(this._connectionListByID[o],n,i)===!0&&(o=void 0),o&&(this.diagramDesigner.deleteComponent(o),delete this._connectionListByID[o],r=this._connectionListByType[n].indexOf(o),this._connectionListByType[n].splice(r,1),r=this._connectionListBySrcGMEID[e][t][n].indexOf(o),this._connectionListBySrcGMEID[e][t][n].splice(r,1),r=this._connectionListByDstGMEID[t][e][n].indexOf(o),this._connectionListByDstGMEID[t][e][n].splice(r,1))},g.prototype._updateConnectionText=function(e,t,n,i){for(var o,r,s,a=this._connectionListBySrcGMEID[e][t][n].length,c=i.name,d=!1;a--;)o=this._connectionListBySrcGMEID[e][t][n][a],this._isPointerOrSetAndConnDescDoesNotMatchName(this._connectionListByID[o],n,c)===!0&&(o=void 0),o&&(this._connectionListByID[o].name=i.name,this._connectionListByID[o].connTexts=i,this.diagramDesigner.updateConnectionTexts(o,i),d=!0);if(!d)if(-1!==this._GMENodes.indexOf(e)&&-1===this._GMENodes.indexOf(t))for(a=this._connectionWaitingListByDstGMEID[t][e].length,r=0;a>r;r+=1)s=this._connectionWaitingListByDstGMEID[t][e][r],s[0]===n&&(n===l.META_RELATIONS.POINTER||n===l.META_RELATIONS.SET?c&&""!==c&&s[1].name===c&&(s[1]=i):s[1]=i);else if(-1===this._GMENodes.indexOf(e)&&-1!==this._GMENodes.indexOf(t))for(a=this._connectionWaitingListBySrcGMEID[e][t].length,r=0;a>r;r+=1)s=this._connectionWaitingListBySrcGMEID[e][t][r],s[0]===n&&(n===l.META_RELATIONS.POINTER||n===l.META_RELATIONS.SET?c&&""!==c&&s[1].name===c&&(s[1]=i):s[1]=i)},g.prototype._processNodeUpdate=function(e){var t,n,i={};this._GMEID2ComponentID.hasOwnProperty(e)&&(t=this._GMEID2ComponentID[e],n=this._client.decoratorManager.getDecoratorForWidget(u,m),i.decoratorClass=n,i.preferencesHelper=h.getPreferences([{containerID:this.metaAspectContainerNodeID,setID:c.META_ASPECT_SET_NAME}]),this.diagramDesigner.updateDesignerItem(t,i),this._processNodeMetaContainment(e),this._processNodeMetaPointers(e,!1),this._processNodeMetaInheritance(e),this._processNodeMixins(e),this._processNodeMetaPointers(e,!0))},g.prototype._processNodeMetaContainment=function(e){var t,n,i,o,r,s=this._client.getValidChildrenItems(e)||[],a=this._client.getOwnValidChildrenTypes(e)||[],c={targets:[]};for(this._nodeMetaContainment[e]=this._nodeMetaContainment[e]||{targets:[]},n=this._nodeMetaContainment[e],t=s.length;t--;)-1!==a.indexOf(s[t].id)&&(c.targets.push(s[t].id),c[s[t].id]={multiplicity:""+(s[t].min||0)+".."+(s[t].max||"*")});for(i=_.intersection(n.targets,c.targets),t=i.length;t--;)o=i[t],n[o].multiplicity!==c[o].multiplicity&&(n[o].multiplicity=c[o].multiplicity,this._updateConnectionText(e,o,l.META_RELATIONS.CONTAINMENT,{dstText:c[o].multiplicity,dstTextEdit:!0}));for(i=_.difference(n.targets,c.targets),t=i.length;t--;)o=i[t],this._removeConnection(e,o,l.META_RELATIONS.CONTAINMENT),r=n.targets.indexOf(o),n.targets.splice(r,1),delete n[o];for(i=_.difference(c.targets,n.targets),t=i.length;t--;)o=i[t],n.targets.push(o),n[o]={multiplicity:c[o].multiplicity},this._createConnection(e,o,l.META_RELATIONS.CONTAINMENT,{dstText:c[o].multiplicity,dstTextEdit:!0})},g.prototype._processNodeMetaPointers=function(e,t){var n,i,o,r,s,a,c,d,h,p,g=this._client.getNode(e),u=t===!0?g.getValidSetNames():g.getValidPointerNames(),f={names:[],combinedNames:[]},m=t===!0?l.META_RELATIONS.SET:l.META_RELATIONS.POINTER;for(t!==!0?(this._nodeMetaPointers[e]=this._nodeMetaPointers[e]||{names:[],combinedNames:[]},r=this._nodeMetaPointers[e]):(this._nodeMetaSets[e]=this._nodeMetaSets[e]||{names:[],combinedNames:[]},r=this._nodeMetaSets[e]),o=u.length;o--;)if(n=this._client.getValidTargetItems(e,u[o]),i=this._client.getOwnValidTargetTypes(e,u[o]),n)for(h=n.length;h--;)-1!==i.indexOf(n[h].id)&&(p=u[o]+"_"+n[h].id,f.names.push(u[o]),f.combinedNames.push(p),f[p]={name:u[o],target:n[h].id},t&&(f[p].multiplicity=""+(n[h].min||0)+".."+(n[h].max||"*")));for(s=_.intersection(r.combinedNames,f.combinedNames),o=s.length;o--;)p=s[o],r[p].multiplicity!==f[p].multiplicity&&(c=r[p].name,a=r[p].target,r[p].multiplicity=f[p].multiplicity,this._updateConnectionText(e,a,m,{name:c,dstText:f[p].multiplicity,dstTextEdit:!0}));for(s=_.difference(r.combinedNames,f.combinedNames),o=s.length;o--;)p=s[o],c=r[p].name,a=r[p].target,this._removeConnection(e,a,m,c),d=r.combinedNames.indexOf(p),r.combinedNames.splice(d,1),delete r[p];for(s=_.difference(f.combinedNames,r.combinedNames),o=s.length;o--;)p=s[o],c=f[p].name,a=f[p].target,r.names.push(c),r.combinedNames.push(p),r[p]={name:f[p].name,target:f[p].target,multiplicity:f[p].multiplicity},this._createConnection(e,a,m,{name:c,dstText:f[p].multiplicity,dstTextEdit:!0})},g.prototype._processNodeMetaInheritance=function(e){var t,n=this._client.getNode(e),i=n.getBaseId();t=this._nodeMetaInheritance[e],t&&t!==i&&(this._removeConnection(e,t,l.META_RELATIONS.INHERITANCE),delete this._nodeMetaInheritance[e]),i&&t!==i&&(this._nodeMetaInheritance[e]=i,this._createConnection(e,i,l.META_RELATIONS.INHERITANCE,void 0))},g.prototype._processNodeMixins=function(e){var t,n,i=this._client.getNode(e),o=i.getMixinPaths();for(this.logger.debug("processing mixins for ["+e+"]"),t=this._nodeMixins[e]||[],n=0;n<t.length;n+=1)-1===o.indexOf(t[n])&&this._removeConnection(e,t[n],l.META_RELATIONS.MIXIN);for(n=0;n<o.length;n+=1)-1===t.indexOf(o[n])&&this._createConnection(e,o[n],l.META_RELATIONS.MIXIN,void 0);this._nodeMixins[e]=o},g.prototype._setNewConnectionType=function(e){var t,n=l.getLineVisualDescriptor(e);this._connType!==e&&(this._connType=e,e===l.META_RELATIONS.CONTAINMENT&&(t=n[s.LINE_START_ARROW],n[s.LINE_START_ARROW]=n[s.LINE_END_ARROW],n[s.LINE_END_ARROW]=t),n[s.LINE_WIDTH]=2,this.diagramDesigner.connectionDrawingManager.setConnectionInDrawProperties(n),this.diagramDesigner.setFilterChecked(this._connType))},g.prototype._onCreateNewConnection=function(e){var t=this._ComponentID2GMEID[e.src],n=this._ComponentID2GMEID[e.dst];switch(this._connType){case l.META_RELATIONS.CONTAINMENT:this._createContainmentRelationship(n,t);break;case l.META_RELATIONS.INHERITANCE:this._createInheritanceRelationship(t,n);break;case l.META_RELATIONS.POINTER:this._createPointerRelationship(t,n,!1);break;case l.META_RELATIONS.SET:this._createPointerRelationship(t,n,!0);break;case l.META_RELATIONS.MIXIN:this._createMixinRelationship(t,n)}},g.prototype._createContainmentRelationship=function(e,t){var n=this._client.getNode(e),i=this._client.getNode(t);n&&i&&this._client.setChildMeta(e,t)},g.prototype._deleteContainmentRelationship=function(e,t){var n=this._client.getNode(e),i=this._client.getNode(t);n&&i&&this._client.delChildMeta(e,t)},g.prototype._createPointerRelationship=function(e,t,i){var o,r,s,a=this._client.getNode(e),l=this._client.getNode(t),d=this;a&&l&&(s=_.union(a.getSetNames(),a.getPointerNames()),r=i===!0?_.difference(a.getSetNames()||[],a.getValidAspectNames()):a.getPointerNames()||[],s=_.difference(s,r),r=_.difference(r,c.RESERVED_POINTER_NAMES),s=s.concat(c.RESERVED_POINTER_NAMES),i!==!0&&s.push(n.CORE.MEMBER_RELATION),this.diagramDesigner.selectNewPointerName(r,s,i,function(n){d._client.startTransaction(),o=d._client.getOwnValidTargetItems(e,n),o?i!==!0?d._client.setPointerMetaTarget(e,n,t,-1,1):d._client.setPointerMetaTarget(e,n,t,-1,-1):i!==!0?(d._client.setPointerMeta(e,n,{min:1,max:1,items:[{id:t,max:1}]}),d._client.setPointer(e,n,null)):(d._client.setPointerMeta(e,n,{items:[{id:t}]}),d._client.createSet(e,n)),d._client.completeTransaction()}))},g.prototype._deletePointerRelationship=function(e,t,n,i){var o,r=this._client.getNode(e),s=this._client.getNode(t);r&&s&&(this._client.delPointerMetaTarget(e,n,t),o=this._client.getValidTargetItems(e,n),o&&0!==o.length||(i===!1?(this._client.delPointerMeta(e,n),this._client.delPointer(e,n)):(this._client.delPointerMeta(e,n),this._client.deleteSet(e,n))))},g.prototype._createInheritanceRelationship=function(e,t){var n,i=this._client.getNode(t),r=this._client.getNode(e);i&&r&&(n=r.getBaseId(),n&&!_.isEmpty(n)&&this.logger.debug('InheritanceRelationship from "'+r.getAttribute(o.Attributes.name)+'" ('+e+') to parent "'+n+'" already exists, but overwriting to "'+i.getAttribute(o.Attributes.name)+'" ('+t+')"'),this._client.setBase(e,t))},g.prototype._deleteInheritanceRelationship=function(e,t){var n,i,r=this._client.getNode(t);r&&(n=r.getBaseId(),n&&(i=this._client.getNode(n),i&&(n=i.getAttribute(o.Attributes.name)+" ("+n+")"),this.logger.error('Deleting InheritanceRelationship from "'+r.getAttribute(o.Attributes.name)+'" ('+t+') to parent "'+n+'" is not allowed...')))},g.prototype._createMixinRelationship=function(e,t){var n=this._client.getNode(t),i=this._client.getNode(e);n&&i?this._client.addMixin(e,t):this.logger.error("cannot set ["+t+"] as mixin for ["+e+"] because not all node are loaded")},g.prototype._deleteMixinRelationship=function(e,t){var n=this._client.getNode(t),i=this._client.getNode(e);n&&i?this._client.delMixin(e,t):this.logger.error("cannot remove ["+newMixinId+"] mixin from ["+e+"] because not all node are loaded")},g.prototype._initFilterPanel=function(){var e;e=l.createButtonIcon(l.META_RELATIONS.CONTAINMENT),this.diagramDesigner.addFilterItem("Containment",l.META_RELATIONS.CONTAINMENT,e),e=l.createButtonIcon(l.META_RELATIONS.POINTER),this.diagramDesigner.addFilterItem("Pointer",l.META_RELATIONS.POINTER,e),e=l.createButtonIcon(l.META_RELATIONS.INHERITANCE),this.diagramDesigner.addFilterItem("Inheritance",l.META_RELATIONS.INHERITANCE,e),e=l.createButtonIcon(l.META_RELATIONS.MIXIN),this.diagramDesigner.addFilterItem("Mixin",l.META_RELATIONS.MIXIN,e),e=l.createButtonIcon(l.META_RELATIONS.SET),this.diagramDesigner.addFilterItem("Set",l.META_RELATIONS.SET,e)},g.prototype._onConnectionTypeFilterCheckChanged=function(e,t){var n;t===!0?(n=this._filteredOutConnTypes.indexOf(e),this._filteredOutConnTypes.splice(n,1),this._unfilterConnType(e)):(this._filteredOutConnTypes.push(e),this._filterConnType(e))},g.prototype._filterConnType=function(e){var t,n,i,o,r,s=this._connectionListByType&&this._connectionListByType.hasOwnProperty(e)?this._connectionListByType[e].length:0;for(this._filteredOutConnectionDescriptors[e]=[],this.diagramDesigner.beginUpdate();s--;)t=this._connectionListByType[e][s],n=this._connectionListByID[t].GMESrcId,i=this._connectionListByID[t].GMEDstId,o=this._connectionListByID[t].connTexts,(e===l.META_RELATIONS.POINTER||e===l.META_RELATIONS.SET)&&(r=this._connectionListByID[t].name),this._filteredOutConnectionDescriptors[e].push([n,i,o]),this._removeConnection(n,i,e,r);this.diagramDesigner.endUpdate()},g.prototype._unfilterConnType=function(e){var t,n,i,o=this._filteredOutConnectionDescriptors&&this._filteredOutConnectionDescriptors.hasOwnProperty(e)?this._filteredOutConnectionDescriptors[e].length:0;for(this.diagramDesigner.beginUpdate();o--;)t=this._filteredOutConnectionDescriptors[e][o][0],n=this._filteredOutConnectionDescriptors[e][o][1],i=this._filteredOutConnectionDescriptors[e][o][2],this._createConnection(t,n,e,i);delete this._filteredOutConnectionDescriptors[e],this.diagramDesigner.endUpdate()},g.prototype._onConnectionDstTextChanged=function(e,t,n){var i=this._connectionListByID[e];i.type===l.META_RELATIONS.CONTAINMENT?this._containmentRelationshipMultiplicityUpdate(i.GMESrcId,i.GMEDstId,t,n):i.type===l.META_RELATIONS.POINTER?this._pointerRelationshipMultiplicityUpdate(i.GMESrcId,i.GMEDstId,i.name,t,n):i.type===l.META_RELATIONS.INHERITANCE||i.type===l.META_RELATIONS.SET&&this._setRelationshipMultiplicityUpdate(i.GMESrcId,i.GMEDstId,i.name,t,n)},g.prototype._containmentRelationshipMultiplicityUpdate=function(e,t,n,i){var o,r,s=this._client.getNode(e),a=this._client.getNode(t);r=function(e){var t=null,n=/^\d+$/g,i=/^\d+\.\.\d+$/g,o=/^\d+\.\.\*$/g;return n.test(e)?t={min:parseInt(e,10),max:parseInt(e,10)}:i.test(e)?t={min:parseInt(e,10),max:parseInt(e.substring(e.indexOf("..")+2),10)}:o.test(e)&&(t={min:parseInt(e,10),max:-1}),t},s&&a&&(o=r(i),o?this._client.setChildMeta(e,t,o.min,o.max):this._updateConnectionText(e,t,l.META_RELATIONS.CONTAINMENT,{dstText:n,dstTextEdit:!0}))},g.prototype._pointerRelationshipMultiplicityUpdate=function(e,t,n,i,o){var r,s,a=this._client.getNode(e),c=this._client.getNode(t);r=function(e){var t,n="1",i="0..1";return e===n?t={min:1,max:1}:e===i&&(t={min:0,max:1}),t},a&&c&&(s=r(o),s?this._client.setPointerMetaTarget(e,n,t,s.min,s.max):this._updateConnectionText(e,t,l.META_RELATIONS.POINTER,{name:n,dstText:i,dstTextEdit:!0}))},g.prototype._setRelationshipMultiplicityUpdate=function(e,t,n,i,o){var r,s,a=this._client.getNode(e),c=this._client.getNode(t);r=function(e){var t=null,n=/^\d+$/g,i=/^\d+\.\.\d+$/g,o=/^\d+\.\.\*$/g;return n.test(e)?t={min:parseInt(e,10),max:parseInt(e,10)}:i.test(e)?t={min:parseInt(e,10),max:parseInt(e.substring(e.indexOf("..")+2),10)}:o.test(e)&&(t={min:parseInt(e,10),max:-1}),t},a&&c&&(s=r(o),s?this._client.setPointerMetaTarget(e,n,t,s.min,s.max):this._updateConnectionText(e,t,l.META_RELATIONS.SET,{name:n,dstText:i,dstTextEdit:!0}))},g.prototype.activeSelectionChanged=function(e){for(var t=[],n=e.length;n--;)this._GMEID2ComponentID.hasOwnProperty(e[n])&&(t=t.concat(this._GMEID2ComponentID[e[n]]));this.diagramDesigner.select(t)},g.prototype._stateActiveSelectionChanged=function(e,t){this._settingActiveSelection!==!0&&(t?this.activeSelectionChanged(t):this.activeSelectionChanged([]))},g.prototype._stateActiveTabChanged=function(e,t){this._onSelectedTabChanged(t)},g.prototype._attachClientEventListeners=function(){this._detachClientEventListeners(),WebGMEGlobal.State.on("change:"+n.STATE_ACTIVE_SELECTION,this._stateActiveSelectionChanged,this),WebGMEGlobal.State.on("change:"+n.STATE_ACTIVE_TAB,this._stateActiveTabChanged,this)},g.prototype._detachClientEventListeners=function(){WebGMEGlobal.State.off("change:"+n.STATE_ACTIVE_SELECTION,this._stateActiveSelectionChanged),WebGMEGlobal.State.off("change:"+n.STATE_ACTIVE_TAB,this._stateActiveTabChanged)},g.prototype.onActivate=function(){this._selectedSheetID&&WebGMEGlobal.State.registerActiveTab(this._selectedSheetID),this._attachClientEventListeners(),this._displayToolbarItems()},g.prototype.onDeactivate=function(){this._detachClientEventListeners(),this._hideToolbarItems()},g.prototype._displayToolbarItems=function(){if(this._toolbarInitialized!==!0)this._initializeToolbar();else for(var e=0;e<this._toolbarItems.length;e++)this._toolbarItems[e].show()},g.prototype._hideToolbarItems=function(){if(this._toolbarInitialized===!0)for(var e=0;e<this._toolbarItems.length;e++)this._toolbarItems[e].hide()},g.prototype._removeToolbarItems=function(){
if(this._toolbarInitialized===!0)for(var e=0;e<this._toolbarItems.length;e++)this._toolbarItems[e].destroy()},g.prototype._initializeToolbar=function(){var e=WebGMEGlobal.Toolbar,t=this;this._toolbarItems=[],this._radioButtonGroupMetaRelationType=e.addRadioButtonGroup(function(e){t._setNewConnectionType(e.connType)}),this._toolbarItems.push(this._radioButtonGroupMetaRelationType),this._radioButtonGroupMetaRelationType.addButton({title:"Containment",selected:!0,data:{connType:l.META_RELATIONS.CONTAINMENT},icon:l.createButtonIcon(l.META_RELATIONS.CONTAINMENT)}),this._radioButtonGroupMetaRelationType.addButton({title:"Inheritance",selected:!1,data:{connType:l.META_RELATIONS.INHERITANCE},icon:l.createButtonIcon(l.META_RELATIONS.INHERITANCE)}),this._radioButtonGroupMetaRelationType.addButton({title:"Mixin",selected:!1,data:{connType:l.META_RELATIONS.MIXIN},icon:l.createButtonIcon(l.META_RELATIONS.MIXIN)}),this._radioButtonGroupMetaRelationType.addButton({title:"Pointer",selected:!1,data:{connType:l.META_RELATIONS.POINTER},icon:l.createButtonIcon(l.META_RELATIONS.POINTER)}),this._radioButtonGroupMetaRelationType.addButton({title:"Set",selected:!1,data:{connType:l.META_RELATIONS.SET},icon:l.createButtonIcon(l.META_RELATIONS.SET)}),this._toolbarItems.push(e.addSeparator()),this._toolbarItems.push(e.addDragItem({icon:"fa fa-file-text-o",title:"Drag to create Meta Documentation",dragParams:function(){return c.CREATE_META_DOC}})),this._toolbarInitialized=!0},g.prototype._getAssociatedConnections=function(e){var t,n,i,o={src:[],dst:[]};return i=function(i,o){var r,s;if(i.hasOwnProperty(e))for(r in i[e])if(i[e].hasOwnProperty(r))for(s in i[e][r])if(i[e][r].hasOwnProperty(s))for(t=i[e][r][s].length;t--;)n=i[e][r][s][t],-1===o.indexOf(n)&&o.push(n)},i(this._connectionListBySrcGMEID,o.src),i(this._connectionListByDstGMEID,o.dst),o},g.prototype._processMetaAspectSheetsRegistry=function(){var e,t,i,o,s,a,l,h,p,g,u=this._client.getNode(this.metaAspectContainerNodeID),f=u.getEditableRegistry(r.META_SHEETS)||[],m=this._metaAspectMembersCoordinatesPerSheet;for(this._sheets={},this._metaAspectMembersPerSheet={},this._metaAspectMembersCoordinatesPerSheet={},this.diagramDesigner.clearTabs(),this._metaAspectSheetsPerMember={},t=this._metaDocItemsPerSheet,this._metaDocItemsPerSheet={},f.sort(function(e,t){return e.order<t.order?-1:1}),this.diagramDesigner.addMultipleTabsBegin(),s=f.length,o=0;s>o;o+=1){for(h=f[o].SetID,a=this.diagramDesigner.addTab(f[o].title,!0,!0),this._sheets[a]=h,this._metaAspectMembersPerSheet[h]=u.getMemberIds(h),this._metaDocItemsPerSheet[h]={},i=u.getSetRegistryNames(h),p=0;p<i.length;p+=1)0===i[p].indexOf(c.META_DOC_REGISTRY_PREFIX)&&(t[h]&&t[h][i[p]]?(e=t[h][i[p]],e.update()):e=new d(this._client,u.getId(),h,i[p]),this._metaDocItemsPerSheet[h][i[p]]=e);for(this._metaAspectMembersPerSheet[h].indexOf(n.PROJECT_ROOT_ID)>-1&&this.logger.error("ROOT is in MetaSet: "+h),this._metaAspectMembersCoordinatesPerSheet[h]={},p=this._metaAspectMembersPerSheet[h].length;p--;)g=this._metaAspectMembersPerSheet[h][p],this._metaAspectMembersCoordinatesPerSheet[h][g]=u.getMemberRegistry(h,g,r.POSITION),this._metaAspectSheetsPerMember[g]=this._metaAspectSheetsPerMember[g]||[],this._metaAspectSheetsPerMember[g].push(h);this._selectedMetaAspectSet&&this._selectedMetaAspectSet===f[o].SetID&&(l=a)}this.diagramDesigner.addMultipleTabsEnd();var _=[];if(this._selectedMetaAspectSet){var b=m[this._selectedMetaAspectSet],y=this._metaAspectMembersCoordinatesPerSheet[this._selectedMetaAspectSet];if(b&&y)for(var v in b)b.hasOwnProperty(v)&&y.hasOwnProperty(v)&&(b[v]?(b[v].x!==y[v].x||b[v].y!==y[v].y)&&_.push(v):_.push(v))}if(null!==WebGMEGlobal.State.getActiveTab()&&void 0!==WebGMEGlobal.State.getActiveTab()&&f.length>WebGMEGlobal.State.getActiveTab())if(WebGMEGlobal.PanelManager._activePanel.control===this)l=WebGMEGlobal.State.getActiveTab().toString();else for(l in this._sheets||{})if(this._sheets[l]===this._selectedMetaAspectSet)break;if(!l)for(l in this._sheets)if(this._sheets.hasOwnProperty(l))break;return this._selectedSheetID=l,this.diagramDesigner.selectTab(l),_},g.prototype._initializeSelectedSheet=function(){var e,t=this;for(this.logger.debug("_initializeSelectedSheet"),this.diagramDesigner.clear(),this._GMENodes=[],this._GMEID2ComponentID={},this._ComponentID2GMEID={},this._ComponentID2DocItemID={},this._DocItemID2ComponentID={},this._connectionWaitingListByDstGMEID={},this._connectionWaitingListBySrcGMEID={},this._connectionListBySrcGMEID={},this._connectionListByDstGMEID={},this._connectionListByType={},this._connectionListByID={},this._nodeMetaContainment={},this._nodeMetaPointers={},this._nodeMetaSets={},this._nodeMetaInheritance={},this._nodeMixins=[],this._selectedMetaAspectSheetMembers=[],this._filteredOutConnectionDescriptors={},e=this._filteredOutConnTypes.length;e--;)this._filteredOutConnectionDescriptors[this._filteredOutConnTypes[e]]=[];if(this._metaAspectMembersTerritoryId&&this._client.removeUI(this._metaAspectMembersTerritoryId),this._metaAspectMemberPatterns={},this._selectedMetaAspectSet&&this._metaAspectMembersPerSheet[this._selectedMetaAspectSet])for(e=this._metaAspectMembersPerSheet[this._selectedMetaAspectSet].length,e>0&&this.diagramDesigner.showProgressbar();e--;)this._selectedMetaAspectSheetMembers.push(this._metaAspectMembersPerSheet[this._selectedMetaAspectSet][e]),this._metaAspectMemberPatterns[this._metaAspectMembersPerSheet[this._selectedMetaAspectSet][e]]={children:0};this._processMetaDocItems(),this._metaAspectMembersTerritoryId=this._client.addUI(this,function(e){t._eventCallback(e)}),this._client.updateTerritory(this._metaAspectMembersTerritoryId,this._metaAspectMemberPatterns)},g.prototype.setReadOnly=function(e){this._radioButtonGroupMetaRelationType.enabled(!e)},_.extend(g.prototype,a.prototype),g}),define("js/Panels/MetaEditor/MetaEditorPanel",["js/PanelBase/PanelBaseWithHeader","js/PanelManager/IActivePanel","js/Widgets/MetaEditor/MetaEditorWidget","./MetaEditorControl"],function(e,t,n,i){"use strict";var o;return o=function(t,n){var i={};i[e.OPTIONS.LOGGER_INSTANCE_NAME]="MetaEditorPanel",i[e.OPTIONS.FLOATING_TITLE]=!0,e.apply(this,[i,t]),this._client=n.client,this._initialize(),this.logger.debug("MetaEditorPanel ctor finished")},_.extend(o.prototype,e.prototype),_.extend(o.prototype,t.prototype),o.prototype._initialize=function(){var e=this;this.$panelHeaderTitle&&this.$panelHeaderTitle.remove(),this.widget=new n(this.$el,{toolBar:this.toolBar}),this.widget.setTitle=function(){},this.widget.onUIActivity=function(){WebGMEGlobal.PanelManager.setActivePanel(e),WebGMEGlobal.KeyboardManager.setListener(e.widget)},this.control=new i({client:this._client,widget:this.widget}),this.onActivate()},o.prototype.onReadOnlyChanged=function(t){e.prototype.onReadOnlyChanged.call(this,t),this.widget.setReadOnly(t),this.control.setReadOnly(t)},o.prototype.onResize=function(e,t){this.logger.debug("onResize --> width: "+e+", height: "+t),this.widget.onWidgetContainerResize(e,t)},o.prototype.destroy=function(){this.control.destroy(),this.widget.destroy(),e.prototype.destroy.call(this),WebGMEGlobal.KeyboardManager.setListener(void 0),WebGMEGlobal.Toolbar.refresh()},o.prototype.onActivate=function(){this.widget.onActivate(),this.control.onActivate(),WebGMEGlobal.KeyboardManager.setListener(this.widget),WebGMEGlobal.Toolbar.refresh()},o.prototype.onDeactivate=function(){this.widget.onDeactivate(),this.control.onDeactivate(),WebGMEGlobal.KeyboardManager.setListener(void 0),WebGMEGlobal.Toolbar.refresh()},o}),define("js/Widgets/ModelEditor/ModelEditorWidget",["js/DragDrop/DragHelper","js/Widgets/DiagramDesigner/DiagramDesignerWidget"],function(e,t){"use strict";var n;return n=function(e,n){n=n||{},n.loggerName="gme:Widgets:ModelEditor:ModelEditorWidget",n.tabsEnabled=!0,n.addTabs=!1,n.deleteTabs=!1,n.reorderTabs=!1,t.call(this,e,n),this.logger.debug("ModelEditorWidget ctor")},_.extend(n.prototype,t.prototype),n.prototype._afterManagersInitialized=function(){this.enableOpenButton(!0)},n.prototype.getDragEffects=function(n,i){var o=i.ctrlKey||i.metaKey,r=i.altKey,s=i.shiftKey,a=t.prototype.getDragEffects.apply(this,[n,i]);return o||!r||s?o||r||!s||(a=[e.DRAG_EFFECTS.DRAG_CREATE_POINTER]):a=[e.DRAG_EFFECTS.DRAG_CREATE_INSTANCE],a},n.prototype._dragHelper=function(n,i,o){var r=t.prototype._dragHelper.apply(this,[n,i,o]),s=e.getDragEffects(o);return 1===s.length&&(s[0]===e.DRAG_EFFECTS.DRAG_CREATE_INSTANCE?r.html($('<i class="glyphicon glyphicon-share-alt"></i>')).append(" Create instance..."):s[0]===e.DRAG_EFFECTS.DRAG_CREATE_POINTER&&r.html($('<i class="glyphicon glyphicon-share"></i>')).append(" Create pointer...")),r},n}),define("text!js/Dialogs/ReplaceBase/templates/ReplaceBaseDialog.html",[],function(){return'<div class="replace-base-dialog modal fade" tabindex="-1" role="dialog">\r\n    <div class="modal-dialog modal-md">\r\n        <div class="modal-content">\r\n            <div class="modal-header">\r\n                <button type="button" class="close" data-dismiss="modal">×</button>\r\n                <i class="glyphicon glyphicon-transfer header-icon"></i><span>Replace Base</span>\r\n            </div>\r\n            <div class="modal-body">\r\n                <h5>Select new base\r\n                    <i class="glyphicon glyphicon-info-sign toggle-info-btn"/>\r\n                </h5>\r\n                    <span class="info-message hidden">Select a node in the inheritance tree that should replace the\r\n                        base of the replaceable node. The root of the tree is the either the meta-type of the\r\n                        replaceable node or, if defined, the target of the "constrainedby" pointer. All displayed nodes\r\n                        may not be a valid new base. To validate on demand double-click the node in the tree.\r\n                     </span>\r\n                <span>\r\n                </span>\r\n                <div class="tree-container"></div>\r\n                <div class="alert alert-info message-badge hidden" role="alert"></div>\r\n            </div>\r\n            <div class="modal-footer">\r\n                <button class="btn btn-primary btn-ok">OK</button>\r\n                <button class="btn btn-default btn-cancel">Cancel</button>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>'}),define("css!js/Dialogs/ReplaceBase/styles/ReplaceBaseDialog",[],function(){}),define("js/Dialogs/ReplaceBase/ReplaceBaseDialog",["js/Panels/ObjectBrowser/InheritanceBrowserControl","js/Widgets/TreeBrowser/TreeBrowserWidget","js/Utils/GMEConcepts","text!./templates/ReplaceBaseDialog.html","css!./styles/ReplaceBaseDialog.css"],function(e,t,n,i){"use strict";function o(){this._dialog=null,this._okBtn=null,this._cancelBtn=null,this._infoBtn=null,this._infoSpan=null,this._alertDiv=null,this._treeWidget=null,this._treeControl=null}return o.prototype.show=function(o){var r=this,s=o.client,a=n.getConstrainedById(o.nodeId);this._dialog=$(i),this._infoBtn=this._dialog.find(".toggle-info-btn"),this._infoSpan=this._dialog.find(".info-message"),this._alertDiv=this._dialog.find(".alert"),this._okBtn=this._dialog.find(".btn-ok"),this._cancelBtn=this._dialog.find(".btn-cancel"),this._treeWidget=new t(this._dialog.find(".tree-container"),{titleFilter:{text:"",type:"caseInsensitive"}}),this._treeWidget._makeNodeDraggable=function(){},this._treeControl=new e(s,this._treeWidget),this._treeControl._getRootId=function(){return a},this._treeControl._onNodeDoubleClicked=function(e){var t=s.getNode(e);n.isValidReplaceableTarget(o.nodeId,e)?r._showAlert(t.getAttribute("name")+" ["+e+"] is valid new base. Press OK to replace the current base with it.","alert-success"):r._showAlert(t.getAttribute("name")+" ["+e+"] is not a valid new base - it would create a loop in containment/inheritance tree.","alert-danger")},this._treeControl._onCreatingContextMenu=function(e,t){t.rename=!1,t["delete"]=!1},this._infoBtn.on("click",function(){r._infoSpan.hasClass("hidden")?r._infoSpan.removeClass("hidden"):r._infoSpan.addClass("hidden")}),this._okBtn.on("click",function(e){var t=r._treeWidget.getSelectedIDs();e.preventDefault(),e.stopPropagation(),1!==t.length?r._showAlert("Please select exactly one node in the tree to replace the current base.","alert-danger"):n.isValidReplaceableTarget(o.nodeId,t[0])===!1?(t=s.getNode(t[0]),r._showAlert(t.getAttribute("name")+" ["+t.getId()+"] is not a valid new base - it would create a loop in containment/inheritance tree.","alert-danger")):(s.setBase(o.nodeId,t[0]),r._dialog.modal("hide"))}),this._cancelBtn.on("click",function(e){e.preventDefault(),e.stopPropagation(),r._dialog.modal("hide")}),this._dialog.on("hide.bs.modal",function(){r._treeControl.destroy(),r._okBtn.off("click"),r._cancelBtn.off("click"),r._infoBtn.off("click"),r._dialog.remove(),r._dialog.empty(),r._dialog=void 0}),this._dialog.modal("show")},o.prototype._showAlert=function(e,t){this._alertDiv.removeClass("alert-success alert-info alert-warning alert-danger hidden"),this._alertDiv.addClass(t),this._alertDiv.text(e)},o.prototype._hideAlert=function(){this._alertDiv.addClass("hidden")},o}),define("js/Panels/ModelEditor/ModelEditorControl.DiagramDesignerWidgetEventHandlers",["js/logger","js/util","js/Constants","js/UIEvents","js/NodePropertyNames","js/RegistryKeys","js/Utils/GMEConcepts","js/Widgets/DiagramDesigner/DiagramDesignerWidget.Constants","js/DragDrop/DragHelper","js/Dialogs/ReplaceBase/ReplaceBaseDialog","js/Utils/Exporters","js/Dialogs/ImportModel/ImportModelDialog"],function(e,t,n,i,o,r,s,a,l,c,d,h){"use strict";var p,g="attributes",u="registry",f=n.POINTER_SOURCE,m=n.POINTER_TARGET;return p=function(){},p.prototype.attachDiagramDesignerWidgetEventHandlers=function(){var e=this;this.designerCanvas.onDesignerItemsMove=function(t){e._onDesignerItemsMove(t)},this.designerCanvas.onCreateNewConnection=function(t){e._onCreateNewConnection(t)},this.designerCanvas.onSelectionDelete=function(t){e._onSelectionDelete(t)},this.designerCanvas.onDesignerItemDoubleClick=function(t,n){e._onDesignerItemDoubleClick(t,n)},this.designerCanvas.onModifyConnectionEnd=function(t){e._onModifyConnectionEnd(t)},this.designerCanvas.onRegisterSubcomponent=function(t,n,i){e._onRegisterSubcomponent(t,n,i)},this.designerCanvas.onUnregisterSubcomponent=function(t,n){e._onUnregisterSubcomponent(t,n)},this.designerCanvas.onBackgroundDroppableAccept=function(t,n){return e._onBackgroundDroppableAccept(t,n)},this.designerCanvas.onBackgroundDrop=function(t,n,i){e._onBackgroundDrop(t,n,i)},this.designerCanvas.onSelectionChanged=function(t){e._onSelectionChanged(t)},this.designerCanvas.onClipboardCopy=function(t){e._onClipboardCopy(t)},this.designerCanvas.onClipboardPaste=function(){e._onClipboardPaste()},this.designerCanvas.onConnectionSegmentPointsChange=function(t){e._onConnectionSegmentPointsChange(t)},this.designerCanvas.onFilterNewConnectionDroppableEnds=function(t){return e._onFilterNewConnectionDroppableEnds(t)},this.designerCanvas.onFilterReconnectionDroppableEnds=function(t){return e._onFilterReconnectionDroppableEnds(t)},this.designerCanvas.onDragStartDesignerItemDraggable=function(t){return e._onDragStartDesignerItemDraggable(t)},this.designerCanvas.onDragStartDesignerItemCopyable=function(t){return e._onDragStartDesignerItemCopyable(t)},this.designerCanvas.onDragStartDesignerConnectionCopyable=function(t){return e._onDragStartDesignerConnectionCopyable(t)},this.designerCanvas.onSelectionRotated=function(t,n){return e._onSelectionRotated(t,n)},this.designerCanvas.onSetConnectionProperty=function(t){e._onSetConnectionProperty(t)},this.designerCanvas.onCopy=function(){return e._onCopy()},this.designerCanvas.onPaste=function(t){return e._onPaste(t)},this.designerCanvas.getDragItems=function(t){return e._getDragItems(t)},this._oGetDragParams=this.designerCanvas.getDragParams,this.designerCanvas.getDragParams=function(t,n){return e._getDragParams(t,n)},this.designerCanvas.onSelectionContextMenu=function(t,n){e._onSelectionContextMenu(t,n)},this.designerCanvas.onSelectionAlignMenu=function(t,n){e._onSelectionAlignMenu(t,n)},this.designerCanvas.onSelectionFillColorChanged=function(t,n){e._onSelectionFillColorChanged(t,n)},this.designerCanvas.onSelectionBorderColorChanged=function(t,n){e._onSelectionBorderColorChanged(t,n)},this.designerCanvas.onSelectionTextColorChanged=function(t,n){e._onSelectionTextColorChanged(t,n)},this.designerCanvas.onSelectedTabChanged=function(t){e._onSelectedTabChanged(t)},this.designerCanvas.onAlignSelection=function(t,n){e._onAlignSelection(t,n)},this.logger.debug("attachDiagramDesignerWidgetEventHandlers finished")},p.prototype._onDesignerItemsMove=function(e){var t,i,o=this.currentNodeInfo.id;this._client.startTransaction();for(t in e)e.hasOwnProperty(t)&&(i={x:e[t].x,y:e[t].y},this._selectedAspect===n.ASPECT_ALL?this._client.setRegistry(this._ComponentID2GMEID[t],r.POSITION,i):(this._client.addMember(o,this._ComponentID2GMEID[t],this._selectedAspect),this._client.setMemberRegistry(o,this._ComponentID2GMEID[t],this._selectedAspect,r.POSITION,i)));this._client.completeTransaction()},p.prototype._onDesignerItemsCopy=function(e){var t,n,i,o={parentId:this.currentNodeInfo.id};this.designerCanvas.beginUpdate();for(t in e.items)e.items.hasOwnProperty(t)&&(n=e.items[t],i=this._ComponentID2GMEID[n.oItemId],o[i]={},o[i][g]={},o[i][u]={},o[i][u][r.POSITION]={x:n.posX,y:n.posY},this.designerCanvas.deleteComponent(t));for(t in e.connections)e.connections.hasOwnProperty(t)&&(n=e.connections[t],i=this._ComponentID2GMEID[n.oConnectionId],o[i]={},this.designerCanvas.deleteComponent(t));this.designerCanvas.endUpdate(),this._client.intellyPaste(o)},p.prototype._onCreateNewConnection=function(e){var t,i,r,a,l,c,d,h,p=this.currentNodeInfo.id,g=this._client,u=10,f={},m=this._selectedAspect;for(r=function(e){e&&(g.startTransaction(),c=g.createChild({parentId:p,baseId:e}),g.setPointer(c,n.POINTER_SOURCE,t),g.setPointer(c,n.POINTER_TARGET,i),g.completeTransaction())},t=void 0!==e.srcSubCompId?this._Subcomponent2GMEID[e.src][e.srcSubCompId]:this._ComponentID2GMEID[e.src],i=void 0!==e.dstSubCompId?this._Subcomponent2GMEID[e.dst][e.dstSubCompId]:this._ComponentID2GMEID[e.dst],d=s.getValidConnectionTypesInAspect(t,i,p,m),a=d.length;a--;)s.canCreateChild(p,d[a])||d.splice(a,1);if(1===d.length)r(d[0]);else if(d.length>1){for(a=0;a<d.length;a+=1)l=this._client.getNode(d[a]),f[d[a]]={name:"Create type '"+(l?l.getAttribute(o.Attributes.name):d[a])+"'",icon:!1};h=this.designerCanvas.items[e.dst].getBoundingBox(),this.designerCanvas.createMenu(f,function(e){r(e)},this.designerCanvas.posToPageXY(h.x-u,h.y-u))}},p.prototype._onSelectionDelete=function(e){for(var t,n=[],i=e.length;i--;)t=this._ComponentID2GMEID[e[i]],s.canDeleteNode(t)?n.pushUnique(t):this.logger.warn("Can not delete item with ID: "+t+". Possibly it is the ROOT or FCO");n.length>0&&this._client.deleteNodes(n)},p.prototype._onDesignerItemDoubleClick=function(e){var t=this._ComponentID2GMEID[e];t&&(this.logger.debug('Opening model with id "'+t+'"'),WebGMEGlobal.State.registerActiveObject(t))},p.prototype._onModifyConnectionEnd=function(e){var t,n=this._ComponentID2GMEID[e.id],i=e.old,o=e["new"];n&&(this._client.startTransaction(),(i.srcObjId!==o.srcObjId||i.srcSubCompId!==o.srcSubCompId)&&(t=void 0!==o.srcSubCompId?this._Subcomponent2GMEID[o.srcObjId][o.srcSubCompId]:this._ComponentID2GMEID[o.srcObjId],this._client.setPointer(n,f,t)),(i.dstObjId!==o.dstObjId||i.dstSubCompId!==o.dstSubCompId)&&(t=void 0!==o.dstSubCompId?this._Subcomponent2GMEID[o.dstObjId][o.dstSubCompId]:this._ComponentID2GMEID[o.dstObjId],this._client.setPointer(n,m,t)),this._client.completeTransaction())},p.prototype._onRegisterSubcomponent=function(e,t,i){this._GMEID2Subcomponent[i[n.GME_ID]]=this._GMEID2Subcomponent[i[n.GME_ID]]||{},this._GMEID2Subcomponent[i[n.GME_ID]][e]=t,this._Subcomponent2GMEID[e]=this._Subcomponent2GMEID[e]||{},this._Subcomponent2GMEID[e][t]=i[n.GME_ID]},p.prototype._onUnregisterSubcomponent=function(e,t){var n=this._Subcomponent2GMEID[e][t];delete this._Subcomponent2GMEID[e][t],this._GMEID2Subcomponent[n]&&delete this._GMEID2Subcomponent[n][e]},p.prototype._getPossibleDropActions=function(e){var t,n,i,r,a,c=l.getDragItems(e),d=l.getDragEffects(e),h=l.getDragParams(e),p=[],g=this.currentNodeInfo.id,u=!1,f=[],m=this._selectedAspect,_=function(e,t){var n=e.name.toLowerCase(),i=t.name.toLowerCase(),o=e.pointer.toLowerCase(),r=t.pointer.toLowerCase();return r>o?-1:o>r?1:i>n?-1:1};for(t=0;t<c.length;t+=1)if(s.isProjectFCO(c[t])){u=!0;break}if(c.length>0)for(t=d.length;t--;)switch(d[t]){case l.DRAG_EFFECTS.DRAG_MOVE:(h&&h.parentID===g||s.canCreateChildrenInAspect(g,c,m)&&s.canMoveNodeHere(g,c)&&!u)&&(a={dragEffect:d[t]},p.push(a));break;case l.DRAG_EFFECTS.DRAG_COPY:s.canCreateChildrenInAspect(g,c,m)&&!u&&(a={dragEffect:d[t]},p.push(a));break;case l.DRAG_EFFECTS.DRAG_CREATE_INSTANCE:s.canCreateChildrenInAspect(g,c,m)&&(a={dragEffect:d[t]},p.push(a));break;case l.DRAG_EFFECTS.DRAG_CREATE_POINTER:if(1===c.length&&(f=s.getValidPointerTypes(g,c[0]),f.length>0)){for(n=f.length;n--;)i=f[n].baseId,r=this._client.getNode(i),f[n].name=i,r&&(f[n].name=r.getAttribute(o.Attributes.name));for(f.sort(_),n=0;n<f.length;n+=1)a={dragEffect:l.DRAG_EFFECTS.DRAG_CREATE_POINTER,name:f[n].name,baseId:f[n].baseId,pointer:f[n].pointer},p.push(a)}}return this.logger.debug("possibleDropActions: "+JSON.stringify(p)),p},p.prototype._onBackgroundDroppableAccept=function(e,t){var n;return n=this._getPossibleDropActions(t).length>0},p.prototype._onBackgroundDrop=function(e,t,n){var i,o,r,s=this._getPossibleDropActions(t),a=s.length,c=this;if(1===a)o=s[0],this._handleDropAction(o,t,n);else{for(r={},i=0;i<s.length;i+=1)switch(s[i].dragEffect){case l.DRAG_EFFECTS.DRAG_COPY:r[i]={name:"Copy here",icon:"glyphicon glyphicon-plus"};break;case l.DRAG_EFFECTS.DRAG_MOVE:r[i]={name:"Move here",icon:"glyphicon glyphicon-move"};break;case l.DRAG_EFFECTS.DRAG_CREATE_INSTANCE:r[i]={name:"Create instance here",icon:"glyphicon glyphicon-share-alt"};break;case l.DRAG_EFFECTS.DRAG_CREATE_POINTER:r[i]={name:'Create pointer "'+s[i].pointer+'" of type "'+s[i].name+'"',icon:"glyphicon glyphicon-share"}}this.designerCanvas.createMenu(r,function(e){o=s[parseInt(e,10)],c._handleDropAction(o,t,n)},this.designerCanvas.posToPageXY(n.x,n.y))}},p.prototype._handleDropAction=function(e,t,n){var i,s,a,c,d,h,p=e.dragEffect,g=l.getDragItems(t),f=l.getDragParams(t),m=this.currentNodeInfo.id,_=20;switch(this.logger.debug("dropAction: "+JSON.stringify(e)),this.logger.debug("dragInfo: "+JSON.stringify(t)),this.logger.debug("position: "+JSON.stringify(n)),p){case l.DRAG_EFFECTS.DRAG_COPY:for(a={parentId:m},i=g.length;i--;)s=g[i],a[s]={},c=f&&f.positions[s]||{x:0,y:0},a[s][u]={},a[s][u][r.POSITION]={x:n.x+c.x,y:n.y+c.y};this._client.startTransaction(),this._client.copyMoreNodes(a),this._client.completeTransaction();break;case l.DRAG_EFFECTS.DRAG_MOVE:if(f&&f.parentID===m)this._repositionItems(g,f.positions,n);else{for(a={parentId:m},i=g.length;i--;)s=g[i],a[s]={},c=f&&f.positions[s]||{x:0,y:0},a[s][u]={},a[s][u][r.POSITION]={x:n.x+c.x,y:n.y+c.y};this._client.moveMoreNodes(a)}break;case l.DRAG_EFFECTS.DRAG_CREATE_INSTANCE:for(a={parentId:m},i=g.length;i--;)c=f&&f.positions[g[i]]||{x:0,y:0},a[g[i]]={registry:{position:{x:n.x+c.x,y:n.y+c.y}}},f&&f.positions[g[i]]||(n.x+=_,n.y+=_);this._client.createChildren(a);break;case l.DRAG_EFFECTS.DRAG_CREATE_POINTER:a={parentId:m,baseId:e.baseId},this._client.startTransaction(),s=this._client.createChild(a),s&&(c=f&&f.positions[g[0]]||{x:0,y:0},this._client.setRegistry(s,r.POSITION,{x:n.x+c.x,y:n.y+c.y}),this._client.setPointer(s,e.pointer,g[0]),d=this._client.getNode(g[0]),d&&(h=d.getAttribute(o.Attributes.name)+"-"+e.pointer,this._client.setAttribute(s,o.Attributes.name,h))),this._client.completeTransaction()}},p.prototype._repositionItems=function(e,t,n){var i,o,r,s,a=e.length,l=[],c=this;if(t&&!_.isEmpty(t)){for(this.designerCanvas.beginUpdate();a--;)if(r=e[a],i=t[r],i||(i={x:0,y:0}),this._GMEID2ComponentID.hasOwnProperty(r))for(s=this._GMEID2ComponentID[r].length;s--;)o=this._GMEID2ComponentID[r][s],l.push(o),this.designerCanvas.updateDesignerItem(o,{position:{x:n.x+i.x,y:n.y+i.y}});this.designerCanvas.endUpdate(),this.designerCanvas.select(l),setTimeout(function(){c._saveReposition(e,t,n)},10)}},p.prototype._saveReposition=function(e,t,i){var o,s,a,l=this.currentNodeInfo.id,c=this._selectedAspect,d=this._client;for(d.startTransaction(),a=e.length;a--;)o=e[a],s=t[o],s||(s={x:0,y:0}),c===n.ASPECT_ALL?d.setRegistry(o,r.POSITION,{x:i.x+s.x,y:i.y+s.y}):(d.addMember(l,o,c),d.setMemberRegistry(l,o,c,r.POSITION,{x:i.x+s.x,y:i.y+s.y}));d.completeTransaction()},p.prototype._onSelectionChanged=function(e){for(var t,n=[],i=e.length,o=e.length>0;i--;)t=this._ComponentID2GMEID[e[i]],t&&(n.push(t),o=o&&s.isConnectionType(t));this.designerCanvas.toolbarItems.ddbtnConnectionArrowStart.enabled(o),this.designerCanvas.toolbarItems.ddbtnConnectionPattern.enabled(o),this.designerCanvas.toolbarItems.ddbtnConnectionArrowEnd.enabled(o),this.designerCanvas.toolbarItems.ddbtnConnectionLineType.enabled(o),this.designerCanvas.toolbarItems.ddbtnConnectionLineWidth.enabled(o),this.designerCanvas.toolbarItems.ddbtnConnectionLabelPlacement.enabled(o),this.$btnConnectionRemoveSegmentPoints.enabled(o),this._settingActiveSelection=!0,WebGMEGlobal.State.registerActiveSelection(n),this._settingActiveSelection=!1},p.prototype._onClipboardCopy=function(e){for(var t,n=[],i=e.length;i--;)t=this._ComponentID2GMEID[e[i]],t&&n.push(t);0!==n.length&&this._client.copyNodes(n)},p.prototype._onClipboardPaste=function(){this.currentNodeInfo.id&&this._client.pasteNodes(this.currentNodeInfo.id)},p.prototype._onConnectionSegmentPointsChange=function(e){var t,n=e.connectionID,i=e.points,o=this._ComponentID2GMEID[n];o&&(t=this._client.getNode(o),t&&this._client.setRegistry(o,r.LINE_CUSTOM_POINTS,i))},p.prototype._onFilterNewConnectionDroppableEnds=function(e){var t,i,o,r,a,l,c,d=e.availableConnectionEnds,h=[],p=this.currentNodeInfo.id,g=(this._client,this._selectedAspect);for(i=void 0===e.srcSubCompId?this._ComponentID2GMEID[e.srcId]:this._Subcomponent2GMEID[e.srcId][e.srcSubCompId],r=s.getValidConnectionTypesFromSourceInAspect(i,p,g),t=r.length;t--;)s.canCreateChild(p,r[t])||r.splice(t,1);for(t=d.length;t--;)for(c=d[t],o=void 0===c.dstSubCompID?this._ComponentID2GMEID[c.dstItemID]:this._Subcomponent2GMEID[c.dstItemID][c.dstSubCompID],a=r.length,l=this._client.getNode(o);a--;)if(l&&l.isValidTargetOf(r[a],n.POINTER_TARGET)){h.push(d[t]);break}return h},p.prototype._onFilterReconnectionDroppableEnds=function(e){var t,n,i,o=e.connId,r=e.draggedEnd===a.CONNECTION_END_SRC,l=e.srcItemID,c=e.srcSubCompID,d=e.dstItemID,h=e.dstSubCompID,p=e.availableConnectionEnds,g=e.availableConnectionSources,u=[],f=this._ComponentID2GMEID[o];if(r===!0)for(i=void 0!==h?this._Subcomponent2GMEID[d][h]:this._ComponentID2GMEID[d],t=g.length;t--;)l=g[t].srcItemID,c=g[t].srcSubCompID,n=void 0!==c?this._Subcomponent2GMEID[l][c]:this._ComponentID2GMEID[l],s.isValidConnection(n,i,f)===!0&&u.push(g[t]);else for(i=void 0!==c?this._Subcomponent2GMEID[l][c]:this._ComponentID2GMEID[l],t=p.length;t--;)d=p[t].dstItemID,h=p[t].dstSubCompID,n=void 0!==h?this._Subcomponent2GMEID[d][h]:this._ComponentID2GMEID[d],s.isValidConnection(i,n,f)===!0&&u.push(p[t]);return u},p.prototype._onDragStartDesignerItemDraggable=function(){var e=!0;return e},p.prototype._onDragStartDesignerItemCopyable=function(e){var t=this._client.getNode(this._ComponentID2GMEID[e]),n=!0;return t&&(n="false"!==t.getAttribute("copy")),n},p.prototype._onDragStartDesignerConnectionCopyable=function(e){return this._onDragStartDesignerItemCopyable(e)},p.prototype._onSelectionRotated=function(e,t){for(var n,i,o,s,l,c=t.length,d=!0,h=!1;c--;)l=this._ComponentID2GMEID[t[c]],s=this._client.getNode(l),s&&(n=s.getEditableRegistry(r.ROTATION)||0,o=s.getOwnEditableRegistry(r.ROTATION),e===a.ROTATION_RESET?i=0:e===a.ROTATION_TOLEFT?i=n-n%90:e===a.ROTATION_TORIGHT?i=n%90>0?n+90-n%90:n:e===a.ROTATION_CLEAR?d=!1:i=(n+e)%360,d&&i!==o?(h||(h=!0,this._client.startTransaction()),this._client.setRegistry(l,r.ROTATION,i)):d||void 0===o||(h||(h=!0,this._client.startTransaction()),this._client.delRegistry(l,r.ROTATION)));h&&this._client.completeTransaction()},p.prototype._onSetConnectionProperty=function(e){var t,i,o=e.items,s=e.params,a=[],l=o.length,c=this._client;for(i=function(e,t,n){s.hasOwnProperty(t)&&c.setRegistry(e,n,s[t])};l--;)t=this._ComponentID2GMEID[o[l]],t&&a.push(t);if(l=a.length,l>0){for(this._client.startTransaction();l--;)t=a[l],i(t,n.LINE_STYLE.START_ARROW,r.LINE_START_ARROW),i(t,n.LINE_STYLE.END_ARROW,r.LINE_END_ARROW),i(t,n.LINE_STYLE.TYPE,r.LINE_TYPE),i(t,n.LINE_STYLE.PATTERN,r.LINE_STYLE),i(t,n.LINE_STYLE.WIDTH,r.LINE_WIDTH),i(t,n.LINE_STYLE.LABEL_PLACEMENT,r.LINE_LABEL_PLACEMENT);this._client.completeTransaction()}},p.prototype._onCopy=function(){for(var e,t,n,i=[],s=this.designerCanvas.selectionManager.getSelectedElements(),a=s.length,l={project:this._client.getActiveProjectId(),items:[]};a--;)e=this._ComponentID2GMEID[s[a]],t={ID:e,Name:void 0,Position:void 0},n=this._client.getNode(e),n&&(t.Name=n.getAttribute(o.Attributes.name),t.Position=n.getRegistry(r.POSITION)),i.push(t);return l.items=i,l},p.prototype._onPaste=function(e){var t,n,i=this.currentNodeInfo.id,o={parentId:i},r=this._client.getActiveProjectId(),a=[],l=this._selectedAspect;if(i){try{e=JSON.parse(e)}catch(c){this.logger.error('Invalid clipboard data: "'+e+'"'),e=void 0}if(e&&e.project&&e.items)if(r!==e.project)alert("Trying to copy from project '"+e.project+"' to project '"+r+"' which is not supported... Copy&Paste is supported in the same project only.");else if(_.isArray(e.items)){for(e=e.items,t=e.length;t--;)n=e[t],n&&n.ID&&(o[n.ID]={},a.push(n.ID));s.canCreateChildrenInAspect(i,a,l)?(this._client.startTransaction(),this._client.copyMoreNodes(o),this._client.completeTransaction(),this.logger.warn("Pasted "+a.length+" items successfully into node ("+i+")")):this.logger.warn("Can not paste items because not all the items on the clipboard can be created as a child of the currently opened node ("+i+")")}}},p.prototype._getDragItems=function(e){for(var t=[],n=e.length;n--;)t.push(this._ComponentID2GMEID[e[n]]);return t},p.prototype._getDragParams=function(e,t){var n,i=this._oGetDragParams.call(this.designerCanvas,e,t),o={positions:{},parentID:this.currentNodeInfo.id};for(n in i.positions)i.positions.hasOwnProperty(n)&&(o.positions[this._ComponentID2GMEID[n]]=i.positions[n]);return o},p.prototype._onSelectionContextMenu=function(e,t){var n,o,r,a={},l="connode",c="conmodel",p="metaRulesNode",g="metaRulesModel",u="editReplaceable",f="exportModels",m="importModels",_=!1,b=this;if(1===e.length)a[i.LOCATE_NODE]={name:"Locate in tree browser",doNotHide:!0,icon:"glyphicon glyphicon-screenshot"},s.isReplaceable(b._ComponentID2GMEID[e[0]])&&(a[u]={name:"Replace base ...",icon:"glyphicon glyphicon-transfer"}),a[p]={name:"Check Meta rules for node",icon:"glyphicon glyphicon-ok-sign"},a[g]={name:"Check Meta rules for node and its children",icon:"glyphicon glyphicon-ok-sign"},b._client.gmeConfig.core.enableCustomConstraints===!0&&(a[l]={name:"Check Custom Constraints for node",icon:"glyphicon glyphicon-fire"},a[c]={name:"Check Custom Constraints for node and its children",icon:"glyphicon glyphicon-fire"}),n=b._client.getNode(b._ComponentID2GMEID[e[0]]),n.isLibraryElement()===!1&&n.isLibraryRoot()===!1&&(a[f]={name:"Export selected model",icon:"glyphicon glyphicon-export"},a[m]={name:"Import models into",icon:"glyphicon glyphicon-import"});else if(e.length>1){for(a[p]={name:"Check Meta rules for nodes",icon:"glyphicon glyphicon-ok-sign"},a[g]={name:"Check Meta rules for nodes and their children",icon:"glyphicon glyphicon-ok-sign"},b._client.gmeConfig.core.enableCustomConstraints===!0&&(a[l]={name:"Check Custom Constraints for nodes",icon:"glyphicon glyphicon-fire"
},a[c]={name:"Check Custom Constraints for nodes and their children",icon:"glyphicon glyphicon-fire"}),o=0;o<e.length;o+=1)if(n=b._client.getNode(b._ComponentID2GMEID[e[o]]),n.isLibraryElement()||n.isLibraryRoot()){_=!0;break}_===!1&&(a[f]={name:"Export selected models",icon:"glyphicon glyphicon-export"})}this.designerCanvas.createMenu(a,function(t){if(t===l)b._nodeConCheck(e,!1);else if(t===c)b._nodeConCheck(e,!0);else if(t===p)b._metaRulesCheck(e,!1);else if(t===g)b._metaRulesCheck(e,!0);else if(t===i.LOCATE_NODE)b._client.dispatchEvent(i.LOCATE_NODE,{nodeId:b._ComponentID2GMEID[e[0]]});else if(t===u)b._replaceBaseDialog(b._ComponentID2GMEID[e[0]]);else if(t===f){for(r=[],o=0;o<e.length;o+=1)r.push(b._ComponentID2GMEID[e[o]]);d.exportModels(b._client,b.logger,r)}else if(t===m){var n=new h(b._client,b.logger.fork("ImportModel"));n.show(b._ComponentID2GMEID[e[0]])}},this.designerCanvas.posToPageXY(t.mX,t.mY))},p.prototype._replaceBaseDialog=function(e){var t;"string"==typeof e&&this._client.getNode(e)&&(t=new c,t.show({client:this._client,nodeId:e}))},p.prototype._onSelectionAlignMenu=function(e,t){var n=this.designerCanvas.posToPageXY(t.mX,t.mY),i=this;this._alignMenu.show(e,n,function(t){i._onAlignSelection(e,t)})},p.prototype._metaRulesCheck=function(e,t){for(var n=e.length,i=[];n--;)i.push(this._ComponentID2GMEID[e[n]]);i.length>0&&this._client.checkMetaRules(i,t)},p.prototype._nodeConCheck=function(e,t){for(var n=e.length,i=[];n--;)i.push(this._ComponentID2GMEID[e[n]]);i.length>0&&this._client.checkCustomConstraints(i,t)},p.prototype._onSelectionFillColorChanged=function(e,t){this._onSelectionSetColor(e,t,r.COLOR)},p.prototype._onSelectionBorderColorChanged=function(e,t){this._onSelectionSetColor(e,t,r.BORDER_COLOR)},p.prototype._onSelectionTextColorChanged=function(e,t){this._onSelectionSetColor(e,t,r.TEXT_COLOR)},p.prototype._onSelectionSetColor=function(e,t,n){var i,o=e.length;for(this._client.startTransaction();o--;)i=this._ComponentID2GMEID[e[o]],t?this._client.setRegistry(i,n,t):this._client.delRegistry(i,n);this._client.completeTransaction()},p.prototype._onSelectedTabChanged=function(e){this._aspects[e]&&this._selectedAspect!==this._aspects[e]&&(this._selectedAspect=this._aspects[e],this.logger.debug("selectedAspectChanged: "+this._selectedAspect),this._initializeSelectedAspect(e))},p.prototype._onAlignSelection=function(e,t){var i,o,s=[],a=[],l=this.currentNodeInfo.id,c=this;e.forEach(function(e){var t,n=c._ComponentID2GMEID[e];c._GMEModels.indexOf(n)>-1&&(t=c._getObjectDescriptor(n),t?s.push(t):c.logger.warn("_onAlignSelection, could not get objectDescriptor for a selectedIds",n))}),0!==s.length&&(0===t.indexOf("MOVE_TO_")?(c._GMEModels.forEach(function(e){var t=c._getObjectDescriptor(e);t?a.push(t):c.logger.warn("_onAlignSelection, could not get objectDescriptor for a _GMEModels",e)}),i=c._alignMenu.getExtremePosition(a,t)):i=s[0],i&&(o=c._alignMenu.isXAxisType(t),this._client.startTransaction(),s.forEach(function(e){var t=e.position;i.id!==e.id&&(o===!0?t.x=i.position.x:t.y=i.position.y,c._selectedAspect===n.ASPECT_ALL?c._client.setRegistry(e.id,r.POSITION,t):(c._client.addMember(l,e.id,c._selectedAspect),c._client.setMemberRegistry(l,e.id,c._selectedAspect,r.POSITION,t)))}),this._client.completeTransaction()))},p}),define("js/Panels/ModelEditor/ModelEditorControl",["js/logger","js/Constants","js/NodePropertyNames","js/RegistryKeys","js/Widgets/DiagramDesigner/DiagramDesignerWidget.Constants","./ModelEditorControl.DiagramDesignerWidgetEventHandlers","js/Utils/GMEConcepts","js/Utils/GMEVisualConcepts","js/Utils/PreferencesHelper","js/Controls/AlignMenu","js/Utils/ComponentSettings"],function(e,t,n,i,o,r,s,a,l,c,d){"use strict";var h,p="#DEDEDE",g=30,u="ModelDecorator",f="DiagramDesigner",m=t.POINTER_SOURCE,b=t.POINTER_TARGET;return h=function(n,i){if(this.logger=n.logger||e.create(n.loggerName||"gme:Panels:ModelEditor:ModelEditorControl",WebGMEGlobal.gmeConfig.client.log),this._client=n.client,this._config=h.getDefaultConfig(),d.resolveWithWebGMEGlobal(this._config,h.getComponentId()),this._firstLoad=!1,this._topNode=t.PROJECT_ROOT_ID,this.designerCanvas=n.widget,this._alignMenu=new c(this.designerCanvas.CONSTANTS,{}),void 0===this._client)throw this.logger.error("ModelEditorControl's client is not specified..."),"ModelEditorControl can not be created";if(void 0===this.designerCanvas)throw this.logger.error("ModelEditorControl's DesignerCanvas is not specified..."),"ModelEditorControl can not be created";this._selfPatterns={},this._GMEID2ComponentID=this._GmeID2ComponentID={},this._ComponentID2GMEID=this._ComponentID2GmeID={},this.eventQueue=[],this._componentIDPartIDMap={},this.___SLOW_CONN=!1,this.currentNodeInfo={id:null,children:[],parentId:null},this.attachDiagramDesignerWidgetEventHandlers(),this._updateTopNode(),this.logger.debug("ModelEditorControl ctor finished")},h.prototype.selectedObjectChanged=function(e){var n,i,o,r=this;if(this.logger.debug('activeObject "'+e+'"'),this.designerCanvas.clear(),this._GMEModels=[],this._GMEConnections=[],this._GMEID2ComponentID=this._GmeID2ComponentID={},this._ComponentID2GMEID=this._ComponentID2GmeID={},this._GMEID2Subcomponent={},this._Subcomponent2GMEID={},this._territoryId&&this._client.removeUI(this._territoryId),this.currentNodeInfo.id=e,this.currentNodeInfo.parentId=void 0,this._delayedConnections=[],this._selectedAspect=WebGMEGlobal.State.getActiveAspect(),e||e===t.PROJECT_ROOT_ID){if(n=this._getObjectDescriptor(e),i=n&&n.name||" ",n&&(this.currentNodeInfo.parentId=n.parentId),this._refreshBtnModelHierarchyUp(),o=this._client.getNode(e),this._selectedAspect!==t.ASPECT_ALL){var s=o?o.getValidAspectNames():[];-1===s.indexOf(this._selectedAspect)&&(this.logger.warn('The currently selected aspect "'+this._selectedAspect+'" does not exist in the object "'+i+" ("+e+')", falling back to "All"'),this._selectedAspect=t.ASPECT_ALL,WebGMEGlobal.State.registerActiveAspect(t.ASPECT_ALL))}this._selfPatterns={},this._selectedAspect===t.ASPECT_ALL?this._selfPatterns[e]={children:2}:(this._selfPatterns[e]=this._client.getAspectTerritoryPattern(e,this._selectedAspect),this._selfPatterns[e].children=2),this._firstLoad=!0,this.designerCanvas.setTitle(i),this.designerCanvas.setBackgroundText(i,{"font-size":g,color:p}),!o||this._client.isProjectReadOnly()||this._client.isCommitReadOnly()||(this.designerCanvas.setReadOnly(o.isLibraryRoot()||o.isLibraryElement()),this.setReadOnly(o.isLibraryRoot()||o.isLibraryElement())),this.designerCanvas.showProgressbar(),this._territoryId=this._client.addUI(this,function(e){r._eventCallback(e)}),this._client.updateTerritory(this._territoryId,this._selfPatterns)}else this.designerCanvas.setBackgroundText("No object to display",{color:p,"font-size":g})},h.prototype._getObjectDescriptor=function(e){var n,o,r,l,c=this._client.getNode(e),d=0;if(c){if(n={},n.id=c.getId(),n.name=c.getFullyQualifiedName(),n.parentId=c.getParentId(),c.isLibraryRoot())return n;e!==this.currentNodeInfo.id&&(s.isConnection(e)?(n.connectionChanged=this._GMEModels.indexOf(e)>-1&&-1===this._GMEConnections.indexOf(e),n.kind="CONNECTION",n.source=c.getPointer(m).to,n.target=c.getPointer(b).to,_.extend(n,a.getConnectionVisualProperties(e)),(n.srcText||n.dstText)&&delete n.name,r=c.getRegistry(i.LINE_CUSTOM_POINTS),r&&_.isArray(r)&&(n[t.LINE_STYLE.CUSTOM_POINTS]=$.extend(!0,[],r))):(n.kind="MODEL",n.connectionChanged=-1===this._GMEModels.indexOf(e)&&this._GMEConnections.indexOf(e)>-1,this._selectedAspect===t.ASPECT_ALL?o=c.getRegistry(i.POSITION):(l=this._client.getNode(this.currentNodeInfo.id),o=l.getMemberRegistry(this._selectedAspect,e,i.POSITION)||c.getRegistry(i.POSITION)),o?n.position={x:o.x,y:o.y}:n.position={x:d,y:d},n.position.hasOwnProperty("x")?n.position.x=this._getDefaultValueForNumber(n.position.x,d):n.position.x=d,n.position.hasOwnProperty("y")?n.position.y=this._getDefaultValueForNumber(n.position.y,d):n.position.y=d,n.decorator=c.getRegistry(i.DECORATOR)||"",n.rotation=parseInt(c.getRegistry(i.ROTATION),10)||0))}return n},h.prototype._getDefaultValueForNumber=function(e,t){return _.isNumber(e)?_.isNaN(e)?t:e:t},h.prototype._eventCallback=function(e){var t,n=e?e.length:0;this.logger.debug('_eventCallback "'+n+'" items'),n>0&&(this.eventQueue.push(e),t=this.processNextInQueue()),this.logger.debug('_eventCallback "'+e.length+'" items - DONE'),t===!0&&this.selectedObjectChanged(this.currentNodeInfo.id)},h.prototype.processNextInQueue=function(){var e,n,i=this.eventQueue.length,o=[u],r=!1,s=this;if(i>0){for(e=this.eventQueue.pop(),i=e.length;i--;)(e[i].etype===t.TERRITORY_EVENT_LOAD||e[i].etype===t.TERRITORY_EVENT_UPDATE)&&(e[i].desc=this._getObjectDescriptor(e[i].eid),r=r||e[i].desc.connectionChanged===!0,n=e[i].desc.decorator,n&&""!==n&&-1===o.indexOf(n)&&o.pushUnique(n));this._client.decoratorManager.download(o,f,function(){s._dispatchEvents(e)})}return r},h.prototype._dispatchEvents=function(e){var n,i,o,r,s,a,l,c,d,h,p,g,u,f,m=e.length,_=!1,b=this,y=999999999;if(this.logger.debug("_dispatchEvents "+e[0].etype),e.shift(),this.logger.debug('_dispatchEvents "'+m+'" items'),i=[],o=[],this._delayedConnections&&this._delayedConnections.length>0)for(m=0;m<this._delayedConnections.length;m+=1)o.push({etype:t.TERRITORY_EVENT_LOAD,eid:this._delayedConnections[m],desc:this._getObjectDescriptor(this._delayedConnections[m])});for(this._delayedConnections=[],r=[],m=e.length;m--;)if(n=e[m],n.etype===t.TERRITORY_EVENT_UNLOAD)r.push(n);else if("MODEL"===n.desc.kind)i.push(n);else if("CONNECTION"===n.desc.kind)if(n.desc.parentId===this.currentNodeInfo.id){for(s=n.desc.source,a=n.desc.target,l=-1,c=-1,d=o.length;d--&&(h=o[d],h.id===s?l=d:h.id===a&&(c=d),-1===l||-1===c););for(p=Math.max(l,c),u=y,f=y,d=o.length;d--&&(h=o[d],n.desc.id===h.desc.source?u=d:n.desc.id===h.desc.target&&(f=d),u===y||f===y););g=Math.min(u,f),-1===p&&g===y?o.push(n):-1!==p&&g===y?o.splice(p+1,0,n):-1===p&&g!==y?o.splice(g,0,n):-1!==p&&g!==y&&o.splice(g,0,n)}else i.push(n);else this.currentNodeInfo.id===n.eid&&i.push(n);for(e=r.concat(i),m=e.length,this._notifyPackage={},this.designerCanvas.beginUpdate(),m=0;m<e.length;m+=1)switch(n=e[m],n.etype){case t.TERRITORY_EVENT_LOAD:_=this._onLoad(n.eid,n.desc)||_;break;case t.TERRITORY_EVENT_UPDATE:this._onUpdate(n.eid,n.desc);break;case t.TERRITORY_EVENT_UNLOAD:_=this._onUnload(n.eid)||_}for(this._handleDecoratorNotification(),e=o,m=e.length,m=0;m<e.length;m+=1)switch(n=e[m],n.etype){case t.TERRITORY_EVENT_LOAD:this._onLoad(n.eid,n.desc);break;case t.TERRITORY_EVENT_UPDATE:this._onUpdate(n.eid,n.desc);break;case t.TERRITORY_EVENT_UNLOAD:this._onUnload(n.eid)}if(this.designerCanvas.endUpdate(),this.designerCanvas.hideProgressbar(),_&&(this.___SLOW_CONN===!0?setTimeout(function(){b.logger.debug("Updating territory with ruleset from decorators: "+JSON.stringify(b._selfPatterns)),b._client.updateTerritory(b._territoryId,b._selfPatterns)},2e3):(this.logger.debug("Updating territory with ruleset from decorators: "+JSON.stringify(this._selfPatterns)),this._client.updateTerritory(this._territoryId,this._selfPatterns))),this._firstLoad===!0){this._firstLoad=!1;var v=WebGMEGlobal.State.getActiveSelection();if(v&&v.length>0){m=v.length;for(var C,E=[];m--;)C=v[m],this._GMEID2ComponentID[C]&&(E=E.concat(this._GMEID2ComponentID[C]));this.designerCanvas.select(E)}}this.logger.debug('_dispatchEvents "'+e.length+'" items - DONE'),this.processNextInQueue()},h.prototype._getItemDecorator=function(e){var t;return t=this._client.decoratorManager.getDecoratorForWidget(e,f),t||(t=this._client.decoratorManager.getDecoratorForWidget(u,f)),t},h.prototype._onLoad=function(e,n){var i,o,r,s,a,c,d,h=[],p=[],g=!1,u=this;if(s=function(e){var t,n;if(e&&(t=e.getTerritoryQuery()))for(n in t)t.hasOwnProperty(n)&&(u._selfPatterns[n]=t[n],g=!0)},this.currentNodeInfo.id!==e){if(n)if(n.parentId===this.currentNodeInfo.id){if(r=_.extend({},n),this._GMEID2ComponentID[e]=[],"MODEL"===r.kind&&(this._GMEModels.push(e),o=this._getItemDecorator(r.decorator),r.decoratorClass=o,r.control=this,r.metaInfo={},r.metaInfo[t.GME_ID]=e,r.preferencesHelper=l.getPreferences(),r.aspect=this._selectedAspect,i=this.designerCanvas.createDesignerItem(r),this._GMEID2ComponentID[e].push(i.id),this._ComponentID2GMEID[i.id]=e,s(i._decoratorInstance)),"CONNECTION"===r.kind)if(this._GMEConnections.push(e),a=this._getAllSourceDestinationPairsForConnection(r.source,r.target),h=a.sources,p=a.destinations,c=h.length,d=p.length,c>0&&d>0)for(;c--;)for(;d--;)r.srcObjId=h[c].objId,r.srcSubCompId=h[c].subCompId,r.dstObjId=p[d].objId,r.dstSubCompId=p[d].subCompId,r.reconnectable=!0,r.editable=!0,delete r.source,delete r.target,_.extend(r,this.getConnectionDescriptor(e)),i=this.designerCanvas.createConnection(r),this.logger.debug("Connection: "+i.id+" for GME object: "+r.id),this._GMEID2ComponentID[e].push(i.id),this._ComponentID2GMEID[i.id]=e;else this._delayedConnections.push(e)}else this._checkComponentDependency(e,t.TERRITORY_EVENT_LOAD)}else this._updateSheetName(n.name),this._updateAspects();return g},h.prototype._onUpdate=function(e,n){var i,o,r,s,a,c,d,h,p;if(e===this.currentNodeInfo.id)this._updateSheetName(n.name),this._updateAspects();else if(n)if(n.parentId===this.currentNodeInfo.id){if("MODEL"===n.kind&&this._GMEID2ComponentID[e])for(o=this._GMEID2ComponentID[e].length;o--;)i=this._GMEID2ComponentID[e][o],r=this._getItemDecorator(n.decorator),n.decoratorClass=r,n.preferencesHelper=l.getPreferences(),n.aspect=this._selectedAspect,this.designerCanvas.updateDesignerItem(i,n);if(-1!==this._GMEConnections.indexOf(e)){for(o=this._GMEID2ComponentID[e].length,s=this._getAllSourceDestinationPairsForConnection(n.source,n.target),a=s.sources,c=s.destinations,d=a.length,h=c.length,o-=1,d=a.length-1;d>=0;d-=1)for(h=c.length-1;h>=0;h-=1)n.srcObjId=a[d].objId,n.srcSubCompId=a[d].subCompId,n.dstObjId=c[h].objId,n.dstSubCompId=c[h].subCompId,n.reconnectable=!0,n.editable=!0,delete n.source,delete n.target,o>=0?(i=this._GMEID2ComponentID[e][o],_.extend(n,this.getConnectionDescriptor(e)),this.designerCanvas.updateConnection(i,n),o-=1):(this.logger.warn("Updating connections...Existing connections are less than the needed src-dst combo..."),_.extend(n,this.getConnectionDescriptor(e)),p=this.designerCanvas.createConnection(n),this.logger.debug("Connection: "+p.id+" for GME object: "+n.id),this._GMEID2ComponentID[e].push(p.id),this._ComponentID2GMEID[p.id]=e);if(o>=0)for(o+=1;o--;)i=this._GMEID2ComponentID[e][o],this.designerCanvas.deleteComponent(i),this._GMEID2ComponentID[e].splice(o,1),delete this._ComponentID2GMEID[i]}}else this._checkComponentDependency(e,t.TERRITORY_EVENT_UPDATE)},h.prototype._updateSheetName=function(e){this.designerCanvas.setTitle(e),this.designerCanvas.setBackgroundText(e,{"font-size":g,color:p})},h.prototype._onUnload=function(e){var n,i,o,r=this,s=!1;if(o=function(e){var t,n;if(e&&(t=e.getTerritoryQuery()))for(n in t)t.hasOwnProperty(n)&&(delete r._selfPatterns[n],s=!0)},e===this.currentNodeInfo.id)this.logger.debug('The previously opened model does not exist... --- GMEID: "'+this.currentNodeInfo.id+'"'),this.designerCanvas.setBackgroundText("The previously opened model does not exist...",{"font-size":g,color:p});else if(this._GMEID2ComponentID.hasOwnProperty(e)){for(i=this._GMEID2ComponentID[e].length;i--;)n=this._GMEID2ComponentID[e][i],-1!==this.designerCanvas.itemIds.indexOf(n)&&o(this.designerCanvas.items[n]._decoratorInstance),this.designerCanvas.deleteComponent(n),delete this._ComponentID2GMEID[n];delete this._GMEID2ComponentID[e]}else this._checkComponentDependency(e,t.TERRITORY_EVENT_UNLOAD);return s},h.prototype.destroy=function(){this._detachClientEventListeners(),this._removeToolbarItems(),this._client.removeUI(this._territoryId)},h.prototype._onModelHierarchyUp=function(){var e=this.currentNodeInfo.id;(this.currentNodeInfo.parentId||this.currentNodeInfo.parentId===t.PROJECT_ROOT_ID)&&(WebGMEGlobal.State.registerActiveObject(this.currentNodeInfo.parentId),WebGMEGlobal.State.registerActiveSelection([e]))},h.prototype._removeConnectionSegmentPoints=function(){var e,t=this.designerCanvas.selectionManager.getSelectedElements(),n=t.length;for(this._client.startTransaction();n--;)-1!==this.designerCanvas.connectionIds.indexOf(t[n])&&(e=this._client.getNode(this._ComponentID2GMEID[t[n]]),e&&this._client.delRegistry(e.getId(),i.LINE_CUSTOM_POINTS));this._client.completeTransaction()},h.prototype._getAllSourceDestinationPairsForConnection=function(e,t){var n,i=[],o=[];if(this._GMEID2ComponentID.hasOwnProperty(e))for(n=this._GMEID2ComponentID[e].length;n--;)i.push({objId:this._GMEID2ComponentID[e][n],subCompId:void 0});else if(this._GMEID2Subcomponent&&this._GMEID2Subcomponent.hasOwnProperty(e))for(n in this._GMEID2Subcomponent[e])this._GMEID2Subcomponent[e].hasOwnProperty(n)&&i.push({objId:n,subCompId:this._GMEID2Subcomponent[e][n]});if(this._GMEID2ComponentID.hasOwnProperty(t))for(n=this._GMEID2ComponentID[t].length;n--;)o.push({objId:this._GMEID2ComponentID[t][n],subCompId:void 0});else if(this._GMEID2Subcomponent&&this._GMEID2Subcomponent.hasOwnProperty(t))for(n in this._GMEID2Subcomponent[t])this._GMEID2Subcomponent[t].hasOwnProperty(n)&&o.push({objId:n,subCompId:this._GMEID2Subcomponent[t][n]});return{sources:i,destinations:o}},h.prototype.registerComponentIDForPartID=function(e,t){this._componentIDPartIDMap[e]=this._componentIDPartIDMap[e]||[],-1===this._componentIDPartIDMap[e].indexOf(t)&&this._componentIDPartIDMap[e].push(t)},h.prototype.unregisterComponentIDFromPartID=function(e,t){var n;this._componentIDPartIDMap&&this._componentIDPartIDMap[e]&&(n=this._componentIDPartIDMap[e].indexOf(t),-1!==n&&(this._componentIDPartIDMap[e].splice(n,1),0===this._componentIDPartIDMap[e].length&&delete this._componentIDPartIDMap[e]))},h.prototype._checkComponentDependency=function(e,t){var n;if(this._componentIDPartIDMap&&this._componentIDPartIDMap[e])for(n=this._componentIDPartIDMap[e].length;n--;)this._notifyPackage[this._componentIDPartIDMap[e][n]]=this._notifyPackage[this._componentIDPartIDMap[e][n]]||[],this._notifyPackage[this._componentIDPartIDMap[e][n]].push({id:e,event:t})},h.prototype._handleDecoratorNotification=function(){var e,t,n;for(e in this._notifyPackage)if(this._notifyPackage.hasOwnProperty(e)&&(this.logger.debug("NotifyPartDecorator: "+e+", componentIDs: "+JSON.stringify(this._notifyPackage[e])),this._GMEID2ComponentID.hasOwnProperty(e)))for(t=this._GMEID2ComponentID[e].length;t--;)n=this._GMEID2ComponentID[e][t],this.designerCanvas.notifyItemComponentEvents(n,this._notifyPackage[e])},h.prototype._stateActiveObjectChanged=function(e,t){this.currentNodeInfo&&this.currentNodeInfo.id===t?this.logger.debug("Disregarding activeObject changed when it is already the same."):this.selectedObjectChanged(t)},h.prototype._stateActiveSelectionChanged=function(e,t){this._settingActiveSelection!==!0&&(t?this.activeSelectionChanged(t):this.activeSelectionChanged([]))},h.prototype._activeProjectChanged=function(){this._updateTopNode()},h.prototype._updateTopNode=function(){var e,t=this._client.getActiveProjectId();t&&(e=this._client.getActiveProjectName(),this._config.byProjectId.topNode.hasOwnProperty(t)?this._topNode=this._config.byProjectId.topNode[t]:this._config.byProjectName.topNode.hasOwnProperty(e)?this._topNode=this._config.byProjectName.topNode[e]:this._topNode=this._config.topNode)},h.prototype._attachClientEventListeners=function(){this._detachClientEventListeners(),WebGMEGlobal.State.on("change:"+t.STATE_ACTIVE_OBJECT,this._stateActiveObjectChanged,this),WebGMEGlobal.State.on("change:"+t.STATE_ACTIVE_SELECTION,this._stateActiveSelectionChanged,this),WebGMEGlobal.State.on("change:"+t.STATE_ACTIVE_PROJECT_NAME,this._activeProjectChanged,this)},h.prototype._detachClientEventListeners=function(){WebGMEGlobal.State.off("change:"+t.STATE_ACTIVE_OBJECT,this._stateActiveObjectChanged),WebGMEGlobal.State.off("change:"+t.STATE_ACTIVE_SELECTION,this._stateActiveSelectionChanged),WebGMEGlobal.State.off("change:"+t.STATE_ACTIVE_PROJECT_NAME,this._activeProjectChanged,this)},h.prototype.onActivate=function(){this._attachClientEventListeners(),this._displayToolbarItems(),this._selectedAspect&&WebGMEGlobal.State.registerActiveAspect(this._selectedAspect),this.currentNodeInfo&&"string"==typeof this.currentNodeInfo.id&&(WebGMEGlobal.State.registerSuppressVisualizerFromNode(!0),WebGMEGlobal.State.registerActiveObject(this.currentNodeInfo.id),WebGMEGlobal.State.registerSuppressVisualizerFromNode(!1))},h.prototype.onDeactivate=function(){this._detachClientEventListeners(),this._hideToolbarItems()},h.prototype._displayToolbarItems=function(){if(this._toolbarInitialized!==!0)this._initializeToolbar();else for(var e=0;e<this._toolbarItems.length;e++)this._toolbarItems[e].show();this._refreshBtnModelHierarchyUp()},h.prototype._hideToolbarItems=function(){if(this._toolbarInitialized===!0)for(var e=0;e<this._toolbarItems.length;e++)this._toolbarItems[e].hide()},h.prototype._removeToolbarItems=function(){if(this._toolbarInitialized===!0)for(var e=0;e<this._toolbarItems.length;e++)this._toolbarItems[e].destroy()},h.prototype._initializeToolbar=function(){var e=WebGMEGlobal.Toolbar,t=this;this._toolbarItems=[],this.$btnConnectionRemoveSegmentPoints=e.addButton({title:"Remove segment points",icon:"glyphicon glyphicon-remove-circle",clickFn:function(){t._removeConnectionSegmentPoints()}}),this._toolbarItems.push(this.$btnConnectionRemoveSegmentPoints),this.$btnConnectionRemoveSegmentPoints.enabled(!1),this.$btnModelHierarchyUp=e.addButton({title:"Go to parent",icon:"glyphicon glyphicon-circle-arrow-up",clickFn:function(){t._onModelHierarchyUp()}}),this._toolbarItems.push(this.$btnModelHierarchyUp),this.$btnModelHierarchyUp.enabled(!1),this._toolbarInitialized=!0},h.prototype.getNodeID=function(){return this.currentNodeInfo.id},h.prototype._refreshBtnModelHierarchyUp=function(){this.currentNodeInfo.id&&this.currentNodeInfo.id!==this._topNode?this.$btnModelHierarchyUp.enabled(!0):this.$btnModelHierarchyUp.enabled(!1)},h.prototype.activeSelectionChanged=function(e){for(var t=[],n=e.length;n--;)this._GMEID2ComponentID.hasOwnProperty(e[n])&&(t=t.concat(this._GMEID2ComponentID[e[n]]));this.designerCanvas.select(t)},h.prototype._updateAspects=function(){var e,n,i,o,r=this.currentNodeInfo.id,s=this._client.getNode(r),a=WebGMEGlobal.PanelManager.getActivePanel();if(this._aspects={},this.designerCanvas.clearTabs(),a&&a.control!==this||(this._selectedAspect=WebGMEGlobal.State.getActiveAspect()),r||r===t.PROJECT_ROOT_ID){for(e=s?s.getValidAspectNames():[],e.sort(function(e,t){var n=e.toLowerCase(),i=t.toLowerCase();return i>n?-1:1}),e.splice(0,0,t.ASPECT_ALL),this.designerCanvas.addMultipleTabsBegin(),i=0;i<e.length;i+=1)n=this.designerCanvas.addTab(e[i]),this._aspects[n]=e[i],this._selectedAspect&&this._selectedAspect===e[i]&&(o=n);this.designerCanvas.addMultipleTabsEnd()}if(!o)for(o in this._aspects)if(this._aspects.hasOwnProperty(o))break;if(this.designerCanvas.selectTab(o.toString()),this._selectedAspect!==t.ASPECT_ALL){var l=this._client.getAspectTerritoryPattern(r,this._selectedAspect),c=!1;this._selfPatterns[r].items&&l.items?(c=_.difference(this._selfPatterns[r].items,l.items).length>0,c===!1&&(c=_.difference(l.items,this._selfPatterns[r].items).length>0)):(this._selfPatterns[r].items||l.items)&&(c=!0),c&&this.selectedObjectChanged(r)}},h.prototype._initializeSelectedAspect=function(e){WebGMEGlobal.State.registerActiveAspect(this._selectedAspect),WebGMEGlobal.State.registerActiveTab(e),this.selectedObjectChanged(this.currentNodeInfo.id)},h.prototype.getConnectionDescriptor=function(){return{}},h.getDefaultConfig=function(){return{topNode:"",byProjectName:{topNode:{}},byProjectId:{topNode:{}}}},h.getComponentId=function(){return"GenericUIModelEditorControl"},_.extend(h.prototype,r.prototype),h}),define("js/Panels/ModelEditor/ModelEditorPanel",["js/PanelBase/PanelBaseWithHeader","js/PanelManager/IActivePanel","js/Widgets/ModelEditor/ModelEditorWidget","./ModelEditorControl"],function(e,t,n,i){"use strict";var o;return o=function(t,n){var i={};i[e.OPTIONS.LOGGER_INSTANCE_NAME]="ModelEditorPanel",i[e.OPTIONS.FLOATING_TITLE]=!0,e.apply(this,[i,t]),this._client=n.client,this._initialize(),this.logger.debug("ModelEditorPanel ctor finished")},_.extend(o.prototype,e.prototype),_.extend(o.prototype,t.prototype),o.prototype._initialize=function(){var e=this;this.widget=new n(this.$el,{toolBar:this.toolBar}),this.widget.setTitle=function(t){e.setTitle(t)},this.widget.onUIActivity=function(){WebGMEGlobal.PanelManager.setActivePanel(e),WebGMEGlobal.KeyboardManager.setListener(e.widget)},this.control=new i({client:this._client,widget:this.widget}),this.control.setReadOnly=function(t){e.setReadOnly(t)},this.onActivate()},o.prototype.onReadOnlyChanged=function(t){e.prototype.onReadOnlyChanged.call(this,t),this.widget.setReadOnly(t)},o.prototype.onResize=function(e,t){this.logger.debug("onResize --> width: "+e+", height: "+t),this.widget.onWidgetContainerResize(e,t)},o.prototype.destroy=function(){this.control.destroy(),this.widget.destroy(),e.prototype.destroy.call(this),WebGMEGlobal.KeyboardManager.setListener(void 0),WebGMEGlobal.Toolbar.refresh()},o.prototype.onActivate=function(){this.widget.onActivate(),this.control.onActivate(),WebGMEGlobal.KeyboardManager.setListener(this.widget),WebGMEGlobal.Toolbar.refresh()},o.prototype.onDeactivate=function(){this.widget.onDeactivate(),this.control.onDeactivate(),WebGMEGlobal.KeyboardManager.setListener(void 0),WebGMEGlobal.Toolbar.refresh()},o.prototype.getNodeID=function(){return this.control.getNodeID()},o}),define("css!js/Widgets/SetEditor/styles/SetEditorWidget",[],function(){}),define("js/Widgets/SetEditor/SetEditorWidget",["js/DragDrop/DragHelper","js/Widgets/DiagramDesigner/DiagramDesignerWidget","css!./styles/SetEditorWidget.css"],function(e,t){"use strict";var n,i="#FFCCFF",o=$('<i class="glyphicon glyphicon-exclamation-sign delete-set-tab"/>');return n=function(e,n){n=n||{},n.loggerName="gme:Widgets:SetEditor:SetEditorWidget",n.tabsEnabled=!0,n.addTabs=!1,n.deleteTabs=!0,n.reorderTabs=!1,n.lineStyleControls=!1,n.enableConnectionDrawing=!1,n.defaultConnectionRouteManagerType="basic",n.disableConnectionRendering=!0,t.call(this,e,n),this.logger.debug("SetEditorWidget ctor")},_.extend(n.prototype,t.prototype),n.prototype._initializeUI=function(){t.prototype._initializeUI.apply(this,arguments),this.logger.debug("SetEditorWidget._initializeUI"),this.$el.parent().addClass("set-editor-widget"),this._connectToConnection=!1},n.prototype._afterManagersInitialized=function(){this.enableRotate(!1)},n.prototype.getDragEffects=function(){return[e.DRAG_EFFECTS.DRAG_MOVE]},n.prototype._dragHelper=function(e,n,i){var o=t.prototype._dragHelper.apply(this,[e,n,i]);return o.html(""),o},n.prototype.setBackgroundText=function(e,n){n=n||{},n.color=n.color||i,t.prototype.setBackgroundText.apply(this,[e,n])},n.prototype._addTabDeleteBtn=function(e){var t=o.clone();t.attr("title","Remove meta-invalid set"),e.find("a").append(t)},n}),define("js/Panels/Crosscut/CrosscutConstants",[],function(){"use strict";return{CROSSCUT_NAME_PREFIX:"Crosscut_"}}),define("js/Panels/ControllerBase/DiagramDesignerWidgetMultiTabMemberListControllerBase",["js/logger","common/util/guid","js/Constants","js/NodePropertyNames","js/RegistryKeys","js/Utils/GMEConcepts","js/Utils/GMEVisualConcepts","js/DragDrop/DragHelper","js/Utils/PreferencesHelper","js/Controls/AlignMenu"],function(e,t,n,i,o,r,s,a,l,c){"use strict";var d,h="ModelDecorator",p="DiagramDesigner",g=n.POINTER_SOURCE,u=n.POINTER_TARGET,f="DRAG_PARAMS_MULTI_TAB_MEMBER_LIST_CONTAINER_ID",m=o.POSITION;return d=function(t){var n=t.loggerName||"gme:Panels:ControllerBase:DiagramDesignerWidgetMultiTabMemberListControllerBase";if(this.logger=e.create(n,WebGMEGlobal.gmeConfig.client.log),this._client=t.client,this.disableConnectionRendering=t.disableConnectionRendering,this._widget=t.widget,this._alignMenu=new c(this._widget.CONSTANTS,{}),void 0===this._client)throw this.logger.error("DiagramDesignerWidgetMultiTabMemberListControllerBase's client is not specified..."),"DiagramDesignerWidgetMultiTabMemberListControllerBase can not be created";if(void 0===this._widget)throw this.logger.error("DiagramDesignerWidgetMultiTabMemberListControllerBase's widget is not specified..."),"DiagramDesignerWidgetMultiTabMemberListControllerBase can not be created";this._attachDiagramDesignerWidgetEventHandlers(),this.logger.debug("DiagramDesignerWidgetMultiTabMemberListControllerBase ctor finished")},d.prototype._attachDiagramDesignerWidgetEventHandlers=function(){var e=this;this._widget.onSelectedTabChanged=function(t){e._onSelectedTabChanged(t)},this._widget.onBackgroundDroppableAccept=function(t,n){return e._onBackgroundDroppableAccept(t,n)},this._widget.onBackgroundDrop=function(t,n,i){e._onBackgroundDrop(t,n,i)},this._widget.getDragItems=function(t){return e._getDragItems(t)},this._oGetDragParams=this._widget.getDragParams,this._widget.getDragParams=function(t,n){return e._getDragParams(t,n)},this._widget.onSelectionDelete=function(t){e._onSelectionDelete(t)},this._widget.onTabTitleChanged=function(t,n,i){e._onTabTitleChanged(t,n,i)},this._widget.onTabsSorted=function(t){e._onTabsSorted(t)},this._widget.onTabDeleteClicked=function(t){e._onTabDeleteClicked(t)},this._widget.onTabAddClicked=function(){e._onTabAddClicked()},this._widget.onSelectionChanged=function(t){e._onSelectionChanged(t)},this._widget.onSelectionFillColorChanged=function(t,n){e._onSelectionSetColor(t,n,o.COLOR)},this._widget.onSelectionBorderColorChanged=function(t,n){e._onSelectionSetColor(t,n,o.BORDER_COLOR)},this._widget.onSelectionTextColorChanged=function(t,n){e._onSelectionSetColor(t,n,o.TEXT_COLOR)},this._widget.onConnectionSegmentPointsChange=function(t){e._onConnectionSegmentPointsChange(t)},this._widget.onRegisterSubcomponent=function(t,n,i){e._onRegisterSubcomponent(t,n,i)},this._widget.onUnregisterSubcomponent=function(t,n){e._onUnregisterSubcomponent(t,n)},this._widget.onSelectionAlignMenu=function(t,n){e._onSelectionAlignMenu(t,n)},this._widget.onAlignSelection=function(t,n){e._onAlignSelection(t,n)},this._widget.onDesignerItemsMove=function(t){e._onDesignerItemsMove(t)}},d.prototype.selectedObjectChanged=function(e){var t,i=this;this.logger.debug('activeObject nodeId "'+e+'"'),this._widget.clear(),this._territoryId&&(this._client.removeUI(this._territoryId),this._selectedMemberListMembersTerritoryId&&this._client.removeUI(this._selectedMemberListMembersTerritoryId),this._widget.clearTabs()),e=this._validateNodeId(e),this._memberListContainerID=e,this._selectedMemberListID=void 0,e||e===n.PROJECT_ROOT_ID?(t={},t[e]={children:0},this._widget.showProgressbar(),this._territoryId=this._client.addUI(this,function(){i._processMemberListContainer(),i._widget.hideProgressbar()}),this._client.updateTerritory(this._territoryId,t)):this._widget.setBackgroundText("No object to display...")},d.prototype._validateNodeId=function(e){return e===n.PROJECT_ROOT_ID&&(e=void 0),e},d.prototype._stateActiveObjectChanged=function(e,t){this._memberListContainerID===t?this.logger.debug("Disregarding activeObject changed when it is already the same."):this.selectedObjectChanged(t)},d.prototype._stateActiveTabChanged=function(e,t){this._tabIDMemberListID&&this._selectedMemberListID!==this._tabIDMemberListID[t]&&this._widget.selectTab(t+"")},d.prototype._attachClientEventListeners=function(){this._detachClientEventListeners(),WebGMEGlobal.State.on("change:"+n.STATE_ACTIVE_OBJECT,this._stateActiveObjectChanged,this),WebGMEGlobal.State.on("change:"+n.STATE_ACTIVE_TAB,this._stateActiveTabChanged,this)},d.prototype._detachClientEventListeners=function(){WebGMEGlobal.State.off("change:"+n.STATE_ACTIVE_OBJECT,this._stateActiveObjectChanged),WebGMEGlobal.State.off("change:"+n.STATE_ACTIVE_TAB,this._stateActiveTabChanged)},d.prototype.onActivate=function(){this._attachClientEventListeners(),this._displayToolbarItems(),"string"==typeof this._memberListContainerID&&(WebGMEGlobal.State.registerSuppressVisualizerFromNode(!0),
WebGMEGlobal.State.registerActiveObject(this._memberListContainerID),WebGMEGlobal.State.registerSuppressVisualizerFromNode(!1))},d.prototype.onDeactivate=function(){this._detachClientEventListeners(),this._hideToolbarItems()},d.prototype._displayToolbarItems=function(){var e;if(this._toolbarInitialized===!0)for(e=0;e<this._toolbarItems.length;e++)this._toolbarItems[e].show();else this._initializeToolbar()},d.prototype._hideToolbarItems=function(){var e;if(this._toolbarInitialized===!0)for(e=0;e<this._toolbarItems.length;e++)this._toolbarItems[e].hide()},d.prototype._removeToolbarItems=function(){var e;if(this._toolbarInitialized===!0)for(e=0;e<this._toolbarItems.length;e++)this._toolbarItems[e].destroy()},d.prototype._initializeToolbar=function(){this._toolbarItems=[],this._toolbarInitialized=!0},d.prototype.setReadOnly=function(){},d.prototype.destroy=function(){this._detachClientEventListeners(),this._removeToolbarItems(),this._client.removeUI(this._territoryId),this._selectedMemberListMembersTerritoryId&&this._client.removeUI(this._selectedMemberListMembersTerritoryId)},d.prototype._processMemberListContainer=function(){var e,t,n,i,o,r,s,a,l,c,d=this._client.getNode(this._memberListContainerID);if(this.logger.debug("_processMemberListContainer"),this._widget.clearTabs(),this._tabIDMemberListID={},this._memberListMembers={},this._memberListMemberCoordinates={},d)if(this._displayContainerObjectName(),e=this.getOrderedMemberListInfo(d)||[],e.length>0){for(this._widget.addMultipleTabsBegin(),t=0;t<e.length;t+=1){for(o=e[t].memberListID,r=e[t].title,s=e[t].enableDeleteTab&&!0,a=e[t].enableRenameTab&&!0,n=this._widget.addTab(r,s,a),this._tabIDMemberListID[n]=o,this._memberListMembers[o]=d.getMemberIds(o),this._memberListMemberCoordinates[o]={},l=this._memberListMembers[o].length;l--;)c=this._memberListMembers[o][l],this._memberListMemberCoordinates[o][c]=d.getMemberRegistry(o,c,m);this._selectedMemberListID&&this._selectedMemberListID===o&&(i=n)}if(this._widget.addMultipleTabsEnd(),!i&&null!==WebGMEGlobal.State.getActiveTab()&&void 0!==WebGMEGlobal.State.getActiveTab()&&WebGMEGlobal.State.getActiveTab()<Object.keys(this._tabIDMemberListID).length&&(i=WebGMEGlobal.State.getActiveTab()),!i)for(i in this._tabIDMemberListID)if(this._tabIDMemberListID.hasOwnProperty(i))break;this._widget.selectTab(i),this._updateSelectedMemberListMembersTerritoryPatterns()}else this.displayNoTabMessage()},d.prototype._updateSelectedMemberListMembersTerritoryPatterns=function(){var e,t,n,i,o=(this._selectedMemberListMembers||[]).slice(0),s=(this._memberListMembers[this._selectedMemberListID]||[]).slice(0),a=!1,l=this._selectedMemberListMembersTerritoryId,c=this._selectedMemberListMembersTerritoryPatterns,d=this._client;for(e=_.difference(o,s),t=e.length;t--;)delete c[e[t]],a=!0;for(e=_.difference(s,o),t=e.length;t--;)c[e[t]]={children:0},a=!0;for(e=_.intersection(s,o),t=e.length,this._widget.beginUpdate();t--;)this.disableConnectionRendering||r.isConnection(e[t])===!1?this._onUpdate(e[t],{isConnection:!1}):this._delayedConnectionsAsItems[e[t]]?this._onUpdate(e[t],{isConnection:!1}):(n={isConnection:!0},i=d.getNode(e[t]),i&&(n.srcID=i.getPointer(g).to,n.dstID=i.getPointer(u).to,this._onUpdate(e[t],n)));this._widget.endUpdate(),this._selectedMemberListMembers=s,a&&setTimeout(function(){d.updateTerritory(l,c)},10)},d.prototype.getOrderedMemberListInfo=function(e){return void this.logger.warn('DiagramDesignerWidgetMultiTabMemberListControllerBase.getOrderedMemberListInfo(memberListContainerObject) is not overridden for object "'+e+'", returning default...')},d.prototype.getMemberListSetsRegistryKey=function(){return void this.logger.warn("DiagramDesignerWidgetMultiTabMemberListControllerBase.getMemberListSetsRegistryKey is not overridden, returning default value...")},d.prototype._onSelectedTabChanged=function(e){this._tabIDMemberListID[e]&&this._selectedMemberListID!==this._tabIDMemberListID[e]&&(this._selectedMemberListID=this._tabIDMemberListID[e],this.logger.debug("_selectedMemberListID changed to : "+this._selectedMemberListID),this._initializeSelectedMemberList(),WebGMEGlobal.State.registerActiveTab(e))},d.prototype._getDragParams=function(e,t){var n,i=this._oGetDragParams.call(this._widget,e,t),o={positions:{}};o[f]=this._getDragParamsDataID();for(n in i.positions)i.positions.hasOwnProperty(n)&&(o.positions[this._ComponentID2GMEID[n]]=i.positions[n]);return o},d.prototype._getDragItems=function(e){for(var t=[],n=e.length;n--;)t.push(this._ComponentID2GMEID[e[n]]);return t},d.prototype._getDragParamsDataID=function(){return this._memberListContainerID+this._selectedMemberListID},d.prototype._onBackgroundDroppableAccept=function(e,t){var n,i=a.getDragItems(t),o=a.getDragParams(t),r=a.getDragEffects(t),s=!1;if(this._selectedMemberListID)if(o&&o.hasOwnProperty(f)&&o[f]===this._getDragParamsDataID())s=!0;else if(1===r.length&&r[0]===a.DRAG_EFFECTS.DRAG_CREATE_INSTANCE)s=!1;else if(i.length>0)for(s=!0,n=0;n<i.length;n+=1){if(i[n]===this._memberListContainerID){s=!1;break}if(-1!==this._memberListMembers[this._selectedMemberListID].indexOf(i[n])){s=!1;break}}return s},d.prototype._onBackgroundDrop=function(e,t,n){var i,o,r,s,l=this._client,c=this._memberListContainerID,d=this._selectedMemberListID,h=a.getDragItems(t),p=a.getDragParams(t),g=[];if(p&&p.hasOwnProperty(f)&&p[f]===this._getDragParamsDataID()){l.startTransaction(),this._widget.beginUpdate();for(i in p.positions)p.positions.hasOwnProperty(i)&&(r=n.x+p.positions[i].x,s=n.y+p.positions[i].y,l.setMemberRegistry(c,i,d,m,{x:r,y:s}),o=this._GMEID2ComponentID[i][0],g.push(o),this._widget.updateDesignerItem(o,{position:{x:r,y:s}}));this._widget.endUpdate(),this._widget.select(g),l.completeTransaction()}else{if(l.startTransaction(),h.length>0)for(i=0;i<h.length;i+=1)o=h[i],-1===this._memberListMembers[d].indexOf(o)&&(r=n.x,s=n.y,p&&p.positions&&p.positions[o]?(r+=p.positions[o].x,s+=p.positions[o].y):(n.x+=20,n.y+=20),l.addMember(c,o,d),l.setMemberRegistry(c,o,d,m,{x:r,y:s}));l.completeTransaction()}},d.prototype._onSelectionDelete=function(e){var t,n,i=this._client,o=this._memberListContainerID,r=this._selectedMemberListID;for(i.startTransaction(),t=e.length;t--;)n=this._ComponentID2GMEID[e[t]],i.removeMember(o,n,r);i.completeTransaction()},d.prototype._initializeSelectedMemberList=function(){var e,t=this;if(this.logger.debug("_initializeSelectedMemberList"),this._widget.clear(),this._displayContainerObjectName(),this._GMEID2ComponentID={},this._ComponentID2GMEID={},this._GMEID2Subcomponent={},this._Subcomponent2GMEID={},this._connectionWaitingListByDstGMEID={},this._connectionWaitingListBySrcGMEID={},this._connectionListBySrcGMEID={},this._connectionListByDstGMEID={},this._connectionListByID={},this._componentIDPartIDMap={},this._selectedMemberListMembers=[],this._delayedConnections=[],this._delayedConnectionsAsItems={},this._selectedMemberListMembersTerritoryId&&this._client.removeUI(this._selectedMemberListMembersTerritoryId),this._selectedMemberListMembersTerritoryPatterns={},this._selectedMemberListID&&this._memberListMembers[this._selectedMemberListID])for(e=this._memberListMembers[this._selectedMemberListID].length,e>0&&this._widget.showProgressbar();e--;)this._selectedMemberListMembers.push(this._memberListMembers[this._selectedMemberListID][e]),this._selectedMemberListMembersTerritoryPatterns[this._memberListMembers[this._selectedMemberListID][e]]={children:0};this._selectedMemberListMembersTerritoryId=this._client.addUI(this,function(e){t._memberListTerritoryCallback(e)}),this._client.updateTerritory(this._selectedMemberListMembersTerritoryId,this._selectedMemberListMembersTerritoryPatterns)},d.prototype._memberListTerritoryCallback=function(e){for(var t,i,s=[h],a=e.length,l=this._client,c=this;a--;)(e[a].etype===n.TERRITORY_EVENT_LOAD||e[a].etype===n.TERRITORY_EVENT_UPDATE)&&(t=l.getNode(e[a].eid),e[a].desc={isConnection:!this.disableConnectionRendering&&r.isConnection(e[a].eid)},t&&(e[a].desc.isConnection===!0?(e[a].desc.srcID=t.getPointer(g).to,e[a].desc.dstID=t.getPointer(u).to):(i=t.getRegistry(o.DECORATOR),i&&""!==i||(i=h),-1===s.indexOf(i)&&s.pushUnique(i),e[a].desc.decorator=i)));l.decoratorManager.download(s,p,function(){c._dispatchEvents(e)})},d.prototype._dispatchEvents=function(e){var t,i,o,r,s,a,l,c,d,h,p,g=!1,u=[],f=[],m=999999999,_=m,b=m;for(this.logger.debug('_dispatchEvents "'+e.length+'" items: '+JSON.stringify(e)),this._widget.beginUpdate(),o=Object.keys(this._GMEID2ComponentID||{}),t=0;t<o.length;t+=1)this._widget.items[this._GMEID2ComponentID[o[t]]]&&this._widget.items[this._GMEID2ComponentID[o[t]]]._decoratorInstance&&this._widget.items[this._GMEID2ComponentID[o[t]]]._decoratorInstance.update();if(this._delayedConnections&&this._delayedConnections.length>0){for(t=e.length;t--;)if(i=e[t],i.etype===n.TERRITORY_EVENT_UNLOAD)for(o=this._delayedConnections.length;o--;)this._delayedConnections[o].ID===i.eid&&(this.logger.debug("Removing "+i.eid+" from delayed connections..."),this._delayedConnections.splice(o,1),this._widget.deleteComponent(this._delayedConnectionsAsItems[i.eid]),delete this._delayedConnectionsAsItems[i.eid]);else if(i.etype===n.TERRITORY_EVENT_UPDATE&&i.desc.isConnection===!0)for(o=this._delayedConnections.length;o--;)this._delayedConnections[o].ID===i.eid&&(this.logger.debug("Updating "+i.eid+" in delayed connections..."),this._delayedConnections[o].desc.srcID=i.desc.srcID,this._delayedConnections[o].desc.dstID=i.desc.dstID,e.splice(t,1));for(t=0;t<this._delayedConnections.length;t+=1)this._delayedConnections[t].desc.src&&this._delayedConnections[t].desc.dst&&(f.push({etype:n.TERRITORY_EVENT_LOAD,eid:this._delayedConnections[t].ID,desc:this._delayedConnections[t].desc}),this._widget.deleteComponent(this._delayedConnectionsAsItems[this._delayedConnections[t].ID]),delete this._delayedConnectionsAsItems[this._delayedConnections[t].ID])}for(this._delayedConnections=[],this._delayedConnectionsAsItems={},s=[],t=e.length;t--;)if(i=e[t],i.etype!==n.TERRITORY_EVENT_COMPLETE&&i.etype!==n.TERRITORY_EVENT_INCOMPLETE)if(i.etype===n.TERRITORY_EVENT_UNLOAD)s.push(i);else if(i.desc.isConnection===!1)u.push(i);else if(i.desc.isConnection===!0){for(a=i.desc.srcID,l=i.desc.dstID,c=-1,d=-1,o=f.length;o--&&(r=f[o],r.id===a?c=o:r.id===l&&(d=o),-1===c||-1===d););for(h=Math.max(c,d),o=f.length;o--&&(r=f[o],i.eid===r.desc.srcID?_=o:i.eid===r.desc.dstID&&(b=o),_===m||b===m););p=Math.min(_,b),-1===h&&p===m?f.push(i):-1!==h&&p===m?f.splice(h+1,0,i):-1===h&&p!==m?f.splice(p,0,i):-1!==h&&p!==m&&f.splice(p,0,i)}for(this._notifyPackage={},e=s.concat(u),t=0;t<e.length;t+=1)switch(i=e[t],i.etype){case n.TERRITORY_EVENT_LOAD:g=this._onLoad(i.eid,i.desc)||g;break;case n.TERRITORY_EVENT_UPDATE:this._onUpdate(i.eid,i.desc);break;case n.TERRITORY_EVENT_UNLOAD:g=this._onUnload(i.eid)||g}for(this._handleDecoratorNotification(),e=f,t=0;t<e.length;t+=1)switch(i=e[t],i.etype){case n.TERRITORY_EVENT_LOAD:this._onLoad(i.eid,i.desc);break;case n.TERRITORY_EVENT_UPDATE:this._onUpdate(i.eid,i.desc);break;case n.TERRITORY_EVENT_UNLOAD:this._onUnload(i.eid)}this._widget.endUpdate(),this._widget.hideProgressbar(),g&&(this.logger.debug("Updating territory with ruleset from decorators: "+JSON.stringify(this._selfPatterns)),this._client.updateTerritory(this._selectedMemberListMembersTerritoryId,this._selectedMemberListMembersTerritoryPatterns)),this.logger.debug('_dispatchEvents "'+e.length+'" items - DONE')},d.prototype._updateDecoratorTerritoryQuery=function(e,t){var n,i,o=this._selectedMemberListMembersTerritoryPatterns,r=!1;if(e&&(n=e.getTerritoryQuery()))for(i in n)n.hasOwnProperty(i)&&(t?delete o[i]:o[i]=n[i],r=!0);return r},d.prototype._getItemDecorator=function(e){var t;return t=this._client.decoratorManager.getDecoratorForWidget(e,p),t||(t=this._client.decoratorManager.getDecoratorForWidget(h,p)),t},d.prototype._getAllSourceDestinationPairsForConnection=function(e,t){var n,i=[],o=[];if(this._GMEID2ComponentID.hasOwnProperty(e))for(n=this._GMEID2ComponentID[e].length;n--;)i.push({objId:this._GMEID2ComponentID[e][n],subCompId:void 0});else if(this._GMEID2Subcomponent&&this._GMEID2Subcomponent.hasOwnProperty(e))for(n in this._GMEID2Subcomponent[e])this._GMEID2Subcomponent[e].hasOwnProperty(n)&&i.push({objId:n,subCompId:this._GMEID2Subcomponent[e][n]});if(this._GMEID2ComponentID.hasOwnProperty(t))for(n=this._GMEID2ComponentID[t].length;n--;)o.push({objId:this._GMEID2ComponentID[t][n],subCompId:void 0});else if(this._GMEID2Subcomponent&&this._GMEID2Subcomponent.hasOwnProperty(t))for(n in this._GMEID2Subcomponent[t])this._GMEID2Subcomponent[t].hasOwnProperty(n)&&o.push({objId:n,subCompId:this._GMEID2Subcomponent[t][n]});return{sources:i,destinations:o}},d.prototype._onLoad=function(e,t){var i,o,r,s,a,c,d,h,p={},g=[],u=[],f=!1;if(-1!==this._selectedMemberListMembers.indexOf(e)&&t.decorator)if(t.isConnection===!1)o=this._getItemDecorator(t.decorator),p.decoratorClass=o,p.control=this,p.metaInfo={},p.metaInfo[n.GME_ID]=e,p.position={x:100,y:100},this._memberListMemberCoordinates[this._selectedMemberListID]&&this._memberListMemberCoordinates[this._selectedMemberListID][e]&&(p.position.x=this._memberListMemberCoordinates[this._selectedMemberListID][e].x,p.position.y=this._memberListMemberCoordinates[this._selectedMemberListID][e].y),p.decoratorParams={},t.decoratorParams&&_.extend(p.decoratorParams,t.decoratorParams),p.preferencesHelper=l.getPreferences([{containerID:this._memberListContainerID,setID:this._selectedMemberListID}]),i=this._widget.createDesignerItem(p),this._GMEID2ComponentID[e]=this._GMEID2ComponentID[e]||[],this._GMEID2ComponentID[e].push(i.id),this._ComponentID2GMEID[i.id]=e,f=f||this._updateDecoratorTerritoryQuery(i._decoratorInstance,!1);else if(r=this._getAllSourceDestinationPairsForConnection(t.srcID,t.dstID),g=r.sources,u=r.destinations,s=g.length,a=u.length,c=this._getConnectionVisualProperties(e),s>0&&a>0)for(;s--;)for(;a--;)p={},_.extend(p,c),p.srcObjId=g[s].objId,p.srcSubCompId=g[s].subCompId,p.dstObjId=u[a].objId,p.dstSubCompId=u[a].subCompId,p.reconnectable=void 0===t.reconnectable?!1:t.reconnectable,p.editable=void 0===t.editable?!1:t.editable,delete p.source,delete p.target,i=this._widget.createConnection(p),this.logger.debug("Connection: "+i.id+" for GME object: "+e),this._GMEID2ComponentID[e]=this._GMEID2ComponentID[e]||[],this._GMEID2ComponentID[e].push(i.id),this._ComponentID2GMEID[i.id]=e;else{for(d=!1,h=this._delayedConnections.length;h--;)if(this._delayedConnections[h].ID===e){d=!0;break}d!==!0&&(this._delayedConnections.push({ID:e,desc:t}),this._displayConnectionAsItem(e,t))}return this._checkComponentDependency(e,n.TERRITORY_EVENT_LOAD),f},d.prototype._onUpdate=function(e,t){var i,o,r,s,a,c,d,h,p,g={};if(-1!==this._selectedMemberListMembers.indexOf(e)&&this._GMEID2ComponentID[e])if(t.isConnection===!1)for(o=this._GMEID2ComponentID[e].length;o--;)i=this._GMEID2ComponentID[e][o],g={position:{x:100,y:100}},this._memberListMemberCoordinates[this._selectedMemberListID]&&this._memberListMemberCoordinates[this._selectedMemberListID][e]&&(g.position.x=this._memberListMemberCoordinates[this._selectedMemberListID][e].x,g.position.y=this._memberListMemberCoordinates[this._selectedMemberListID][e].y),t&&t.decorator&&(g.decoratorClass=this._getItemDecorator(t.decorator),g.preferencesHelper=l.getPreferences([{containerID:this._memberListContainerID,setID:this._selectedMemberListID}])),this._widget.updateDesignerItem(i,g);else{for(o=this._GMEID2ComponentID[e].length,r=this._getAllSourceDestinationPairsForConnection(t.srcID,t.dstID),c=r.sources,d=r.destinations,s=c.length,a=d.length,o-=1,h=this._getConnectionVisualProperties(e);s--;)for(;a--;)g={},_.extend(g,h),g.srcObjId=c[s].objId,g.srcSubCompId=c[s].subCompId,g.dstObjId=d[a].objId,g.dstSubCompId=d[a].subCompId,g.reconnectable=void 0===t.reconnectable?!0:t.reconnectable,g.editable=void 0===t.editable?!0:t.editable,delete g.source,delete g.target,o>=0?(i=this._GMEID2ComponentID[e][o],this._widget.updateConnection(i,g),o-=1):(this.logger.warn("Updating connections...Existing connections are less than the needed src-dst combo..."),p=this._widget.createConnection(g),this.logger.debug("Connection: "+p.id+" for GME object: "+e),this._GMEID2ComponentID[e].push(p.id),this._ComponentID2GMEID[p.id]=e);if(o>=0)for(o+=1;o--;)i=this._GMEID2ComponentID[e][o],0===i.indexOf("C_")&&(this._widget.deleteComponent(i),this._GMEID2ComponentID[e].splice(o,1),delete this._ComponentID2GMEID[i])}else-1===this._selectedMemberListMembers.indexOf(e)&&this._GMEID2ComponentID[e]?this._onUpdatePortToItem(e,!0,t):-1===this._selectedMemberListMembers.indexOf(e)||this._GMEID2ComponentID[e]||this._onUpdatePortToItem(e,!1,t);this._checkComponentDependency(e,n.TERRITORY_EVENT_UPDATE)},d.prototype._onUnload=function(e){var t,i,r,s,a,l,c,d,h,p,f=!1;if(this._GMEID2ComponentID.hasOwnProperty(e)){for(i=this._GMEID2ComponentID[e].length;i--;)if(t=this._GMEID2ComponentID[e][i],-1!==this._widget.itemIds.indexOf(t)&&(f=f||this._updateDecoratorTerritoryQuery(this._widget.items[t]._decoratorInstance,!0)),r=this._widget._getAssociatedConnectionsForItems([t]),this._widget.deleteComponent(t),delete this._ComponentID2GMEID[t],r&&r.length>0)for(s=r.length;s--;){for(t=r[s],a=this._ComponentID2GMEID[t],c=!1,d=0;d<this._delayedConnections.length;d+=1)if(this._delayedConnections[d].ID===a){c=!0;break}c===!1&&(l=this._client.getNode(a),h={isConnection:!0,decorator:l.getRegistry(o.DECORATOR),srcID:l.getPointer(g).to,dstID:l.getPointer(u).to},l&&(this._delayedConnections.push({ID:a,desc:h}),this._displayConnectionAsItem(a,h))),this._widget.deleteComponent(t),delete this._ComponentID2GMEID[t],p=this._GMEID2ComponentID[a].indexOf(t),p>-1&&this._GMEID2ComponentID[a].splice(p,1)}delete this._GMEID2ComponentID[e]}return this._checkComponentDependency(e,n.TERRITORY_EVENT_UNLOAD),f},d.prototype._onUpdatePortToItem=function(e,t,n){var i,o,r,s,a=this._selectedMemberListMembers,l=[];for(i=0;i<a.length;i+=1)o=this._client.getNode(a[i]),o&&o.isConnection()&&(r=o.getPointer(g).to,s=o.getPointer(u).to,(r===e||s===e)&&(this._onUnload.call(this,a[i]),l.push(a[i])));for(t===!0?this._onUnload(e):this._onLoad(e,n),i=0;i<l.length;i+=1)o=this._client.getNode(l[i]),r=o.getPointer(g).to,s=o.getPointer(u).to,this._onLoad.call(this,l[i],{isConnection:!0,srcID:r,dstID:s,reconnectable:!1,editable:!1})},d.prototype.registerComponentIDForPartID=function(e,t){this._componentIDPartIDMap[e]=this._componentIDPartIDMap[e]||[],-1===this._componentIDPartIDMap[e].indexOf(t)&&this._componentIDPartIDMap[e].push(t)},d.prototype.unregisterComponentIDFromPartID=function(e,t){var n;this._componentIDPartIDMap&&this._componentIDPartIDMap[e]&&(n=this._componentIDPartIDMap[e].indexOf(t),-1!==n&&(this._componentIDPartIDMap[e].splice(n,1),0===this._componentIDPartIDMap[e].length&&delete this._componentIDPartIDMap[e]))},d.prototype._checkComponentDependency=function(e,t){var n;if(this._componentIDPartIDMap&&this._componentIDPartIDMap[e])for(n=this._componentIDPartIDMap[e].length;n--;)this._notifyPackage[this._componentIDPartIDMap[e][n]]=this._notifyPackage[this._componentIDPartIDMap[e][n]]||[],this._notifyPackage[this._componentIDPartIDMap[e][n]].push({id:e,event:t})},d.prototype._handleDecoratorNotification=function(){var e,t,n;for(e in this._notifyPackage)if(this._notifyPackage.hasOwnProperty(e)&&(this.logger.debug("NotifyPartDecorator: "+e+", componentIDs: "+JSON.stringify(this._notifyPackage[e])),this._GMEID2ComponentID.hasOwnProperty(e)))for(t=this._GMEID2ComponentID[e].length;t--;)n=this._GMEID2ComponentID[e][t],this._widget.notifyItemComponentEvents(n,this._notifyPackage[e])},d.prototype._onTabTitleChanged=function(e,t,n){var i,o,r,s,a,l=this._memberListContainerID,c=this.getMemberListSetsRegistryKey();if(l&&c&&""!==c&&(i=this._client.getNode(l),o=i.getEditableRegistry(c)||[],this._tabIDMemberListID[e])){for(a=this._tabIDMemberListID[e],s=o.length,r=0;s>r;r+=1)if(o[r].SetID===a){o[r].title=n;break}this._client.setRegistry(l,c,o)}},d.prototype._onTabsSorted=function(e){var t,n,i,o,r,s=this._memberListContainerID,a=this.getMemberListSetsRegistryKey(),l=this._tabIDMemberListID,c=WebGMEGlobal.State.getActiveTab();if("string"==typeof s&&a&&""!==a){for(t=this._client.getNode(s),n=t.getEditableRegistry(a)||[],this._tabIDMemberListID={},i=0;i<e.length;i+=1)for(c===e[i]&&WebGMEGlobal.State.registerActiveTab(i),r=l[e[i]],this._tabIDMemberListID[i]=r,o=0;o<n.length;o+=1)if(n[o].SetID===r){n[o].order=i;break}n.sort(function(e,t){return e.order<t.order?-1:1}),this._client.setRegistry(s,a,n)}},d.prototype._onTabDeleteClicked=function(e){var t,n,i,o,r=this._memberListContainerID,s=this.getMemberListSetsRegistryKey();if("string"==typeof r){if(o=this._tabIDMemberListID[e],this._client.startTransaction(),s){for(t=this._client.getNode(r),n=t.getEditableRegistry(s)||[],i=n.length;i--;)if(n[i].SetID===o){n.splice(i,1);break}for(n.sort(function(e,t){return e.order<t.order?-1:1}),i=n.length;i--;)n[i].order=i;this._client.setRegistry(r,s,n)}this._client.deleteSet(r,o),this._client.completeTransaction()}},d.prototype._onTabAddClicked=function(){var e,n,i,o,r,s,a=this._memberListContainerID,l=this.getMemberListSetsRegistryKey();if(this._canAddTab()&&l&&""!==l){for(e=this._client.getNode(a),n=e.getEditableRegistry(l)||[],n.sort(function(e,t){return e.order<t.order?-1:1}),i=n.length;i--;)n[i].order=i;r=this.getNewSetNamePrefixDesc(),o=r.SetID+t(),s={SetID:o,order:n.length,title:r.Title+n.length},n.push(s),this._client.startTransaction(),this._client.createSet(a,o),this._client.setRegistry(a,l,n),1!==n.length&&(this._selectedMemberListID=o),this._client.completeTransaction()}},d.prototype._canAddTab=function(){var e=this._memberListContainerID;return e&&e!==n.PROJECT_ROOT_ID},d.prototype.getNewSetNamePrefixDesc=function(){var e={SetID:"SET_",Title:"Tab "};return this.logger.warn("DiagramDesignerWidgetMultiTabMemberListControllerBase.getNewSetNamePrefixDesc is not overridden, returning default value: "+JSON.stringify(e)),e},d.prototype._onSelectionChanged=function(e){for(var t,n=[],i=e.length;i--;)t=this._ComponentID2GMEID[e[i]],t&&-1===n.indexOf(t)&&n.push(t);WebGMEGlobal.State.registerActiveSelection(n)},d.prototype.displayNoTabMessage=function(){this._widget.setBackgroundText("NO TAB TO DISPLAY...")},d.prototype._displayContainerObjectName=function(){var e=this._client.getNode(this._memberListContainerID);e&&this._widget.setTitle(e.getAttribute(i.Attributes.name))},d.prototype._onSelectionSetColor=function(e,t,n){var i,o=e.length,r=this._memberListContainerID,s=this._selectedMemberListID;for(this._client.startTransaction();o--;)i=this._ComponentID2GMEID[e[o]],t?this._client.setMemberRegistry(r,i,s,n,t):this._client.delMemberRegistry(r,i,s,n);this._client.completeTransaction()},d.prototype._getConnectionVisualProperties=function(e){var t,i=s.getConnectionVisualProperties(e),r=this._client.getNode(this._memberListContainerID);return t=r.getMemberRegistry(this._selectedMemberListID,e,o.COLOR),t&&(i[n.LINE_STYLE.COLOR]=t),t=r.getMemberRegistry(this._selectedMemberListID,e,o.LINE_CUSTOM_POINTS),t&&_.isArray(t)&&(i[n.LINE_STYLE.CUSTOM_POINTS]=$.extend(!0,[],t)),i},d.prototype._onConnectionSegmentPointsChange=function(e){var t=e.connectionID,n=e.points,i=this._ComponentID2GMEID[t],r=this._memberListContainerID,s=this._selectedMemberListID,a=o.LINE_CUSTOM_POINTS;i&&(n&&n.length>0?this._client.setMemberRegistry(r,i,s,a,n):this._client.delMemberRegistry(r,i,s,a))},d.prototype._onRegisterSubcomponent=function(e,t,i){this._GMEID2Subcomponent[i[n.GME_ID]]=this._GMEID2Subcomponent[i[n.GME_ID]]||{},this._GMEID2Subcomponent[i[n.GME_ID]][e]=t,this._Subcomponent2GMEID[e]=this._Subcomponent2GMEID[e]||{},this._Subcomponent2GMEID[e][t]=i[n.GME_ID]},d.prototype._onUnregisterSubcomponent=function(e,t){var n=this._Subcomponent2GMEID[e][t];delete this._Subcomponent2GMEID[e][t],this._GMEID2Subcomponent[n]&&delete this._GMEID2Subcomponent[n][e]},d.prototype._displayConnectionAsItem=function(e,t){var i,o,r={};o=this._getItemDecorator(t.decorator),r.decoratorClass=o,r.control=this,r.metaInfo={},r.metaInfo[n.GME_ID]=e,r.position={x:100,y:100},this._memberListMemberCoordinates[this._selectedMemberListID]&&this._memberListMemberCoordinates[this._selectedMemberListID][e]&&(r.position.x=this._memberListMemberCoordinates[this._selectedMemberListID][e].x,r.position.y=this._memberListMemberCoordinates[this._selectedMemberListID][e].y),r.decoratorParams={},t.decoratorParams&&_.extend(r.decoratorParams,t.decoratorParams),r.preferencesHelper=l.getPreferences([{containerID:this._memberListContainerID,setID:this._selectedMemberListID}]),i=this._widget.createDesignerItem(r),this._GMEID2ComponentID[e]=this._GMEID2ComponentID[e]||[],this._GMEID2ComponentID[e].push(i.id),this._ComponentID2GMEID[i.id]=e,this._delayedConnectionsAsItems[e]=i.id},d.prototype._onSelectionAlignMenu=function(e,t){var n=this._widget.posToPageXY(t.mX,t.mY),i=this;this._alignMenu.show(e,n,function(t){i._onAlignSelection(e,t)})},d.prototype._onAlignSelection=function(e,t){var n={client:this._client,modelId:this._memberListContainerID,idMap:this._ComponentID2GMEID,setName:this._selectedMemberListID,coordinates:this._memberListMemberCoordinates[this._selectedMemberListID]};n.coordinates&&this._alignMenu.alignSetSelection(n,e,t)},d.prototype._onDesignerItemsMove=function(e){var t;this._client.startTransaction();for(t in e)e.hasOwnProperty(t)&&this._client.setMemberRegistry(this._memberListContainerID,this._ComponentID2GMEID[t],this._selectedMemberListID,o.POSITION,{x:e[t].x,y:e[t].y});this._client.completeTransaction()},d}),define("js/Panels/SetEditor/SetEditorController",["js/Utils/GMEConcepts","js/DragDrop/DragHelper","js/NodePropertyNames","js/RegistryKeys","./../Crosscut/CrosscutConstants","js/Panels/ControllerBase/DiagramDesignerWidgetMultiTabMemberListControllerBase"],function(e,t,n,i,o,r){"use strict";var s,a="DRAG_PARAMS_MULTI_TAB_MEMBER_LIST_CONTAINER_ID";return s=function(e){e=e||{},e.loggerName="gme:Panels:SetEditor:SetEditorController",e.disableConnectionRendering=!0,r.call(this,e),this.logger.debug("SetEditorController ctor finished")},_.extend(s.prototype,r.prototype),s.prototype.getOrderedMemberListInfo=function(){var t,n,i=[],o=this._memberListContainerID,r=e.getSets(o),s=this._client.getNode(o);for(t=s?s.getValidSetNames():[],n=r.length;n--;)i.push({memberListID:r[n],title:r[n],enableDeleteTab:-1===t.indexOf(r[n]),enableRenameTab:!1});return i.sort(function(e,t){return e.title.toLowerCase()<t.title.toLowerCase()?-1:1}),i},s.prototype._onBackgroundDroppableAccept=function(n,i){var o,s=t.getDragItems(i),l=!1;return r.prototype._onBackgroundDroppableAccept.call(this,n,i)&&(o=t.getDragParams(i),l=o&&o.hasOwnProperty(a)&&o[a]===this._getDragParamsDataID()?!0:e.canAddToSet(this._memberListContainerID,this._selectedMemberListID,s)),l},s.prototype.displayNoTabMessage=function(){var e="The currently selected object does not contain any sets.";this._widget.setBackgroundText(e)},s}),define("js/Panels/SetEditor/SetEditorPanel",["js/PanelBase/PanelBaseWithHeader","js/PanelManager/IActivePanel","js/Widgets/SetEditor/SetEditorWidget","./SetEditorController"],function(e,t,n,i){"use strict";var o;return o=function(t,n){var i={};i[e.OPTIONS.LOGGER_INSTANCE_NAME]="SetEditorPanel",i[e.OPTIONS.FLOATING_TITLE]=!0,e.apply(this,[i,t]),this._client=n.client,this._initialize(),this.logger.debug("SetEditorPanel ctor finished")},_.extend(o.prototype,e.prototype),_.extend(o.prototype,t.prototype),o.prototype._initialize=function(){var e=this;this.widget=new n(this.$el,{toolBar:this.toolBar}),this.widget.setTitle=function(t){e.setTitle(t)},this.widget.onUIActivity=function(){WebGMEGlobal.PanelManager.setActivePanel(e),WebGMEGlobal.KeyboardManager.setListener(e.widget)},this.control=new i({client:this._client,widget:this.widget}),this.onActivate()},o.prototype.onReadOnlyChanged=function(t){e.prototype.onReadOnlyChanged.call(this,t),this.widget.setReadOnly(t),this.control.setReadOnly(t)},o.prototype.onResize=function(e,t){this.logger.debug("onResize --> width: "+e+", height: "+t),this.widget.onWidgetContainerResize(e,t)},o.prototype.destroy=function(){this.control.destroy(),this.widget.destroy(),e.prototype.destroy.call(this),WebGMEGlobal.KeyboardManager.setListener(void 0),WebGMEGlobal.Toolbar.refresh()},o.prototype.onActivate=function(){this.widget.onActivate(),this.control.onActivate(),WebGMEGlobal.KeyboardManager.setListener(this.widget),WebGMEGlobal.Toolbar.refresh()},o.prototype.onDeactivate=function(){this.widget.onDeactivate(),this.control.onDeactivate(),WebGMEGlobal.KeyboardManager.setListener(void 0),WebGMEGlobal.Toolbar.refresh()},o}),define("js/Widgets/Crosscut/CrosscutWidget",["js/DragDrop/DragHelper","js/Widgets/DiagramDesigner/DiagramDesignerWidget","js/Controls/iCheckBox","jquery","underscore"],function(e,t,n){"use strict";var i,o="#CCCCFF";return i=function(e,n){n=n||{},n.loggerName="gme:Widgets:CrossCut:CrosscutWidget",n.tabsEnabled=!0,n.addTabs=!0,n.deleteTabs=!0,n.reorderTabs=!0,n.lineStyleControls=!1,n.defaultConnectionRouteManagerType="basic2",n.disableAutoRouterOption=!0,t.call(this,e,n),this.logger.debug("CrosscutWidget ctor")},_.extend(i.prototype,t.prototype),i.prototype._initializeUI=function(){t.prototype._initializeUI.apply(this,arguments),this.logger.debug("CrosscutWidget._initializeUI"),this._connectToConnection=!1,this._initializeFilterPanel()},i.prototype._afterManagersInitialized=function(){this.enableRotate(!1)},i.prototype.getDragEffects=function(){return[e.DRAG_EFFECTS.DRAG_MOVE]},i.prototype._dragHelper=function(e,n,i){var o=t.prototype._dragHelper.apply(this,[e,n,i]);return o.html(""),o},i.prototype.setBackgroundText=function(e,n){n=n||{},n.color=n.color||o,t.prototype.setBackgroundText.apply(this,[e,n])},i.prototype._initializeFilterPanel=function(){this.$filterPanel=$("<div/>",{"class":"filterPanel"}),this.$filterPanel.html('<div class="header">FILTER</div><ul class="body"></ul>'),this.$filterHeader=this.$filterPanel.find(".header"),this.$filterUl=this.$filterPanel.find("ul.body"),this.$el.parent().append(this.$filterPanel),this._filterCheckboxes={}},i.prototype.addFilterItem=function(e,t,i){var o,r=$("<li/>",{"class":"filterItem"}),s=this;return o=new n({checkChangedFn:function(e,n){s._checkChanged(t,n)}}),r.append(i.addClass("inline")),r.append(e),r.append(o.el),this.$filterUl.append(r),this._refreshHeaderText(),this._filterCheckboxes[t]=o,r},i.prototype._refreshHeaderText=function(){var e=this.$filterUl.find(".iCheckBox").length,t=this.$filterUl.find(".iCheckBox.checked").length;this.$filterHeader.html("FILTER"+(e===t?"":" *"))},i.prototype._checkChanged=function(e,t){this._refreshHeaderText(),this.logger.debug("CheckBox checkChanged: "+e+", checked: "+t),this.onCheckChanged(e,t)},i.prototype.setChecked=function(e,t){this._filterCheckboxes[e]&&this._filterCheckboxes[e].setChecked(t)},i.prototype.onCheckChanged=function(){this.logger.warn("CrosscutWidget.onCheckChanged(value, isChecked) is not overridden!")},i}),define("js/Panels/Crosscut/CrosscutController",["js/logger","js/RegistryKeys","js/Constants","./CrosscutConstants","js/DragDrop/DragHelper","js/Utils/GMEConcepts","js/Panels/ControllerBase/DiagramDesignerWidgetMultiTabMemberListControllerBase","js/Panels/MetaEditor/MetaRelations","js/NodePropertyNames","js/Utils/ComponentSettings"],function(e,t,n,i,o,r,s,a,l,c){"use strict";var d,h="ModelDecorator",p="DiagramDesigner";return d=function(e){e=e||{},e.loggerName="gme:Panels:CrossCut:CrosscutController",this._config=d.getDefaultConfig(),c.resolveWithWebGMEGlobal(this._config,d.getComponentId()),s.call(this,e),this._filteredOutConnTypes=[],this._filteredOutConnectionDescriptors={},this._activeCrosscutId=null,this._initActiveTab=!1,this._tabsHasBeenRequested=!1,this._autoCreateCrosscut=this._config.autoCreateCrosscut===!0,this._initFilterPanel(),this.logger.debug("CrosscutController ctor finished")},_.extend(d.prototype,s.prototype),d.prototype._attachDiagramDesignerWidgetEventHandlers=function(){
var e,t=this;s.prototype._attachDiagramDesignerWidgetEventHandlers.call(this),this._widget.onFilterNewConnectionDroppableEnds=function(e){return t._onFilterNewConnectionDroppableEnds(e)},this._widget.onCreateNewConnection=function(e){t._onCreateNewConnection(e)},this._widget.onModifyConnectionEnd=function(e){t._onModifyConnectionEnd(e)},this._widget.onCheckChanged=function(e,n){t._onConnectionTypeFilterCheckChanged(e,n)},e=this._widget.onSelectedTabChanged,this._widget.onSelectedTabChanged=function(n){e(n),t._selectedTabChanged(n)}},d.prototype._validateNodeId=function(e){return e},d.prototype._canAddTab=function(){var e=this._memberListContainerID;return e||e===n.PROJECT_ROOT_ID},d.prototype._updateSelectedMemberListMembersTerritoryPatterns=function(){var e,t,n=(this._selectedMemberListMembers||[]).slice(0),i=(this._memberListMembers[this._selectedMemberListID]||[]).slice(0),o=!1,r=this._selectedMemberListMembersTerritoryId,s=this._selectedMemberListMembersTerritoryPatterns,a=function(e){var t,n,i=[],o=[];for(t=0;t<e.length;t+=1)n=l.getNode(e[t]),n&&n.isConnection()?o.push(e[t]):i.push(e[t]);return o.concat(i)},l=this._client;for(e=a(_.difference(n,i)),t=e.length;t--;)delete s[e[t]],o=!0;for(e=a(_.difference(i,n)),t=e.length;t--;)s[e[t]]={children:0},o=!0;this._selectedMemberListMembers=i,o&&setTimeout(function(){l.updateTerritory(r,s)},10)},d.prototype._initializeSelectedMemberList=function(){this._nodePointers={},this._nodeSets={},this._connectionListByType={},this._filteredOutConnectionDescriptors={},this._connectionWaitingListByDstGMEID={},this._connectionWaitingListBySrcGMEID={},s.prototype._initializeSelectedMemberList.call(this)},d.prototype._memberListTerritoryCallback=function(e){for(var i,o,s=[h],a=e.length,l=[],c=this._client,d=this;a--;)(e[a].etype===n.TERRITORY_EVENT_LOAD||e[a].etype===n.TERRITORY_EVENT_UPDATE)&&(i=c.getNode(e[a].eid),e[a].desc={isConnection:r.isConnection(e[a].eid)},i&&(e[a].desc.isConnection===!0?(e[a].desc.srcID=i.getPointer(n.POINTER_SOURCE).to,e[a].desc.dstID=i.getPointer(n.POINTER_TARGET).to,e[a].desc.reconnectable=!0,e[a].desc.editable=!0):o=i.getRegistry(t.DECORATOR),o&&""!==o||(o=h),-1===s.indexOf(o)&&s.pushUnique(o),e[a].desc.decorator=o,e[a].desc.isConnection&&(l.push(e[a]),e.splice(a,1))));c.decoratorManager.download(s,p,function(){e=e.concat(l),d._dispatchEvents(e)})},d.prototype.getOrderedMemberListInfo=function(){var e=[],t=this._memberListContainerID,n=r.getCrosscuts(t),i=n.length;for(this._autoCreateCrosscut===!0&&0===i&&this._tabsHasBeenRequested===!1&&(this._onTabAddClicked(),t=this._memberListContainerID,n=r.getCrosscuts(t),i=n.length),this._tabsHasBeenRequested=!0;i--;)e.push({memberListID:n[i].SetID,title:n[i].title,filterInfo:n[i].filter||{},enableDeleteTab:!0,enableRenameTab:!0});return e.sort(function(e,t){return e.order<t.order?-1:1}),e},d.prototype.getMemberListSetsRegistryKey=function(){return t.CROSSCUTS},d.prototype.getNewSetNamePrefixDesc=function(){return{SetID:i.CROSSCUT_NAME_PREFIX,Title:"Crosscut "}},d.prototype.displayNoTabMessage=function(){this._widget.setBackgroundText("No crosscuts defined yet. Press the + button in the top-left corner to create one...")},d.prototype._onBackgroundDroppableAccept=function(e,t){var n=o.getDragItems(t),i=s.prototype._onBackgroundDroppableAccept.call(this,e,t);return i===!0&&(i=r.isValidChildrenTypeInCrossCut(this._memberListContainerID,n)),i},d.prototype._onLoad=function(e,t){var n;return n=s.prototype._onLoad.call(this,e,t),this._processNodePointers(e,!1),this._processNodePointers(e,!0),this._processConnectionWaitingList(e),n},d.prototype._onUpdate=function(e,t){var i=this._client.getNode(e);if(t=t||{},i&&i.isConnection()?(t.isConnection=!0,t.srcID=i.getPointer(n.POINTER_SOURCE).to,t.dstID=i.getPointer(n.POINTER_TARGET).to,t.reconnectable=!0,t.editable=!0):t.isConnection=!1,-1!==this._selectedMemberListMembers.indexOf(e)&&this._GMEID2ComponentID[e]){if(t.isConnection){if(this._GMEID2ComponentID[e].length>0&&0===this._GMEID2ComponentID[e][0].indexOf("C_")&&(!t.srcID||!t.dstID))return this._onUnload(e),void this._onLoad(e,t);if(this._GMEID2ComponentID[e].length>0&&0!==this._GMEID2ComponentID[e][0].indexOf("C_")&&t.srcID&&t.dstID)return this._onUnload(e),void this._onLoad(e,t)}s.prototype._onUpdate.call(this,e,t),this._processNodePointers(e,!1),this._processNodePointers(e,!0),this._processConnectionWaitingList(e)}else-1===this._selectedMemberListMembers.indexOf(e)&&this._GMEID2ComponentID[e]?this._onUpdatePortToItem(e,!0,t):-1===this._selectedMemberListMembers.indexOf(e)||this._GMEID2ComponentID[e]||this._onUpdatePortToItem(e,!1,t)},d.prototype._onUnload=function(e){var t,i,o,r,s,l,c=!1;if(this._GMEID2ComponentID.hasOwnProperty(e)){for(i=this._nodePointers[e].combinedNames.length;i--;)s=this._nodePointers[e].combinedNames[i],l=this._nodePointers[e][s].target,s=this._nodePointers[e][s].name,this._removeConnection(e,l,a.META_RELATIONS.POINTER,s);for(i=this._nodeSets[e].combinedNames.length;i--;)s=this._nodeSets[e].combinedNames[i],l=this._nodeSets[e][s].target,s=this._nodeSets[e][s].name,this._removeConnection(e,l,a.META_RELATIONS.SET,s);for(i=this._GMEID2ComponentID[e].length;i--;)t=this._GMEID2ComponentID[e][i],-1!==this._widget.itemIds.indexOf(t)&&(c=c||this._updateDecoratorTerritoryQuery(this._widget.items[t]._decoratorInstance,!0)),this._widget.deleteComponent(t),delete this._ComponentID2GMEID[t];delete this._GMEID2ComponentID[e]}for(this._checkComponentDependency(e,n.TERRITORY_EVENT_UNLOAD),o=this._getAssociatedConnections(e),i=o.src.length;i--;)r=o.src[i],this._saveConnectionToWaitingList(this._connectionListByID[r].GMESrcId,this._connectionListByID[r].GMEDstId,this._connectionListByID[r].type,this._connectionListByID[r].connTexts),this._removeConnection(this._connectionListByID[r].GMESrcId,this._connectionListByID[r].GMEDstId,this._connectionListByID[r].type);for(i=o.dst.length;i--;)r=o.dst[i],this._connectionListByID[r]&&(this._saveConnectionToWaitingList(this._connectionListByID[r].GMESrcId,this._connectionListByID[r].GMEDstId,this._connectionListByID[r].type,this._connectionListByID[r].connTexts),this._removeConnection(this._connectionListByID[r].GMESrcId,this._connectionListByID[r].GMEDstId,this._connectionListByID[r].type));for(l in this._connectionWaitingListBySrcGMEID)this._connectionWaitingListBySrcGMEID.hasOwnProperty(l)&&(delete this._connectionWaitingListBySrcGMEID[l][e],_.isEmpty(this._connectionWaitingListBySrcGMEID[l])&&delete this._connectionWaitingListBySrcGMEID[l]);for(l in this._connectionWaitingListByDstGMEID)this._connectionWaitingListByDstGMEID.hasOwnProperty(l)&&(delete this._connectionWaitingListByDstGMEID[l][e],_.isEmpty(this._connectionWaitingListByDstGMEID[l])&&delete this._connectionWaitingListByDstGMEID[l]);return delete this._nodePointers[e],delete this._nodeSets[e],c},d.prototype._getAssociatedConnections=function(e){var t,n,i,o,r,s={src:[],dst:[]};return r=function(r,s){if(r.hasOwnProperty(e))for(t in r[e])if(r[e].hasOwnProperty(t))for(n in r[e][t])if(r[e][t].hasOwnProperty(n))for(i=r[e][t][n].length;i--;)o=r[e][t][n][i],-1===s.indexOf(o)&&s.push(o)},r(this._connectionListBySrcGMEID,s.src),r(this._connectionListByDstGMEID,s.dst),s},d.prototype._processNodePointers=function(e,t){var i,o,r,s,l,c,d,h,p,g,u=this._client.getNode(e),f=null===u?[]:t===!0?u.getSetNames():u.getPointerNames(),m={names:[],combinedNames:[]},b=null===u?!1:u.isConnection();for(t===!0?(this._nodeSets[e]=this._nodeSets[e]||{names:[],combinedNames:[]},r=this._nodeSets[e]):(this._nodePointers[e]=this._nodePointers[e]||{names:[],combinedNames:[]},r=this._nodePointers[e]),o=f.length;o--;)if(t)for(p=u.getMemberIds(f[o]),g=p.pop(),"string"==typeof g&&m.names.push(f[o]);"string"==typeof g;)h=e+"_"+f[o]+"_"+g,m.combinedNames.push(h),m[h]={name:f[o],target:g,type:a.META_RELATIONS.SET},g=p.pop();else f[o]===n.POINTER_BASE||b&&(f[o]===n.POINTER_SOURCE||f[o]===n.POINTER_TARGET)||(i=u.getPointer(f[o]).to,i&&(h=e+"_"+f[o]+"_"+i,m.names.push(f[o]),m.combinedNames.push(h),m[h]={name:f[o],target:i,type:a.META_RELATIONS.POINTER}));for(!t&&u&&(i=u.getParentId(),"string"==typeof i&&(h=e+"_"+n.RELATION_CONTAINMENT+"_"+i,m.names.push(n.RELATION_CONTAINMENT),m.combinedNames.push(h),m[h]={name:n.RELATION_CONTAINMENT,target:i,type:a.META_RELATIONS.CONTAINMENT}),i=u.getBaseId(),"string"==typeof i&&(h=e+"_"+n.POINTER_BASE+"_"+i,m.names.push(n.POINTER_BASE),m.combinedNames.push(h),m[h]={name:n.POINTER_BASE,target:i,type:a.META_RELATIONS.INHERITANCE})),s=_.difference(r.combinedNames,m.combinedNames),o=s.length;o--;)h=s[o],c=r[h].name,l=r[h].target,this._removeConnection(e,l,r[h].type,c),d=r.combinedNames.indexOf(h),r.combinedNames.splice(d,1),delete r[h];for(s=_.difference(m.combinedNames,r.combinedNames),o=s.length;o--;)h=s[o],c=m[h].name,l=m[h].target,r.names.push(c),r.combinedNames.push(h),r[h]={name:m[h].name,target:m[h].target,type:m[h].type},this._createConnection(e,l,m[h].type,{name:c})},d.prototype._processConnectionWaitingList=function(e){var t,n,i,o,r,s=[];if(i=e,this._connectionWaitingListByDstGMEID&&this._connectionWaitingListByDstGMEID.hasOwnProperty(i)){for(n in this._connectionWaitingListByDstGMEID[i])if(this._connectionWaitingListByDstGMEID[i].hasOwnProperty(n))for(t=this._connectionWaitingListByDstGMEID[i][n].length;t--;)o=this._connectionWaitingListByDstGMEID[i][n][t][0],r=this._connectionWaitingListByDstGMEID[i][n][t][1],s.push({gmeSrcID:n,gmeDstID:i,connType:o,connTexts:r});delete this._connectionWaitingListByDstGMEID[i]}if(n=e,this._connectionWaitingListBySrcGMEID&&this._connectionWaitingListBySrcGMEID.hasOwnProperty(n)){for(i in this._connectionWaitingListBySrcGMEID[n])if(this._connectionWaitingListBySrcGMEID[n].hasOwnProperty(i))for(t=this._connectionWaitingListBySrcGMEID[n][i].length;t--;)o=this._connectionWaitingListBySrcGMEID[n][i][t][0],r=this._connectionWaitingListBySrcGMEID[n][i][t][1],s.push({gmeSrcID:n,gmeDstID:i,connType:o,connTexts:r});delete this._connectionWaitingListBySrcGMEID[n]}for(t=s.length;t--;)n=s[t].gmeSrcID,i=s[t].gmeDstID,o=s[t].connType,r=s[t].connTexts,this._createConnection(n,i,o,r)},d.prototype._createConnection=function(e,t,i,o){var r,s,l;if(this._GMEID2ComponentID[e]&&this._GMEID2ComponentID[e].length>0&&this._GMEID2ComponentID[t]&&this._GMEID2ComponentID[t].length>0)if(-1===this._filteredOutConnTypes.indexOf(i)){if(r={srcObjId:this._GMEID2ComponentID[e][0],srcSubCompId:void 0,dstObjId:this._GMEID2ComponentID[t][0],dstSubCompId:void 0,reconnectable:!1,name:"",nameEdit:!1},l=i,o)switch(o.name){case n.POINTER_BASE:l=a.META_RELATIONS.INHERITANCE;break;case n.RELATION_CONTAINMENT:l=a.META_RELATIONS.CONTAINMENT,r.srcObjId=this._GMEID2ComponentID[t][0],r.dstObjId=this._GMEID2ComponentID[e][0]}_.extend(r,a.getLineVisualDescriptor(l)),o&&_.extend(r,o),s=this._widget.createConnection(r),this._saveConnection(e,t,i,s.id,o)}else this._filteredOutConnectionDescriptors[i]=this._filteredOutConnectionDescriptors[i]||[],this._filteredOutConnectionDescriptors[i].push([e,t,o]);else this._saveConnectionToWaitingList(e,t,i,o)},d.prototype._saveConnectionToWaitingList=function(e,t,n,i){var o=this._GMEID2ComponentID[e]&&this._GMEID2ComponentID[e].length>0,r=this._GMEID2ComponentID[t]&&this._GMEID2ComponentID[t].length>0;o&&!r?(this._connectionWaitingListByDstGMEID[t]=this._connectionWaitingListByDstGMEID[t]||{},this._connectionWaitingListByDstGMEID[t][e]=this._connectionWaitingListByDstGMEID[t][e]||[],this._connectionWaitingListByDstGMEID[t][e].push([n,i])):!o&&r&&(this._connectionWaitingListBySrcGMEID[e]=this._connectionWaitingListBySrcGMEID[e]||{},this._connectionWaitingListBySrcGMEID[e][t]=this._connectionWaitingListBySrcGMEID[e][t]||[],this._connectionWaitingListBySrcGMEID[e][t].push([n,i]))},d.prototype._saveConnection=function(e,t,n,i,o){this._connectionListBySrcGMEID[e]=this._connectionListBySrcGMEID[e]||{},this._connectionListBySrcGMEID[e][t]=this._connectionListBySrcGMEID[e][t]||{},this._connectionListBySrcGMEID[e][t][n]=this._connectionListBySrcGMEID[e][t][n]||[],this._connectionListBySrcGMEID[e][t][n].push(i),this._connectionListByDstGMEID[t]=this._connectionListByDstGMEID[t]||{},this._connectionListByDstGMEID[t][e]=this._connectionListByDstGMEID[t][e]||{},this._connectionListByDstGMEID[t][e][n]=this._connectionListByDstGMEID[t][e][n]||[],this._connectionListByDstGMEID[t][e][n].push(i),this._connectionListByType[n]=this._connectionListByType[n]||[],this._connectionListByType[n].push(i),this._connectionListByID[i]={GMESrcId:e,GMEDstId:t,type:n,name:o&&o.name?o.name:void 0,connTexts:o}},d.prototype._removeConnection=function(e,t,n,i){var o,r,s,l=!1;if(this._connectionListBySrcGMEID[e]&&this._connectionListBySrcGMEID[e][t]&&this._connectionListBySrcGMEID[e][t][n]&&(l=!0),l)for(s=this._connectionListBySrcGMEID[e][t][n].length;s--;)o=this._connectionListBySrcGMEID[e][t][n][s],n===a.META_RELATIONS.POINTER&&i&&""!==i&&this._connectionListByID[o].name!==i&&(o=void 0),o&&(this._widget.deleteComponent(o),delete this._connectionListByID[o],r=this._connectionListByType[n].indexOf(o),this._connectionListByType[n].splice(r,1),r=this._connectionListBySrcGMEID[e][t][n].indexOf(o),this._connectionListBySrcGMEID[e][t][n].splice(r,1),r=this._connectionListByDstGMEID[t][e][n].indexOf(o),this._connectionListByDstGMEID[t][e][n].splice(r,1))},d.prototype._onSelectionDelete=function(e){var t,i,o,s,l,c,d=this._client,h=this._memberListContainerID,p=this._selectedMemberListID,g=[n.POINTER_SOURCE,n.POINTER_TARGET,n.POINTER_BASE],u=this.logger;for(d.startTransaction(),t=e.length;t--;)s=e[t],i=this._ComponentID2GMEID[s],i?(u.debug("removeMember memberListContainerID: "+h+", gmeID: "+i+", memberListToRemoveFrom: "+p),o=d.getNode(i),r.isConnection(i)&&o.getParentId()===h&&r.canDeleteNode(i)?(u.debug("deleting connection from crosscut hierarchy too gmeID: "+i),d.deleteNodes([i])):d.removeMember(h,i,p)):(l=this._connectionListByID[s],l&&(c=!0,l.type===a.META_RELATIONS.POINTER&&-1!==g.indexOf(l.name)&&(c=!1),c?(u.debug("deleting pointer from: "+l.GMESrcId+", type: "+l.name),d.delPointer(l.GMESrcId,l.name)):u.warn("can not delete pointer from: "+l.GMESrcId+", type: "+l.name)));d.completeTransaction()},d.prototype._onFilterNewConnectionDroppableEnds=function(e){var t,i,o,s,a,l,c,d,h,p,g,u=e.availableConnectionEnds,f=[],m=this._client,b=this._memberListContainerID;for(i=void 0===e.srcSubCompId?this._ComponentID2GMEID[e.srcId]:this._Subcomponent2GMEID[e.srcId][e.srcSubCompId],a=r.getValidPointerTargetTypesFromSource(i,!1),l=r.getValidPointerTargetTypesFromSource(i,!0),d=r.getValidConnectionTypesFromSourceInAspect(i,b,n.ASPECT_ALL),c=[],t=d.length;t--;)if(r.canCreateChild(b,d[t])&&(p=this._client.getValidTargetItems(d[t],n.POINTER_TARGET),p&&p.length>0))for(s=p.length;s--;)-1===c.indexOf(p[s].id)&&c.push(p[s].id);for(h=_.union(a,l,c),this.logger.debug("validEndTypes: "+h),t=u.length;t--;)for(g=u[t],o=void 0===g.dstSubCompID?this._ComponentID2GMEID[g.dstItemID]:this._Subcomponent2GMEID[g.dstItemID][g.dstSubCompID],s=h.length;s--;)if(m.isTypeOf(o,h[s])){f.push(u[t]);break}return f},d.prototype._onCreateNewConnection=function(e){function i(e,t,n){D.debug("createPointer srcId: "+e+", dstId: "+t+", ptrName: "+n),C.setPointer(e,n,t)}function o(e,t,n){D.debug("addToSet containerId: "+e+", objId: "+t+", ptrName: "+n),C.addMember(e,t,n)}function s(e,i,o){var r,s,a;D.debug("createConnection srcId: "+e+", dstId: "+i+", connType: "+o),C.startTransaction(),r=C.createChild({parentId:v,baseId:o}),C.setPointer(r,n.POINTER_SOURCE,e),C.setPointer(r,n.POINTER_TARGET,i),C.addMember(v,r,I),s=T.x-P.x,a=T.y-P.y,s=P.x+s/2,a=P.y+a/2,C.setMemberRegistry(v,r,I,t.POSITION,{x:s,y:a}),C.completeTransaction()}function a(e){var t,n={};n[e]={children:0},t=C.addUI(null,function(n){var i,o;for(o=0;o<n.length;o+=1)if(n[o].eid===e&&"load"===n[o].etype){i=C.getNode(e),i&&WebGMEGlobal.State.registerActiveObject(e);break}C.removeUI(t)}),C.updateTerritory(t,n)}function c(){var e,t,n,r=p.getAttribute(l.Attributes.name),c=g.getAttribute(l.Attributes.name),_=10,v="PTR",D="SET",I="CONN",P="FOLLOW_CONN";for(t=0;t<u.length;t+=1)E[v+u[t]]={name:"Create pointer '"+u[t]+"' from '"+r+"' to '"+c+"'",icon:"glyphicon glyphicon-share",action:v,type:u[t]};for(t=0;t<f.length;t+=1)E[D+f[t]]={name:"Add '"+c+"' to set '"+f[t]+"' of '"+r+"'",icon:!1,action:D,type:f[t]};for(n="",t=0;t<m.length;t+=1)e=C.getNode(m[t]),n=e?e.getAttribute(l.Attributes.name):m[t],E[I+m[t]]={name:"Create connection '"+n+"' from '"+r+"' to '"+c+"'",icon:"glyphicon glyphicon-resize-horizontal",action:I,type:m[t]};if(m.length>0)for(t=0;t<b.length;t+=1)E[P+b[t]]={name:"Open existing connection ["+b[t]+"] from '"+r+"' to '"+c+"'",icon:"glyphicon glyphicon-share",action:P,type:b[t]};y._widget.createMenu(E,function(e){var t=E[e],n=t.type,r=t.action;switch(r){case v:i(d,h,n);break;case D:o(d,h,n);break;case I:s(d,h,n);break;case P:a(n)}},y._widget.posToPageXY(T.x-_,T.y-_))}var d,h,p,g,u,f,m,b,y=this,v=this._memberListContainerID,C=this._client,E={},D=this.logger,I=this._selectedMemberListID,T=this._widget.items[e.dst].getBoundingBox(),P=this._widget.items[e.src].getBoundingBox();d=void 0===e.srcSubCompId?this._ComponentID2GMEID[e.src]:this._Subcomponent2GMEID[e.src][e.srcSubCompId],h=void 0===e.dstSubCompId?this._ComponentID2GMEID[e.dst]:this._Subcomponent2GMEID[e.dst][e.dstSubCompId],u=r.getValidPointerTypesFromSourceToTarget(d,h),f=r.getValidSetTypesFromContainerToMember(d,h),m=r.getValidConnectionTypesInAspect(d,h,v,n.ASPECT_ALL),u.length+f.length+m.length>0&&(p=C.getNode(d),g=C.getNode(h),m.length>0&&(b=_.intersection(p.getCollectionPaths("src"),g.getCollectionPaths("dst"))),u.length+f.length+m.length===1?1===u.length?i(d,h,u[0]):1===f.length?o(d,h,f[0]):1===m.length&&(0===b.length?s(d,h,m[0]):c()):c())},d.prototype._onModifyConnectionEnd=function(e){var t,n=this._ComponentID2GMEID[e.id],i=e.old,o=e["new"];n&&(this._client.startTransaction(),(i.srcObjId!==o.srcObjId||i.srcSubCompId!==o.srcSubCompId)&&(t=void 0!==o.srcSubCompId?this._Subcomponent2GMEID[o.srcObjId][o.srcSubCompId]:this._ComponentID2GMEID[o.srcObjId],this._client.setPointer(n,"src",t)),(i.dstObjId!==o.dstObjId||i.dstSubCompId!==o.dstSubCompId)&&(t=void 0!==o.dstSubCompId?this._Subcomponent2GMEID[o.dstObjId][o.dstSubCompId]:this._ComponentID2GMEID[o.dstObjId],this._client.setPointer(n,"dst",t)),this._client.completeTransaction())},d.prototype._getDragItems=function(e){for(var t=[],n=e.length;n--;)this._ComponentID2GMEID[e[n]]&&t.push(this._ComponentID2GMEID[e[n]]);return t},d.prototype._attachClientEventListeners=function(){s.prototype._attachClientEventListeners.call(this)},d.prototype._detachClientEventListeners=function(){s.prototype._detachClientEventListeners.call(this)},d.prototype._initFilterPanel=function(){var e;e=a.createButtonIcon(a.META_RELATIONS.CONTAINMENT),this._widget.addFilterItem("Containment",a.META_RELATIONS.CONTAINMENT,e),e=a.createButtonIcon(a.META_RELATIONS.POINTER),this._widget.addFilterItem("Pointer",a.META_RELATIONS.POINTER,e),e=a.createButtonIcon(a.META_RELATIONS.INHERITANCE),this._widget.addFilterItem("Inheritance",a.META_RELATIONS.INHERITANCE,e),e=a.createButtonIcon(a.META_RELATIONS.SET),this._widget.addFilterItem("Set",a.META_RELATIONS.SET,e)},d.prototype._onConnectionTypeFilterCheckChanged=function(e,t){var n;t===!0?(n=this._filteredOutConnTypes.indexOf(e),this._filteredOutConnTypes.splice(n,1),this._unfilterConnType(e)):(this._filteredOutConnTypes.push(e),this._filterConnType(e)),this._initActiveTab||this._updateCrosscutRegistry()},d.prototype._filterConnType=function(e){var t,n,i,o,r,s=this._connectionListByType&&this._connectionListByType.hasOwnProperty(e)?this._connectionListByType[e].length:0;for(this._filteredOutConnectionDescriptors[e]=[],this._widget.beginUpdate();s--;)t=this._connectionListByType[e][s],n=this._connectionListByID[t].GMESrcId,i=this._connectionListByID[t].GMEDstId,o=this._connectionListByID[t].connTexts,e===a.META_RELATIONS.POINTER&&(r=this._connectionListByID[t].name),this._filteredOutConnectionDescriptors[e].push([n,i,o]),this._removeConnection(n,i,e,r);this._widget.endUpdate()},d.prototype._unfilterConnType=function(e){var t,n,i,o=this._filteredOutConnectionDescriptors&&this._filteredOutConnectionDescriptors.hasOwnProperty(e)?this._filteredOutConnectionDescriptors[e].length:0;for(this._widget.beginUpdate();o--;)t=this._filteredOutConnectionDescriptors[e][o][0],n=this._filteredOutConnectionDescriptors[e][o][1],i=this._filteredOutConnectionDescriptors[e][o][2],this._createConnection(t,n,e,i);delete this._filteredOutConnectionDescriptors[e],this._widget.endUpdate()},d.prototype._updateCrosscutRegistry=function(){var e,n=this._client.getNode(this._memberListContainerID),i=n.getEditableRegistry(t.CROSSCUTS),o=Number(this._activeCrosscutId);for(e=0;e<i.length;e+=1)i[e].order===o&&(i[e].filter=this._filteredOutConnTypes);this._client.setRegistry(this._memberListContainerID,t.CROSSCUTS,i)},d.prototype._selectedTabChanged=function(e){if(e!==this._activeCrosscutId){this._activeCrosscutId=e,this._initActiveTab=!0;var n,i=this._client.getNode(this._memberListContainerID),o=i?i.getEditableRegistry(t.CROSSCUTS):[],r=Number(this._activeCrosscutId),s=[];for(n=0;n<o.length;n+=1)o[n].order===r&&(s=o[n].filter||[]);for(this._widget._filterCheckboxes[a.META_RELATIONS.CONTAINMENT]&&this._widget.setChecked(a.META_RELATIONS.CONTAINMENT,!0),this._widget._filterCheckboxes[a.META_RELATIONS.POINTER]&&this._widget.setChecked(a.META_RELATIONS.POINTER,!0),this._widget._filterCheckboxes[a.META_RELATIONS.INHERITANCE]&&this._widget.setChecked(a.META_RELATIONS.INHERITANCE,!0),this._widget._filterCheckboxes[a.META_RELATIONS.SET]&&this._widget.setChecked(a.META_RELATIONS.SET,!0),n=0;n<s.length;n+=1)this._widget.setChecked(s[n],!1);this._initActiveTab=!1}},d.getDefaultConfig=function(){return{autoCreateCrosscut:!1}},d.getComponentId=function(){return"GenericUICrosscutController"},d}),define("js/Panels/Crosscut/CrosscutPanel",["js/PanelBase/PanelBaseWithHeader","js/PanelManager/IActivePanel","js/Widgets/Crosscut/CrosscutWidget","./CrosscutController"],function(e,t,n,i){"use strict";var o;return o=function(t,n){var i={};i[e.OPTIONS.LOGGER_INSTANCE_NAME]="CrosscutPanel",i[e.OPTIONS.FLOATING_TITLE]=!0,e.apply(this,[i,t]),this._client=n.client,this._initialize(),this.logger.debug("CrosscutPanel ctor finished")},_.extend(o.prototype,e.prototype),_.extend(o.prototype,t.prototype),o.prototype._initialize=function(){var e=this;this.widget=new n(this.$el,{toolBar:this.toolBar}),this.widget.setTitle=function(t){e.setTitle(t)},this.widget.onUIActivity=function(){WebGMEGlobal.PanelManager.setActivePanel(e),WebGMEGlobal.KeyboardManager.setListener(e.widget)},this.control=new i({client:this._client,widget:this.widget}),this.control.setReadOnly=function(t){e.setReadOnly(t)},this.onActivate()},o.prototype.onReadOnlyChanged=function(t){e.prototype.onReadOnlyChanged.call(this,t),this.widget.setReadOnly(t),this.control.setReadOnly(t)},o.prototype.onResize=function(e,t){this.logger.debug("onResize --> width: "+e+", height: "+t),this.widget.onWidgetContainerResize(e,t)},o.prototype.destroy=function(){this.control.destroy(),this.widget.destroy(),e.prototype.destroy.call(this),WebGMEGlobal.KeyboardManager.setListener(void 0),WebGMEGlobal.Toolbar.refresh()},o.prototype.onActivate=function(){this.widget.onActivate(),this.control.onActivate(),WebGMEGlobal.KeyboardManager.setListener(this.widget),WebGMEGlobal.Toolbar.refresh()},o.prototype.onDeactivate=function(){this.widget.onDeactivate(),this.control.onDeactivate(),WebGMEGlobal.KeyboardManager.setListener(void 0),WebGMEGlobal.Toolbar.refresh()},o}),define("js/Widgets/GraphViz/GraphVizWidget.Zoom",["js/Widgets/ZoomWidget/ZoomWidget"],function(e){"use strict";var t;return t=function(){},t.prototype._initZoom=function(t){t=t||{};var n=new e({zoomValues:t.zoomValues,"class":"graph-viz-zoom-container",sliderClass:"graph-viz-zoom-slider",zoomTarget:this._el.find("svg")});this._zoomSlider=n.$zoomSlider,this._el.parent().append(n.$zoomContainer),this._addZoomMouseHandler(this._el)},t.prototype._addZoomMouseHandler=function(e){var t=this;e.attr("tabindex",0),e.mouseenter(function(){$(this).focus()}),e.on("mousewheel",function(e){var n=e.originalEvent;n&&(n.ctrlKey||n.metaKey||n.altKey)&&(n.wheelDelta<0?t._zoomSlider.csszoom("zoomOut"):t._zoomSlider.csszoom("zoomIn"),e.stopPropagation(),e.preventDefault())}),e.on("DOMMouseScroll",function(e){var n=e.originalEvent;n&&(n.ctrlKey||n.metaKey||n.altKey)&&(n.detail>0?t._zoomSlider.csszoom("zoomOut"):t._zoomSlider.csszoom("zoomIn"),e.stopPropagation(),e.preventDefault())})},t}),define("css!js/Widgets/GraphViz/styles/GraphVizWidget",[],function(){}),define("js/Widgets/GraphViz/GraphVizWidget",["js/logger","js/Widgets/GraphViz/GraphVizWidget.Zoom","js/Utils/ComponentSettings","d3","css!./styles/GraphVizWidget.css"],function(e,t,n){"use strict";var i,o="graph-viz",r=750,s=20,a=0,l="closed",c="open",d="LEAF",h="opening",p="CLOSING",g=15,u=180;return i=function(t){var o=i.getDefaultConfig();this._logger=e.create("gme:Widgets:GraphViz:GraphVizWidget",WebGMEGlobal.gmeConfig.client.log),n.resolveWithWebGMEGlobal(o,i.getComponentId()),this._el=t,this._initialize(),this._initZoom(o),this._logger.debug("GraphVizWidget ctor finished")},i.prototype._initialize=function(){var e=this._el.width(),t=this._el.height(),n=this;this._el.addClass(o),this._root=void 0,this._tree=d3.layout.tree().sort(function(e,t){return e.name<t.name?-1:e.name>t.name?1:0}),this.__svg=d3.select(this._el[0]).append("svg"),this._resizeD3Tree(e,t),this._svg=this.__svg.append("g").attr("transform","translate("+s+","+s+")"),this._el.on("dblclick",function(e){e.stopPropagation(),e.preventDefault(),n.onBackgroundDblClick()})},i.prototype.onWidgetContainerResize=function(e,t){this._resizeD3Tree(e,t),this._root&&this._update(void 0)},i.prototype._resizeD3Tree=function(e,t){var n=this._el.width(),i=this._el.height();e=Math.max(n,e),t=Math.max(i,t),this._tree.size([t-2*s,e-2*s]),this.__svg.attr("width",e).attr("height",t)},i.prototype._update=function(e){var t=this,n=this._tree.nodes(this._root).reverse(),i=this._tree.links(n),o=d3.svg.diagonal().projection(function(e){return[e.y,e.x]}),s=function(e){var t=d;return e.childrenNum>0&&(t=l,e.children&&e.children.length===e.childrenNum&&(t=c)),t};n.forEach(function(e){e.y=e.depth*u,e.status=e.status||s(e)});var f=this._svg.selectAll("g.node").data(n,function(e){return e.id||(e.id=++a)}),m=function(e){var t=e.name;return e.childrenNum>0&&(t+=" ["+e.childrenNum+"]"),t},_=f.enter().append("g").attr("class","node").attr("transform",function(e){return e.parent?"translate("+e.parent.y0+","+e.parent.x0+")":"translate("+e.y+","+e.x+")"}).on("click",function(e){d3.event.stopPropagation(),d3.event.preventDefault(),t._onNodeClick(e)}).on("dblclick",function(e){d3.event.preventDefault(),d3.event.stopPropagation(),t._onNodeDblClick(e)});_.append("circle").attr("r",1e-6),_.append("text").attr("dy",".35em").style("fill-opacity",1e-6);var b=f.transition().duration(r).attr("transform",function(e){return"translate("+e.y+","+e.x+")"});b.select("circle").attr("r",4.5),b.select("circle").style("fill",function(e){var t=e.status,n="#FFFFFF";return t===l?n="lightsteelblue":t===h?n="#ff0000":t===c?n="#ffFFFF":t===d?n="#ffFFFF":t===p&&(n="#00FF00"),n}),b.select("text").attr("x",function(e){return e.children&&e.children.length>0?-10:10}).attr("text-anchor",function(e){return e.children&&e.children.length>0?"end":"start"}).text(function(e){return m(e)}).style("fill-opacity",1);var y=f.exit().transition().duration(r).attr("transform",function(t){return e?"translate("+e.y+","+e.x+")":t.parent?"translate("+t.parent.y+","+t.parent.x+")":"translate("+t.y+","+t.x+")"}).remove();y.select("circle").attr("r",1e-6),y.select("text").style("fill-opacity",1e-6);var v=this._svg.selectAll("path.link").data(i,function(e){return e.target.id});v.enter().insert("path","g").attr("class","link").attr("d",function(e){var t={x:e.source.x0||e.source.y,y:e.source.y0||e.source.y};return o({source:t,target:t})}),v.transition().duration(r).attr("d",o),v.exit().transition().duration(r).attr("d",function(e){var t={x:e.source.x,y:e.source.y};return o({source:t,target:t})}).remove();var C=[];if(n.forEach(function(e){e.x0=e.x,e.y0=e.y,C[e.depth]=C[e.depth]||[],C[e.depth].push(e.x)}),this.__resizing!==!0){var E=C.length,D=[];for(a=1;E>a;a+=1){C[a].sort(function(e,t){return e-t});var I,T=C[a].length;for(I=0;T-1>I;I+=1)if(C[a][I+1]-g<=C[a][I]){D.push([a,T]);break}}this._logger.debug("Collide:"+D);var P=0,N=D.length;if(this.__resizing=!0,N>0)for(;N--;)P+=D[N][1];else P=this._el.height()/g;this._resizeD3Tree(C.length*u,P*g),this._update(),this.__resizing=!1}},i.prototype._onNodeClick=function(e){switch(e.status){case l:e.status=h,this._update(void 0),this.onNodeOpen(e.id);break;case c:e.status=p,e.children=void 0,this._update(e),this.onNodeClose(e.id);break;case h:break;case p:break;case d:}},i.prototype._onNodeDblClick=function(e){this.onNodeDblClick(e.id)},i.prototype.setData=function(e){this.__root=this._root,this._root=$.extend(!0,{},e);var t=function(e,n){var i,o;if(e&&n&&e.id===n.id&&(n.x0=e.x0,n.y0=e.y0,i=e.children?e.children.length:0,i>0))for(;i--;)if(o=n.children?n.children.length:0,o>0)for(;o--;)t(e.children[i],n.children[o])};t(this.__root,this._root),delete this.__root;var n=this._el.width(),i=this._el.height();if(this._resizeD3Tree(n,i),this._update(void 0),this._root&&this._root.name){var o=6*this._root.name.length;this._root.children&&(o=6*(this._root.name+" ["+this._root.children.length+"]").length),this._el.find("svg > g").attr("transform","translate("+(o+s)+","+s+")")}},i.prototype.onNodeOpen=function(){},i.prototype.onNodeClose=function(){},i.prototype.onNodeDblClick=function(){},i.prototype.onBackgroundDblClick=function(){},i.prototype.destroy=function(){},i.prototype.onActivate=function(){},i.prototype.onDeactivate=function(){},_.extend(i.prototype,t.prototype),i.getDefaultConfig=function(){return{zoomValues:[.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.2,1.4,1.6,1.8,2,2.5,3,3.5,4]}},i.getComponentId=function(){return"GenericUIGraphVizWidget"},i}),define("js/Panels/GraphViz/GraphVizPanelControl",["js/logger","js/util","js/Constants","js/Utils/GMEConcepts","js/NodePropertyNames"],function(e,t,n,i,o){"use strict";var r;return r=function(t){this._logger=e.create("gme:Panels:GraphViz:GraphVizControl",WebGMEGlobal.gmeConfig.client.log),this._client=t.client,this._graphVizWidget=t.widget,this._currentNodeId=null,this._currentNodeParentId=void 0,this._displayModelsOnly=!1,this._initWidgetEventHandlers(),this._logger.debug("Created")},r.prototype._initWidgetEventHandlers=function(){var e=this;this._graphVizWidget.onBackgroundDblClick=function(){e._currentNodeParentId&&WebGMEGlobal.State.registerActiveObject(e._currentNodeParentId)},this._graphVizWidget.onNodeOpen=function(t){e._selfPatterns[t]={children:1},e._client.updateTerritory(e._territoryId,e._selfPatterns)},this._graphVizWidget.onNodeDblClick=function(e){WebGMEGlobal.State.registerActiveObject(e)},this._graphVizWidget.onNodeClose=function(t){var n,i,o,r;n=function(t){if(e._selfPatterns.hasOwnProperty(t)){if(i=e._nodes[t])for(o=i.childrenIDs,r=0;r<o.length;r+=1)n(o[r]);delete e._selfPatterns[t]}},n(t),t===e._currentNodeId&&(e._selfPatterns[t]={children:0}),e._client.updateTerritory(e._territoryId,e._selfPatterns)}},r.prototype.selectedObjectChanged=function(e){var t=this._getObjectDescriptor(e),i=this;this._logger.debug("activeObject nodeId '"+e+"'"),this._currentNodeId&&this._client.removeUI(this._territoryId),this._currentNodeId=e,this._currentNodeParentId=void 0,this._nodes={},(this._currentNodeId||this._currentNodeId===n.PROJECT_ROOT_ID)&&(this._selfPatterns={},this._selfPatterns[e]={children:0},this._graphVizWidget.setTitle(t.name.toUpperCase()),t.parentId||t.parentId===n.PROJECT_ROOT_ID?this.$btnModelHierarchyUp.show():this.$btnModelHierarchyUp.hide(),this._currentNodeParentId=t.parentId,this._territoryId=this._client.addUI(this,function(e){i._eventCallback(e);
}),this._client.updateTerritory(this._territoryId,this._selfPatterns),setTimeout(function(){i._selfPatterns[e]={children:1},i._client.updateTerritory(i._territoryId,i._selfPatterns)},1e3))},r.prototype._getObjectDescriptor=function(e){var t,n=this._client.getNode(e);return n&&(t={id:void 0,name:void 0,childrenIDs:void 0,parentId:void 0,isConnection:!1},t.id=n.getId(),t.name=n.getAttribute(o.Attributes.name),t.childrenIDs=n.getChildrenIds(),t.childrenNum=t.childrenIDs.length,t.parentId=n.getParentId(),t.isConnection=i.isConnection(e)),t},r.prototype._eventCallback=function(e){var t,i=e?e.length:0;for(this._logger.debug("_eventCallback '"+i+"' items");i--;)switch(t=e[i],t.etype){case n.TERRITORY_EVENT_LOAD:this._onLoad(t.eid);break;case n.TERRITORY_EVENT_UPDATE:this._onUpdate(t.eid);break;case n.TERRITORY_EVENT_UNLOAD:this._onUnload(t.eid)}this._generateData(),this._logger.debug("_eventCallback '"+e.length+"' items - DONE")},r.prototype._generateData=function(){function e(t){for(var n=t&&t.childrenIDs?t.childrenIDs.length:0;n--;)t.children=t.children||[],i._nodes[t.childrenIDs[n]]&&(i._displayModelsOnly===!0&&i._nodes[t.childrenIDs[n]].isConnection!==!0||i._displayModelsOnly===!1)&&(t.children.push(_.extend({},i._nodes[t.childrenIDs[n]])),e(t.children[t.children.length-1]))}var t,i=this;t=_.extend({},this._currentNodeId||this._currentNodeId===n.PROJECT_ROOT_ID?this._nodes[this._currentNodeId]:{}),e(t),this._graphVizWidget.setData(t)},r.prototype._onLoad=function(e){this._nodes[e]=this._getObjectDescriptor(e)},r.prototype._onUpdate=function(e){this._nodes[e]=this._getObjectDescriptor(e)},r.prototype._onUnload=function(e){delete this._nodes[e]},r.prototype.destroy=function(){this._detachClientEventListeners()},r.prototype._stateActiveObjectChanged=function(e,t){this._currentNodeId===t?this._logger.debug("Disregarding activeObject changed when it is already the same."):this.selectedObjectChanged(t)},r.prototype._attachClientEventListeners=function(){this._detachClientEventListeners(),WebGMEGlobal.State.on("change:"+n.STATE_ACTIVE_OBJECT,this._stateActiveObjectChanged,this)},r.prototype._detachClientEventListeners=function(){WebGMEGlobal.State.off("change:"+n.STATE_ACTIVE_OBJECT,this._stateActiveObjectChanged)},r.prototype.onActivate=function(){this._attachClientEventListeners(),this._displayToolbarItems(),"string"==typeof this._currentNodeId&&WebGMEGlobal.State.registerActiveObject(this._currentNodeId)},r.prototype.onDeactivate=function(){this._detachClientEventListeners(),this._hideToolbarItems()},r.prototype._displayToolbarItems=function(){var e;if(this._toolbarInitialized===!0)for(e=0;e<this._toolbarItems.length;e++)this._toolbarItems[e].show();else this._initializeToolbar()},r.prototype._hideToolbarItems=function(){var e;if(this._toolbarInitialized===!0)for(e=0;e<this._toolbarItems.length;e++)this._toolbarItems[e].hide()},r.prototype._removeToolbarItems=function(){var e;if(this._toolbarInitialized===!0)for(e=0;e<this._toolbarItems.length;e++)this._toolbarItems[e].destroy()},r.prototype._initializeToolbar=function(){var e=WebGMEGlobal.Toolbar,t=this;this._toolbarItems=[],this._toolbarItems.push(e.addSeparator()),this.$btnModelHierarchyUp=e.addButton({title:"Go to parent",icon:"glyphicon glyphicon-circle-arrow-up",clickFn:function(){WebGMEGlobal.State.registerActiveObject(t._currentNodeParentId)}}),this._toolbarItems.push(this.$btnModelHierarchyUp),this.$btnModelHierarchyUp.hide(),this.$cbShowConnection=e.addCheckBox({title:"Show connection",icon:"gme icon-gme_diagonal-arrow",checkChangedFn:function(e,n){t._displayModelsOnly=!n,t._generateData()}}),this._toolbarItems.push(this.$cbShowConnection),this._toolbarInitialized=!0},r}),define("js/Panels/GraphViz/GraphVizPanel",["js/PanelBase/PanelBaseWithHeader","js/PanelManager/IActivePanel","js/Widgets/GraphViz/GraphVizWidget","./GraphVizPanelControl"],function(e,t,n,i){"use strict";var o;return o=function(t,n){var i={};i[e.OPTIONS.LOGGER_INSTANCE_NAME]="GraphVizPanel",i[e.OPTIONS.FLOATING_TITLE]=!0,e.apply(this,[i,t]),this._client=n.client,this._initialize(),this.logger.debug("GraphVizPanel ctor finished")},_.extend(o.prototype,e.prototype),_.extend(o.prototype,t.prototype),o.prototype._initialize=function(){var e=this;this.setTitle(""),this.widget=new n(this.$el),this.widget.setTitle=function(t){e.setTitle(t)},this.control=new i({client:this._client,widget:this.widget}),this.onActivate()},o.prototype.onReadOnlyChanged=function(t){e.prototype.onReadOnlyChanged.call(this,t)},o.prototype.onResize=function(e,t){this.logger.debug("onResize --> width: "+e+", height: "+t),this.widget.onWidgetContainerResize(e,t)},o.prototype.destroy=function(){this.control.destroy(),this.widget.destroy(),e.prototype.destroy.call(this),WebGMEGlobal.KeyboardManager.setListener(void 0),WebGMEGlobal.Toolbar.refresh()},o.prototype.onActivate=function(){this.widget.onActivate(),this.control.onActivate(),WebGMEGlobal.KeyboardManager.setListener(this.widget),WebGMEGlobal.Toolbar.refresh()},o.prototype.onDeactivate=function(){this.widget.onDeactivate(),this.control.onDeactivate(),WebGMEGlobal.KeyboardManager.setListener(void 0),WebGMEGlobal.Toolbar.refresh()},o}),define("js/Decorators/DecoratorBase",["js/logger"],function(e){"use strict";var t,n="DecoratorBase";return t=function(t){var n="gme:Decorators:DecoratorBase:";n=n+=t.loggerName?t.loggerName:this.DECORATORID,this.logger=e.create(n,WebGMEGlobal.gmeConfig.client.log),this.supportedWidgetMap={},this.initializeSupportedWidgetMap(),this.logger.debug("Created")},t.prototype.DECORATORID=n,t.prototype.initializeSupportedWidgetMap=function(){},t.prototype.getDecoratorForWidget=function(e){return this.supportedWidgetMap[e]},t}),define("decorators/CircleDecorator/Core/CircleDecorator.Core",["js/Constants","js/Utils/DisplayFormat"],function(e,t){"use strict";var n,i=11;return n=function(){},n.prototype.DECORATOR_DEFAULT_PARAMS={displayName:!0},n.prototype._initializeVariables=function(e){this.formattedName="",this.circleSize=i,this._displayConnectors=!1,e&&e.connectors&&(this._displayConnectors=e.connectors)},n.prototype.destroy=function(){},n.prototype.doSearch=function(e){var t=e.toString().toLowerCase();return this.formattedName&&-1!==this.formattedName.toLowerCase().indexOf(t)},n.prototype._renderContent=function(){this.$el.attr({"data-id":this._metaInfo[e.GME_ID]}),this.skinParts.$name=this.$el.find(".name"),this.decoratorParams.displayName===!1&&(this.skinParts.$name.remove(),delete this.skinParts.$name),this._update()},n.prototype._update=function(){this._updateName()},n.prototype._updateName=function(){var n=this._control._client,i=n.getNode(this._metaInfo[e.GME_ID]),o="(N/A)";this.skinParts.$name&&(i?this.formattedName=t.resolve(i):this.formattedName=o,this.skinParts.$name.text(this.formattedName),this.skinParts.$name.attr("title",this.formattedName))},n}),define("text!decorators/CircleDecorator/Core/CircleDecorator.html",[],function(){return'<div class="circle-decorator">\r\n    <svg width="11" height="11" xmlns="http://www.w3.org/2000/svg">\r\n        <circle cx="5.5" cy="5.5" r="5" stroke="#000" fill="#000"/>\r\n    </svg>\r\n    <div class="circle-shadow"></div>\r\n    <span class="name"></span>\r\n\r\n    <div class=\'connector\'></div>\r\n</div>'}),define("css!decorators/CircleDecorator/DiagramDesigner/CircleDecorator.DiagramDesignerWidget",[],function(){}),define("decorators/CircleDecorator/DiagramDesigner/CircleDecorator.DiagramDesignerWidget",["js/Widgets/DiagramDesigner/DiagramDesignerWidget.DecoratorBase","../Core/CircleDecorator.Core","js/Widgets/DiagramDesigner/DiagramDesignerWidget.Constants","text!../Core/CircleDecorator.html","css!./CircleDecorator.DiagramDesignerWidget.css"],function(e,t,n,i){"use strict";var o,r="CircleDecoratorDiagramDesignerWidget";return o=function(n){var i=_.extend({},n);e.apply(this,[i]),t.apply(this,[i]),this._initializeVariables({connectors:!0}),this.logger.debug("CircleDecoratorDiagramDesignerWidget ctor")},_.extend(o.prototype,e.prototype),_.extend(o.prototype,t.prototype),o.prototype.DECORATORID=r,o.prototype.$DOMBase=$(i),o.prototype.on_addTo=function(){this._renderContent()},o.prototype.update=function(){this._update()},o.prototype.onRenderGetLayoutInfo=function(){e.prototype.onRenderGetLayoutInfo.apply(this,arguments),this.skinParts.$name&&(this.renderLayoutInfo.nameWidth=this.skinParts.$name.outerWidth())},o.prototype.onRenderSetLayoutInfo=function(){if(this.renderLayoutInfo&&this.skinParts.$name){var t=(this.circleSize-this.renderLayoutInfo.nameWidth)/2;this.skinParts.$name.css({left:t})}e.prototype.onRenderSetLayoutInfo.apply(this,arguments)},o.prototype.calculateDimension=function(){var e=this.circleSize;this.hostDesignerItem&&this.hostDesignerItem.setSize(e,e)},o.prototype.getConnectionAreas=function(){var e=[],t=10,n=this.circleSize,i=Math.floor(n/2);return e.push({id:"N",x1:i,y1:0,x2:i,y2:0,angle1:270,angle2:270,len:t}),e.push({id:"S",x1:i,y1:n-1,x2:i,y2:n-1,angle1:90,angle2:90,len:t}),e.push({id:"W",x1:0,y1:i,x2:0,y2:i,angle1:180,angle2:180,len:t}),e.push({id:"E",x1:n-1,y1:i,x2:n-1,y2:i,angle1:0,angle2:0,len:t}),e},o}),define("js/Widgets/PartBrowser/PartBrowserWidget.DecoratorBase",["js/logger","js/Decorators/WidgetDecoratorBase"],function(e,t){"use strict";var n,i="PartBrowserWidgetDecoratorBase";return n=function(e){t.call(this,e),this.skinParts={},this._initialize(),this.logger.debug("Created")},_.extend(n.prototype,t.prototype),n.prototype.DECORATORID=i,n.prototype.setControl=function(e){this._control=e},n.prototype.getControl=function(){return this._control},n.prototype.setMetaInfo=function(e){this._metaInfo=e},n.prototype.getMetaInfo=function(){return this._metaInfo},n.prototype.getTerritoryQuery=function(){return void 0},n.prototype.notifyComponentEvent=function(e){this.logger.warn("notifyComponentEvent "+e)},n.prototype._initialize=function(){this.$el=$("<div/>")},n.prototype.beforeAppend=function(){},n.prototype.afterAppend=function(){},n.prototype.destroy=function(){this.logger.debug("PartBrowserWidgetDecoratorBase.destroyed")},n.prototype.update=function(){},n}),define("css!decorators/CircleDecorator/PartBrowser/CircleDecorator.PartBrowserWidget",[],function(){}),define("decorators/CircleDecorator/PartBrowser/CircleDecorator.PartBrowserWidget",["js/Constants","js/NodePropertyNames","js/Widgets/PartBrowser/PartBrowserWidget.DecoratorBase","js/Widgets/DiagramDesigner/DiagramDesignerWidget.Constants","../Core/CircleDecorator.Core","text!../Core/CircleDecorator.html","css!./CircleDecorator.PartBrowserWidget.css"],function(e,t,n,i,o,r){"use strict";var s,a="CircleDecoratorPartBrowserWidget";return s=function(e){var t=_.extend({},e);n.apply(this,[t]),o.apply(this,[t]),this._initializeVariables({connectors:!1}),this.logger.debug("CircleDecoratorPartBrowserWidget ctor")},_.extend(s.prototype,n.prototype),_.extend(s.prototype,o.prototype),s.prototype.DECORATORID=a,s.prototype.$DOMBase=function(){var e=$(r);return e.find("."+i.CONNECTOR_CLASS).remove(),e.find(".circle-shadow").remove(),e}(),s.prototype.beforeAppend=function(){this.$el=this.$DOMBase.clone(),this._renderContent()},s.prototype.afterAppend=function(){this._update()},s.prototype.update=function(){this._update()},s.prototype._updateName=function(){if(o.prototype._updateName.call(this),this.skinParts.$name){var e=this.skinParts.$name.outerWidth(),t=(this.circleSize-e)/2;this.skinParts.$name.css({left:t})}},s}),define("decorators/CircleDecorator/CircleDecorator",["js/Decorators/DecoratorBase","./DiagramDesigner/CircleDecorator.DiagramDesignerWidget","./PartBrowser/CircleDecorator.PartBrowserWidget"],function(e,t,n){"use strict";var i,o="CircleDecorator";return i=function(t){var n=_.extend({loggerName:this.DECORATORID},t);e.apply(this,[n]),this.logger.debug("CircleDecorator ctor")},_.extend(i.prototype,e.prototype),i.prototype.DECORATORID=o,i.prototype.initializeSupportedWidgetMap=function(){this.supportedWidgetMap={DiagramDesigner:t,PartBrowser:n}},i}),define("text!decorators/DefaultDecorator/DiagramDesigner/DefaultDecorator.DiagramDesignerWidget.html",[],function(){return"<div class=\"default-decorator\">\r\n    <div class=\"name\"></div>\r\n    <div class='connector bottom'></div>\r\n    <div class='connector top'></div>\r\n</div>"}),define("css!decorators/DefaultDecorator/DiagramDesigner/DefaultDecorator.DiagramDesignerWidget",[],function(){}),define("decorators/DefaultDecorator/DiagramDesigner/DefaultDecorator.DiagramDesignerWidget",["js/Constants","js/NodePropertyNames","js/Widgets/DiagramDesigner/DiagramDesignerWidget.DecoratorBase","text!./DefaultDecorator.DiagramDesignerWidget.html","css!./DefaultDecorator.DiagramDesignerWidget.css"],function(e,t,n,i){"use strict";var o,r=n,s=n.prototype,a="DefaultDecorator";return o=function(e){var t=_.extend({},e);r.apply(this,[t]),this.name="",this.logger.debug("DefaultDecorator ctor")},_.extend(o.prototype,s),o.prototype.DECORATORID=a,o.prototype.$DOMBase=$(i),o.prototype.on_addTo=function(){var e=this;this._renderName(),this.skinParts.$name.on("dblclick.editOnDblClick",null,function(t){e.hostDesignerItem.canvas.getIsReadOnlyMode()!==!0&&$(this).editInPlace({"class":"",onChange:function(t,n){e._onNodeTitleChanged(t,n)}}),t.stopPropagation(),t.preventDefault()}),s.on_addTo.apply(this,arguments)},o.prototype._renderName=function(){var t=this._control._client,n=t.getNode(this._metaInfo[e.GME_ID]);this.$el.attr({"data-id":this._metaInfo[e.GME_ID]}),n&&(this.name=n.getFullyQualifiedName()),this.skinParts.$name=this.$el.find(".name"),this.skinParts.$name.text(this.name)},o.prototype.update=function(){var t=this._control._client,n=t.getNode(this._metaInfo[e.GME_ID]),i="";n&&(i=n.getFullyQualifiedName(),this.name!==i&&(this.name=i,this.skinParts.$name.text(this.name)))},o.prototype.getConnectionAreas=function(e){var t=[],n=10,i=20;return(void 0===e||e===this.hostDesignerItem.id)&&(t.push({id:"0",x1:n,y1:0,x2:this.hostDesignerItem.getWidth()-n,y2:0,angle1:270,angle2:270,len:i}),t.push({id:"1",x1:this.hostDesignerItem.getWidth(),y1:n,x2:this.hostDesignerItem.getWidth(),y2:this.hostDesignerItem.getHeight()-n,angle1:0,angle2:0,len:i}),t.push({id:"2",x1:n,y1:this.hostDesignerItem.getHeight(),x2:this.hostDesignerItem.getWidth()-n,y2:this.hostDesignerItem.getHeight(),angle1:90,angle2:90,len:i}),t.push({id:"3",x1:0,y1:n,x2:0,y2:this.hostDesignerItem.getHeight()-n,angle1:180,angle2:180,len:i})),t},o.prototype._onNodeTitleChanged=function(n,i){var o=this._control._client;o.setAttribute(this._metaInfo[e.GME_ID],t.Attributes.name,i)},o.prototype.doSearch=function(e){var t=e.toString();return this.name&&-1!==this.name.toLowerCase().indexOf(t.toLowerCase())?!0:!1},o}),define("css!decorators/DefaultDecorator/PartBrowser/DefaultDecorator.PartBrowserWidget",[],function(){}),define("decorators/DefaultDecorator/PartBrowser/DefaultDecorator.PartBrowserWidget",["js/Constants","js/NodePropertyNames","js/Widgets/PartBrowser/PartBrowserWidget.DecoratorBase","js/Widgets/DiagramDesigner/DiagramDesignerWidget.Constants","text!../DiagramDesigner/DefaultDecorator.DiagramDesignerWidget.html","css!../DiagramDesigner/DefaultDecorator.DiagramDesignerWidget.css","css!./DefaultDecorator.PartBrowserWidget.css"],function(e,t,n,i,o){"use strict";var r,s=n,a="DefaultDecoratorPartBrowserWidget";return r=function(e){var t=_.extend({},e);s.apply(this,[t]),this.logger.debug("DefaultDecoratorPartBrowserWidget ctor")},_.extend(r.prototype,s.prototype),r.prototype.DECORATORID=a,r.prototype.$DOMBase=function(){var e=$(o);return e.find("."+i.CONNECTOR_CLASS).remove(),e}(),r.prototype.beforeAppend=function(){this.$el=this.$DOMBase.clone(),this.skinParts.$name=this.$el.find(".name"),this._renderContent()},r.prototype.afterAppend=function(){},r.prototype._renderContent=function(){var t=this._control._client,n=t.getNode(this._metaInfo[e.GME_ID]);DEBUG&&this.$el.attr({"data-id":this._metaInfo[e.GME_ID]}),n&&this.skinParts.$name.text(n.getFullyQualifiedName())},r.prototype.update=function(){this._renderContent()},r}),define("decorators/DefaultDecorator/DefaultDecorator",["js/Decorators/DecoratorBase","./DiagramDesigner/DefaultDecorator.DiagramDesignerWidget","./PartBrowser/DefaultDecorator.PartBrowserWidget"],function(e,t,n){"use strict";var i,o=e,r=e.prototype,s="DefaultDecorator";return i=function(e){var t=_.extend({loggerName:this.DECORATORID},e);o.apply(this,[t]),this.logger.debug("DefaultDecorator ctor")},_.extend(i.prototype,r),i.prototype.DECORATORID=s,i.prototype.initializeSupportedWidgetMap=function(){this.supportedWidgetMap={DiagramDesigner:t,PartBrowser:n}},i}),define("decorators/DocumentDecorator/Core/DocumentDecorator.Core",["js/RegistryKeys","js/Constants"],function(e,t){"use strict";function n(){}return n.prototype._updateColors=function(e){this._getNodeColorsFromRegistry(),this.fillColor?this.$el.css({"background-color":this.fillColor}):this.$el.css({"background-color":""}),this.textColor?this.$el.css({color:this.textColor}):this.$el.css({color:""}),e||(this.borderColor?(this.$el.css({"border-color":this.borderColor,"box-shadow":"0px 0px 7px 0px "+this.borderColor+" inset"}),this.skinParts.$name.css({"border-color":this.borderColor})):(this.$el.css({"border-color":"","box-shadow":""}),this.skinParts.$name.css({"border-color":""})))},n.prototype._getNodeColorsFromRegistry=function(){var n=this._metaInfo[t.GME_ID];this.fillColor=this.preferencesHelper.getRegistry(n,e.COLOR,!0),this.borderColor=this.preferencesHelper.getRegistry(n,e.BORDER_COLOR,!0),this.textColor=this.preferencesHelper.getRegistry(n,e.TEXT_COLOR,!0)},n}),define("text!decorators/DocumentDecorator/DiagramDesigner/DocumentEditorDialog.html",[],function(){return'<div class="meta-text-editor-dialog modal fade" tabindex="-1" role="dialog">\r\n    <div class="modal-dialog modal-xlg">\r\n        <div class="modal-content">\r\n            <div class="modal-header">\r\n                <button type="button" class="close" data-dismiss="modal">×</button>\r\n                <h3>Edit Comment Documentation</h3>\r\n            </div>\r\n            <form class="modal-body form-horizontal" role="form">\r\n                <div class="control-group" id="pMeta">\r\n                    <label class="control-label"></label>\r\n                    <div class="controls"></div>\r\n                </div>\r\n            </form>\r\n            <div class="modal-footer">\r\n                <a href="#" class="btn btn-primary btn-save">Save</a>\r\n                <a href="#" class="btn btn-default" data-dismiss="modal">Cancel</a>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>'}),define("decorators/DocumentDecorator/DiagramDesigner/DocumentEditorDialog",["js/util","epiceditor","text!./DocumentEditorDialog.html"],function(e,t,n){"use strict";var i;return i=function(){this._dialog=$(n),this._dialog.appendTo($(document.body)),this._el=this._dialog.find(".modal-body").first(),this._btnSave=this._dialog.find(".btn-save").first(),this._pMeta=this._el.find("#pMeta").first(),this._content=this._pMeta.find("div.controls").first();var e={container:this._content.get(0),basePath:"bower_components/EpicEditor/epiceditor",autogrow:{minHeight:300},button:{fullscreen:!0},parser:t};this.editor=new EpicEditor(e),this.text=""},i.prototype.initialize=function(e,t){var n=this;this.text=e,this._dialog.modal({show:!1}),this._btnSave.on("click",function(e){t&&t.call(null,n.editor.exportFile()),n._dialog.modal("hide"),e.stopPropagation(),e.preventDefault()}),this._dialog.on("shown.bs.modal",function(){n.editor.is("loaded")||n.editor.load(),n.editor.importFile("epiceditor",n.text)}),this._dialog.on("hidden.bs.modal",function(){n._dialog.empty(),n._dialog.remove(),n.editor.remove()})},i.prototype.updateText=function(e){this.text=e},i.prototype.show=function(){var e=this;e._dialog.modal("show")},i}),define("text!decorators/DocumentDecorator/DiagramDesigner/DocumentDecorator.DiagramDesignerWidget.html",[],function(){return'<div class="Document-decorator">\r\n    <div class="name"></div>\r\n    <div class="doc"></div>\r\n    <div class=\'connector bottom\'></div>\r\n    <div class=\'connector top\'></div>\r\n</div>'}),define("css!decorators/DocumentDecorator/DiagramDesigner/DocumentDecorator.DiagramDesignerWidget",[],function(){}),define("decorators/DocumentDecorator/DiagramDesigner/DocumentDecorator.DiagramDesignerWidget",["epiceditor","js/Constants","js/NodePropertyNames","js/Widgets/DiagramDesigner/DiagramDesignerWidget.DecoratorBase","../Core/DocumentDecorator.Core","./DocumentEditorDialog","text!./DocumentDecorator.DiagramDesignerWidget.html","css!./DocumentDecorator.DiagramDesignerWidget.css"],function(e,t,n,i,o,r,s){"use strict";var a,l="DocumentDecorator",c=$('<i class="glyphicon glyphicon-cog text-meta" title="Edit documentation" />');return a=function(t){var n=_.extend({},t);i.apply(this,[n]),o.apply(this,[n]),this.name="",this._skinParts={},this.$doc=this.$el.find(".doc").first(),e.setOptions({gfm:!0,tables:!0,breaks:!1,pedantic:!1,sanitize:!0,smartLists:!0,smartypants:!1}),this.logger.debug("DocumentDecorator ctor")},_.extend(a.prototype,i.prototype),_.extend(a.prototype,o.prototype),a.prototype.DECORATORID=l,a.prototype.$DOMBase=$(s),a.prototype.on_addTo=function(){var e=this,n=this._control._client,o=n.getNode(this._metaInfo[t.GME_ID]);this._renderName(),this._skinParts.$EditorBtn=c.clone(),this.$el.append(this._skinParts.$EditorBtn),this._skinParts.$EditorBtn.on("click",function(t){e.hostDesignerItem.canvas.getIsReadOnlyMode()!==!0&&void 0!==o.getAttribute("documentation")&&e._showEditorDialog(),t.stopPropagation(),t.preventDefault()}),this.skinParts.$name.on("dblclick.editOnDblClick",null,function(t){e.hostDesignerItem.canvas.getIsReadOnlyMode()!==!0&&$(this).editInPlace({"class":"",onChange:function(t,n){e._onNodeTitleChanged(t,n)}}),t.stopPropagation(),t.preventDefault()}),this.skinParts.$name.on("click",function(t){e.skinParts.$name.popover({}),e.skinParts.$name.popover("show"),e.logger.debug(e.skinParts.$name.popover),t.stopPropagation(),t.preventDefault()}),i.prototype.on_addTo.apply(this,arguments),e.update()},a.prototype._renderName=function(){var e=this._control._client,i=e.getNode(this._metaInfo[t.GME_ID]);this.$el.attr({"data-id":this._metaInfo[t.GME_ID]}),i&&(this.name=i.getAttribute(n.Attributes.name)||""),this.skinParts.$name=this.$el.find(".name"),this.skinParts.$name.text(this.name)},a.prototype.update=function(){var i=this._control._client,o=this,r=i.getNode(this._metaInfo[t.GME_ID]),s="",a="";r&&(s=r.getAttribute(n.Attributes.name)||"",a=r.getAttribute("documentation"),this.$doc.empty(),void 0===a?(this.$doc.append('Editor is disabled because attribute "documentation" is not found in Meta-Model'),this._skinParts.$EditorBtn.addClass("not-activated")):(o.hostDesignerItem.canvas.getIsReadOnlyMode()===!1?o._skinParts.$EditorBtn.removeClass("not-activated"):o._skinParts.$EditorBtn.addClass("not-activated"),this.$doc.append($(e(a)))),this.name!==s&&(this.name=s,this.skinParts.$name.text(this.name))),this._updateColors()},a.prototype.getConnectionAreas=function(e){var t=[],n=10,i=20;return(void 0===e||e===this.hostDesignerItem.id)&&(t.push({id:"0",x1:n,y1:0,x2:this.hostDesignerItem.getWidth()-n,y2:0,angle1:270,angle2:270,len:i}),t.push({id:"1",x1:this.hostDesignerItem.getWidth(),y1:n,x2:this.hostDesignerItem.getWidth(),y2:this.hostDesignerItem.getHeight()-n,angle1:0,angle2:0,len:i}),t.push({id:"2",x1:n,y1:this.hostDesignerItem.getHeight(),x2:this.hostDesignerItem.getWidth()-n,y2:this.hostDesignerItem.getHeight(),angle1:90,angle2:90,len:i}),t.push({id:"3",x1:0,y1:n,x2:0,y2:this.hostDesignerItem.getHeight()-n,angle1:180,angle2:180,len:i})),t},a.prototype._onNodeTitleChanged=function(e,i){var o=this._control._client;o.setAttribute(this._metaInfo[t.GME_ID],n.Attributes.name,i)},a.prototype.doSearch=function(e){var t=e.toString();return this.name&&-1!==this.name.toLowerCase().indexOf(t.toLowerCase())?!0:!1},a.prototype._showEditorDialog=function(){var n=this,i=this._control._client,o=i.getNode(this._metaInfo[t.GME_ID]),s=o.getAttribute("documentation")||"Click to enter documentation.",a=new r;a.initialize(s,function(o){try{i.setAttribute(n._metaInfo[t.GME_ID],"documentation",o),n.$doc.empty(),n.$doc.append($(e(o)))}catch(r){n.logger.error("Saving META failed... Either not JSON object or something else went wrong...")}}),a.show()},a}),define("css!decorators/DocumentDecorator/PartBrowser/DocumentDecorator.PartBrowserWidget",[],function(){}),define("decorators/DocumentDecorator/PartBrowser/DocumentDecorator.PartBrowserWidget",["js/Constants","js/RegistryKeys","js/NodePropertyNames","js/Widgets/PartBrowser/PartBrowserWidget.DecoratorBase","../Core/DocumentDecorator.Core","js/Widgets/DiagramDesigner/DiagramDesignerWidget.Constants","text!../DiagramDesigner/DocumentDecorator.DiagramDesignerWidget.html","css!../DiagramDesigner/DocumentDecorator.DiagramDesignerWidget.css","css!./DocumentDecorator.PartBrowserWidget.css"],function(e,t,n,i,o,r,s){"use strict";var a,l="DocumentDecoratorPartBrowserWidget",c=$("<img>",{"class":"embeddedsvg"});return a=function(e){var t=_.extend({},e);i.apply(this,[t]),o.apply(this,[t]),this.logger.debug("DocumentDecoratorPartBrowserWidget ctor")},_.extend(a.prototype,i.prototype),_.extend(a.prototype,o.prototype),a.prototype.DECORATORID=l,a.prototype.$DOMBase=function(){var e=$(s);return e.find("."+r.CONNECTOR_CLASS).remove(),e}(),a.prototype.beforeAppend=function(){this.$el=this.$DOMBase.clone(),this.skinParts.$name=this.$el.find(".name"),this._renderContent()},a.prototype.afterAppend=function(){},a.prototype.update=function(){this._renderContent()},a.prototype._renderContent=function(){var t=this._control._client,i=t.getNode(this._metaInfo[e.GME_ID]);DEBUG&&this.$el.attr({"data-id":this._metaInfo[e.GME_ID]}),i&&this.skinParts.$name.text(i.getAttribute(n.Attributes.name)||""),this._updateColors(!0),this._updateSVG()},a.prototype._updateSVG=function(){var n,i=this._control._client,o=i.getNode(this._metaInfo[e.GME_ID]),r="",s=this;o&&(r=o.getRegistry(t.SVG_ICON)),r?(n=e.ASSETS_DECORATOR_SVG_FOLDER+r,this.skinParts.$imgSVG||(this.skinParts.$imgSVG=c.clone(),this.$el.append(this.skinParts.$imgSVG)),this.skinParts.$imgSVG.attr("src")!==n&&(this.skinParts.$imgSVG.on("load",function(){s.skinParts.$imgSVG.css("margin-top","5px"),s.skinParts.$imgSVG.off("load"),s.skinParts.$imgSVG.off("error")}),this.skinParts.$imgSVG.on("error",function(){s.skinParts.$imgSVG.css("margin-top","5px"),s.skinParts.$imgSVG.off("load"),s.skinParts.$imgSVG.off("error")}),this.skinParts.$imgSVG.attr("src",n))):this.skinParts.$imgSVG&&(this.skinParts.$imgSVG.remove(),this.skinParts.$imgSVG=void 0)},a}),define("decorators/DocumentDecorator/DocumentDecorator",["js/Decorators/DecoratorBase","./DiagramDesigner/DocumentDecorator.DiagramDesignerWidget","./PartBrowser/DocumentDecorator.PartBrowserWidget"],function(e,t,n){"use strict";var i,o=e,r=e.prototype,s="DocumentDecorator";return i=function(e){var t=_.extend({loggerName:this.DECORATORID},e);o.apply(this,[t]),this.logger.debug("DocumentDecorator ctor")},_.extend(i.prototype,r),i.prototype.DECORATORID=s,i.prototype.initializeSupportedWidgetMap=function(){this.supportedWidgetMap={DiagramDesigner:t,PartBrowser:n}},i}),define("text!decorators/MetaDecorator/DiagramDesigner/templates/MetaDecorator.DiagramDesignerWidget.html",[],function(){return'<div class="meta-decorator">\r\n    <div class="name"></div>\r\n    <div class="attributes-title">ATTRIBUTES\r\n        <div class="add-new-attribute" title="Add attribute...">+</div>\r\n    </div>\r\n    <ul class="attributes unstyled"></ul>\r\n    <div class="constraints-title">CONSTRAINTS\r\n        <div class="add-new-constraint" title="Add constraint...">+</div>\r\n    </div>\r\n    <ul class="constraints unstyled"></ul>\r\n    <div class="aspects-title">ASPECTS\r\n        <div class="add-new-aspect" title="Add aspect...">+</div>\r\n    </div>\r\n    <ul class="aspects unstyled"></ul>\r\n    <div class=\'connector bottom\'></div>\r\n    <div class=\'connector top\'></div>\r\n</div>'}),define("decorators/MetaDecorator/DiagramDesigner/Attribute",["js/logger"],function(e){"use strict";var t;return t=function(t){this.name=t.name,this.type=t.type,this._render(),this.logger=e.create("gme:decorators:MetaDecorator:DiagramDesigner:Attribute_"+this.name,WebGMEGlobal.gmeConfig.client.log),this.logger.debug("Created")},t.prototype._DOMAttributeBase=$('<div class="attr" data-name="__ID__"><span class="n"></span><span class="t"></span></div>'),t.prototype._render=function(){this.$el=this._DOMAttributeBase.clone(),this.$el.attr({"data-name":this.name,title:this.name}),this.$el.find(".n").text(this.name+":"),this.$el.find(".t").text(this.type)},t.prototype.destroy=function(){this.$el&&(this.$el.remove(),this.$el.empty())},t}),define("text!decorators/MetaDecorator/DiagramDesigner/templates/AttributeDetailsDialog.html",[],function(){return'<div class="attribute-details-dialog modal fade" tabindex="-1" role="dialog">\r\n    <div class="modal-dialog modal-lg">\r\n        <div class="modal-content">\r\n            <div class="modal-header">\r\n                <button type="button" class="close" data-dismiss="modal">×</button>\r\n                <h3>Edit attribute parameters...</h3>\r\n            </div>\r\n            <form class="modal-body form-horizontal" role="form">\r\n                <div class="form-group" id="pName">\r\n                    <label class="col-sm-4 control-label" for="inputName">Name</label>\r\n\r\n                    <div class="col-sm-8 controls">\r\n                        <input type="text" id="inputName" placeholder="Name">\r\n                    </div>\r\n                </div>\r\n                <div class="form-group">\r\n                    <label class="col-sm-4 control-label" for="inputType">Type</label>\r\n\r\n                    <div class="col-sm-8 controls">\r\n                        <select id="inputType">\r\n                            <option>string</option>\r\n                            <option>integer</option>\r\n                            <option>float</option>\r\n                            <option>boolean</option>\r\n                            <option>asset</option>\r\n                        </select>\r\n                    </div>\r\n                </div>\r\n                <div class="form-group" id="pDefaultValue">\r\n                    <label class="col-sm-4 control-label" for="inputDefaultValue">Default value</label>\r\n\r\n                    <div class="col-sm-8 controls">\r\n                        <input type="text" id="inputDefaultValue" placeholder="Default value">\r\n                    </div>\r\n                </div>\r\n                <div class="control-group" id="pDefaultValueBoolean">\r\n                    <label class="col-sm-4 control-label">Default value</label>\r\n\r\n                    <div class="col-sm-8 controls">\r\n                        <label class="radio inline">\r\n                            <input type="radio" name="rbBoolean" id="rbBooleanTrue" value="true" checked>\r\n                            TRUE\r\n                        </label>\r\n                        <label class="radio inline">\r\n                            <input type="radio" name="rbBoolean" id="rbBooleanFalse" value="false">\r\n                            FALSE\r\n                        </label>\r\n                    </div>\r\n                </div>\r\n                <div class="form-group" id="pRegExp">\r\n                    <label class="col-sm-4 control-label">Regular Expression</label>\r\n                    <div class="col-sm-8 controls">\r\n                        <input type="text" id="inputRegExp" title="No leading and trailing slash needed. Modifiers not allowed!">\r\n                    </div>\r\n                </div>\r\n                <div class="form-group" id="pRange">\r\n                    <label class="col-sm-4 control-label" for="inputDefaultValue">Inclusive Value Range</label>\r\n\r\n                    <div class="col-sm-8 controls">\r\n                        <input type="number" id="inputMinValue" placeholder="minimum">\r\n                        <input type="number" id="inputMaxValue" placeholder="maximum">\r\n                    </div>\r\n                </div>\r\n                <div class="form-group" id="pEnum">\r\n                    <label class="col-sm-4 control-label"></label>\r\n\r\n                    <div class="col-sm-8 controls">\r\n                        <label class="checkbox">\r\n                            <input type="checkbox" id="cbEnum" value="">\r\n                            Enumeration\r\n                        </label>\r\n                    </div>\r\n                </div>\r\n                <div id="pEnumValues" class="form-group">\r\n                    <label class="col-sm-4 control-label" for="inputEnumValues">Values</label>\r\n\r\n                    <div class="col-sm-8 controls">\r\n                        <textarea rows="3" id="inputEnumValues"\r\n                                  placeholder="Enter each value in separate line"></textarea>\r\n                    </div>\r\n                </div>\r\n            </form>\r\n            <div class="modal-footer">\r\n                <a href="#" class="btn btn-danger btn-delete pull-left">Delete</a>\r\n                <a href="#" class="btn btn-primary disabled btn-save">Save</a>\r\n                <a href="#" class="btn btn-default" data-dismiss="modal">Cancel</a>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>';
}),define("css!decorators/MetaDecorator/DiagramDesigner/styles/AttributeDetailsDialog",[],function(){}),define("decorators/MetaDecorator/DiagramDesigner/AttributeDetailsDialog",["js/util","common/regexp","text!./templates/AttributeDetailsDialog.html","css!./styles/AttributeDetailsDialog.css"],function(e,t,n){"use strict";var i,o="asset";return i=function(){},i.prototype.show=function(e,t,n,i){var o=this;this._initDialog(e,t,n,i),this._dialog.modal("show"),this._dialog.on("shown.bs.modal",function(){o._inputName.focus().trigger("keyup")}),this._dialog.on("hidden.bs.modal",function(){o._dialog.remove(),o._dialog.empty(),o._dialog=void 0})},i.prototype._initDialog=function(e,i,r,s){function a(e){var t=!0;try{new RegExp(e)}catch(n){t=!1}return t}var l,c,d,h,p,g=this;l=function(){var e,t,n,i,s={name:g._inputName.val(),type:g._inputType.val(),defaultValue:g._inputDefaultValue.val(),isEnum:g._cbEnum.is(":checked")};if(s.isEnum&&(s.enumValues=g._inputEnumValues.val().split("\n")),"integer"===s.type||"float"===s.type){if(s.defaultValue=p(s.defaultValue,s.type),s.enumValues)for(n=s.enumValues.slice(0),s.enumValues=[],t=n.length,e=0;t>e;e+=1)i=p(n[e],s.type),i&&s.enumValues.push(i);p(g._pRangeMax.val(),s.type)&&(s.max=p(g._pRangeMax.val(),s.type)),p(g._pRangeMin.val(),s.type)&&(s.min=p(g._pRangeMin.val(),s.type))}else"boolean"===s.type?(s.defaultValue=g._el.find("#rbBooleanTrue").first().is(":checked"),delete s.isEnum):s.type===o?(s.defaultValue="",delete s.isEnum):"string"===s.type&&g._pRegExpValue.val()&&(s.regexp=g._pRegExpValue.val());g._dialog.modal("hide"),r&&r.call(g,s)},c=function(){g._dialog.modal("hide"),s&&s.call(g)},p=function(e,t){var n;switch(t){case"integer":n=parseInt(e,10),isNaN(n)&&(n=0);break;case"float":n=parseFloat(e,10),isNaN(n)&&(n=0);break;case"boolean":}return n},h=function(e){switch(g._pDefaultValue.show(),g._pEnum.show(),g._cbEnum.is(":checked")&&g._pEnumValues.show(),g._pDefaultValueBoolean.hide(),e){case"integer":g._pRegExp.hide(),g._pRange.show();break;case"float":g._pRange.show(),g._pRegExp.hide();break;case"boolean":g._pDefaultValue.hide(),g._pEnum.hide(),g._pEnumValues.hide(),g._pDefaultValueBoolean.show(),g._pRegExp.hide(),g._pRange.hide();break;case o:g._pDefaultValue.hide(),g._pEnum.hide(),g._pEnumValues.hide(),g._pRegExp.hide(),g._pRange.hide();break;default:g._pRegExp.show(),g._pRange.hide()}},d=function(e){return!(""===e||"name"===e||-1!==i.indexOf(e)||t.DOCUMENT_KEY.test(e)===!1)},this._dialog=$(n),this._el=this._dialog.find(".modal-body").first(),this._cbEnum=this._el.find("#cbEnum").first(),this._pEnum=this._el.find("#pEnum").first(),this._pEnumValues=this._el.find("#pEnumValues").first(),this._pEnumValues.hide(),this._btnSave=this._dialog.find(".btn-save").first(),this._btnDelete=this._dialog.find(".btn-delete").first(),this._inputName=this._el.find("#inputName").first(),this._inputType=this._el.find("#inputType").first(),this._inputDefaultValue=this._el.find("#inputDefaultValue").first(),this._pDefaultValue=this._el.find("#pDefaultValue").first(),this._pDefaultValueBoolean=this._el.find("#pDefaultValueBoolean").first(),this._pDefaultValueBoolean.hide(),this._inputEnumValues=this._el.find("#inputEnumValues").first(),this._pRegExp=this._el.find("#pRegExp"),this._pRegExpValue=this._el.find("#inputRegExp"),this._pRange=this._el.find("#pRange"),this._pRangeMin=this._el.find("#inputMinValue"),this._pRangeMax=this._el.find("#inputMaxValue"),this._inputName.on("keyup",function(){var e=g._inputName.val();d(e)?(g._inputName.removeClass("text-danger"),g._btnSave.disable(!1),g._btnDelete.disable(!1)):(g._inputName.addClass("text-danger"),g._btnSave.disable(!0),g._btnDelete.disable(!0))}),this._pRegExpValue.on("keyup",function(){var e=g._pRegExpValue.val();a(e)?(g._pRegExpValue.removeClass("text-danger"),g._btnSave.disable(!1),g._btnDelete.disable(!1)):(g._pRegExpValue.addClass("text-danger"),g._btnSave.disable(!0),g._btnDelete.disable(!0))}),this._inputName.on("keydown",function(e){var t=13===e.which,n=g._inputName.val();t&&d(n)&&(l(),e.stopPropagation(),e.preventDefault())}),this._cbEnum.on("change",null,function(){var e=$(this).is(":checked");e?(g._pEnumValues.show(),g._pRange.hide(),g._pRangeMax.val(""),g._pRangeMin.val(""),g._pRegExp.hide(),g._pRegExpValue.val("")):(g._pEnumValues.hide(),g._inputEnumValues.val(""),"float"===g._inputType.val()||"integer"===g._inputType.val()?g._pRange.show():"string"===g._inputType.val()&&g._pRegExp.show())}),this._inputType.on("change",null,function(){h(g._inputType.val())}),this._btnSave.on("click",function(e){var t=g._inputName.val();e.stopPropagation(),e.preventDefault(),d(t)&&l()}),s?this._btnDelete.on("click",function(e){e.stopPropagation(),e.preventDefault(),c()}):this._btnDelete.remove(),this._inputName.val(e.name),this._inputType.val(e.type),"boolean"===e.type?(this._pDefaultValue.hide(),this._pEnum.hide(),this._pDefaultValueBoolean.show(),this._pRange.hide(),this._pRegExp.hide(),e.defaultValue!==!0&&this._el.find("#rbBooleanFalse").first().attr("checked","checked")):e.type===o?(this._pDefaultValue.hide(),this._pEnum.hide(),this._pRange.hide(),this._pRegExp.hide()):(this._inputDefaultValue.val(e.defaultValue),e.isEnum&&(this._cbEnum.attr("checked",!0),this._inputEnumValues.val(e.enumValues.join("\n")),this._pEnumValues.show()),"string"===e.type?(this._pRange.hide(),this._pRegExp.show(),e.regexp&&this._pRegExpValue.val(e.regexp)):(this._pRange.show(),this._pRegExp.hide(),e.min&&this._pRangeMin.val(e.min),e.max&&this._pRangeMax.val(e.max)))},i}),define("text!decorators/MetaDecorator/DiagramDesigner/templates/ConstraintDetailsDialog.html",[],function(){return'<div class="constraint-details-dialog modal fade" tabindex="-1" role="dialog">\r\n    <div class="modal-dialog modal-lg">\r\n        <div class="modal-content">\r\n            <div class="modal-header">\r\n                <button type="button" class="close" data-dismiss="modal">×</button>\r\n                <h3>Edit constraint parameters...</h3>\r\n            </div>\r\n            <form class="modal-body form-horizontal" role="form">\r\n                <div class="form-group" id="pName">\r\n                    <label class="col-sm-4 control-label" for="inputName">Name</label>\r\n\r\n                    <div class="col-sm-8 controls">\r\n                        <input type="text" class="info-input" id="inputName" placeholder="Name">\r\n                    </div>\r\n                </div>\r\n                <div class="form-group" id="pScript">\r\n                    <label class="col-sm-4 control-label">Script</label>\r\n\r\n                    <div class="col-sm-8 controls">\r\n                    </div>\r\n                </div>\r\n                <div class="form-group" id="pMessage">\r\n                    <label class="col-sm-4 control-label" for="inputMessage">Info</label>\r\n\r\n                    <div class="col-sm-8 controls">\r\n                        <input type="text" class="input-xxlarge info-input" id="inputMessage"\r\n                               placeholder="Info about the constraint...">\r\n                    </div>\r\n                </div>\r\n                <!--\r\n                <div class="form-group" id="pPriority">\r\n                    <label class="col-sm-4 control-label" for="inputPriority">Priority</label>\r\n                    <div class="col-sm-8 controls">\r\n                        <input type="text" id="inputPriority" placeholder="Priority">\r\n                    </div>\r\n                </div>\r\n                -->\r\n            </form>\r\n            <div class="modal-footer">\r\n                <a href="#" class="btn btn-danger btn-delete pull-left">Delete</a>\r\n                <a href="#" class="btn btn-primary disabled btn-save">Save</a>\r\n                <a href="#" class="btn btn-default" data-dismiss="modal">Cancel</a>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>'}),define("css!decorators/MetaDecorator/DiagramDesigner/styles/ConstraintDetailsDialog",[],function(){}),define("decorators/MetaDecorator/DiagramDesigner/ConstraintDetailsDialog",["js/util","text!./templates/ConstraintDetailsDialog.html","common/regexp","codemirror/lib/codemirror","codemirror/mode/javascript/javascript","css!./styles/ConstraintDetailsDialog.css"],function(e,t,n,i){"use strict";var o;return o=function(){},o.prototype.show=function(e,t,n,i){var o=this;this._initDialog(e,t,n,i),this._dialog.modal("show"),this._dialog.on("shown.bs.modal",function(){o._codeMirror.refresh(),o._inputName.focus().trigger("keyup")}),this._dialog.on("hidden.bs.modal",function(){o._dialog.remove(),o._dialog.empty(),o._dialog=void 0})},o.prototype._initDialog=function(e,o,r,s){var a,l,c,d=this;a=function(){var e={name:d._inputName.val(),script:d._codeMirror.getValue(),priority:d._inputPriority.val(),info:d._inputMessage.val()};d._dialog.modal("hide"),r&&r.call(d,e)},l=function(){d._dialog.modal("hide"),s&&s.call(d)},c=function(e){return!(""===e||-1!==o.indexOf(e)||n.DOCUMENT_KEY.test(e)===!1)},this._dialog=$(t),this._el=this._dialog.find(".modal-body").first(),this._btnSave=this._dialog.find(".btn-save").first(),this._btnDelete=this._dialog.find(".btn-delete").first(),this._pScript=this._el.find("#pScript").first(),this._scriptEditor=this._pScript.find("div.controls").first(),this._inputName=this._el.find("#inputName").first(),this._inputPriority=this._el.find("#inputPriority").first(),this._inputMessage=this._el.find("#inputMessage").first(),this._inputName.on("keyup",function(){var e=d._inputName.val();c(e)?(d._inputName.removeClass("text-danger"),d._btnSave.disable(!1)):(d._inputName.addClass("text-danger"),d._btnSave.disable(!0))}),this._inputName.on("keydown",function(e){var t=13===e.which,n=d._inputName.val();t&&c(n)&&(a(),e.stopPropagation(),e.preventDefault())}),this._btnSave.on("click",function(e){var t=d._inputName.val();e.stopPropagation(),e.preventDefault(),c(t)&&a()}),s?this._btnDelete.on("click",function(e){e.stopPropagation(),e.preventDefault(),l()}):this._btnDelete.remove(),this._inputName.val(e.name).focus(),this._inputMessage.val(e.info),this._codeMirror=i(this._scriptEditor[0],{value:e.script,mode:"javascript"})},o}),define("decorators/MetaDecorator/DiagramDesigner/Constraint",["js/logger"],function(e){"use strict";var t;return t=function(t){this.name=t.name,this.script=t.script,this.info=t.info,this._render(),this.logger=e.create("gme:decorators:MetaDecorator:DiagramDesigner:Constraint_"+this.name,WebGMEGlobal.gmeConfig.client.log),this.logger.debug("Created")},t.prototype._DOMConstraintBase=$('<div class="const" data-name="__ID__"><span class="n"></span><span class="t"></span></div>'),t.prototype._render=function(){this.$el=this._DOMConstraintBase.clone(),this.$el.attr({"data-name":this.name,title:this.name+", info: "+this.info}),this.$el.find(".n").text(this.name),this.$el.find(".i").text(this.info)},t.prototype.update=function(e){this.name=e.name,this.script=e.script,this.info=e.info,this._render()},t.prototype.destroy=function(){this.$el&&(this.$el.remove(),this.$el.empty())},t}),define("decorators/MetaDecorator/DiagramDesigner/MetaDecorator.DiagramDesignerWidget.Constraints",["js/Constants","./ConstraintDetailsDialog","./Constraint"],function(e,t,n){"use strict";var i,o=["/**"," * To be called when the constraint has been evaluated."," * @callback constraintCallback"," * @param {string|Error} err - Should be null unless unexpected execution errors."," * @param {object} result - Result of the constraint evaluation."," * @param {boolean} result.hasViolation - Set to true if there were violations."," * @param {string} [result.message] - Message to display in case of violation."," */","","/**"," * The function defining the constraint."," * @param {Core} core - API for retrieving data about the node."," * @param {Node} node - The node being checked."," * @param {constraintCallback} callback"," */","function (core, node, callback) {","    var result = {hasViolation: false, message: ''};","    // Here goes the constraint checking..","    callback(null, result)","}"].join("\n");return i=function(){},i.prototype._renderContentConstraints=function(){var n=this._control._client,i=n.getNode(this._metaInfo[e.GME_ID]),o=this;this._constraintNames=[],this._constraints={},this._skinParts.$constraintsContainer=this.$el.find(".constraints"),this._skinParts.$addConstraintContainer=this.$el.find(".add-new-constraint"),this._skinParts.$constraintsContainer.on("dblclick","li",function(e){if(o.hostDesignerItem.canvas.getIsReadOnlyMode()!==!0){var n=$(this).find(".n").text().replace(":",""),r=o._constraintNames.slice(0),s=new t,a=_.extend({},i.getConstraint(n));a.name=n,r.splice(o._constraintNames.indexOf(n),1),s.show(a,r,function(e){o.saveConstraintDescriptor(n,e)},function(){o.deleteConstraintDescriptor(n)})}e.stopPropagation(),e.preventDefault()}),this._skinParts.$addConstraintContainer.on("click",null,function(e){o.hostDesignerItem.canvas.getIsReadOnlyMode()!==!0&&o._onNewConstraintClick(),e.stopPropagation(),e.preventDefault()})},i.prototype._onNewConstraintClick=function(){this._onNewClick(this._constraintNames,this._skinParts.$constraintsContainer,this._skinParts.$addConstraintContainer,this._skinParts.$constraintsTitle,this._onNewConstraintCreate)},i.prototype._updateConstraints=function(){var t,n,i,o=this._control._client,r=o.getNode(this._metaInfo[e.GME_ID]),s=r?r.getOwnConstraintNames():[],a=this._constraintNames.slice(0),l=$("<li/>");for(n=_.difference(a,s),t=n.length;t--;)this._removeConstraint(n[t]);for(n=_.difference(s,a),t=n.length;t--;)this._addConstraint(n[t]);for(n=_.intersection(s,a),t=n.length;t--;)this._updateConstraint(n[t]);for(this._constraintNames.sort(),this._skinParts.$constraintsContainer.empty(),t=this._constraintNames.length,i=0;t>i;i+=1)this._skinParts.$constraintsContainer.append(l.clone().append(this._constraints[this._constraintNames[i]].$el))},i.prototype._addConstraint=function(t){var i=this._control._client,o=i.getNode(this._metaInfo[e.GME_ID]),r=o.getConstraint(t);r&&(r.name=t,this._constraints[t]=new n(r),this._constraintNames.push(t))},i.prototype._updateConstraint=function(t){var n=this._control._client,i=n.getNode(this._metaInfo[e.GME_ID]),o=i.getConstraint(t);o&&(o.name=t,this._constraints[t].update(o))},i.prototype._removeConstraint=function(e){var t=this._constraintNames.indexOf(e);-1!==t&&(this._constraints[e].destroy(),delete this._constraints[e],this._constraintNames.splice(t,1))},i.prototype._onNewConstraintCreate=function(e){var n,i=this,r=this._constraintNames.slice(0),s=new t;this.logger.debug("_onNewConstraintCreate: "+e),r.splice(this._constraintNames.indexOf(e),1),n={name:e,script:o,info:""},s.show(n,r,function(t){i.saveConstraintDescriptor(e,t)})},i.prototype.saveConstraintDescriptor=function(t,n){var i=this._control._client,o=this._metaInfo[e.GME_ID];i.startTransaction(),t!==n.name&&i.delConstraint(o,t),i.setConstraint(o,n.name,n),i.completeTransaction()},i.prototype.deleteConstraintDescriptor=function(t){var n=this._control._client,i=this._metaInfo[e.GME_ID];n.startTransaction(),n.delConstraint(i,t),n.completeTransaction()},i}),define("text!decorators/MetaDecorator/DiagramDesigner/templates/AspectDetailsDialog.html",[],function(){return'<div class="aspect-details-dialog modal fade" tabindex="-1" role="dialog">\r\n    <div class="modal-dialog modal-lg">\r\n        <div class="modal-content">\r\n            <div class="modal-header">\r\n                <button type="button" class="close" data-dismiss="modal">×</button>\r\n                <h3>Edit aspect parameters...</h3>\r\n            </div>\r\n            <form class="modal-body form-horizontal" role="form">\r\n                <div class="form-group" id="pName">\r\n                    <label class="col-sm-4 control-label" for="inputName">Name</label>\r\n\r\n                    <div class="col-sm-8 controls">\r\n                        <input type="text" id="inputName" placeholder="Name">\r\n                    </div>\r\n                </div>\r\n                <div class="form-group" id="pTypes">\r\n                    <label class="col-sm-4 control-label">Types</label>\r\n\r\n                    <div class="col-sm-8 controls">\r\n                    </div>\r\n                </div>\r\n            </form>\r\n            <div class="modal-footer">\r\n                <a href="#" class="btn btn-danger btn-delete pull-left">Delete</a>\r\n                <a href="#" class="btn btn-primary btn-save">Save</a>\r\n                <a href="#" class="btn btn-default" data-dismiss="modal">Cancel</a>\r\n            </div>\r\n        </div>\r\n    </div>\r\n</div>'}),define("css!decorators/MetaDecorator/DiagramDesigner/styles/AspectDetailsDialog",[],function(){}),define("decorators/MetaDecorator/DiagramDesigner/AspectDetailsDialog",["js/util","js/Constants","common/regexp","text!./templates/AspectDetailsDialog.html","css!./styles/AspectDetailsDialog.css"],function(e,t,n,i){"use strict";var o,r={name:void 0,items:[]},s=$('<label class="checkbox"><input type="checkbox"></label>'),a="typeid";return o=function(){},o.prototype.show=function(e,t,n,i){var o=this;this._initDialog(e,t,n,i),this._dialog.modal("show"),this._dialog.on("hidden.bs.modal",function(){o._dialog.remove(),o._dialog.empty(),o._dialog=void 0})},o.prototype._initDialog=function(e,o,l,c){var d,h,p,g,u,f,m,b,y,v=this,C={};_.extend(C,r),_.extend(C,e),d=function(){var e={},t=E.find("input[type=checkbox]:checked");_.extend(e,r),e.name=v._inputName.val(),e.items=[],t.each(function(){e.items.push($(this).data(a))}),v._dialog.modal("hide"),l&&l.call(v,e)},h=function(){v._dialog.modal("hide"),c&&c.call(v)},p=function(e){return!(""===e||-1!==o.indexOf(e)||e.toLowerCase()===t.ASPECT_ALL.toLowerCase()||n.DOCUMENT_KEY.test(e)===!1)},y=function(){var e=E.find("input[type=checkbox]:checked");e.length>0&&p(v._inputName.val())?v._btnSave.disable(!1):v._btnSave.disable(!0)},this._dialog=$(i),this._el=this._dialog.find(".modal-body").first(),this._btnSave=this._dialog.find(".btn-save").first(),this._btnDelete=this._dialog.find(".btn-delete").first(),this._pTypes=this._el.find("#pTypes").first();var E=this._pTypes.find(".controls");for(this._inputName=this._el.find("#inputName").first(),this._inputName.on("keyup",function(){var e=v._inputName.val();if(p(e)){v._inputName.removeClass("text-danger");var t=E.find("input[type=checkbox]:checked");t.length>0&&v._btnSave.disable(!1)}else v._inputName.addClass("text-danger"),v._btnSave.disable(!0)}),this._inputName.on("keydown",function(e){var t=13===e.which,n=v._inputName.val();t&&p(n)&&(d(),e.stopPropagation(),e.preventDefault())}),this._btnSave.on("click",function(e){var t=v._inputName.val();e.stopPropagation(),e.preventDefault(),$(this).hasClass("disabled")===!1&&p(t)&&d()}),c?this._btnDelete.on("click",function(e){e.stopPropagation(),e.preventDefault(),h()}):this._btnDelete.remove(),this._inputName.val(e.name).focus(),g=0;g<C.validChildrenTypes.length;g+=1)f=C.validChildrenTypes[g],m=f.name,u=s.clone(),u.append(m),b=u.find("input[type=checkbox]"),b.data(a,f.id),-1!==C.items.indexOf(f.id)&&b.prop("checked",!0),E.append(u);this._pTypes.on("change","input[type=checkbox]",function(){y()}),y()},o}),define("decorators/MetaDecorator/DiagramDesigner/Aspect",["js/logger"],function(e){"use strict";var t;return t=function(t){this.name=t.name,this.itemNum=t.items?t.items.length:0,this._render(),this.logger=e.create("gme:decorators:MetaDecorator:DiagramDesigner:Aspect_"+this.name,WebGMEGlobal.gmeConfig.client.log),this.logger.debug("Created")},t.prototype._DOMAspectBase=$('<div class="aspect" data-name="__ID__"><span class="n"></span><span class="t"></span></div>'),t.prototype._render=function(){this.$el=this._DOMAspectBase.clone(),this.$el.attr({"data-name":this.name,title:this.name+", types: "+this.itemNum}),this.$el.find(".n").text(this.name+":"),this.$el.find(".t").text(this.itemNum)},t.prototype.update=function(e){this.name=e.name,this.itemNum=e.items?e.items.length:0,this._render()},t.prototype.destroy=function(){this.$el&&(this.$el.remove(),this.$el.empty())},t}),define("decorators/MetaDecorator/DiagramDesigner/MetaDecorator.DiagramDesignerWidget.Aspects",["js/Constants","js/Utils/GMEConcepts","js/NodePropertyNames","./AspectDetailsDialog","./Aspect"],function(e,t,n,i,o){"use strict";var r;return r=function(){},r.prototype._renderContentAspects=function(){var t=this._control._client,n=this._metaInfo[e.GME_ID],o=this;this._aspectNames=[],this._aspects={},this._skinParts.$aspectsContainer=this.$el.find(".aspects"),this._skinParts.$addAspectContainer=this.$el.find(".add-new-aspect"),this._skinParts.$aspectsContainer.on("dblclick","li",function(e){if(o.hostDesignerItem.canvas.getIsReadOnlyMode()!==!0){var r=$(this).find(".n").text().replace(":",""),s=t.getNode(n),a=s.getSetNames(),l=new i,c={items:s.getAspectMeta(r)};c.name=r,c.validChildrenTypes=o._getAspectDescriptorValidChildrenTypes(),-1!==a.indexOf(r)&&a.splice(a.indexOf(r),1),l.show(c,a,function(e){o.saveAspectDescriptor(r,e)},function(){o.deleteAspectDescriptor(r)})}e.stopPropagation(),e.preventDefault()}),this._skinParts.$addAspectContainer.on("click",null,function(e){o.hostDesignerItem.canvas.getIsReadOnlyMode()!==!0&&o._onNewAspectClick(),e.stopPropagation(),e.preventDefault()})},r.prototype._onNewAspectClick=function(){var t=this._control._client,n=this._metaInfo[e.GME_ID],i=t.getNode(n),o=[e.ASPECT_ALL].concat(i.getSetNames());this._onNewClick(o,this._skinParts.$aspectsContainer,this._skinParts.$addAspectContainer,this._skinParts.$aspectsTitle,this._onNewAspectCreate)},r.prototype._updateAspects=function(){var t,n,i,o=this._control._client,r=this._metaInfo[e.GME_ID],s=o.getNode(r),a=s?s.getOwnValidAspectNames():[],l=this._aspectNames.slice(0),c=$("<li/>");for(n=_.difference(l,a),t=n.length;t--;)this._removeAspect(n[t]);for(n=_.difference(a,l),t=n.length;t--;)this._addAspect(n[t]);for(n=_.intersection(a,l),t=n.length;t--;)this._updateAspect(n[t]);for(this._aspectNames.sort(),this._skinParts.$aspectsContainer.empty(),t=this._aspectNames.length,i=0;t>i;i+=1)this._skinParts.$aspectsContainer.append(c.clone().append(this._aspects[this._aspectNames[i]].$el))},r.prototype._addAspect=function(t){var n=this._control._client,i=this._metaInfo[e.GME_ID],r=n.getNode(i),s=r&&r.getAspectMeta(t);s&&(s={items:s},s.name=t,this._aspects[t]=new o(s),this._aspectNames.push(t))},r.prototype._updateAspect=function(t){var n=this._control._client,i=this._metaInfo[e.GME_ID],o=n.getNode(i),r=o&&o.getAspectMeta(t);r&&(r={items:r},r.name=t,this._aspects[t].update(r))},r.prototype._removeAspect=function(e){var t=this._aspectNames.indexOf(e);-1!==t&&(this._aspects[e].destroy(),delete this._aspects[e],this._aspectNames.splice(t,1))},r.prototype._onNewAspectCreate=function(t){var n,o=this,r=this._control._client,s=this._metaInfo[e.GME_ID],a=r.getNode(s),l=a.getSetNames(),c=new i;this.logger.debug("_onNewAspectCreate: "+t),-1!==l.indexOf(t)&&l.splice(l.indexOf(t),1),n={name:t,items:[],validChildrenTypes:this._getAspectDescriptorValidChildrenTypes()},c.show(n,l,function(e){o.saveAspectDescriptor(t,e)})},r.prototype._getAspectDescriptorValidChildrenTypes=function(){var i,o,r,s,a=this._metaInfo[e.GME_ID],l=[],c=this._control._client;for(o=t.getMETAAspectMergedValidChildrenTypes(a),i=o.length;i--;)s={id:o[i],name:o[i]},r=c.getNode(o[i]),r&&(s.name=r.getAttribute(n.Attributes.name)),l.push(s);return l.sort(function(e,t){var n=e.name.toLowerCase(),i=t.name.toLowerCase(),o=e.id,r=t.id;return i>n?-1:n>i?1:r>o?-1:1}),l},r.prototype.saveAspectDescriptor=function(t,n){var i=this._control._client,o=this._metaInfo[e.GME_ID];i.startTransaction(),t!==n.name&&(i.delAspectMeta(o,t),i.deleteSet(o,t)),i.setAspectMetaTargets(o,n.name,n.items||[]),i.createSet(o,n.name),i.completeTransaction()},r.prototype.deleteAspectDescriptor=function(t){var n=this._control._client,i=this._metaInfo[e.GME_ID];n.startTransaction(),n.delAspectMeta(i,t),n.deleteSet(i,t),n.completeTransaction()},r}),define("text!decorators/MetaDecorator/DiagramDesigner/templates/MetaTextEditorDialog.html",[],function(){return'<div class="meta-text-editor-dialog modal fade" tabindex="-1" role="dialog">\r\n    <div class="modal-dialog modal-lg">\r\n        <div class="modal-content">\r\n            <div class="modal-header">\r\n                <button type="button" class="close" data-dismiss="modal">×</button>\r\n                <h3 id="pHeader"></h3>\r\n            </div>\r\n            <div id="pMeta"></div>\r\n        </div>\r\n    </div>\r\n</div>'}),define("css!decorators/MetaDecorator/DiagramDesigner/styles/MetaTextEditorDialog",[],function(){}),define("decorators/MetaDecorator/DiagramDesigner/MetaTextEditorDialog",["js/util","text!./templates/MetaTextEditorDialog.html","codemirror/lib/codemirror","codemirror/mode/javascript/javascript","css!./styles/MetaTextEditorDialog.css"],function(e,t,n){"use strict";var i;return i=function(){},i.prototype.show=function(e,t){var n=this;this._initDialog(e,t),this._dialog.modal("show"),this._dialog.on("shown.bs.modal",function(){n._codeMirror.refresh(),n._codeMirror.focus()}),this._dialog.on("hidden.bs.modal",function(){n._dialog.remove(),n._dialog.empty(),n._dialog=void 0})},i.prototype._initDialog=function(e,i){this._dialog=$(t),this._pMeta=this._dialog.find("#pMeta").first(),this._pHeader=this._dialog.find("#pHeader").first(),this._pHeader[0]&&e&&(this._pHeader[0].innerHTML="META definition of ["+e.getAttribute("name")+"]"),this._codeMirror=n(this._pMeta[0],{value:i,mode:"javascript",readOnly:!0})},i}),define("css!decorators/MetaDecorator/DiagramDesigner/styles/MetaDecorator.DiagramDesignerWidget",[],function(){}),define("decorators/MetaDecorator/DiagramDesigner/MetaDecorator.DiagramDesignerWidget",["js/Constants","js/NodePropertyNames","js/RegistryKeys","../../DefaultDecorator/DiagramDesigner/DefaultDecorator.DiagramDesignerWidget","text!./templates/MetaDecorator.DiagramDesignerWidget.html","./Attribute","./AttributeDetailsDialog","js/Panels/MetaEditor/MetaRelations","./MetaDecorator.DiagramDesignerWidget.Constraints","./MetaDecorator.DiagramDesignerWidget.Aspects","./MetaTextEditorDialog","common/regexp","css!./styles/MetaDecorator.DiagramDesignerWidget.css"],function(e,t,n,i,o,r,s,a,l,c,d,h){"use strict";var p,g="MetaDecorator",u="abstract",f=$('<i class="glyphicon glyphicon-cog text-meta"/>'),m=$('<i class="glyphicon glyphicon-lock meta-lock"/>');return p=function(e){var t=_.extend({},e);i.apply(this,[t]),this.name="",this._attributeNames=[],this._attributes={},this._inLibrary=!1,this._skinParts={$name:void 0,$attributesContainer:void 0,$addAttributeContainer:void 0,$constraintsContainer:void 0,$addConstraintContainer:void 0,$aspectsContainer:void 0,$addAspectContainer:void 0,$attributesTitle:void 0,$constraintsTitle:void 0,$aspectsTitle:void 0},this.logger.debug("MetaDecorator ctor")},_.extend(p.prototype,i.prototype),p.prototype.DECORATORID=g,_.extend(p.prototype,l.prototype),_.extend(p.prototype,c.prototype),p.prototype.$DOMBase=$(o),p.prototype.on_addTo=function(){var t=this,n=t._control._client.getNode(t._metaInfo[e.GME_ID]);n&&(n.isLibraryElement()||n.isLibraryRoot())&&(t._inLibrary=!0),this._renderContent(),t._inLibrary?this.readOnlyMode(!0):this._skinParts.$name.on("dblclick.editOnDblClick",null,function(e){t.hostDesignerItem.canvas.getIsReadOnlyMode()!==!0&&$(this).editInPlace({"class":"",onChange:function(e,n){t._onNodeTitleChanged(e,n)}}),e.stopPropagation(),e.preventDefault()}),this._skinParts.$addAttributeContainer.on("click",null,function(e){t.hostDesignerItem.canvas.getIsReadOnlyMode()!==!0&&t._onNewAttributeClick(),e.stopPropagation(),e.preventDefault()})},p.prototype._renderContent=function(){var n=this._control._client,i=this;this.$el.attr({"data-id":this._metaInfo[e.GME_ID]}),this._skinParts.$name=this.$el.find(".name"),this._skinParts.$attributesContainer=this.$el.find(".attributes"),this._skinParts.$addAttributeContainer=this.$el.find(".add-new-attribute"),this._skinParts.$attributesTitle=this.$el.find(".attributes-title"),this._skinParts.$constraintsTitle=this.$el.find(".constraints-title"),this._skinParts.$aspectsTitle=this.$el.find(".aspects-title"),this._skinParts.$attributesContainer.on("dblclick","li",function(o){if(i.hostDesignerItem.canvas.getIsReadOnlyMode()!==!0){var r,a=$(this).find(".n").text().replace(":",""),l=new s,c=n.getNode(i._metaInfo[e.GME_ID]),d=c.getAttributeMeta(a)||{},h=c.getAttribute(a),p=_.extend({},{name:a,type:d.type,defaultValue:h,min:d.min,max:d.max,regexp:d.regexp});if(a===t.Attributes.name)return;if(d["enum"]&&d["enum"].length>0){p.isEnum=!0,p.enumValues=[];for(var g=0;g<d["enum"].length;g++)p.enumValues.push(d["enum"][g])}else p.isMeta=!1;r=c.getOwnValidAttributeNames(),r.splice(r.indexOf(a),1),l.show(p,r,function(e){i.saveAttributeDescriptor(a,e)},function(){i.deleteAttributeDescriptor(a)})}o.stopPropagation(),o.preventDefault()}),this._renderContentConstraints(),this._renderContentAspects(),this._skinParts.$textMetaEditorBtn=f.clone(),this._skinParts.$textMetaLock=m.clone(),this.$el.append(this._skinParts.$textMetaEditorBtn),this._skinParts.$textMetaEditorBtn.on("click",function(e){i.hostDesignerItem.canvas.getIsReadOnlyMode()!==!0&&i._showMetaTextEditorDialog(),e.stopPropagation(),e.preventDefault()}),this.$el.append(this._skinParts.$textMetaLock),this._skinParts.$textMetaLock.hide(),this.hostDesignerItem.canvas.getIsReadOnlyMode()===!0&&(this._skinParts.$addAttributeContainer.detach(),this._skinParts.$addConstraintContainer.detach(),this._skinParts.$addAspectContainer.detach()),this.update()},p.prototype.update=function(){var t=this._control._client,n=t.getNode(this._metaInfo[e.GME_ID]),i="";n&&(i=n.getFullyQualifiedName(),this.name!==i&&(this.name=i,this._refreshName()),this._updateColors(),this._updateAttributes(),this._updateConstraints(),this._updateAbstract(),this._updateAspects())},p.prototype._updateColors=function(){this._getNodeColorsFromRegistry(),this.fillColor?this.$el.css({"background-color":this.fillColor}):this.$el.css({"background-color":""}),this.borderColor?(this.$el.css({"border-color":this.borderColor}),this._skinParts.$name.css({"border-color":this.borderColor})):(this.$el.css({"border-color":"","box-shadow":""}),this._skinParts.$name.css({"border-color":""})),this.textColor?this.$el.css({color:this.textColor}):this.$el.css({color:""})},p.prototype._getNodeColorsFromRegistry=function(){var t=this._metaInfo[e.GME_ID];this.fillColor=this.preferencesHelper.getRegistry(t,n.COLOR,!1),this.borderColor=this.preferencesHelper.getRegistry(t,n.BORDER_COLOR,!1),this.textColor=this.preferencesHelper.getRegistry(t,n.TEXT_COLOR,!1)},p.prototype._refreshName=function(){this._skinParts.$name.text(this.name),this._skinParts.$name.attr("title",this.name)},p.prototype._updateAbstract=function(){var t=this._control._client,i=t.getNode(this._metaInfo[e.GME_ID]);i&&i.getRegistry(n.IS_ABSTRACT)===!0?this.$el.addClass(u):this.$el.removeClass(u)},p.prototype._updateAttributes=function(){var t,n,i=this._control._client,o=i.getNode(this._metaInfo[e.GME_ID]),r=o?o.getOwnValidAttributeNames():[],s=this._attributeNames.slice(0),a=$("<li/>");for(t=s.length;t--;)this._removeAttribute(s[t]);for(t=r.length;t--;)this._addAttribute(r[t]);for(this._attributeNames.sort(),this._skinParts.$attributesContainer.empty(),t=this._attributeNames.length,n=0;t>n;n+=1)this._skinParts.$attributesContainer.append(a.clone().append(this._attributes[this._attributeNames[n]].$el))},p.prototype._addAttribute=function(t){var n,i=this._control._client,o=i.getNode(this._metaInfo[e.GME_ID]);o&&(n=o.getAttributeMeta(t)||{}),n&&(this._attributes[t]=new r({name:t,type:n.type||"null"}),this._attributeNames.push(t))},p.prototype._removeAttribute=function(e){var t=this._attributeNames.indexOf(e);-1!==t&&(this._attributes[e].destroy(),delete this._attributes[e],this._attributeNames.splice(t,1))},p.prototype.destroy=function(){for(var e=this._attributeNames.length;e--;)this._removeAttribute(this._attributeNames[e])},p.prototype._onNodeTitleChanged=function(n,i){
var o=this._control._client;o.setAttribute(this._metaInfo[e.GME_ID],t.Attributes.name,i)},p.prototype._onNewAttributeClick=function(){var t=this._control._client,n=this._metaInfo[e.GME_ID],i=t.getNode(n),o=i?i.getOwnValidAttributeNames():[];this._onNewClick(o,this._skinParts.$attributesContainer,this._skinParts.$addAttributeContainer,this._skinParts.$attributesTitle,this._onNewAttributeCreate)},p.prototype._onNewClick=function(e,t,n,i,o){var r,s,a,l,c,d=t.width(),h=this;n.detach(),l=function(){c.remove(),i.append(n)},s=function(){l()},a=function(){var t=r.val();h._isValidName(t,e)&&(_.isFunction(o)&&o.call(h,t),l())},c=$("<div/>",{"class":"control-group"}),r=$("<input/>",{type:"text","class":"new-attr"}),r.outerWidth(d),r.css({"box-sizing":"border-box",margin:"0px"}),c.append(r),c.insertAfter(t),r.focus(),r.keydown(function(e){switch(e.which){case 27:r.val(""),e.preventDefault(),e.stopPropagation(),s();break;case 13:e.preventDefault(),e.stopPropagation(),a();break;case 46:e.stopPropagation()}}).keyup(function(){h._isValidName(r.val(),e)?r.removeClass("text-danger"):r.addClass("text-danger")}).blur(function(){s()}),this.hostDesignerItem.canvas.selectNone()},p.prototype._onNewAttributeCreate=function(e){var t,n=this,i=this._attributeNames.slice(0),o=new s;this.logger.debug("_onNewAttributeCreate: "+e),i.splice(this._attributeNames.indexOf(e),1),t={name:e,type:"string",isEnum:!1},o.show(t,i,function(t){n.saveAttributeDescriptor(e,t)})},p.prototype._isValidName=function(e,t){var n=!0;return(""===e||"string"!=typeof e||"name"===e||-1!==t.indexOf(e)||h.DOCUMENT_KEY.test(e)===!1)&&(n=!1),n},p.prototype.readOnlyMode=function(e){i.prototype.readOnlyMode.call(this,e),this._setReadOnlyMode(e)},p.prototype._setReadOnlyMode=function(e){e===!0||this._inLibrary===!0?(this._skinParts.$addAttributeContainer.detach(),this._skinParts.$addConstraintContainer.detach(),this._skinParts.$addAspectContainer.detach(),this.$el.find("input.new-attr").val("").blur(),this._skinParts.$textMetaLock.show()):(this._skinParts.$attributesTitle.append(this._skinParts.$addAttributeContainer),this._skinParts.$constraintsTitle.append(this._skinParts.$addConstraintContainer),this._skinParts.$aspectsTitle.append(this._skinParts.$addAspectContainer),this._skinParts.$textMetaLock.hide())},p.prototype.saveAttributeDescriptor=function(t,n){var i,o=this._control._client,r=this._metaInfo[e.GME_ID];o.startTransaction(),this.logger.debug("saveAttributeDescriptor: "+t+", attrDesc: "+JSON.stringify(n)),t!==n.name&&(o.delAttributeMeta(r,t),o.delAttribute(r,t)),i={type:n.type,min:n.min,max:n.max,regexp:n.regexp},n.isEnum&&(i["enum"]=n.enumValues),o.setAttributeMeta(r,n.name,i),o.setAttribute(r,n.name,n.defaultValue),o.completeTransaction()},p.prototype.deleteAttributeDescriptor=function(n){var i=this._control._client,o=this._metaInfo[e.GME_ID];i.startTransaction(),n!==t.Attributes.name&&(i.delAttributeMeta(o,n),i.delAttribute(o,n)),i.completeTransaction()},p.prototype.getConnectionAreas=function(e,t,n){var i,o,r,s,l=[],c=10,d=20,h=n&&n[a.CONNECTION_META_INFO.TYPE]?n[a.CONNECTION_META_INFO.TYPE]:null,p=this._getDisabledConnectionAreas();return(void 0===e||e===this.hostDesignerItem.id)&&(i={id:"0",x1:c,y1:0,x2:this.hostDesignerItem.getWidth()-c,y2:0,angle1:270,angle2:270,len:d},o={id:"1",x1:this.hostDesignerItem.getWidth(),y1:c,x2:this.hostDesignerItem.getWidth(),y2:this.hostDesignerItem.getHeight()-c,angle1:0,angle2:0,len:d},s={id:"2",x1:c,y1:this.hostDesignerItem.getHeight(),x2:this.hostDesignerItem.getWidth()-c,y2:this.hostDesignerItem.getHeight(),angle1:90,angle2:90,len:d},r={id:"3",x1:0,y1:c,x2:0,y2:this.hostDesignerItem.getHeight()-c,angle1:180,angle2:180,len:d},!h||h!==a.META_RELATIONS.INHERITANCE&&h!==a.META_RELATIONS.MIXIN?(l.push(i),l.push(o),l.push(s),l.push(r)):t?-1===p.indexOf(s.id)?l.push(s):(l.push(i),l.push(o),l.push(r)):-1===p.indexOf(i.id)?l.push(i):(l.push(o),l.push(s),l.push(r))),l},p.prototype._showMetaTextEditorDialog=function(){var t=this._control._client,n=new d,i=this._metaInfo[e.GME_ID],o=t.getNode(i),r=o.getJsonMeta(i);n.show(t.getNode(i),JSON.stringify(r,void 0,2))},p}),define("decorators/MetaDecorator/MetaDecorator",["js/Decorators/DecoratorBase","./DiagramDesigner/MetaDecorator.DiagramDesignerWidget"],function(e,t){"use strict";var n,i=e,o=e.prototype,r="MetaDecorator";return n=function(e){var t=_.extend({loggerName:this.DECORATORID},e);i.apply(this,[t]),this.logger.debug("MetaDecorator ctor")},_.extend(n.prototype,o),n.prototype.DECORATORID=r,n.prototype.initializeSupportedWidgetMap=function(){this.supportedWidgetMap={DiagramDesigner:t}},n}),define("js/Widgets/DiagramDesigner/DiagramDesignerWidget.DecoratorBaseWithDragPointerHelpers",["./DiagramDesignerWidget.DecoratorBase","js/Constants","js/DragDrop/DragConstants","js/DragDrop/DragHelper"],function(e,t,n,i){"use strict";var o,r="accept-droppable",s="DRAGGABLE";return o=function(t){e.call(this,t)},_.extend(o.prototype,e.prototype),o.prototype._enableDragEvents=function(){var e=this;this.$el.on("mouseenter."+s,null,function(t){e.__onMouseEnter(t)}).on("mouseleave."+s,null,function(t){e.__onMouseLeave(t)}).on("mouseup."+s,null,function(t){e.__onMouseUp(t)})},o.prototype._disableDragEvents=function(){this.$el.off("mouseenter."+s).off("mouseleave."+s).off("mouseup."+s)},o.prototype.__isPotentialDropItem=function(e,n){return 1===e.length&&e[0]!==this._metaInfo[t.GME_ID]&&(-1!==n.indexOf(i.DRAG_EFFECTS.DRAG_CREATE_POINTER)||-1!==n.indexOf(i.DRAG_EFFECTS.DRAG_SET_REPLACEABLE))},o.prototype.__onBackgroundDroppableOver=function(e){this.__onBackgroundDroppableAccept(e)===!0&&this.__doAcceptDroppable(!0)},o.prototype.__onBackgroundDroppableOut=function(){this.__doAcceptDroppable(!1)},o.prototype.__onBackgroundDrop=function(e){var t=e.data(n.DRAG_INFO),o=i.getDragItems(t),r=i.getDragEffects(t);this.__acceptDroppable===!0&&this.__isPotentialDropItem(o,r)&&this._setPointerTarget(o[0],e.offset()),this.__doAcceptDroppable(!1)},o.prototype.__onBackgroundDroppableAccept=function(e){var t=e.data(n.DRAG_INFO),o=i.getDragItems(t),r=i.getDragEffects(t),s=!1;return this.__isPotentialDropItem(o,r)&&(s=this._getValidPointersForTarget(o[0]).length>0||this._isValidReplaceableTarget(o[0])),s},o.prototype.__doAcceptDroppable=function(e){e===!0?(this.__acceptDroppable=!0,this.$el.addClass(r)):(this.__acceptDroppable=!1,this.$el.removeClass(r)),this.hostDesignerItem.canvas._enableDroppable(!e)},o.prototype.__onMouseEnter=function(e){this.hostDesignerItem.canvas.getIsReadOnlyMode()!==!0&&$.ui.ddmanager.current&&$.ui.ddmanager.current.helper&&(this.__onDragOver=!0,this.__onBackgroundDroppableOver($.ui.ddmanager.current.helper),e.stopPropagation(),e.preventDefault())},o.prototype.__onMouseLeave=function(e){this.__onDragOver&&(this.__onBackgroundDroppableOut(),this.__onDragOver=!1,e.stopPropagation(),e.preventDefault())},o.prototype.__onMouseUp=function(){this.__onDragOver&&(this.__onBackgroundDrop($.ui.ddmanager.current.helper),this.__onDragOver=!1,this.hostDesignerItem.canvas.acceptDropTempDisabled=!0)},o}),define("text!decorators/ModelDecorator/Core/ModelDecorator.html",[],function(){return'<div class="model-decorator">\r\n    <div class="name"></div>\r\n    <div class="ports">\r\n        <div class="left"></div>\r\n        <div class="center"></div>\r\n        <div class="right"></div>\r\n    </div>\r\n    <div class=\'connector bottom\'></div>\r\n    <div class=\'connector top\'></div>\r\n</div>'}),define("decorators/ModelDecorator/Core/Port",["js/logger","js/Widgets/DiagramDesigner/DiagramDesignerWidget.Constants","js/Constants"],function(e,t,n){"use strict";var i,o=20,r=15,s="w-icon",a=3,l=5;return i=function(t,n){this.id=t,this.title=n.title||"",this.icon=n.svg||"",this.orientation=void 0,this.position={},this.skinParts=[],this.connectionArea={x1:0,y1:0,x2:0,y2:0,angle1:0,angle2:0,len:o},this.decorator=n.decorator,this.logger=e.create("gme:decorators:ModelDecorator:Core:Port_"+this.id,WebGMEGlobal.gmeConfig.client.log),this.logger.debug("Created")},i.prototype._DOMPortBase=$('<div  id="__ID__" class="port" data-id="__ID__"></div>'),i.prototype._DOMTitleWrapper=$('<div class="title-wrapper"><span class="title">__NAME__</span></div>'),i.prototype._DOMDot=$('<span class="dot"></span>'),i.prototype._DOMConnector=$('<div class="connector"></div>'),i.prototype._DOMSVGIcon=$('<img class="svg-icon"/>'),i.prototype._DOMBaseLeftTemplate=i.prototype._DOMPortBase.clone().append(i.prototype._DOMDot.clone()).append(i.prototype._DOMConnector.clone()).append(i.prototype._DOMSVGIcon.clone()).append(i.prototype._DOMTitleWrapper.clone()),i.prototype._DOMBaseRightTemplate=i.prototype._DOMPortBase.clone().append(i.prototype._DOMTitleWrapper.clone()).append(i.prototype._DOMSVGIcon.clone()).append(i.prototype._DOMDot.clone()).append(i.prototype._DOMConnector.clone()),i.prototype._initialize=function(){var e="W"===this.orientation?this._DOMBaseLeftTemplate:this._DOMBaseRightTemplate;this.$el=e.clone(),this.$el.attr({id:this.id,"data-id":this.id,title:this.title}),this.$portTitle=this.$el.find(".title"),this._updateTitle(),this.$portTitleWrapper=this.$el.find(".title-wrapper"),this.$portIcon=this.$el.find(".svg-icon"),this._updateIcon(),this.$connectors=this.$el.find("."+t.CONNECTOR_CLASS),this.$portDot=this.$el.find(".dot"),this.decorator._displayConnectors===!0?(this.decorator.hostDesignerItem&&this.decorator.hostDesignerItem.registerConnectors(this.$connectors,this.id),this.hideConnectors()):this.$connectors.remove()},i.prototype.update=function(e){this.title=e.title||"",this.icon=e.svg||"",this._updateTitle(),this._updateIcon()},i.prototype._updateTitle=function(){this.$portTitle.text(this.title),this.$el.attr({title:this.title})},i.prototype._updateIcon=function(){this.icon?(this.$portIcon.attr("src",n.ASSETS_DECORATOR_SVG_FOLDER+this.icon),this.$portIcon.show(),this.$el.addClass(s)):(this.$portIcon.hide(),this.$el.removeClass(s))},i.prototype.updateOrPos=function(e,t){var n=!1;return this.position.x!==t.x&&(this.position.x=t.x,n=!0),this.position.y!==t.y&&(this.position.y=t.y,n=!0),this.orientation!==e&&(this.orientation=e,n=!0,this.$el?(this.$connectors.detach(),this.$portDot.detach(),"E"===this.orientation?this.$el.append(this.$portDot).append(this.$connectors):this.$el.prepend(this.$connectors).prepend(this.$portDot),this.decorator._displayConnectors!==!0&&this.$connectors.remove()):this._initialize()),n},i.prototype.destroy=function(){this.$el&&(this.$el.remove(),this.$el.empty())},i.prototype.showConnectors=function(){this.$connectors.show()},i.prototype.hideConnectors=function(){this.$connectors.hide()},i.prototype.getConnectorArea=function(){var e,t=this.$el.parent().children(),n=t.length;for(e=0;n>e&&t[e]!==this.$el[0];e+=1);return this.connectionArea.x1="W"===this.orientation?0:this.decorator.hostDesignerItem.getWidth(),this.icon?this.connectionArea.x1+=("W"===this.orientation?-1:1)*(l-1):this.connectionArea.x1+=("W"===this.orientation?-1:1)*(a-1),this.connectionArea.x2=this.connectionArea.x1,this.connectionArea.y1=e*r+9,this.connectionArea.y2=this.connectionArea.y1,this.connectionArea.angle1="W"===this.orientation?180:0,this.connectionArea.angle2="W"===this.orientation?180:0,this.connectionArea},i}),define("decorators/ModelDecorator/Core/ModelDecorator.Constants",[],function(){"use strict";return{POINTER_CLASS:"ptr",POINTER_CLASS_NON_SET:"ptr-nonset",PROGRESS_BAR_CLASS:"progress-bar",REPLACEABLE_CLASS:"replaceable"}}),define("js/Decorators/DecoratorWithPorts.Base",["js/Constants","js/Utils/GMEConcepts"],function(e,t){"use strict";var n;return n=function(){this.portIDs=[],this.ports={}},n.prototype.getTerritoryQuery=function(){var t={},n=this._metaInfo[e.GME_ID],i=this._control._client,o=i.getNode(n),r=this._aspect&&this._aspect!==e.ASPECT_ALL&&-1!==o.getValidAspectNames().indexOf(this._aspect);return r?(t[n]=i.getAspectTerritoryPattern(n,this._aspect),t[n].children=1):t[n]={children:1},t},n.prototype.registerPortIdForNotification=function(t){var n=this._metaInfo[e.GME_ID];this._control.registerComponentIDForPartID(t,n)},n.prototype.unregisterPortIdForNotification=function(t){var n=this._metaInfo[e.GME_ID];this._control.unregisterComponentIDFromPartID(t,n)},n.prototype.updatePortIDList=function(){var e,t,n=this.getPortIDs(),i=this.portIDs.slice(0);for(t=_.difference(i,n),e=t.length;e--;)this.unregisterPortIdForNotification(t[e]),this.removePort(t[e]);for(t=_.difference(n,i),e=t.length;e--;)this.registerPortIdForNotification(t[e]),this.addPort(t[e])},n.prototype.getPortIDs=function(){var n,i=this._control._client,o=i.getNode(this._metaInfo[e.GME_ID]),r=[],s=this._metaInfo[e.GME_ID],a=this._aspect&&this._aspect!==e.ASPECT_ALL&&-1!==o.getValidAspectNames().indexOf(this._aspect);if(o){for(r=o.getChildrenIds().slice(0),n=r.length;n--;)t.isPort(r[n])||r.splice(n,1);if(a)for(n=r.length;n--;)t.isValidTypeInAspect(r[n],s,this._aspect)||r.splice(n,1)}return r},n.prototype.isPort=function(e){return t.isPort(e)},n.prototype.addPort=function(e){this.isPort(e)&&(this.ports[e]=this.renderPort(e),this.portIDs.push(e))},n.prototype.renderPort=function(){return{destroy:function(){}}},n.prototype.removePort=function(e){var t=this.portIDs.indexOf(e);-1!==t&&(this.ports[e].destroy(),delete this.ports[e],this.portIDs.splice(t,1))},n}),define("js/Decorators/DecoratorWithPortsAndPointerHelpers.Base",["./DecoratorWithPorts.Base","js/Constants","js/Utils/GMEConcepts","js/Controls/ContextMenu"],function(e,t,n,i){"use strict";var o,r=[t.POINTER_BASE,t.POINTER_SOURCE,t.POINTER_TARGET,t.POINTER_CONSTRAINED_BY];return o=function(){e.apply(this,[])},_.extend(o.prototype,e.prototype),o.prototype._getPointerNames=function(){var e=this._control._client,n=e.getNode(this._metaInfo[t.GME_ID]),i=[];return n&&(i=_.difference(n.getPointerNames().slice(0),r)),i},o.prototype._getValidPointersForTarget=function(e){for(var n,i=this._control._client,o=this._metaInfo[t.GME_ID],r=this._getPointerNames(),s=r.length,a=[],l=i.getNode(e);s--&&l;)n=r[s],l.isValidTargetOf(o,n)&&a.push(n);return a.length>0&&a.sort(function(e,t){var n=e.toLowerCase(),i=t.toLowerCase();return i>n?-1:n>i?1:0}),a},o.prototype._getPointerTargets=function(){var e,n,i,o=[],r=this._control._client,s=r.getNode(this._metaInfo[t.GME_ID]);if(s){for(e=this._getPointerNames(),n=e.length;n--;)i=s.getPointer(e[n]),i&&void 0!==i.to&&null!==i.to&&o.push([e[n],i.to]);o.length>0&&o.sort(function(e,t){var n=e[0].toLowerCase(),i=t[0].toLowerCase();return i>n?-1:n>i?1:0})}return o},o.prototype._setPointerTarget=function(e,t){var n=this._getValidPointersForTarget(e),i=this._isValidReplaceableTarget(e);(n.length>0||i)&&(1!==n.length||i?this._selectPointerForTarget(n,e,t,i):this._setPointer(n[0],e))},o.prototype._setPointer=function(e,n){var i=this._control._client,o=this._metaInfo[t.GME_ID],r=i.getNode(o),s=r.getPointer(e);s!==n&&i.setPointer(o,e,n)},o.prototype._selectPointerForTarget=function(e,t,n,o){var r,s,a=this.logger,l=this,c={};for(s=0;s<e.length;s+=1)c[e[s]]={icon:"glyphicon glyphicon-share",name:'Set pointer "'+e[s]+'"'};o&&(c[""]={icon:"glyphicon glyphicon-transfer",name:"Replace base"}),r=new i({items:c,callback:function(e){e?(a.debug("_selectPointerForTarget: "+e),l._setPointer(e,t)):l._replaceWithTarget(t)}}),r.show({x:n.left,y:n.top})},o.prototype._setPointerTerritory=function(e){var t=this.logger,n=e.length;if(this._selfPatterns={},n>0)for(this._territoryId||(this._territoryId=this._control._client.addUI(this,function(e){t.debug("onEvent: "+JSON.stringify(e))}));n--;)this._selfPatterns[e[n][1]]={children:0};this._selfPatterns&&!_.isEmpty(this._selfPatterns)?this._control._client.updateTerritory(this._territoryId,this._selfPatterns):this._territoryId&&this._control._client.removeUI(this._territoryId)},o.prototype._isReplaceable=function(){return n.isReplaceable(this._metaInfo[t.GME_ID])},o.prototype._isValidReplaceableTarget=function(e){return n.isValidReplaceableTarget(this._metaInfo[t.GME_ID],e)},o.prototype._replaceWithTarget=function(e){this._control._client.setBase(this._metaInfo[t.GME_ID],e)},o}),define("decorators/ModelDecorator/Core/ModelDecorator.Core",["js/Constants","js/NodePropertyNames","js/RegistryKeys","js/Loader/LoaderProgressBar","./Port","./ModelDecorator.Constants","js/Decorators/DecoratorWithPortsAndPointerHelpers.Base","js/Utils/DisplayFormat","js/Utils/GMEConcepts"],function(e,t,n,i,o,r,s,a,l){"use strict";var c,d="abstract",h="embeddedsvg",p="conn-type",g=$("<div/>",{"class":p}),u=$("<img>",{"class":h});return c=function(e){s.apply(this,[]),e&&e.aspect&&(this._aspect=e.aspect)},_.extend(c.prototype,s.prototype),c.prototype._initializeVariables=function(e){this.name="",this.formattedName="",this.portIDs=[],this.ports={},this.skinParts={$name:void 0,$portsContainer:void 0,$portsContainerLeft:void 0,$portsContainerRight:void 0,$portsContainerCenter:void 0,$ptr:void 0,$imgSVG:void 0,$replaceable:void 0},this._displayConnectors=!1,e&&e.connectors&&(this._displayConnectors=e.connectors)},c.prototype.destroy=function(){for(var e=this.portIDs.length;e--;)this.unregisterPortIdForNotification(this.portIDs[e]),this.removePort(this.portIDs[e])},c.prototype.doSearch=function(e){var t=e.toString().toLowerCase();return this.formattedName&&-1!==this.formattedName.toLowerCase().indexOf(t)},c.prototype._renderContent=function(){this.$el.attr({"data-id":this._metaInfo[e.GME_ID]}),this.skinParts.$name=this.$el.find(".name"),this.skinParts.$portsContainer=this.$el.find(".ports"),this.skinParts.$portsContainerLeft=this.skinParts.$portsContainer.find(".left"),this.skinParts.$portsContainerRight=this.skinParts.$portsContainer.find(".right"),this.skinParts.$portsContainerCenter=this.skinParts.$portsContainer.find(".center"),this._update()},c.prototype._update=function(){this._updateColors(),this._updateName(),this._updatePorts(),this._updatePointers(),this._updateAbstract(),this._updateSVG(),this._updateConnectionType(),this._updateIsReplaceable()},c.prototype._updateColors=function(){this._getNodeColorsFromRegistry(),this.fillColor?this.$el.css({"background-color":this.fillColor}):this.$el.css({"background-color":""}),this.borderColor?(this.$el.css({"border-color":this.borderColor,"box-shadow":"0px 0px 7px 0px "+this.borderColor+" inset"}),this.skinParts.$name.css({"border-color":this.borderColor})):(this.$el.css({"border-color":"","box-shadow":""}),this.skinParts.$name.css({"border-color":""})),this.textColor?this.$el.css({color:this.textColor}):this.$el.css({color:""})},c.prototype._getNodeColorsFromRegistry=function(){var t=this._metaInfo[e.GME_ID];this.fillColor=this.preferencesHelper.getRegistry(t,n.COLOR,!0),this.borderColor=this.preferencesHelper.getRegistry(t,n.BORDER_COLOR,!0),this.textColor=this.preferencesHelper.getRegistry(t,n.TEXT_COLOR,!0)},c.prototype._updateName=function(){var t=this._control._client,n=t.getNode(this._metaInfo[e.GME_ID]),i="(N/A)";n?(this.name=n.getFullyQualifiedName(),this.formattedName=a.resolve(n)):(this.name="",this.formattedName=i),this.skinParts.$name.text(this.formattedName),this.skinParts.$name.attr("title",this.formattedName)},c.prototype._updateConnectionType=function(){var t=l.isConnectionType(this._metaInfo[e.GME_ID]);this.skinParts.$name.text(this.formattedName),this.skinParts.$name.attr("title",this.formattedName),t?this.skinParts.$divConnType||(this.skinParts.$divConnType=g.clone(),this.skinParts.$divConnType.insertAfter(this.skinParts.$name),this.skinParts.$divConnType.text("<< Connection >>")):this.skinParts.$divConnType&&(this.skinParts.$divConnType.remove(),delete this.skinParts.$divConnType)},c.prototype._updatePorts=function(){this.updatePortIDList(),this._checkTerritoryReady()},c.prototype.renderPort=function(e){var t=this._control._client,i=t.getNode(e),r=a.resolve(i),s=new o(e,{title:r,decorator:this,svg:i.getRegistry(n.PORT_SVG_ICON)});return this._addPortToContainer(i,s),s},c.prototype._addPortToContainer=function(e,t){var i,o,r=e.getId(),s="W",a=this.skinParts.$portsContainerLeft,l=e.getRegistry(n.POSITION)||{x:0,y:0},c=null;l.x>300&&(s="E",a=this.skinParts.$portsContainerRight),o=t.updateOrPos(s,l);for(i in this.ports)this.ports.hasOwnProperty(i)&&i!==r&&this.ports[i].orientation===t.orientation&&(t.position.y<this.ports[i].position.y||t.position.y===this.ports[i].position.y&&t.title<this.ports[i].title)&&(null===c?c=i:(this.ports[i].position.y<this.ports[c].position.y||this.ports[i].position.y===this.ports[c].position.y&&this.ports[i].title<this.ports[c].title)&&(c=i));null===c?a.append(t.$el):t.$el.insertBefore(this.ports[c].$el),o===!0&&this._portPositionChanged(r)},c.prototype._portPositionChanged=function(){},c.prototype._updatePort=function(e){var t,i=this.portIDs.indexOf(e),o=this._control._client,r=o.getNode(e),s=this.isPort(e);-1!==i?s===!0?(t=a.resolve(r),this.ports[e].update({title:t,svg:r.getRegistry(n.PORT_SVG_ICON)}),this._updatePortPosition(e)):this.removePort(e):this.addPort(e)},c.prototype._updatePortPosition=function(e){var t=this._control._client.getNode(e),i=t.getRegistry(n.POSITION)||{x:0,y:0};(this.ports[e].position.x!==i.x||this.ports[e].position.y!==i.y)&&(this.ports[e].$el.detach(),this._addPortToContainer(t,this.ports[e]))},c.prototype._checkTerritoryReady=function(){var t,n,i=this._control._client,o=i.getNode(this._metaInfo[e.GME_ID]),r=!0;if(this._aspect===e.ASPECT_ALL)if(o){for(t=o.getChildrenIds(),n=t.length;n--;)if(o=i.getNode(t[n]),!o){r=!1;break}}else r=!1;r===!0?this._hidePortProgressBar():this._showPortProgressBar()},c.prototype._showPortProgressBar=function(){var e=this.$el.find("."+r.PROGRESS_BAR_CLASS);0===e.length&&(e=$("<div/>",{"class":r.PROGRESS_BAR_CLASS}),this.$el.append(e),this._loader=new i({containerElement:e}),this._loader.start())},c.prototype._hidePortProgressBar=function(){this._loader&&(this._loader.stop(),this._loader.destroy(),delete this._loader),this.$el.find("."+r.PROGRESS_BAR_CLASS).remove()},c.prototype._ptrUIDOMBase=$('<div class="'+r.POINTER_CLASS+'"><i class="glyphicon glyphicon-share"></i></div>'),c.prototype._replaceableUIDOMBase=$('<div class="'+r.REPLACEABLE_CLASS+'"><i class="glyphicon glyphicon-transfer" title="This node is replaceable"></i></div>'),c.prototype._updatePointers=function(){var e;this._getPointerNames().length>0?(this.skinParts.$ptr=this.$el.find("."+r.POINTER_CLASS),0===this.skinParts.$ptr.length&&(this.skinParts.$ptr=this._ptrUIDOMBase.clone(),this.$el.append(this.skinParts.$ptr)),e=this._getPointerTargets(),e.length>0?this.skinParts.$ptr.removeClass(r.POINTER_CLASS_NON_SET):this.skinParts.$ptr.addClass(r.POINTER_CLASS_NON_SET)):this.skinParts.$ptr&&(this.skinParts.$ptr.remove(),this.skinParts.$ptr=void 0)},c.prototype._updateAbstract=function(){var t=this._control._client,i=t.getNode(this._metaInfo[e.GME_ID]);i&&i.getRegistry(n.IS_ABSTRACT)===!0?this.$el.addClass(d):this.$el.removeClass(d)},c.prototype._updateSVG=function(){var t,i=this._control._client,o=i.getNode(this._metaInfo[e.GME_ID]),r="",s=this;o&&(r=o.getRegistry(n.SVG_ICON)),r?(t=e.ASSETS_DECORATOR_SVG_FOLDER+r,this.skinParts.$imgSVG||(this.skinParts.$imgSVG=u.clone(),this.$el.append(this.skinParts.$imgSVG)),this.skinParts.$imgSVG.attr("src")!==t&&(this.skinParts.$imgSVG.on("load",function(){s._svgReady()}),this.skinParts.$imgSVG.on("error",function(){s._svgReady()}),this.skinParts.$imgSVG.attr("src",t))):this.skinParts.$imgSVG&&(this.skinParts.$imgSVG.remove(),this.skinParts.$imgSVG=void 0)},c.prototype._svgReady=function(){var e=this.skinParts.$portsContainer.outerHeight(),t=5,n=-e+t;if(this.skinParts.$imgSVG.css("margin-top",n),this.skinParts.$imgSVG.off("load"),this.skinParts.$imgSVG.off("error"),_.isFunction(this.onRenderGetLayoutInfo)&&this.onRenderGetLayoutInfo(),this.hostDesignerItem&&this.hostDesignerItem.canvas){var i=this.hostDesignerItem.canvas.selectionManager.getSelectedElements();1===i.length&&i[0]===this.hostDesignerItem.id&&(this.hostDesignerItem.canvas.selectNone(),this.hostDesignerItem.canvas.select([this.hostDesignerItem.id]))}},c.prototype._updateIsReplaceable=function(){this._isReplaceable()?(this.skinParts.$replaceable=this.$el.find("."+r.REPLACEABLE_CLASS),0===this.skinParts.$replaceable.length&&(this.skinParts.$replaceable=this._replaceableUIDOMBase.clone(),this.$el.append(this.skinParts.$replaceable))):this.skinParts.$replaceable&&(this.skinParts.$replaceable.remove(),this.skinParts.$replaceable=void 0)},c}),define("css!decorators/ModelDecorator/DiagramDesigner/ModelDecorator.DiagramDesignerWidget",[],function(){}),define("decorators/ModelDecorator/DiagramDesigner/ModelDecorator.DiagramDesignerWidget",["js/Constants","js/NodePropertyNames","js/Widgets/DiagramDesigner/DiagramDesignerWidget.DecoratorBaseWithDragPointerHelpers","js/Widgets/DiagramDesigner/DiagramDesignerWidget.Constants","text!../Core/ModelDecorator.html","../Core/ModelDecorator.Core","../Core/ModelDecorator.Constants","js/Controls/ContextMenu","css!./ModelDecorator.DiagramDesignerWidget.css"],function(e,t,n,i,o,r,s,a){"use strict";var l,c="ModelDecoratorDiagramDesignerWidget",d=15;return l=function(e){var t=_.extend({},e);n.apply(this,[t]),r.apply(this,[t]),this._initializeVariables({connectors:!0}),this._selfPatterns={},this.logger.debug("ModelDecoratorDiagramDesignerWidget ctor")},_.extend(l.prototype,n.prototype),_.extend(l.prototype,r.prototype),l.prototype.DECORATORID=c,l.prototype.$DOMBase=$(o),l.prototype.on_addTo=function(){var e=this;this._renderContent(),this.skinParts.$name.on("dblclick.editOnDblClick",null,function(t){e.hostDesignerItem.canvas.getIsReadOnlyMode()!==!0&&$(this).editInPlace({"class":"",value:e.name,onChange:function(t,n){e.__onNodeTitleChanged(t,n)},onFinish:function(){e.skinParts.$name.text(e.formattedName),e.skinParts.$name.attr("title",e.formattedName)}}),t.stopPropagation(),t.preventDefault()}),this.$el.on("dblclick.ptrDblClick","."+s.POINTER_CLASS,function(t){$(this).hasClass(s.POINTER_CLASS_NON_SET)||e.__onPointerDblClick({x:t.clientX,y:t.clientY}),t.stopPropagation(),t.preventDefault()}),this._updateDropArea()},l.prototype.update=function(){this._update(),this._updateDropArea()},l.prototype.onRenderGetLayoutInfo=function(){this._paddingTop=parseInt(this.$el.css("padding-top"),10),this._borderTop=parseInt(this.$el.css("border-top-width"),10),n.prototype.onRenderGetLayoutInfo.call(this)},l.prototype.destroy=function(){this._territoryId&&this._control._client.removeUI(this._territoryId),r.prototype.destroy.call(this)},l.prototype.getConnectionAreas=function(e){var t=[],n=10,i=20;if(void 0===e||e===this.hostDesignerItem.id){t.push({id:"N",x1:n,y1:0,x2:this.hostDesignerItem.getWidth()-n,y2:0,angle1:270,angle2:270,len:i}),t.push({id:"S",x1:n,y1:this.hostDesignerItem.getHeight(),x2:this.hostDesignerItem.getWidth()-n,y2:this.hostDesignerItem.getHeight(),angle1:90,angle2:90,len:i});var o=!0,r=!0;for(var s in this.ports)if(this.ports.hasOwnProperty(s)&&("E"===this.ports[s].orientation&&(o=!1),"W"===this.ports[s].orientation&&(r=!1)),!o&&!r)break;o&&t.push({id:"E",x1:this.hostDesignerItem.getWidth(),y1:n,x2:this.hostDesignerItem.getWidth(),y2:this.hostDesignerItem.getHeight()-n,angle1:0,angle2:0,len:i}),r&&t.push({id:"W",x1:0,y1:n,x2:0,y2:this.hostDesignerItem.getHeight()-n,angle1:180,angle2:180,len:i})}else if(this.ports[e]){var a=this.ports[e].getConnectorArea(),l=this.portIDs.indexOf(e);t.push({id:l,x1:a.x1,y1:a.y1+d+this._paddingTop+this._borderTop,x2:a.x2,y2:a.y2+d+this._paddingTop+this._borderTop,angle1:a.angle1,angle2:a.angle2,len:a.len})}return t},l.prototype.updateSubcomponent=function(e){this._updatePort(e)},l.prototype.showSourceConnectors=function(e){var t,n;if(e)for(t=e.connectors,n=t.length;n--;)void 0===t[n]?this.$sourceConnectors.show():this.ports[t[n]]&&this.ports[t[n]].showConnectors();else if(this.$sourceConnectors.show(),this.portIDs)for(n=this.portIDs.length;n--;)this.ports[this.portIDs[n]].showConnectors()},l.prototype.hideSourceConnectors=function(){var e;if(this.$sourceConnectors.hide(),this.portIDs)for(e=this.portIDs.length;e--;)this.ports[this.portIDs[e]].hideConnectors()},l.prototype.showEndConnectors=function(e){this.showSourceConnectors(e)},l.prototype.hideEndConnectors=function(){this.hideSourceConnectors()},l.prototype.notifyComponentEvent=function(e){for(var t=e.length;t--;)this._updatePort(e[t].id);this._checkTerritoryReady()},l.prototype._portPositionChanged=function(e){this.onRenderGetLayoutInfo(),this.hostDesignerItem.canvas.dispatchEvent(this.hostDesignerItem.canvas.events.ITEM_SUBCOMPONENT_POSITION_CHANGED,{ItemID:this.hostDesignerItem.id,SubComponentID:e})},l.prototype.renderPort=function(e){return this.__registerAsSubcomponent(e),r.prototype.renderPort.call(this,e)},l.prototype.removePort=function(e){var t=this.portIDs.indexOf(e);-1!==t&&this.__unregisterAsSubcomponent(e),r.prototype.removePort.call(this,e)},l.prototype._updateDropArea=function(){var e="inverse-on-hover";this.skinParts.$ptr||this.skinParts.$replaceable?(this.skinParts.$ptr&&(this.skinParts.$ptr.hasClass(s.POINTER_CLASS_NON_SET)?this.skinParts.$ptr.removeClass(e):this.skinParts.$ptr.addClass(e)),this._enableDragEvents()):this._disableDragEvents(),this._setPointerTerritory(this._getPointerTargets())},l.prototype.__registerAsSubcomponent=function(e){this.hostDesignerItem&&this.hostDesignerItem.registerSubcomponent(e,{GME_ID:e})},l.prototype.__unregisterAsSubcomponent=function(e){this.hostDesignerItem&&this.hostDesignerItem.unregisterSubcomponent(e)},l.prototype.__onNodeTitleChanged=function(n,i){var o=this._control._client;o.setAttribute(this._metaInfo[e.GME_ID],t.Attributes.name,i)},l.prototype.__onPointerDblClick=function(e){var t,n,i=this._getPointerTargets(),o=this,r={},s={};if(i.length>0)if(1===i.length)this._navigateToPointerTarget(i[0][1]);else{for(n=0;n<i.length;n+=1)r[i[n][0]]={name:'Follow pointer "'+i[n][0]+'"'},s[i[n][0]]=i[n][1];t=new a({items:r,callback:function(e){o._navigateToPointerTarget(s[e])}}),t.show(e)}},l.prototype._navigateToPointerTarget=function(t){var n,i=this._control._client;n=i.getNode(t),n&&(n.getParentId()||n.getParentId()===e.PROJECT_ROOT_ID?(WebGMEGlobal.State.registerActiveObject(n.getParentId()),WebGMEGlobal.State.registerActiveSelection([t])):(WebGMEGlobal.State.registerActiveObject(e.PROJECT_ROOT_ID),WebGMEGlobal.State.registerActiveSelection([t])))},l}),define("css!decorators/ModelDecorator/PartBrowser/ModelDecorator.PartBrowserWidget",[],function(){}),define("decorators/ModelDecorator/PartBrowser/ModelDecorator.PartBrowserWidget",["js/Constants","js/NodePropertyNames","js/Widgets/PartBrowser/PartBrowserWidget.DecoratorBase","js/Widgets/DiagramDesigner/DiagramDesignerWidget.Constants","text!../Core/ModelDecorator.html","../Core/ModelDecorator.Core","css!./ModelDecorator.PartBrowserWidget.css"],function(e,t,n,i,o,r){"use strict";var s,a="ModelDecoratorPartBrowserWidget";return s=function(e){var t=_.extend({},e);n.apply(this,[t]),r.apply(this,[t]),this._initializeVariables({connectors:!1}),this.logger.debug("ModelDecoratorPartBrowserWidget ctor")},_.extend(s.prototype,n.prototype),_.extend(s.prototype,r.prototype),s.prototype.DECORATORID=a,s.prototype.$DOMBase=function(){var e=$(o);return e.find("."+i.CONNECTOR_CLASS).remove(),e}(),s.prototype.beforeAppend=function(){this.$el=this.$DOMBase.clone(),this._renderContent()},s.prototype.afterAppend=function(){},s.prototype.update=function(){this._update()},s.prototype.notifyComponentEvent=function(e){for(var t=e.length;t--;)this._updatePort(e[t]);this._checkTerritoryReady()},s}),define("decorators/ModelDecorator/ModelDecorator",["js/Decorators/DecoratorBase","./DiagramDesigner/ModelDecorator.DiagramDesignerWidget","./PartBrowser/ModelDecorator.PartBrowserWidget"],function(e,t,n){"use strict";var i,o=e,r=e.prototype,s="ModelDecorator";return i=function(e){var t=_.extend({loggerName:this.DECORATORID},e);o.apply(this,[t]),this.logger.debug("ModelDecorator ctor")},_.extend(i.prototype,r),i.prototype.DECORATORID=s,i.prototype.initializeSupportedWidgetMap=function(){this.supportedWidgetMap={DiagramDesigner:t,PartBrowser:n}},i}),define("text!decorators/SVGDecorator/Core/SVGDecorator.html",[],function(){
return'<div class="svg-decorator">\r\n    <div class="svg-content"></div>\r\n    <div class="name"></div>\r\n</div>'}),define("text!decorators/SVGDecorator/Core/default.svg",[],function(){return'<svg width="100" height="50" xmlns="http://www.w3.org/2000/svg">\r\n <g>\r\n  <rect fill="#ececec" stroke-width="1" x="0.5" y="0.5" width="99" height="49" stroke="#000"/>\r\n  <text fill="#191919" stroke-width="0" stroke-opacity="null" x="50" y="25" font-size="10" text-anchor="middle" stroke="#000"></text>\r\n </g>\r\n</svg>'}),define("decorators/SVGDecorator/Core/SVGDecorator.Core",["js/Constants","js/NodePropertyNames","js/RegistryKeys","js/Utils/DisplayFormat","js/Decorators/DecoratorWithPortsAndPointerHelpers.Base","js/Widgets/DiagramDesigner/DiagramDesignerWidget.Constants","text!./default.svg","common/regexp"],function(e,t,n,i,o,r,s,a){"use strict";var l,c="abstract",d=e.ASSETS_DECORATOR_SVG_FOLDER,h="fill-color",p="border-color",g="text-color",u={},f=$(s);return l=function(){o.apply(this,[]),this.svgCache=u},_.extend(l.prototype,o.prototype),l.prototype._initializeVariables=function(e){if(this.name="",this.formattedName="",this.$name=void 0,this.$replaceable=void 0,e.data){this.customData=[];for(var t=e.data.length;t--;)void 0===this[e.data[t]]&&(this.customData.push(e.data[t]),this[e.data[t]]=null)}},l.prototype.doSearch=function(e){var t=e.toString().toLowerCase();return this.formattedName&&-1!==this.formattedName.toLowerCase().indexOf(t)},l.prototype._renderContent=function(){this.$el.attr({"data-id":this._metaInfo[e.GME_ID]}),this.$name=this.$el.find(".name"),this.$svgContent=this.$el.find(".svg-content"),this._update()},l.prototype._update=function(){this._updateSVGFile(),this._updateColors(),this._updateName(),this._updateAbstract(),this._updatePorts(),this._updateIsReplaceable()},l.prototype._updateColors=function(){var e=this.$svgElement,t=e.find("."+h),n=e.find("."+p),i=e.find("."+g);this._getNodeColorsFromRegistry(),this.fillColor?t.css({fill:this.fillColor}):t.css({fill:""}),this.borderColor?n.css({stroke:this.borderColor}):n.css({stroke:""}),this.textColor?(this.$el.css({color:this.textColor}),i.css({fill:this.textColor})):(this.$el.css({color:""}),i.css({fill:""}))},l.prototype._getNodeColorsFromRegistry=function(){var t=this._metaInfo[e.GME_ID];this.fillColor=this.preferencesHelper.getRegistry(t,n.COLOR,!0),this.borderColor=this.preferencesHelper.getRegistry(t,n.BORDER_COLOR,!0),this.textColor=this.preferencesHelper.getRegistry(t,n.TEXT_COLOR,!0)},l.prototype._updateName=function(){var t=this._control._client,n=t.getNode(this._metaInfo[e.GME_ID]),o="(N/A)";n?(this.name=n.getFullyQualifiedName(),this.formattedName=i.resolve(n)):(this.name="",this.formattedName=o),this.$name.text(this.formattedName),this.$name.attr("title",this.formattedName)},l.prototype._updateAbstract=function(){var t=this._control._client,i=t.getNode(this._metaInfo[e.GME_ID]);i&&i.getRegistry(n.IS_ABSTRACT)===!0?this.$el.addClass(c):this.$el.removeClass(c)},l.prototype._updateSVGFile=function(){var t,i=this._control._client,o=i.getNode(this._metaInfo[e.GME_ID]),r="",s=this,a=this.logger;o&&(r=o.getRegistry(n.SVG_ICON)),r?this._SVGFile!==r&&(this.svgCache[r]?this._updateSVGContent(r):(t=d+r,$.ajax(t,{async:!1}).done(function(e){var t=$(e).find("svg");t.length>0?(s.svgCache[r]={el:t.first(),customConnectionAreas:void 0},s._discoverCustomConnectionAreas(r),s._getCustomDataFromSvg(r),s.processCustomSvgData(),s._updateSVGContent(r)):s._updateSVGContent(void 0)}).fail(function(){a.error("Failed to download SVG file: "+r),s._updateSVGContent(r)})),this._SVGFile=r):""!==r?(a.error('Invalid SVG file: "'+r+'"'),this._updateSVGContent(void 0)):this._updateSVGContent("")},l.prototype._updateSVGContent=function(e){var t;this.$svgContent.empty(),this.$svgContent.removeClass(),this.$svgContent.addClass("svg-content"),this.$svgContent.addClass(e.replace(a.INVALID_CSS_CHARS,"__")),this.$el.find("> ."+r.CONNECTOR_CLASS).remove(),this._defaultSVGUsed=!1,this.svgCache[e]?t=this.svgCache[e].el.clone():(t=f.clone(),""!==e?$(t.find("text")).html("!!! "+e+" !!!"):this._defaultSVGUsed=!0),this.$svgElement=t,this._getCustomConnectionAreas(e),this._generateConnectors(),this.$svgContent.append(t)},l.prototype._getCustomDataFromSvg=function(e){if(this.customData)for(var t,n,i=this.customData.length,o=this.svgCache[e].el;i--;)for(t=this.customData[i],this[t]=o.find("."+t),n=this[t].length;n--;)this[t][n].remove()},l.prototype.processCustomSvgData=function(){},l.prototype.getSVGCustomData=function(e){var t=null;return this.customData&&-1!==this.customData.indexOf(e)&&(this[e]instanceof Array?t=this[e].slice():this[e]instanceof Object&&(t=_.extend({},this[e]))),t},l.prototype._updateExtras=function(){},l.prototype._updatePorts=function(){},l.prototype._fixPortContainerPosition=function(){},l.prototype._discoverCustomConnectionAreas=function(){},l.prototype._getCustomConnectionAreas=function(){},l.prototype._generateConnectors=function(){},l.prototype._updateIsReplaceable=function(){this._isReplaceable()?(this.$replaceable=this.$el.find(".replaceable"),0===this.$replaceable.length&&(this.$replaceable=$('<div class="replaceable"><i class="glyphicon glyphicon-transfer" title="This node is replaceable"></i></div>'),this.$el.append(this.$replaceable))):this.$replaceable&&(this.$replaceable.remove(),this.$replaceable=void 0)},l}),define("decorators/SVGDecorator/Core/SVGDecorator.Connections",[],function(){"use strict";var e,t="connection-area",n="angle",i="angle1",o="angle2",r={};return e=function(){},e.prototype.setConnectionAreaDefaults=function(e){r=e},e.prototype._getCustomConnectionAreas=function(e){var t,n=this.svgCache[e]?this.svgCache[e].customConnectionAreas:null,i=n?n.length:0;if(delete this._customConnectionAreas,i>0)for(this._customConnectionAreas=[];i--;)t={},_.extend(t,n[i]),this._customConnectionAreas.push(t)},e.prototype._discoverCustomConnectionAreas=function(e){var s,a,l,c,d,h,p,g,u,f=this.svgCache[e].el,m=f.find("."+t),b=m.length,y=1;if(b>0){if(p=parseInt(f.attr("width"),10),g=f[0].getAttribute("viewBox")){var v=parseInt(g.split(" ")[0],10),C=parseInt(g.split(" ")[2],10);y=p/(C-v)}for(this.svgCache[e].customConnectionAreas=[],u=this.svgCache[e].customConnectionAreas;b--;)s=$(m[b]),a={id:s.attr("id"),x1:parseInt(s.attr("x1"),10)*y,y1:parseInt(s.attr("y1"),10)*y,x2:parseInt(s.attr("x2"),10)*y,y2:parseInt(s.attr("y2"),10)*y},l=s.data(),_.extend(a,r),_.extend(a,l),l.hasOwnProperty(n)||l.hasOwnProperty(i)&&l.hasOwnProperty(o)||(c=a.x2-a.x1,d=a.y2-a.y1,0!==c&&0!==d?(h=Math.atan(d/c)*(180/Math.PI),c>0?h=270+h:0>c&&(h=90+h)):0===c&&0!==d?h=d>0?0:180:0!==c&&0===d&&(h=c>0?270:90),a.angle1=h,a.angle2=h),u.push(a),s.remove()}},e}),define("decorators/SVGDecorator/Core/SVGDecorator.Connectors",["js/Widgets/DiagramDesigner/DiagramDesignerWidget.Constants"],function(e){"use strict";var t,n=$('<div class="'+e.CONNECTOR_CLASS+'"/>');return t=function(){},t.prototype._generateConnectors=function(){var t,i=this.$svgElement,o=i.find("."+e.CONNECTOR_CLASS),r=parseInt(i.attr("width"),10),s=parseInt(i.attr("height"),10);0===o.length&&(t=n.clone(),t.addClass("cn"),t.css({top:0,left:r/2}),this.$el.append(t),t=n.clone(),t.addClass("cs"),t.css({top:s,left:r/2}),this.$el.append(t),t=n.clone(),t.addClass("ce"),t.css({top:s/2,left:r}),this.$el.append(t),t=n.clone(),t.addClass("cw"),t.css({top:s/2,left:0}),this.$el.append(t)),this.initializeConnectors()},t}),define("decorators/SVGDecorator/Core/SVGPort",["js/Constants","js/Utils/DisplayFormat","js/RegistryKeys","js/Widgets/DiagramDesigner/DiagramDesignerWidget.Constants"],function(e,t,n,i){"use strict";var o,r=e.ASSETS_DECORATOR_SVG_FOLDER,s="Port.svg";return o=function(e){this._id=e.id,this._logger=e.logger,this._client=e.client,this._decorator=e.decorator,this._initialize()},o.prototype.destroy=function(){this.hideConnectors(),this.$el&&(this.$el.remove(),this.$el.empty())},o.prototype._initialize=function(){this.$el=$("<div/>",{"class":"port"}),this.$title=$("<div/>",{"class":"title"}),this.$icon=$("<div/>",{"class":"icon"}),this.$connector=$("<div/>",{"class":i.CONNECTOR_CLASS}),this.$imgIcon=$("<img/>"),this.$icon.append(this.$imgIcon),this.$el.append(this.$icon).append(this.$title).append(this.$connector),this._decorator._displayConnectors===!0?(this._decorator.hostDesignerItem&&this._decorator.hostDesignerItem.registerConnectors(this.$connector,this._id),this.hideConnectors()):this.$connector.remove()},o.prototype.update=function(){this._updateCoordinates(),this._updateTitle(),this._updateIcon()},o.prototype._updateCoordinates=function(){var e=this._client.getNode(this._id);this.positionX=parseInt(e.getRegistry(n.POSITION).x,10),this.positionY=parseInt(e.getRegistry(n.POSITION).y,10)},o.prototype._updateTitle=function(){var e=this._client.getNode(this._id),n=t.resolve(e);this.$title.text(n),this.$title.attr("title",n)},o.prototype._updateIcon=function(){var e=this._client.getNode(this._id),t=e.getRegistry(n.PORT_SVG_ICON);t=t&&""!==t?r+t:r+s,this.$imgIcon.attr("src",t)},o.prototype.updateOrientation=function(e){this.isLeft=e},o.prototype.updateTop=function(e){this.$el.css("top",e),this.top=e},o.prototype.showConnectors=function(){this.$connector.show()},o.prototype.hideConnectors=function(){this.$connector.hide()},o}),define("decorators/SVGDecorator/Core/SVGDecorator.Ports",["js/Decorators/DecoratorWithPorts.Base","js/Widgets/DiagramDesigner/DiagramDesignerWidget.Constants","./SVGPort"],function(e,t,n){"use strict";var i,o=13,r=50;return i=function(){e.apply(this,[])},_.extend(i.prototype,e.prototype),i.prototype._initializePortVariables=function(){this._PORT_HEIGHT=o},i.prototype._updatePorts=function(){var e=this.$svgElement,t=parseInt(e.attr("width"),10),n=t/2;this._portContainerWidth=n,this.$leftPorts||(this.$leftPorts=$("<div/>",{"class":"ports ports-l"}),this.$leftPorts.insertAfter(this.$svgContent)),this.$leftPorts.css({width:n}),this.$rightPorts||(this.$rightPorts=$("<div/>",{"class":"ports ports-r"}),this.$rightPorts.insertAfter(this.$svgContent)),this.$rightPorts.css({width:n,left:n}),this.updatePortIDList();for(var i=0;i<this.portIDs.length;i+=1)this.ports[this.portIDs[i]].update();this._updatePortPositions()},i.prototype._fixPortContainerPosition=function(e){this._portContainerXShift=e,this.$leftPorts.css("transform","translateX("+e+"px)"),this.$rightPorts.css("transform","translateX("+e+"px)")},i.prototype.renderPort=function(e){return new n({id:e,logger:this.logger,client:this._control._client,decorator:this})},i.prototype._updatePortPositions=function(){var e,n,i,s,a,l,c,d,h,p=[],g=[],u=300,f=2,m=1,_=this.ports;for(e=0;e<this.portIDs.length;e+=1)this.ports[this.portIDs[e]].positionX>u?g.push(this.portIDs[e]):p.push(this.portIDs[e]);for(n=function(e,t){var n=_[e].positionY,i=_[t].positionY;return n-i},p.sort(n),g.sort(n),e=0;e<p.length;e+=1)i=_[p[e]],this.$leftPorts.append(i.$el),i.updateOrientation(!0),i.updateTop(m+e*o);for(this.$leftPorts.css("height",p.length*o),this.$leftPorts.find(".port > .title").css("left",f),this.$leftPorts.find(".port > .title").css("width",this._portContainerWidth-f),this.$leftPorts.find(".port > .icon").css("left",-o),this.$leftPorts.find(".port > ."+t.CONNECTOR_CLASS).css("left",-o+1),e=0;e<g.length;e+=1)i=_[g[e]],this.$rightPorts.append(i.$el),i.updateOrientation(!1),i.updateTop(m+e*o);this.$rightPorts.css("height",g.length*o),this.$rightPorts.find(".port > .title").css("right",-this._portContainerWidth+f),this.$rightPorts.find(".port > .title").css("width",this._portContainerWidth-f),this.$rightPorts.find(".port > .icon").css("left",this._portContainerWidth),this.$rightPorts.find(".port > ."+t.CONNECTOR_CLASS).css("left",this._portContainerWidth),this._leftPorts=p.length>0,this._rightPorts=g.length>0,l=Math.max(p.length*o,g.length*o,r),l=Math.max(p.length*o,g.length*o,r),this._defaultSVGUsed===!0&&(s=this.$svgElement,a=s.find("rect"),s.attr("height",l),a.attr("height",l-1),c=this.$el.find("."+t.CONNECTOR_CLASS+".cs"),c.css("top",l)),this._leftPorts&&(d=this.$el.find("."+t.CONNECTOR_CLASS+".cw"),d.css("top",l/2),d.remove()),this._rightPorts&&(h=this.$el.find("."+t.CONNECTOR_CLASS+".ce"),h.css("top",l/2),h.remove())},i.prototype._updatePort=function(e){var t=this.isPort(e);this.ports[e]?t===!0?this.ports[e].update():this.removePort(e):(this.addPort(e),this.ports[e]&&this.ports[e].update()),this._updatePortPositions()},i}),define("decorators/SVGDecorator/DiagramDesigner/SVGDecorator.Core",["../Core/SVGDecorator.Core","../Core/SVGDecorator.Connections","../Core/SVGDecorator.Connectors","../Core/SVGDecorator.Ports"],function(e,t,n,i){"use strict";var o=function(t){var n=_.extend({},t);e.apply(this,[n]),this.setConnectionAreaDefaults({angle1:0,angle2:0,len:20})};return _.extend(o.prototype,e.prototype),_.extend(o.prototype,i.prototype),_.extend(o.prototype,t.prototype),_.extend(o.prototype,n.prototype),o}),define("css!decorators/SVGDecorator/DiagramDesigner/SVGDecorator.DiagramDesignerWidget",[],function(){}),define("decorators/SVGDecorator/DiagramDesigner/SVGDecorator.DiagramDesignerWidget",["js/Constants","js/NodePropertyNames","js/Widgets/DiagramDesigner/DiagramDesignerWidget.DecoratorBaseWithDragPointerHelpers","js/Widgets/DiagramDesigner/DiagramDesignerWidget.Constants","text!../Core/SVGDecorator.html","./SVGDecorator.Core","css!./SVGDecorator.DiagramDesignerWidget"],function(e,t,n,i,o,r){"use strict";var s,a="SVGDecoratorDiagramDesignerWidget";return s=function(e){var t=_.extend({},e);n.apply(this,[t]),r.apply(this,[t]),this._initializeVariables({connectors:!0}),this._selfPatterns={},this.logger.debug("SVGDecoratorDiagramDesignerWidget ctor")},_.extend(s.prototype,n.prototype),_.extend(s.prototype,r.prototype),s.prototype.DECORATORID=a,s.prototype.$DOMBase=$(o),s.prototype.on_addTo=function(){var e=this;this._renderContent(),this.$name.on("dblclick.editOnDblClick",null,function(t){e.hostDesignerItem.canvas.getIsReadOnlyMode()!==!0&&$(this).editInPlace({"class":"",value:e.name,onChange:function(t,n){e.__onNodeTitleChanged(t,n)},onFinish:function(){e.$name.text(e.formattedName),e.$name.attr("title",e.formattedName)}}),t.stopPropagation(),t.preventDefault()}),this._updateDropArea()},s.prototype.update=function(){this._update(),this._updateDropArea()},s.prototype.onRenderGetLayoutInfo=function(){this.svgContainerWidth=this.$svgContent.outerWidth(!0),this.svgWidth=this.$svgContent.find("svg").outerWidth(!0),this.svgHeight=this.$svgContent.find("svg").outerHeight(!0),this.svgBorderWidth=parseInt(this.$svgContent.find("svg").css("border-width"),10),n.prototype.onRenderGetLayoutInfo.call(this)},s.prototype.onRenderSetLayoutInfo=function(){var e=Math.ceil((this.svgContainerWidth-this.svgWidth)/2+this.svgBorderWidth),t=this.$el.find("> ."+i.CONNECTOR_CLASS);t.css("transform","translateX("+e+"px)"),this._fixPortContainerPosition(e),n.prototype.onRenderSetLayoutInfo.call(this)},s.prototype.getConnectionAreas=function(e){var t=[],n=10,i=20,o=(this.svgContainerWidth-this.svgWidth)/2;if(void 0===e||e===this.hostDesignerItem.id)if(this._customConnectionAreas&&this._customConnectionAreas.length>0){t=$.extend(!0,[],this._customConnectionAreas);for(var r=t.length;r--;)t[r].x1+=o,t[r].x2+=o}else t.push({id:"N",x1:n+o,y1:0,x2:this.svgWidth-n+o,y2:0,angle1:270,angle2:270,len:i}),t.push({id:"S",x1:n+o,y1:this.svgHeight,x2:this.svgWidth-n+o,y2:this.svgHeight,angle1:90,angle2:90,len:i}),this._rightPorts!==!0&&t.push({id:"E",x1:this.svgWidth+o,y1:n,x2:this.svgWidth+o,y2:this.svgHeight-n,angle1:0,angle2:0,len:i}),this._leftPorts!==!0&&t.push({id:"W",x1:0+o,y1:n,x2:0+o,y2:this.svgHeight-n,angle1:180,angle2:180,len:i});else if(this.ports[e]){var s=this.ports[e].top,a=this.ports[e].isLeft,l=this._portContainerXShift+(a?1:this.svgWidth-1),c=a?180:0;t.push({id:e,x1:l,y1:s+this._PORT_HEIGHT/2,x2:l,y2:s+this._PORT_HEIGHT/2,angle1:c,angle2:c,len:i})}return t},s.prototype.showSourceConnectors=function(e){var t,n;if(e)for(t=e.connectors,n=t.length;n--;)void 0===t[n]?this.$sourceConnectors.show():this.ports[t[n]]&&this.ports[t[n]].showConnectors();else if(this.$sourceConnectors.show(),this.portIDs)for(n=this.portIDs.length;n--;)this.ports[this.portIDs[n]].showConnectors()},s.prototype.hideSourceConnectors=function(){var e;if(this.$sourceConnectors.hide(),this.portIDs)for(e=this.portIDs.length;e--;)this.ports[this.portIDs[e]].hideConnectors()},s.prototype.showEndConnectors=function(e){this.showSourceConnectors(e)},s.prototype.hideEndConnectors=function(){this.hideSourceConnectors()},s.prototype.__onNodeTitleChanged=function(n,i){var o=this._control._client;o.setAttribute(this._metaInfo[e.GME_ID],t.Attributes.name,i)},s.prototype.updateSubcomponent=function(e){this._updatePort(e)},s.prototype.renderPort=function(e){return this.__registerAsSubcomponent(e),r.prototype.renderPort.call(this,e)},s.prototype.removePort=function(e){var t=this.portIDs.indexOf(e);-1!==t&&this.__unregisterAsSubcomponent(e),r.prototype.removePort.call(this,e)},s.prototype.__registerAsSubcomponent=function(e){this.hostDesignerItem&&this.hostDesignerItem.registerSubcomponent(e,{GME_ID:e})},s.prototype.__unregisterAsSubcomponent=function(e){this.hostDesignerItem&&this.hostDesignerItem.unregisterSubcomponent(e)},s.prototype.notifyComponentEvent=function(e){for(var t=e.length;t--;)this._updatePort(e[t].id)},s.prototype._updateDropArea=function(){this._getPointerNames().length>0||this._isReplaceable()?this._enableDragEvents():this._disableDragEvents()},s}),define("decorators/SVGDecorator/PartBrowser/SVGDecorator.Core",["../Core/SVGDecorator.Core","../Core/SVGDecorator.Connections","../Core/SVGDecorator.Connectors","../Core/SVGDecorator.Ports"],function(e,t,n,i){"use strict";var o=function(t){var n=_.extend({},t);e.apply(this,[n]),this.setConnectionAreaDefaults({angle1:0,angle2:0,len:20})};return _.extend(o.prototype,e.prototype),_.extend(o.prototype,i.prototype),_.extend(o.prototype,t.prototype),o}),define("css!decorators/SVGDecorator/PartBrowser/SVGDecorator.PartBrowserWidget",[],function(){}),define("decorators/SVGDecorator/PartBrowser/SVGDecorator.PartBrowserWidget",["js/Constants","js/NodePropertyNames","js/Widgets/PartBrowser/PartBrowserWidget.DecoratorBase","js/Widgets/DiagramDesigner/DiagramDesignerWidget.Constants","text!../Core/SVGDecorator.html","./SVGDecorator.Core","css!./SVGDecorator.PartBrowserWidget"],function(e,t,n,i,o,r){"use strict";var s,a="SVGDecoratorPartBrowserWidget";return s=function(e){var t=_.extend({},e);n.apply(this,[t]),r.apply(this,[t]),this._initializeVariables({connectors:!1}),this.logger.debug("SVGDecoratorPartBrowserWidget ctor")},_.extend(s.prototype,n.prototype),_.extend(s.prototype,r.prototype),s.prototype.DECORATORID=a,s.prototype.$DOMBase=function(){var e=$(o);return e.find("."+i.CONNECTOR_CLASS).remove(),e}(),s.prototype.beforeAppend=function(){this.$el=this.$DOMBase.clone(),this._renderContent()},s.prototype.afterAppend=function(){},s.prototype.update=function(){this._update()},s.prototype.afterAppend=function(){this.svgContainerWidth=this.$svgContent.outerWidth(!0),this.svgWidth=this.$svgContent.find("svg").outerWidth(!0),this.svgHeight=this.$svgContent.find("svg").outerHeight(!0);var e=(this.svgContainerWidth-this.svgWidth)/2;this._fixPortContainerPosition(e)},s.prototype.notifyComponentEvent=function(e){for(var t=e.length;t--;)this._updatePort(e[t])},s}),define("decorators/SVGDecorator/SVGDecorator",["js/Decorators/DecoratorBase","./DiagramDesigner/SVGDecorator.DiagramDesignerWidget","./PartBrowser/SVGDecorator.PartBrowserWidget"],function(e,t,n){"use strict";var i,o="SVGDecorator";return i=function(t){var n=_.extend({loggerName:this.DECORATORID},t);e.apply(this,[n]),this.logger.debug("SVGDecorator ctor")},_.extend(i.prototype,e.prototype),i.prototype.DECORATORID=o,i.prototype.initializeSupportedWidgetMap=function(){this.supportedWidgetMap={DiagramDesigner:t,PartBrowser:n}},i}),define("../utils/build/dist/includes",["js/jquery.WebGME","js/WebGME","js/util","js/logger","js/Layouts/DefaultLayout/DefaultLayout","js/Panels/Header/HeaderPanel","js/Panels/FooterControls/FooterControlsPanel","js/Panels/ObjectBrowser/ObjectBrowserPanel","js/Panels/Visualizer/VisualizerPanel","js/Panels/PartBrowser/PartBrowserPanel","js/Panels/PropertyEditor/PropertyEditorPanel","js/Panels/MetaEditor/MetaEditorPanel","js/Panels/ModelEditor/ModelEditorPanel","js/Panels/SetEditor/SetEditorPanel","js/Panels/Crosscut/CrosscutPanel","js/Panels/GraphViz/GraphVizPanel","decorators/CircleDecorator/CircleDecorator","decorators/DefaultDecorator/DefaultDecorator","decorators/DocumentDecorator/DocumentDecorator","decorators/MetaDecorator/MetaDecorator","decorators/ModelDecorator/ModelDecorator","decorators/SVGDecorator/SVGDecorator"],function(){}),function(e){var t=document,n="appendChild",i="styleSheet",o=t.createElement("style");o.type="text/css",t.getElementsByTagName("head")[0][n](o),o[i]?o[i].cssText=e:o[n](t.createTextNode(e))}('.loader-bg {\r\n  position: absolute;\r\n  width: 100%;\r\n  height: 100%;\r\n  top: 0;\r\n  left: 0;\r\n  margin: 0;\r\n  /*background-color: $loader-bg-background-color;\r\n  opacity: $loader-bg-opacity;*/\r\n  z-index: 12000; }\r\n\r\n.loader-container {\r\n  position: absolute;\r\n  width: 86px;\r\n  height: 86px;\r\n  line-height: 86px;\r\n  text-align: center;\r\n  border-radius: 10px;\r\n  top: 50%;\r\n  left: 50%;\r\n  margin: -43px 0 0 -43px;\r\n  background-color: transparent;\r\n  opacity: 1; }\r\n  .loader-container .circle-o {\r\n    background-color: transparent;\r\n    border: 5px solid rgba(82, 168, 236, 0.9);\r\n    opacity: 0.9;\r\n    border-right: 5px solid transparent;\r\n    border-left: 5px solid transparent;\r\n    border-radius: 50px;\r\n    box-shadow: 0 0 36px #52a8ec;\r\n    width: 50px;\r\n    height: 50px;\r\n    margin: 12px auto;\r\n    -moz-animation: spinPulse 1s infinite linear;\r\n    -webkit-animation: spinPulse 1s infinite linear;\r\n    -o-animation: spinPulse 1s infinite linear;\r\n    animation: spinPulse 1s infinite linear; }\r\n  .loader-container .circle-i {\r\n    background-color: transparent;\r\n    border: 5px solid rgba(82, 168, 236, 0.9);\r\n    opacity: 0.9;\r\n    border-left: 5px solid transparent;\r\n    border-right: 5px solid transparent;\r\n    border-radius: 30px;\r\n    box-shadow: 0 0 15px #52a8ec;\r\n    width: 30px;\r\n    height: 30px;\r\n    margin: 0 auto;\r\n    position: relative;\r\n    top: -52px;\r\n    -moz-animation: spinoffPulse 1s infinite linear;\r\n    -webkit-animation: spinoffPulse 1s infinite linear;\r\n    -o-animation: spinoffPulse 1s infinite linear;\r\n    animation: spinoffPulse 1s infinite linear; }\r\n  .loader-container.stop .circle-o,\r\n  .loader-container.stop .circle-i {\r\n    -webkit-animation-play-state: paused;\r\n    -moz-animation-play-state: paused;\r\n    -o-animation-play-state: paused;\r\n    animation-play-state: paused; }\r\n\r\n@keyframes spinPulse {\r\n  0% {\r\n    transform: rotate(160deg);\r\n    opacity: 0;\r\n    box-shadow: 0 0 1px #52a8ec; }\r\n\r\n  50% {\r\n    transform: rotate(145deg);\r\n    opacity: 1; }\r\n\r\n  100% {\r\n    transform: rotate(-320deg);\r\n    opacity: 0; } }\r\n@keyframes spinoffPulse {\r\n  0% {\r\n    transform: rotate(0deg); }\r\n\r\n  100% {\r\n    transform: rotate(360deg); } }\r\n@-moz-keyframes spinPulse {\r\n  0% {\r\n    -moz-transform: rotate(160deg);\r\n    opacity: 0;\r\n    box-shadow: 0 0 1px #52a8ec; }\r\n\r\n  50% {\r\n    -moz-transform: rotate(145deg);\r\n    opacity: 1; }\r\n\r\n  100% {\r\n    -moz-transform: rotate(-320deg);\r\n    opacity: 0; } }\r\n@-moz-keyframes spinoffPulse {\r\n  0% {\r\n    -moz-transform: rotate(0deg); }\r\n\r\n  100% {\r\n    -moz-transform: rotate(360deg); } }\r\n@-webkit-keyframes spinPulse {\r\n  0% {\r\n    -webkit-transform: rotate(160deg);\r\n    opacity: 0;\r\n    box-shadow: 0 0 1px #52a8ec; }\r\n\r\n  50% {\r\n    -webkit-transform: rotate(145deg);\r\n    opacity: 1; }\r\n\r\n  100% {\r\n    -webkit-transform: rotate(-320deg);\r\n    opacity: 0; } }\r\n@-webkit-keyframes spinoffPulse {\r\n  0% {\r\n    -webkit-transform: rotate(0deg); }\r\n\r\n  100% {\r\n    -webkit-transform: rotate(360deg); } }\r\n@-o-keyframes spinPulse {\r\n  0% {\r\n    -o-transform: rotate(160deg);\r\n    opacity: 0;\r\n    box-shadow: 0 0 1px #52a8ec; }\r\n\r\n  50% {\r\n    -o-transform: rotate(145deg);\r\n    opacity: 1; }\r\n\r\n  100% {\r\n    -o-transform: rotate(-320deg);\r\n    opacity: 0; } }\r\n@-o-keyframes spinoffPulse {\r\n  0% {\r\n    -o-transform: rotate(0deg); }\r\n\r\n  100% {\r\n    -o-transform: rotate(360deg); } }\r\n/*\r\n * Copyright (C) 2013 Vanderbilt University, All rights reserved.\r\n * \r\n * Author: Robert Kereskenyi\r\n */\r\ndiv.asset-widget {\r\n  height: 25px;\r\n  line-height: 25px;\r\n  vertical-align: middle;\r\n  width: 50%;\r\n  border-radius: 4px;\r\n  position: relative;\r\n  background-color: rgba(0, 0, 0, 0.025);\r\n  border: 1px dashed #aaaaaa; }\r\n  div.asset-widget .btn-dialog-open {\r\n    position: absolute;\r\n    right: 0;\r\n    top: 0;\r\n    padding: 0 3px; }\r\n  div.asset-widget .upload-progress-bar {\r\n    width: 0;\r\n    display: inline-block;\r\n    height: 100%;\r\n    overflow: hidden;\r\n    text-overflow: ellipsis;\r\n    color: #3160ab;\r\n    background-color: #96e096;\r\n    font-size: 10px;\r\n    border-radius: 4px;\r\n    padding-left: 4px; }\r\n  div.asset-widget a {\r\n    white-space: nowrap;\r\n    display: inline-block;\r\n    max-width: 100%;\r\n    padding-right: 20px;\r\n    padding-left: 1ex;\r\n    overflow: hidden;\r\n    text-overflow: ellipsis; }\r\n  div.asset-widget.hover {\r\n    /*background-color: yellow;*/\r\n    border-color: rgba(82, 168, 236, 0.8);\r\n    background-color: rgba(82, 168, 236, 0.1);\r\n    outline: 0;\r\n    outline: thin dotted \\9;\r\n    /* IE6-9 */\r\n    -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6);\r\n    -moz-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6);\r\n    box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6); }\r\n/*\r\n * @author pmeijer / https://github.com/pmeijer\r\n */\r\ndiv.create-new-project-dialog div.modal-content div.modal-header .header-icon {\r\n  height: 24px;\r\n  width: 24px;\r\n  margin-right: 1ex;\r\n  display: inline-block;\r\n  vertical-align: middle;\r\n  background-size: 24px 24px; }\r\ndiv.create-new-project-dialog div.modal-content div.modal-header span {\r\n  font-size: 24px;\r\n  vertical-align: middle; }\r\ndiv.create-new-project-dialog div.modal-content div.pre-body {\r\n  padding: 15px 15px 0 15px; }\r\n  div.create-new-project-dialog div.modal-content div.pre-body .tabContainer ul.nav.nav-tabs {\r\n    margin-bottom: 0; }\r\n    div.create-new-project-dialog div.modal-content div.pre-body .tabContainer ul.nav.nav-tabs li {\r\n      width: 86px;\r\n      text-align: center; }\r\n      div.create-new-project-dialog div.modal-content div.pre-body .tabContainer ul.nav.nav-tabs li.disabled-from-config {\r\n        display: none; }\r\ndiv.create-new-project-dialog div.modal-content div.modal-body form.form-horizontal {\r\n  display: none; }\r\n  div.create-new-project-dialog div.modal-content div.modal-body form.form-horizontal.activated {\r\n    display: inherit; }\r\n  div.create-new-project-dialog div.modal-content div.modal-body form.form-horizontal span.selection .selector {\r\n    display: inline-block;\r\n    width: 100%;\r\n    padding: 0; }\r\n    div.create-new-project-dialog div.modal-content div.modal-body form.form-horizontal span.selection .selector.widget {\r\n      border: none; }\r\n  div.create-new-project-dialog div.modal-content div.modal-body form.form-horizontal span.selection .asset-widget {\r\n    width: 100%;\r\n    height: 100%;\r\n    padding-top: 0.3ex; }\r\n    div.create-new-project-dialog div.modal-content div.modal-body form.form-horizontal span.selection .asset-widget a.btn-dialog-open {\r\n      font-size: 120%;\r\n      padding-top: 0.6ex; }\r\n  div.create-new-project-dialog div.modal-content div.modal-body form.form-horizontal span.selection.selection-blob {\r\n    padding: 0; }\r\n  div.create-new-project-dialog div.modal-content div.modal-body form.form-horizontal i.toggle-info-btn {\r\n    font-size: 65%;\r\n    vertical-align: top;\r\n    cursor: pointer;\r\n    color: #333; }\r\n    div.create-new-project-dialog div.modal-content div.modal-body form.form-horizontal i.toggle-info-btn:hover {\r\n      color: #2a6496; }\r\n  div.create-new-project-dialog div.modal-content div.modal-body form.form-horizontal span.type-description {\r\n    display: inline-block;\r\n    width: 95%;\r\n    margin-bottom: 2ex;\r\n    margin-left: 0.5ex;\r\n    opacity: 0.90; }\r\n    div.create-new-project-dialog div.modal-content div.modal-body form.form-horizontal span.type-description.hidden {\r\n      display: none; }\r\ndiv.create-new-project-dialog div.modal-content div.modal-footer button.btn-create {\r\n  display: none; }\r\n  div.create-new-project-dialog div.modal-content div.modal-footer button.btn-create.activated {\r\n    display: inline-block; }/*\r\n * @author pmeijer / https://github.com/pmeijer\r\n */\r\ndiv.confirm-dialog .modal-content.info .modal-header .header-icon {\r\n  color: #2e6da4; }\r\ndiv.confirm-dialog .modal-content.warning .modal-header .header-icon {\r\n  color: #f0ad4e; }\r\ndiv.confirm-dialog .modal-content .question-text {\r\n  font-size: 14px; }\r\ndiv.confirm-dialog .modal-content .delete-item {\r\n  text-align: center;\r\n  font-size: 20px;\r\n  margin-top: 14px;\r\n  font-weight: bold; }\r\ndiv.confirm-dialog .modal-content .modal-header .header-icon {\r\n  font-size: 20px;\r\n  margin-right: 1ex;\r\n  display: inline-block;\r\n  color: #d9534f; }\r\ndiv.confirm-dialog .modal-content .modal-header span {\r\n  font-size: 24px; }\r\ndiv.confirm-dialog .modal-footer form .do-not-show {\r\n  display: none; }\r\ndiv.confirm-dialog .modal-footer form label {\r\n  font-weight: lighter; }\r\n.projects-dialog .modal-content.in-background {\r\n  opacity: 0; }\r\n  .projects-dialog .modal-content.in-background * {\r\n    opacity: 0.4; }\r\n.projects-dialog .modal-content .modal-header .header-icon {\r\n  height: 28px;\r\n  width: 28px;\r\n  margin-right: 1ex;\r\n  display: inline-block;\r\n  vertical-align: middle;\r\n  background-size: 28px 28px; }\r\n.projects-dialog .modal-content .modal-header span {\r\n  font-size: 28px;\r\n  vertical-align: middle; }\r\n.projects-dialog .modal-content .pre-body {\r\n  padding: 15px 15px 0 15px; }\r\n  .projects-dialog .modal-content .pre-body .tabContainer ul.nav.nav-tabs {\r\n    margin-bottom: 0; }\r\n    .projects-dialog .modal-content .pre-body .tabContainer ul.nav.nav-tabs li {\r\n      width: 86px;\r\n      text-align: center; }\r\n.projects-dialog .modal-content .modal-body {\r\n  min-height: 300px; }\r\n  .projects-dialog .modal-content .modal-body ul.nav-pills li a span.ro {\r\n    margin-left: 5px;\r\n    color: #999999;\r\n    font-size: 9px; }\r\n  .projects-dialog .modal-content .modal-body table.table.table-projects .info-hidden {\r\n    display: none; }\r\n  .projects-dialog .modal-content .modal-body table.table.table-projects.no-children tr.with-children {\r\n    display: none; }\r\n  .projects-dialog .modal-content .modal-body table.table.table-projects.no-children tr.with-no-children {\r\n    display: inherit; }\r\n    .projects-dialog .modal-content .modal-body table.table.table-projects.no-children tr.with-no-children th {\r\n      border-bottom: white;\r\n      border-top: white;\r\n      font-style: italic;\r\n      padding-left: 20px;\r\n      cursor: default; }\r\n  .projects-dialog .modal-content .modal-body table.table.table-projects thead th {\r\n    text-align: left;\r\n    cursor: pointer;\r\n    border-bottom-width: 1px; }\r\n    .projects-dialog .modal-content .modal-body table.table.table-projects thead th.reverse-order i.sorted.rev-order {\r\n      display: inline-block;\r\n      visibility: visible;\r\n      font-size: 90%;\r\n      padding-left: 1px; }\r\n    .projects-dialog .modal-content .modal-body table.table.table-projects thead th.reverse-order i.sorted.in-order {\r\n      display: none; }\r\n    .projects-dialog .modal-content .modal-body table.table.table-projects thead th.in-order i.sorted.in-order {\r\n      display: inline-block;\r\n      visibility: visible;\r\n      font-size: 90%;\r\n      padding-left: 1px; }\r\n    .projects-dialog .modal-content .modal-body table.table.table-projects thead th.in-order i.sorted.rev-order {\r\n      display: none; }\r\n    .projects-dialog .modal-content .modal-body table.table.table-projects thead th i.sorted {\r\n      visibility: hidden;\r\n      display: inline-block; }\r\n      .projects-dialog .modal-content .modal-body table.table.table-projects thead th i.sorted.rev-order {\r\n        display: none; }\r\n    .projects-dialog .modal-content .modal-body table.table.table-projects thead th.title-icons {\r\n      text-align: right;\r\n      padding: 0; }\r\n  .projects-dialog .modal-content .modal-body table.table.table-projects thead tr.with-no-children {\r\n    display: none; }\r\n  .projects-dialog .modal-content .modal-body table.table.table-projects tbody.project-list tr.project-row:hover td {\r\n    background-color: #f5f5f5; }\r\n  .projects-dialog .modal-content .modal-body table.table.table-projects tbody.project-list tr.project-row.active td {\r\n    background-color: #a5afbe; }\r\n  .projects-dialog .modal-content .modal-body table.table.table-projects tbody.project-list tr.project-row.active:hover td {\r\n    background-color: #a5afbe !important; }\r\n  .projects-dialog .modal-content .modal-body table.table.table-projects tbody.project-list tr.project-row.read-only td {\r\n    opacity: 1; }\r\n    .projects-dialog .modal-content .modal-body table.table.table-projects tbody.project-list tr.project-row.read-only td.name span.name-read-only {\r\n      display: inline-block;\r\n      color: grey;\r\n      padding-left: 0.5ex; }\r\n  .projects-dialog .modal-content .modal-body table.table.table-projects tbody.project-list tr.project-row.filtered-out {\r\n    display: none; }\r\n  .projects-dialog .modal-content .modal-body table.table.table-projects tbody.project-list tr.project-row td {\r\n    text-align: left;\r\n    border-top: none; }\r\n    .projects-dialog .modal-content .modal-body table.table.table-projects tbody.project-list tr.project-row td.name {\r\n      color: #3160ab; }\r\n      .projects-dialog .modal-content .modal-body table.table.table-projects tbody.project-list tr.project-row td.name span.open-link {\r\n        cursor: pointer; }\r\n        .projects-dialog .modal-content .modal-body table.table.table-projects tbody.project-list tr.project-row td.name span.open-link:hover {\r\n          text-decoration: underline;\r\n          color: #ff7700; }\r\n      .projects-dialog .modal-content .modal-body table.table.table-projects tbody.project-list tr.project-row td.name span.name-read-only {\r\n        display: none; }\r\n    .projects-dialog .modal-content .modal-body table.table.table-projects tbody.project-list tr.project-row td.icons {\r\n      text-align: right; }\r\n      .projects-dialog .modal-content .modal-body table.table.table-projects tbody.project-list tr.project-row td.icons i.delete-project {\r\n        cursor: pointer;\r\n        color: darkred; }\r\n        .projects-dialog .modal-content .modal-body table.table.table-projects tbody.project-list tr.project-row td.icons i.delete-project:hover {\r\n          color: #b30404; }\r\n    .projects-dialog .modal-content .modal-body table.table.table-projects tbody.project-list tr.project-row td.modified {\r\n      font-style: italic;\r\n      color: grey; }\r\n    .projects-dialog .modal-content .modal-body table.table.table-projects tbody.project-list tr.project-row td.viewed {\r\n      font-style: italic;\r\n      color: grey; }\r\n    .projects-dialog .modal-content .modal-body table.table.table-projects tbody.project-list tr.project-row td.created {\r\n      font-style: italic;\r\n      color: grey; }\r\n.projects-dialog .modal-content .modal-footer button.corner-button {\r\n  margin-top: 0.5ex; }\r\n.projects-dialog .modal-content .modal-footer ul.dropdown-menu {\r\n  min-width: 0;\r\n  text-align: left; }\r\n  .projects-dialog .modal-content .modal-footer ul.dropdown-menu a {\r\n    cursor: pointer; }\r\n\r\n.txt-project-name {\r\n  width: 50%; }\r\ndiv.iCheckBox {\r\n  width: 70px;\r\n  height: 18.2px;\r\n  display: inline-block;\r\n  border-radius: 3px;\r\n  position: relative;\r\n  cursor: pointer;\r\n  background: -moz-linear-gradient(top, #cbcbcb, white);\r\n  background: -webkit-linear-gradient(top, #cbcbcb, white);\r\n  background: -o-linear-gradient(top, #cbcbcb, white);\r\n  background: linear-gradient(to bottom, #cbcbcb, white);\r\n  box-shadow: 0 0 2px rgba(0, 0, 0, 0.4), inset 0 0 2px rgba(0, 0, 0, 0.8);\r\n  transition: opacity .3s; }\r\n  div.iCheckBox .sw {\r\n    width: 50%;\r\n    height: 100%;\r\n    background: -moz-linear-gradient(top, #d4d4d4, white);\r\n    background: -webkit-linear-gradient(top, #d4d4d4, white);\r\n    background: -o-linear-gradient(top, #d4d4d4, white);\r\n    background: linear-gradient(to bottom, #d4d4d4, white);\r\n    border-radius: 3px;\r\n    display: inline-block;\r\n    position: absolute;\r\n    border: 1px solid #c4c4c4;\r\n    text-align: center; }\r\n    div.iCheckBox .sw [class^="icon-"],\r\n    div.iCheckBox .sw [class*=" icon-"] {\r\n      font-size: 130%;\r\n      position: relative;\r\n      top: -6%; }\r\n  div.iCheckBox .txt {\r\n    width: 36.8px;\r\n    height: 18.2px;\r\n    line-height: 18.2px;\r\n    display: inline-block;\r\n    position: absolute;\r\n    left: 33.2px;\r\n    font-size: 9.1px;\r\n    font-weight: bold;\r\n    text-align: center;\r\n    color: #666666;\r\n    overflow: hidden; }\r\n  div.iCheckBox.checked {\r\n    background: -moz-linear-gradient(top, #3160ab, #082c67);\r\n    background: -webkit-linear-gradient(top, #3160ab, #082c67);\r\n    background: -o-linear-gradient(top, #3160ab, #082c67);\r\n    background: linear-gradient(to bottom, #3160ab, #082c67); }\r\n    div.iCheckBox.checked .sw {\r\n      left: 36.8px; }\r\n    div.iCheckBox.checked .txt {\r\n      left: 0;\r\n      color: white; }\r\n  div.iCheckBox.disabled {\r\n    opacity: 0.5; }\r\n\r\ndiv.iCheckBox:hover {\r\n  opacity: .8; }\r\n  div.iCheckBox:hover.disabled {\r\n    opacity: 0.5; }\r\n/*\r\n * Copyright (C) 2013 Vanderbilt University, All rights reserved.\r\n * \r\n * Author: Robert Kereskenyi\r\n */\r\n.sp-container .sp-palette .sp-thumb-el {\r\n  width: 13px;\r\n  height: 13px; }\r\n.sp-container .sp-thumb-active .sp-thumb-inner {\r\n  background-size: 15px 15px; }\r\n.sp-container .sp-clear {\r\n  cursor: pointer; }\r\n/*\r\n * Copyright (C) 2013 Vanderbilt University, All rights reserved.\r\n * \r\n * Author: Robert Kereskenyi\r\n */\r\n.ptr-widget {\r\n  height: 25px;\r\n  line-height: 25px;\r\n  vertical-align: middle;\r\n  border-radius: 4px;\r\n  position: relative;\r\n  background-color: rgba(0, 0, 0, 0.025);\r\n  padding-left: 3px; }\r\n  .ptr-widget.drop-area {\r\n    border: 1px dashed #aaaaaa; }\r\n    .ptr-widget.drop-area.accept-drop {\r\n      background-color: rgba(0, 255, 0, 0.1); }\r\n    .ptr-widget.drop-area.reject-drop {\r\n      background-color: rgba(255, 0, 0, 0.1); }\r\n  .ptr-widget i {\r\n    margin-top: 6px;\r\n    position: absolute;\r\n    right: 2px;\r\n    cursor: pointer; }\r\n\r\nspan.user-select-on.btn-follow-pointer {\r\n  font-size: 11px;\r\n  color: #3160ab;\r\n  padding-left: 0px;\r\n  padding-right: 0px; }\r\n  span.user-select-on.btn-follow-pointer:hover {\r\n    text-decoration: underline;\r\n    color: #ff7700; }\r\n\r\n.property-editor ul.nav {\r\n  position: relative;\r\n  margin-bottom: 0;\r\n  height: 24px;\r\n  white-space: nowrap; }\r\n  .property-editor ul.nav.nav-tabs > li {\r\n    display: inline-block;\r\n    float: none; }\r\n    .property-editor ul.nav.nav-tabs > li > a {\r\n      padding: 5px 3px 5px 3px;\r\n      line-height: 13px;\r\n      font-size: 11px; }\r\n      .property-editor ul.nav.nav-tabs > li > a .tab-title {\r\n        white-space: nowrap;\r\n        display: inline-block;\r\n        max-width: 120px;\r\n        overflow: hidden;\r\n        text-overflow: ellipsis; }\r\n.property-editor .tab-content {\r\n  overflow: visible; }\r\n/**\r\n * @author pmeijer / https://github.com/pmeijer\r\n */\r\n.multiselect-widget div.btn-group {\r\n  width: 100%; }\r\n  .multiselect-widget div.btn-group button.multiselect {\r\n    font-size: 11px;\r\n    padding: 6px 0;\r\n    width: 100%;\r\n    overflow: hidden;\r\n    text-overflow: ellipsis;\r\n    text-align: left; }\r\n  .multiselect-widget div.btn-group.open {\r\n    position: absolute;\r\n    width: inherit; }\r\n  .multiselect-widget div.btn-group ul.multiselect-container.dropdown-menu {\r\n    max-height: 200px;\r\n    min-width: 0;\r\n    padding: 0;\r\n    width: calc(100% - 6px); }\r\n    .multiselect-widget div.btn-group ul.multiselect-container.dropdown-menu li {\r\n      font-size: 11px;\r\n      padding: 0;\r\n      height: 17px;\r\n      border-bottom: none; }\r\n      .multiselect-widget div.btn-group ul.multiselect-container.dropdown-menu li .checkbox {\r\n        padding: 0 0 0 17px;\r\n        height: 17px; }\r\n      .multiselect-widget div.btn-group ul.multiselect-container.dropdown-menu li input[type=checkbox] {\r\n        height: 11px;\r\n        margin-top: 3px;\r\n        margin-left: -14px; }\r\n      .multiselect-widget div.btn-group ul.multiselect-container.dropdown-menu li label {\r\n        padding: 0 0 0 0;\r\n        overflow: hidden;\r\n        text-overflow: ellipsis; }\r\n      .multiselect-widget div.btn-group ul.multiselect-container.dropdown-menu li.multiselect-group {\r\n        margin-left: 4px;\r\n        margin-bottom: 8px; }\r\n      .multiselect-widget div.btn-group ul.multiselect-container.dropdown-menu li a {\r\n        background-image: none; }\r\n/**\r\n * @author kecso / https://github.com/kecso\r\n */\r\n.svgselect-widget {\r\n  width: 50px; }\r\n  .svgselect-widget div.btn-group {\r\n    width: 100%; }\r\n    .svgselect-widget div.btn-group button.multiselect {\r\n      font-size: 11px;\r\n      padding: 6px 0;\r\n      width: 100%;\r\n      overflow: hidden;\r\n      text-overflow: ellipsis;\r\n      text-align: center; }\r\n    .svgselect-widget div.btn-group.open {\r\n      position: absolute;\r\n      width: inherit; }\r\n    .svgselect-widget div.btn-group ul.svgselect-container.dropdown-menu {\r\n      max-height: 200px;\r\n      min-width: 0;\r\n      padding: 0;\r\n      width: calc(100% - 6px); }\r\n      .svgselect-widget div.btn-group ul.svgselect-container.dropdown-menu li {\r\n        font-size: 11px;\r\n        padding: 0;\r\n        height: 30px;\r\n        border-bottom: none; }\r\n        .svgselect-widget div.btn-group ul.svgselect-container.dropdown-menu li a {\r\n          background-image: none; }\r\n/*\r\n * Copyright (C) 2013 Vanderbilt University, All rights reserved.\r\n * \r\n * Author: Robert Kereskenyi\r\n */\r\n.plugin-config-dialog .modal-header img.plugin-icon {\r\n  width: 28px;\r\n  display: inline-block;\r\n  margin-right: 10px; }\r\n.plugin-config-dialog .modal-header i.plugin-icon {\r\n  font-size: 28px;\r\n  display: inline-block;\r\n  margin-right: 10px; }\r\n.plugin-config-dialog .modal-body {\r\n  padding: 15px; }\r\n  .plugin-config-dialog .modal-body .global-and-plugin-divider {\r\n    margin-top: 0;\r\n    margin-bottom: 10px; }\r\n.plugin-config-dialog .modal-footer {\r\n  padding: 10px;\r\n  margin-top: 5px; }\r\n.plugin-config-dialog .form-group {\r\n  margin-bottom: 10px; }\r\n  .plugin-config-dialog .form-group .row {\r\n    margin: 0 0; }\r\n  .plugin-config-dialog .form-group .controls .widget span {\r\n    margin-top: 5px;\r\n    font-size: 14px;\r\n    line-height: 20px;\r\n    display: block; }\r\n  .plugin-config-dialog .form-group .controls .widget .iCheckBox {\r\n    margin-top: 6px; }\r\n  .plugin-config-dialog .form-group .controls .widget div.color-picker {\r\n    height: 30px;\r\n    width: 100%;\r\n    margin-top: 0;\r\n    cursor: pointer;\r\n    border-radius: 4px; }\r\n  .plugin-config-dialog .form-group .controls .widget div.asset-widget {\r\n    height: 30px;\r\n    line-height: 30px;\r\n    width: 100%;\r\n    margin-top: 0; }\r\n    .plugin-config-dialog .form-group .controls .widget div.asset-widget .btn-dialog-open {\r\n      padding: 3px; }\r\n  .plugin-config-dialog .form-group .controls .widget input[type="text"] {\r\n    width: 100%;\r\n    padding: 0.5ex; }\r\n  .plugin-config-dialog .form-group div.desc {\r\n    font-size: 0.9em;\r\n    color: #444; }\r\n/**\r\n * @author rkereskenyi / https://github.com/rkereskenyi\r\n */\r\n.project-title {\r\n  margin-left: 10px;\r\n  margin-right: 10px; }\r\n  .project-title .title {\r\n    font-size: 20px;\r\n    font-weight: 200;\r\n    color: white; }\r\n  .project-title .readOnlyInfo {\r\n    display: none;\r\n    margin-left: 5px;\r\n    padding-right: 5px;\r\n    font-size: 12px;\r\n    font-weight: bold; }\r\n\r\n.read-only .project-title {\r\n  color: #777777; }\r\n  .read-only .project-title .readOnlyInfo {\r\n    display: inline-block; }\r\n/**\r\n * @author pmeijer / https://github.com/pmeijer\r\n */\r\n.connected-users-widget {\r\n  padding-right: 10px;\r\n  padding-left: 10px; }\r\n  .connected-users-widget .user-badge {\r\n    margin-left: 2px;\r\n    margin-right: 2px; }\r\n/**\r\n * @author rkereskenyi / https://github.com/rkereskenyi\r\n * @author nabana / https://github.com/nabana\r\n */\r\n.webgme-toolbar,\r\n.webgme-toolbar-ext {\r\n  white-space: nowrap; }\r\n  .webgme-toolbar .toolbar-button,\r\n  .webgme-toolbar-ext .toolbar-button {\r\n    display: inline-block;\r\n    position: relative; }\r\n  .webgme-toolbar .toolbar-drag-item,\r\n  .webgme-toolbar-ext .toolbar-drag-item {\r\n    display: inline-block;\r\n    position: relative; }\r\n  .webgme-toolbar .separator,\r\n  .webgme-toolbar-ext .separator {\r\n    margin-left: 0;\r\n    margin-right: 0;\r\n    border-right: 1px solid #DADFE7;\r\n    width: 0;\r\n    height: 26px;\r\n    display: inline-block;\r\n    vertical-align: middle;\r\n    position: relative; }\r\n  .webgme-toolbar .btn-group,\r\n  .webgme-toolbar-ext .btn-group {\r\n    margin-left: 0;\r\n    margin-right: 0; }\r\n  .webgme-toolbar .toolbar-input,\r\n  .webgme-toolbar-ext .toolbar-input {\r\n    display: inline-block;\r\n    margin-left: 2px;\r\n    position: relative; }\r\n    .webgme-toolbar .toolbar-input .input-append,\r\n    .webgme-toolbar .toolbar-input .input-prepend,\r\n    .webgme-toolbar-ext .toolbar-input .input-append,\r\n    .webgme-toolbar-ext .toolbar-input .input-prepend {\r\n      margin-bottom: 0; }\r\n  .webgme-toolbar .toolbar-label,\r\n  .webgme-toolbar-ext .toolbar-label {\r\n    display: inline-block;\r\n    margin-left: 2px;\r\n    position: relative;\r\n    font-size: 12px;\r\n    line-height: 22px;\r\n    height: 22px;\r\n    vertical-align: middle; }\r\n  .webgme-toolbar .toolbar-checkbox,\r\n  .webgme-toolbar-ext .toolbar-checkbox {\r\n    display: inline-block;\r\n    margin-left: 2px;\r\n    position: relative;\r\n    vertical-align: middle; }\r\n  .webgme-toolbar .dropdown-menu li .iCheckBox,\r\n  .webgme-toolbar-ext .dropdown-menu li .iCheckBox {\r\n    top: 1px; }\r\n  .webgme-toolbar .dropdown-menu li .dropdown-list-button.disabled,\r\n  .webgme-toolbar-ext .dropdown-menu li .dropdown-list-button.disabled {\r\n    color: gray;\r\n    cursor: not-allowed; }\r\n  .webgme-toolbar .toolbar-colorpicker,\r\n  .webgme-toolbar-ext .toolbar-colorpicker {\r\n    display: inline-block; }\r\n    .webgme-toolbar .toolbar-colorpicker input,\r\n    .webgme-toolbar-ext .toolbar-colorpicker input {\r\n      margin: 0;\r\n      width: 20px;\r\n      color: transparent !important; }\r\n    .webgme-toolbar .toolbar-colorpicker.input-append, .webgme-toolbar .toolbar-colorpicker.input-prepend,\r\n    .webgme-toolbar-ext .toolbar-colorpicker.input-append,\r\n    .webgme-toolbar-ext .toolbar-colorpicker.input-prepend {\r\n      margin-bottom: 0 !important; }\r\n      .webgme-toolbar .toolbar-colorpicker.input-append .add-on i:hover, .webgme-toolbar .toolbar-colorpicker.input-prepend .add-on i:hover,\r\n      .webgme-toolbar-ext .toolbar-colorpicker.input-append .add-on i:hover,\r\n      .webgme-toolbar-ext .toolbar-colorpicker.input-prepend .add-on i:hover {\r\n        cursor: pointer; }\r\n\r\n.webgme-toolbar-ext {\r\n  position: absolute;\r\n  right: 0;\r\n  margin-top: 1px;\r\n  padding: 0 3px 3px 0;\r\n  background: #F5F5F5;\r\n  border: 1px solid #bbbbbb;\r\n  display: none;\r\n  white-space: normal; }\r\n  .webgme-toolbar-ext.shown {\r\n    display: inline-block; }\r\n  .webgme-toolbar-ext > div {\r\n    margin-top: 2px; }\r\n\r\n.webgme-toolbar-ext-toggle {\r\n  display: inline-block;\r\n  position: absolute;\r\n  right: 2px;\r\n  top: 2px;\r\n  background-color: #F5F5F5;\r\n  height: 22px;\r\n  width: 7px;\r\n  cursor: pointer; }\r\n  .webgme-toolbar-ext-toggle:hover {\r\n    background-color: #E6E6E6; }\r\n  .webgme-toolbar-ext-toggle > i {\r\n    -webkit-transform: scale(0.5, 0.5);\r\n    -moz-transform: scale(0.5, 0.5);\r\n    -ms-transform: scale(0.5, 0.5);\r\n    -o-transform: scale(0.5, 0.5);\r\n    transform: scale(0.5, 0.5);\r\n    position: absolute;\r\n    top: 8px;\r\n    left: -3px; }\r\n  .webgme-toolbar-ext-toggle > i:last-child {\r\n    top: 11px; }\r\n\r\ndiv.toolbar-container {\r\n  position: relative;\r\n  /*overflow: hidden;*/\r\n  overflow-x: visible;\r\n  top: 34px;\r\n  height: 30px;\r\n  padding: 0; }\r\n\r\ndiv.toolbar-container .btn {\r\n  border: 1px solid #fff;\r\n  border-radius: 0;\r\n  padding: 1px 5px;\r\n  margin: 3px 5px !important;\r\n  box-shadow: none; }\r\n.txt-message {\r\n  max-width: 100%;\r\n  max-height: 500px; }\r\n.selected {\r\n  font-weight: bold; }\r\n\r\n.conflict-item {\r\n  cursor: pointer; }\r\n\r\n.commits {\r\n  /* Monospace stack */\r\n  font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace; }\r\n/**\r\n * @author rkereskenyi / https://github.com/rkereskenyi\r\n */\r\n/* make sure to update commit_WIDTH and commit_HEIGHT in Widgets/ProjectRepository/ProjectRepositoryWidget.js */\r\n.repository-dialog .modal-header > h3 {\r\n  margin-top: 0;\r\n  margin-bottom: 0; }\r\n\r\n.project-repository-widget {\r\n  /********* TABLE LAYOUT STYLES ************/ }\r\n  .project-repository-widget table.table.commit-list {\r\n    width: auto; }\r\n  .project-repository-widget table.no-commits-in-table {\r\n    display: none; }\r\n  .project-repository-widget .message-column {\r\n    width: 100%; }\r\n  .project-repository-widget .commits {\r\n    position: absolute;\r\n    width: 1px;\r\n    height: 1px;\r\n    top: 53.5px;\r\n    /*DISABLE OUTER BORDER WHEN FOCUSED*/ }\r\n    .project-repository-widget .commits:focus {\r\n      outline: none; }\r\n    .project-repository-widget .commits .commit {\r\n      position: absolute;\r\n      width: 8px;\r\n      height: 8px;\r\n      background-color: #000000;\r\n      border-radius: 5px; }\r\n      .project-repository-widget .commits .commit.actual {\r\n        background-color: #FF7800;\r\n        -moz-box-shadow: 0 0 10px 3px #FF7800;\r\n        -webkit-box-shadow: 0 0 10px 3px #FF7800;\r\n        box-shadow: 0 0 10px 3px #FF7800; }\r\n  .project-repository-widget .show-more {\r\n    height: 36px;\r\n    line-height: 36px;\r\n    background-color: #F7F7F7;\r\n    border-bottom: 1px solid #3a87ad;\r\n    border-top: 1px solid #3a87ad;\r\n    text-align: center;\r\n    margin-top: 15px;\r\n    position: relative; }\r\n    .project-repository-widget .show-more a:hover {\r\n      text-decoration: none; }\r\n  .project-repository-widget table tr {\r\n    height: 25px; }\r\n    .project-repository-widget table tr.in-selection {\r\n      background-color: lightskyblue; }\r\n    .project-repository-widget table tr th,\r\n    .project-repository-widget table tr td {\r\n      padding: 0 5px;\r\n      white-space: nowrap;\r\n      vertical-align: middle;\r\n      text-align: center; }\r\n      .project-repository-widget table tr th.actions,\r\n      .project-repository-widget table tr td.actions {\r\n        text-align: left; }\r\n        .project-repository-widget table tr th.actions button i,\r\n        .project-repository-widget table tr td.actions button i {\r\n          color: #404040; }\r\n        .project-repository-widget table tr th.actions > div.input-group,\r\n        .project-repository-widget table tr td.actions > div.input-group {\r\n          margin-bottom: 0;\r\n          display: inline-flex;\r\n          display: -webkit-inline-flex; }\r\n          .project-repository-widget table tr th.actions > div.input-group > input,\r\n          .project-repository-widget table tr td.actions > div.input-group > input {\r\n            height: 100%;\r\n            width: 150px;\r\n            padding: 3px 5px; }\r\n      .project-repository-widget table tr th.user-column,\r\n      .project-repository-widget table tr td.user-column {\r\n        text-align: right; }\r\n        .project-repository-widget table tr th.user-column .avatar-container .avatar-image,\r\n        .project-repository-widget table tr td.user-column .avatar-container .avatar-image {\r\n          width: 18px;\r\n          margin-left: 8px; }\r\n      .project-repository-widget table tr th.commit-hash,\r\n      .project-repository-widget table tr td.commit-hash {\r\n        font-family: Consolas, "Liberation Mono", Menlo, Courier, monospace; }\r\n        .project-repository-widget table tr th.commit-hash:hover,\r\n        .project-repository-widget table tr td.commit-hash:hover {\r\n          cursor: pointer;\r\n          text-decoration: underline;\r\n          color: #ff7700; }\r\n      .project-repository-widget table tr th div.commit-message,\r\n      .project-repository-widget table tr td div.commit-message {\r\n        overflow: hidden;\r\n        text-overflow: ellipsis;\r\n        text-align: left;\r\n        min-width: 200px; }\r\n      .project-repository-widget table tr th .common-label,\r\n      .project-repository-widget table tr td .common-label {\r\n        margin-right: 2px; }\r\n        .project-repository-widget table tr th .common-label i.icon-white,\r\n        .project-repository-widget table tr td .common-label i.icon-white {\r\n          margin-left: 2px;\r\n          font-size: 10px; }\r\n          .project-repository-widget table tr th .common-label i.icon-white:hover,\r\n          .project-repository-widget table tr td .common-label i.icon-white:hover {\r\n            cursor: pointer;\r\n            color: darkred; }\r\n        .project-repository-widget table tr th .common-label .select-branch-in-text:hover,\r\n        .project-repository-widget table tr td .common-label .select-branch-in-text:hover {\r\n          cursor: pointer;\r\n          font-weight: bold; }\r\n        .project-repository-widget table tr th .common-label i.tag-label-icon,\r\n        .project-repository-widget table tr td .common-label i.tag-label-icon {\r\n          padding-right: 5px;\r\n          font-size: 9px; }\r\n        .project-repository-widget table tr th .common-label.label,\r\n        .project-repository-widget table tr td .common-label.label {\r\n          font-size: 11px;\r\n          font-weight: normal;\r\n          height: 15px; }\r\n          .project-repository-widget table tr th .common-label.label.delete-prohibited i.icon-white,\r\n          .project-repository-widget table tr td .common-label.label.delete-prohibited i.icon-white {\r\n            display: none; }\r\n      .project-repository-widget table tr th > .btn,\r\n      .project-repository-widget table tr td > .btn {\r\n        margin-left: 2px;\r\n        margin-right: 2px; }\r\n      .project-repository-widget table tr th .control-group,\r\n      .project-repository-widget table tr td .control-group {\r\n        margin-bottom: 0; }\r\n  .project-repository-widget table td:first-child {\r\n    border-top: 1px solid transparent; }\r\n  .project-repository-widget table.table-hover tbody tr:hover > td, .project-repository-widget table.table-hover tbody tr:hover > th {\r\n    background-color: rgba(236, 236, 236, 0.5); }\r\n.repository-dialog .modal-header span.title-container {\r\n  display: flex; }\r\n  .repository-dialog .modal-header span.title-container span.project-repository-title {\r\n    font-size: 24px;\r\n    white-space: nowrap; }\r\n  .repository-dialog .modal-header span.title-container select {\r\n    font-size: 14px;\r\n    margin-right: 2ex;\r\n    margin-left: 4ex; }.branches-dialog .pre-body {\r\n  padding: 15px 15px 0 15px; }\r\n  .branches-dialog .pre-body .tabContainer ul.nav.nav-tabs {\r\n    margin-bottom: 0; }\r\n    .branches-dialog .pre-body .tabContainer ul.nav.nav-tabs li {\r\n      width: 86px;\r\n      text-align: center; }\r\n.branches-dialog .modal-body {\r\n  min-height: 300px; }\r\n  .branches-dialog .modal-body ul.nav-pills li a span.ro {\r\n    margin-left: 5px;\r\n    color: #999999;\r\n    font-size: 9px; }\r\n\r\n.txt-branch-name {\r\n  width: 50%; }\r\n\r\na.btn-env {\r\n  -webkit-user-select: none;\r\n  -moz-user-select: none;\r\n  -ms-user-select: none; }\r\n/*\r\n * @author pmeijer / https://github.com/pmeijer\r\n */\r\ndiv.multi-tab-dialog .modal-content .modal-header .header-icon {\r\n  font-size: 20px;\r\n  margin-right: 1ex;\r\n  display: inline-block;\r\n  color: #2e6da4; }\r\ndiv.multi-tab-dialog .modal-content .modal-header span {\r\n  font-size: 24px; }\r\ndiv.multi-tab-dialog .modal-content .pre-body {\r\n  padding: 15px 15px 0 15px; }\r\n  div.multi-tab-dialog .modal-content .pre-body .tabContainer ul.nav.nav-tabs {\r\n    margin-bottom: 0; }\r\n    div.multi-tab-dialog .modal-content .pre-body .tabContainer ul.nav.nav-tabs li {\r\n      min-width: 86px;\r\n      text-align: center; }\r\ndiv.multi-tab-dialog .modal-content div.modal-body .asset-widget {\r\n  width: 100%;\r\n  height: 30px;\r\n  line-height: 30px; }\r\n  div.multi-tab-dialog .modal-content div.modal-body .asset-widget a.btn-dialog-open {\r\n    padding: 3px; }\r\ndiv.multi-tab-dialog .modal-content div.modal-body form.form-horizontal i.toggle-info-btn {\r\n  font-size: 65%;\r\n  vertical-align: top;\r\n  cursor: pointer;\r\n  color: #333; }\r\n  div.multi-tab-dialog .modal-content div.modal-body form.form-horizontal i.toggle-info-btn:hover {\r\n    color: #2a6496; }\r\ndiv.multi-tab-dialog .modal-content div.modal-body form.form-horizontal span.info-details {\r\n  display: inline-block;\r\n  width: 95%;\r\n  margin-bottom: 2ex;\r\n  margin-left: 0.5ex;\r\n  opacity: 0.90; }\r\n  div.multi-tab-dialog .modal-content div.modal-body form.form-horizontal span.info-details.hidden {\r\n    display: none; }\r\ndiv.multi-tab-dialog .modal-content div.modal-body .error-badge {\r\n  margin-top: 15px;\r\n  margin-bottom: 0; }\r\n/*\r\n * Copyright (C) 2013 Vanderbilt University, All rights reserved.\r\n * \r\n * Author: Robert Kereskenyi\r\n */\r\n.plugin-results-dialog .modal-body div.plugin-result {\r\n  padding: 3px;\r\n  margin-bottom: 10px;\r\n  background-color: #f5f5f5;\r\n  border: 1px solid #ddd; }\r\n  .plugin-results-dialog .modal-body div.plugin-result.unread {\r\n    color: #3a87ad;\r\n    background-color: #d9edf7;\r\n    border-color: #bce8f1; }\r\n  .plugin-results-dialog .modal-body div.plugin-result .alert {\r\n    margin-bottom: 0; }\r\n  .plugin-results-dialog .modal-body div.plugin-result .title {\r\n    margin-left: 5px; }\r\n  .plugin-results-dialog .modal-body div.plugin-result .time {\r\n    margin-left: 5px;\r\n    color: #999999;\r\n    font-size: 9px; }\r\n  .plugin-results-dialog .modal-body div.plugin-result .messages .msg {\r\n    margin-bottom: 5px;\r\n    padding-bottom: 15px; }\r\n    .plugin-results-dialog .modal-body div.plugin-result .messages .msg .msg-title {\r\n      margin-top: 5px;\r\n      font-weight: bold;\r\n      text-transform: uppercase;\r\n      color: #999999;\r\n      border-bottom: 1px solid #999999; }\r\n    .plugin-results-dialog .modal-body div.plugin-result .messages .msg .btn-node {\r\n      font-weight: bold;\r\n      padding-right: 3px;\r\n      padding-left: 3px;\r\n      color: #3a87ad; }\r\n      .plugin-results-dialog .modal-body div.plugin-result .messages .msg .btn-node:hover {\r\n        text-decoration: underline; }\r\n  .plugin-results-dialog .modal-body div.plugin-result .artifacts {\r\n    margin-bottom: 5px; }\r\n    .plugin-results-dialog .modal-body div.plugin-result .artifacts .artifacts-title {\r\n      margin-top: 5px;\r\n      font-weight: bold;\r\n      text-transform: uppercase;\r\n      color: #999999;\r\n      border-bottom: 1px solid #999999; }\r\n    .plugin-results-dialog .modal-body div.plugin-result .artifacts .artifacts-body a {\r\n      color: #3a87ad;\r\n      font-weight: bold;\r\n      font-size: 10.5px; }\r\n    .plugin-results-dialog .modal-body div.plugin-result .artifacts.history .btn-commit, .plugin-results-dialog .modal-body div.plugin-result .artifacts.history .btn-branch {\r\n      font-weight: bold;\r\n      padding-right: 3px;\r\n      padding-left: 3px;\r\n      color: #3a87ad; }\r\n      .plugin-results-dialog .modal-body div.plugin-result .artifacts.history .btn-commit:hover, .plugin-results-dialog .modal-body div.plugin-result .artifacts.history .btn-branch:hover {\r\n        text-decoration: underline; }\r\n\r\n/*\r\n * Copyright (C) 2013 Vanderbilt University, All rights reserved.\r\n * \r\n * Author: Robert Kereskenyi\r\n */\r\n.constraint-check-results-dialog .modal-body div.constraint-check-result {\r\n  padding: 3px;\r\n  margin-bottom: 10px;\r\n  background-color: #f5f5f5;\r\n  border: 1px solid #ddd; }\r\n  .constraint-check-results-dialog .modal-body div.constraint-check-result .result-details.main-details.no-details-available {\r\n    display: none; }\r\n  .constraint-check-results-dialog .modal-body div.constraint-check-result.unread {\r\n    color: #3a87ad;\r\n    background-color: #d9edf7;\r\n    border-color: #bce8f1; }\r\n  .constraint-check-results-dialog .modal-body div.constraint-check-result .alert {\r\n    margin-bottom: 0; }\r\n  .constraint-check-results-dialog .modal-body div.constraint-check-result .title {\r\n    margin-left: 5px; }\r\n  .constraint-check-results-dialog .modal-body div.constraint-check-result .time {\r\n    margin-left: 5px;\r\n    color: #999999;\r\n    font-size: 9px; }\r\n  .constraint-check-results-dialog .modal-body div.constraint-check-result .messages .msg {\r\n    margin-bottom: 5px;\r\n    padding-bottom: 15px; }\r\n    .constraint-check-results-dialog .modal-body div.constraint-check-result .messages .msg .msg-title {\r\n      margin-top: 5px;\r\n      font-weight: bold;\r\n      text-transform: uppercase;\r\n      color: #999999;\r\n      border-bottom: 1px solid #999999; }\r\n/*\r\n * Copyright (C) 2013 Vanderbilt University, All rights reserved.\r\n * \r\n * Author: Robert Kereskenyi\r\n */\r\n.popover.pobox .popover-content {\r\n  white-space: nowrap; }\r\n.popover.pobox.ddwa-warning {\r\n  background-color: #fcf8e3 !important;\r\n  color: #c09853 !important; }\r\n  .popover.pobox.ddwa-warning .arrow:after {\r\n    border-top-color: #fcf8e3 !important; }\r\n.popover.pobox.ddwa-success {\r\n  background-color: #dff0d8 !important;\r\n  color: #468847 !important; }\r\n  .popover.pobox.ddwa-success .arrow:after {\r\n    border-top-color: #dff0d8 !important; }\r\n.popover.pobox.ddwa-error {\r\n  background-color: #f2dede !important;\r\n  color: #b94a48 !important; }\r\n  .popover.pobox.ddwa-error .arrow:after {\r\n    border-top-color: #f2dede !important; }\r\n.popover.pobox.ddwa-info {\r\n  background-color: #d9edf7 !important;\r\n  color: #3a87ad !important; }\r\n  .popover.pobox.ddwa-info .arrow:after {\r\n    border-top-color: #d9edf7 !important; }\r\n.notification-widget ul.dropdown-menu {\r\n  max-height: 60vh;\r\n  overflow-y: scroll; }\r\n.notification-widget a.notification-drop-down-menu-item:hover {\r\n  cursor: default;\r\n  background-image: none; }\r\n.notification-widget a.notification-drop-down-menu-item.notification-drop-down-menu-item-success {\r\n  background-color: #ccffcc; }\r\n  .notification-widget a.notification-drop-down-menu-item.notification-drop-down-menu-item-success:hover {\r\n    background-color: #99ff99; }\r\n.notification-widget a.notification-drop-down-menu-item.notification-drop-down-menu-item-info {\r\n  background-color: #cce5ff; }\r\n  .notification-widget a.notification-drop-down-menu-item.notification-drop-down-menu-item-info:hover {\r\n    background-color: #99ccff; }\r\n.notification-widget a.notification-drop-down-menu-item.notification-drop-down-menu-item-warn {\r\n  background-color: #ffffcc; }\r\n  .notification-widget a.notification-drop-down-menu-item.notification-drop-down-menu-item-warn:hover {\r\n    background-color: #ffff99; }\r\n.notification-widget a.notification-drop-down-menu-item.notification-drop-down-menu-item-error {\r\n  background-color: #ffcccc; }\r\n  .notification-widget a.notification-drop-down-menu-item.notification-drop-down-menu-item-error:hover {\r\n    background-color: #ff9999; }\r\n.notification-widget a.notification-drop-down-menu-item.notification-drop-down-menu-item-clear {\r\n  font-weight: bold; }\r\n  .notification-widget a.notification-drop-down-menu-item.notification-drop-down-menu-item-clear:hover {\r\n    cursor: pointer; }\r\n    .notification-widget a.notification-drop-down-menu-item.notification-drop-down-menu-item-clear:hover i.clear-all-icon {\r\n      color: #b30404; }\r\n/**\r\n * @author rkereskenyi / https://github.com/rkereskenyi\r\n */\r\n.panel-base-wh {\r\n  box-sizing: border-box; }\r\n  .panel-base-wh .ro-icon {\r\n    display: none;\r\n    margin-right: 2px;\r\n    position: absolute;\r\n    top: 2px;\r\n    left: 2px; }\r\n  .panel-base-wh .panel-header {\r\n    background-color: #efefef;\r\n    border-bottom: 3px solid rgba(0, 0, 0, 0);\r\n    white-space: nowrap; }\r\n    .panel-base-wh .panel-header .panel-header-title {\r\n      font-size: 21px;\r\n      line-height: 21px;\r\n      font-weight: 400;\r\n      display: inline-block;\r\n      margin-right: 10px;\r\n      margin-left: 5px;\r\n      white-space: nowrap;\r\n      margin-top: 8px; }\r\n    .panel-base-wh .panel-header .panel-header-toolbar .toolbar-group {\r\n      margin-left: 10px; }\r\n      .panel-base-wh .panel-header .panel-header-toolbar .toolbar-group.toolbar-group-small-margin {\r\n        margin-left: 2px; }\r\n    .panel-base-wh .panel-header .panel-header-toolbar select,\r\n    .panel-base-wh .panel-header .panel-header-toolbar textarea,\r\n    .panel-base-wh .panel-header .panel-header-toolbar input,\r\n    .panel-base-wh .panel-header .panel-header-toolbar .uneditable-input {\r\n      margin-bottom: 0; }\r\n    .panel-base-wh .panel-header .panel-header-toolbar .input-append,\r\n    .panel-base-wh .panel-header .panel-header-toolbar .input-prepend {\r\n      margin-bottom: 0; }\r\n    .panel-base-wh .panel-header .panel-header-toolbar input.no-focus-collapse:not(:focus) {\r\n      width: 30px; }\r\n    .panel-base-wh .panel-header .panel-header-toolbar li div.iCheckBox {\r\n      margin-left: 10px; }\r\n    .panel-base-wh .panel-header .panel-header-toolbar .iCheckBox {\r\n      top: 5px;\r\n      margin-left: 10px; }\r\n    .panel-base-wh .panel-header .panel-header-toolbar ul.dropdown-menu .iCheckBox {\r\n      top: 1px; }\r\n    .panel-base-wh .panel-header.absolute-header {\r\n      border-bottom-width: 0;\r\n      position: absolute;\r\n      top: 0;\r\n      left: 0; }\r\n  .panel-base-wh .panel-body {\r\n    position: relative;\r\n    background-color: white; }\r\n  .panel-base-wh .floating-title {\r\n    position: absolute;\r\n    top: 0;\r\n    left: 0;\r\n    box-shadow: 0;\r\n    text-shadow: 1.5px 1.5px 0 rgba(0, 0, 0, 0.15);\r\n    opacity: .65;\r\n    color: #555555; }\r\n    .panel-base-wh .floating-title .ro-icon {\r\n      position: relative;\r\n      top: -1px;\r\n      left: 2px;\r\n      margin-right: 1.2ex; }\r\n    .panel-base-wh .floating-title .panel-header-title {\r\n      font-size: 21px;\r\n      line-height: 21px;\r\n      font-weight: 400;\r\n      display: inline-block;\r\n      margin-right: 10px;\r\n      margin-left: 5px;\r\n      white-space: nowrap;\r\n      margin-top: 8px; }\r\n      .panel-base-wh .floating-title .panel-header-title:empty {\r\n        display: none; }\r\n  .panel-base-wh.read-only .ro-icon {\r\n    display: inline-block; }\r\n  .panel-base-wh.read-only .panel-body {\r\n    background-color: #fbfbfb; }\r\n  .panel-base-wh .absolute-header {\r\n    border: 1px solid #d3d8df; }\r\n  .panel-base-wh.active-panel .panel-header {\r\n    border-bottom-color: #00235b;\r\n    background: white; }\r\n  .panel-base-wh.active-panel .floating-title {\r\n    opacity: 0.85;\r\n    color: #00235b; }\r\n  .panel-base-wh.active-panel .absolute-header {\r\n    border: 1px solid #00235b; }\r\n  .panel-base-wh.w-tabs .floating-title {\r\n    top: 30px; }\r\n.panel-base-scroll {}\r\n  .panel-base-scroll .panel-body {\r\n    overflow: auto;\r\n  }\r\n.side-panel .panel-base-wh {\r\n  position: relative;\r\n  padding: 0;\r\n  margin-bottom: 2px;\r\n  border: 0;\r\n  -webkit-border-radius: 0;\r\n  -moz-border-radius: 0;\r\n  border-radius: 0;\r\n  background-color: whitesmoke; }\r\n  .side-panel .panel-base-wh .panel-header {\r\n    padding: 0 3px;\r\n    font-size: 0.85em;\r\n    background-color: whitesmoke;\r\n    border-bottom: 3px solid rgba(0, 0, 0, 0); }\r\n    .side-panel .panel-base-wh .panel-header .ro-icon {\r\n      position: relative;\r\n      top: 0;\r\n      left: 0; }\r\n    .side-panel .panel-base-wh .panel-header .panel-header-title {\r\n      font-size: 0.85em;\r\n      line-height: 0.85em;\r\n      color: #999;\r\n      text-transform: uppercase;\r\n      margin-right: 0;\r\n      margin-left: 0; }\r\n    .side-panel .panel-base-wh .panel-header .panel-header-toolbar {\r\n      display: block; }\r\n  .side-panel .panel-base-wh .panel-body {\r\n    background-color: whitesmoke;\r\n    padding: 0; }\r\n  .side-panel .panel-base-wh.read-only .panel-body {\r\n    background-color: #fbfbfb; }\r\n  .side-panel .panel-base-wh.active-panel .panel-header {\r\n    border-bottom-color: #00235b; }\r\n.add-or-update-library-dialog .refresh-link {\r\n  font-size: 18px;\r\n  cursor: pointer; }\r\n/**\r\n * @author pmeijer / https://github.com/pmeijer\r\n */\r\n/*IMPORTS*/\r\n.tree-browser {\r\n  /* OWN STYLES */ }\r\n  .tree-browser .filter-container {\r\n    margin: 1px;\r\n    padding-top: 1px; }\r\n    .tree-browser .filter-container .filter-form .filter-toggle-buttons {\r\n      margin-right: 3px; }\r\n      .tree-browser .filter-container .filter-form .filter-toggle-buttons button {\r\n        line-height: 1; }\r\n    .tree-browser .filter-container .filter-form .input-filter-type label.btn {\r\n      font-weight: bold; }\r\n    .tree-browser .filter-container.collapsed .filter-form {\r\n      display: none; }\r\n    .tree-browser .filter-container.collapsed i.collapse-filter {\r\n      display: none; }\r\n    .tree-browser .filter-container.collapsed i.expand-filter {\r\n      display: inline-block; }\r\n    .tree-browser .filter-container i.collapse-filter {\r\n      display: inline-block; }\r\n    .tree-browser .filter-container i.expand-filter {\r\n      display: none; }\r\n    .tree-browser .filter-container .btn-hide-show-filters {\r\n      position: relative;\r\n      z-index: 1; }\r\n    .tree-browser .filter-container .btn {\r\n      margin-bottom: 1px; }\r\n      .tree-browser .filter-container .btn.btn-hide-show-filters {\r\n        padding-left: 3px; }\r\n        .tree-browser .filter-container .btn.btn-hide-show-filters .filter-icon {\r\n          padding-left: 3px; }\r\n  .tree-browser span.all-filtered-out {\r\n    padding: 12px;\r\n    color: #AAA;\r\n    font-style: italic; }\r\n  .tree-browser .fa {\r\n    line-height: 18px; }/*\r\n * Copyright (C) 2013 Vanderbilt University, All rights reserved.\r\n * \r\n * Author: Robert Kereskenyi\r\n */\r\n.object-browser ul.nav {\r\n  position: relative;\r\n  margin-bottom: 0;\r\n  height: 24px;\r\n  white-space: nowrap; }\r\n  .object-browser ul.nav.nav-tabs > li {\r\n    display: inline-block;\r\n    float: none; }\r\n    .object-browser ul.nav.nav-tabs > li > a {\r\n      padding: 5px 3px 5px 3px;\r\n      line-height: 13px;\r\n      font-size: 11px; }\r\n      .object-browser ul.nav.nav-tabs > li > a .tab-title {\r\n        white-space: nowrap;\r\n        display: inline-block;\r\n        max-width: 120px;\r\n        overflow: hidden;\r\n        text-overflow: ellipsis; }\r\n.object-browser .tab-content {\r\n  overflow: visible; }\r\ndiv.loader-progressbar {\r\n  zoom: 1;\r\n  /* Increase this for a bigger symbol*/\r\n  width: 16px;\r\n  height: 16px;\r\n  background: -webkit-linear-gradient(90deg, #f4f5fa 1px, transparent 0, transparent 8px, #f4f5fa 8px), -webkit-linear-gradient(0deg, #f4f5fa 1px, #f6f9fb 0, #f6f9fb 3px, #f4f5fa 3px), -webkit-linear-gradient(90deg, #ececf5 1px, transparent 0, transparent 8px, #ececf5 8px), -webkit-linear-gradient(0deg, #ececf5 1px, #f2f3f9 0, #f2f3f9 3px, #ececf5 3px), -webkit-linear-gradient(90deg, #e7eaf4 1px, transparent 0, transparent 8px, #e7eaf4 8px), -webkit-linear-gradient(0deg, #e7eaf4 1px, #eef1f8 0, #eef1f8 3px, #e7eaf4 3px), -webkit-linear-gradient(90deg, #b9bedd 1px, transparent 0, transparent 10px, #b9bedd 10px), -webkit-linear-gradient(0deg, #b9bedd 1px, #d0d5e8 0, #d0d5e8 3px, #b9bedd 3px), -webkit-linear-gradient(90deg, #9fa6d2 1px, transparent 0, transparent 15px, #9fa6d2 15px), -webkit-linear-gradient(0deg, #9fa6d2 1px, #c0c5e1 0, #c0c5e1 3px, #9fa6d2 3px), -webkit-linear-gradient(90deg, #8490c6 1px, transparent 0, transparent 15px, #8490c6 15px), -webkit-linear-gradient(0deg, #8490c6 1px, #aeb5da 0, #aeb5da 3px, #8490c6 3px);\r\n  background: linear-gradient(0deg, #f4f5fa 1px, transparent 0, transparent 8px, #f4f5fa 8px), linear-gradient(90deg, #f4f5fa 1px, #f6f9fb 0, #f6f9fb 3px, #f4f5fa 3px), linear-gradient(0deg, #ececf5 1px, transparent 0, transparent 8px, #ececf5 8px), linear-gradient(90deg, #ececf5 1px, #f2f3f9 0, #f2f3f9 3px, #ececf5 3px), linear-gradient(0deg, #e7eaf4 1px, transparent 0, transparent 8px, #e7eaf4 8px), linear-gradient(90deg, #e7eaf4 1px, #eef1f8 0, #eef1f8 3px, #e7eaf4 3px), linear-gradient(0deg, #b9bedd 1px, transparent 0, transparent 10px, #b9bedd 10px), linear-gradient(90deg, #b9bedd 1px, #d0d5e8 0, #d0d5e8 3px, #b9bedd 3px), linear-gradient(0deg, #9fa6d2 1px, transparent 0, transparent 15px, #9fa6d2 15px), linear-gradient(90deg, #9fa6d2 1px, #c0c5e1 0, #c0c5e1 3px, #9fa6d2 3px), linear-gradient(0deg, #8490c6 1px, transparent 0, transparent 15px, #8490c6 15px), linear-gradient(90deg, #8490c6 1px, #aeb5da 0, #aeb5da 3px, #8490c6 3px);\r\n  background-repeat: no-repeat;\r\n  background-size: 4px 9px, 4px 9px, 4px 9px, 4px 9px, 4px 9px, 4px 9px, 4px 11px, 4px 11px, 4px 16px, 4px 16px, 4px 16px, 4px 16px;\r\n  background-position: -4px 3px, -4px 3px, -4px 3px, -4px 3px, -4px 3px, -4px 3px, -4px 2px, -4px 2px, -4px 0px, -4px 0px, -4px 0px, -4px 0px;\r\n  -webkit-animation: wait 0.8s steps(1, start) infinite;\r\n  animation: wait 0.8s steps(1, start) infinite; }\r\n  div.loader-progressbar.stop {\r\n    -webkit-animation-play-state: paused;\r\n    animation-play-state: paused; }\r\n\r\n@keyframes wait {\r\n  12% {\r\n    background-position: -4px 3px,-4px 3px,   -4px 3px, -4px 3px,  -4px 3px,-4px 3px,  -4px 2px,-4px 2px,  -4px 0px, -4px 0px,  0px 0px, 0px 0px; }\r\n\r\n  25% {\r\n    background-position: -4px 3px, -4px 3px,  -4px 3px, -4px 3px,  -4px 3px,-4px 3px,  -4px 2px, -4px 2px,   0px 0px,    0px 0px,     6px 0px, 6px 0px; }\r\n\r\n  37% {\r\n    background-position: -4px 3px, -4px 3px,  -4px 3px, -4px 3px,  -4px 3px, -4px 3px,  0px 2px,    0px 2px,     6px 0px,  6px 0px,  12px 0px, 12px 0px; }\r\n\r\n  50% {\r\n    background-position: -4px 3px, -4px 3px,  -4px 3px, -4px 3px,   0px 3px,    0px 3px,  6px 2px,  6px 2px,  12px 0px, 12px 0px,  -4px 0px, -4px 0px; }\r\n\r\n  62% {\r\n    background-position: -4px 3px, -4px 3px,   0px 3px,    0px 3px,     6px 3px,  6px 3px,  12px 2px, 12px 2px,  -4px 0px, -4px 0px,  -4px 0px, -4px 0px; }\r\n\r\n  75% {\r\n    background-position: 0px 3px,    0px 3px,     6px 3px,  6px 3px,  12px 3px, 12px 3px,  -4px 2px, -4px 2px,  -4px 0px, -4px 0px,  -4px 0px, -4px 0px; }\r\n\r\n  87% {\r\n    background-position: 6px 3px,  6px 3px,  12px 3px, 12px 3px,  -4px 3px, -4px 3px,  -4px 2px, -4px 2px,  -4px 0px, -4px 0px,  -4px 0px, -4px 0px; }\r\n\r\n  100% {\r\n    background-position: 12px 3px, 12px 3px,  -4px 3px, -4px 3px,  -4px 3px, -4px 3px,  -4px 2px, -4px 2px,  -4px 0px, -4px 0px,  -4px 0px, -4px 0px; } }\r\n\r\n@-webkit-keyframes wait {\r\n  12% {\r\n    background-position: -4px 3px,-4px 3px,   -4px 3px, -4px 3px,  -4px 3px,-4px 3px,  -4px 2px,-4px 2px,  -4px 0px, -4px 0px,  0px 0px, 0px 0px; }\r\n\r\n  25% {\r\n    background-position: -4px 3px, -4px 3px,  -4px 3px, -4px 3px,  -4px 3px,-4px 3px,  -4px 2px, -4px 2px,   0px 0px,    0px 0px,     6px 0px, 6px 0px; }\r\n\r\n  37% {\r\n    background-position: -4px 3px, -4px 3px,  -4px 3px, -4px 3px,  -4px 3px, -4px 3px,  0px 2px,    0px 2px,     6px 0px,  6px 0px,  12px 0px, 12px 0px; }\r\n\r\n  50% {\r\n    background-position: -4px 3px, -4px 3px,  -4px 3px, -4px 3px,   0px 3px,    0px 3px,  6px 2px,  6px 2px,  12px 0px, 12px 0px,  -4px 0px, -4px 0px; }\r\n\r\n  62% {\r\n    background-position: -4px 3px, -4px 3px,   0px 3px,    0px 3px,     6px 3px,  6px 3px,  12px 2px, 12px 2px,  -4px 0px, -4px 0px,  -4px 0px, -4px 0px; }\r\n\r\n  75% {\r\n    background-position: 0px 3px,    0px 3px,     6px 3px,  6px 3px,  12px 3px, 12px 3px,  -4px 2px, -4px 2px,  -4px 0px, -4px 0px,  -4px 0px, -4px 0px; }\r\n\r\n  87% {\r\n    background-position: 6px 3px,  6px 3px,  12px 3px, 12px 3px,  -4px 3px, -4px 3px,  -4px 2px, -4px 2px,  -4px 0px, -4px 0px,  -4px 0px, -4px 0px; }\r\n\r\n  100% {\r\n    background-position: 12px 3px, 12px 3px,  -4px 3px, -4px 3px,  -4px 3px, -4px 3px,  -4px 2px, -4px 2px,  -4px 0px, -4px 0px,  -4px 0px, -4px 0px; } }\r\n/*\r\n * Copyright (C) 2013 Vanderbilt University, All rights reserved.\r\n * \r\n * Author: Robert Kereskenyi\r\n */\r\n.split-panel {\r\n  position: absolute;\r\n  top: 0;\r\n  left: 0;\r\n  margin: 0; }\r\n  .split-panel .p1,\r\n  .split-panel .p2 {\r\n    position: absolute;\r\n    overflow: hidden; }\r\n  .split-panel .splitter {\r\n    z-index: 1000;\r\n    background: #DDD;\r\n    border: 0x solid #BBB;\r\n    position: absolute;\r\n    box-sizing: border-box; }\r\n    .split-panel .splitter.vertical {\r\n      border-left-width: 1px;\r\n      border-right-width: 1px;\r\n      cursor: ew-resize; }\r\n    .split-panel .splitter.horizontal {\r\n      border-top-width: 1px;\r\n      border-bottom-width: 1px;\r\n      cursor: ns-resize; }\r\n    .split-panel .splitter.resize {\r\n      background-color: #C4E1A4; }\r\n.visualizer-panel .vis-loader {\r\n  display: inline-block;\r\n  vertical-align: middle;\r\n  margin-left: 7px;\r\n  margin-top: -3px; }\r\n.visualizer-panel ul.nav {\r\n  margin-bottom: 0; }\r\n  .visualizer-panel ul.nav li > a {\r\n    white-space: nowrap; }\r\n.visualizer-panel .pp {\r\n  text-align: left;\r\n  padding: .5ex 1ex;\r\n  font-size: 11px;\r\n  font-weight: bold;\r\n  line-height: 18px;\r\n  color: #999;\r\n  text-transform: uppercase;\r\n  margin: 0 0 1px 0;\r\n  background-color: #fff; }\r\n.part-browser {\r\n  height: 100%;\r\n  width: 100%;\r\n  text-align: center;\r\n  overflow-x: auto;\r\n  overflow-y: auto; }\r\n  .part-browser > ul {\r\n    list-style-type: none;\r\n    margin: 0;\r\n    white-space: nowrap;\r\n    padding: 0 0 30px 0; }\r\n    .part-browser > ul > li {\r\n      list-style-type: none;\r\n      padding: 0;\r\n      text-decoration: none;\r\n      color: black;\r\n      font-size: 10px; }\r\n      .part-browser > ul > li.decorated-list-item {\r\n        margin: 15px 10px 5px 10px; }\r\n      .part-browser > ul > li.name-list-item {\r\n        margin: 0 0 0 0; }\r\n      .part-browser > ul > li div.part {\r\n        display: inline-block;\r\n        cursor: pointer; }\r\n      .part-browser > ul > li div.name-part {\r\n        display: inline-block;\r\n        cursor: pointer;\r\n        font-size: 12px;\r\n        color: #3160AB;\r\n        width: 100%;\r\n        height: 100%;\r\n        overflow: hidden;\r\n        text-overflow: ellipsis;\r\n        padding: 3px 12px 3px 12px; }\r\n      .part-browser > ul > li div.name-part:hover {\r\n        color: #FF7700;\r\n        background-color: #EEEEEE; }\r\n  .part-browser > ul.part {\r\n    text-align: center; }\r\n  .part-browser > ul.name-part {\r\n    text-align: left; }.pgp {\r\n  color: #1a1a1a;\r\n  font-family: "Helvetica", "Arial", "sans-serif";\r\n  font-size: 11px;\r\n  background-color: #e8e8e8; }\r\n  .pgp ul {\r\n    list-style: none;\r\n    margin: 0;\r\n    padding: 0;\r\n    width: 100%;\r\n    clear: both; }\r\n    .pgp ul li {\r\n      -webkit-transition: height 0.1s ease-out;\r\n      -o-transition: height 0.1s ease-out;\r\n      -moz-transition: height 0.1s ease-out;\r\n      transition: height 0.1s ease-out;\r\n      /* Controller row, <li> */ }\r\n      .pgp ul li:not(.folder) {\r\n        border-bottom: 1px solid #fafafa;\r\n        height: 27px;\r\n        line-height: 27px;\r\n        overflow: hidden;\r\n        padding: 0 3px 0 3px;\r\n        white-space: nowrap;\r\n        text-overflow: ellipsis; }\r\n      .pgp ul li.folder {\r\n        border-bottom: 0;\r\n        padding: 0;\r\n        border-left: 4px solid transparent; }\r\n      .pgp ul li.title {\r\n        padding-left: 14px;\r\n        background: gainsboro url(data:image/gif;base64,R0lGODlhBQAFAPcAAAAAAAAAMwAAZgAAmQAAzAAA/wAzAAAzMwAzZgAzmQAzzAAz/wBmAABmMwBmZgBmmQBmzABm/wCZAACZMwCZZgCZmQCZzACZ/wDMAADMMwDMZgDMmQDMzADM/wD/AAD/MwD/ZgD/mQD/zAD//zMAADMAMzMAZjMAmTMAzDMA/zMzADMzMzMzZjMzmTMzzDMz/zNmADNmMzNmZjNmmTNmzDNm/zOZADOZMzOZZjOZmTOZzDOZ/zPMADPMMzPMZjPMmTPMzDPM/zP/ADP/MzP/ZjP/mTP/zDP//2YAAGYAM2YAZmYAmWYAzGYA/2YzAGYzM2YzZmYzmWYzzGYz/2ZmAGZmM2ZmZmZmmWZmzGZm/2aZAGaZM2aZZmaZmWaZzGaZ/2bMAGbMM2bMZmbMmWbMzGbM/2b/AGb/M2b/Zmb/mWb/zGb//5kAAJkAM5kAZpkAmZkAzJkA/5kzAJkzM5kzZpkzmZkzzJkz/5lmAJlmM5lmZplmmZlmzJlm/5mZAJmZM5mZZpmZmZmZzJmZ/5nMAJnMM5nMZpnMmZnMzJnM/5n/AJn/M5n/Zpn/mZn/zJn//8wAAMwAM8wAZswAmcwAzMwA/8wzAMwzM8wzZswzmcwzzMwz/8xmAMxmM8xmZsxmmcxmzMxm/8yZAMyZM8yZZsyZmcyZzMyZ/8zMAMzMM8zMZszMmczMzMzM/8z/AMz/M8z/Zsz/mcz/zMz///8AAP8AM/8AZv8Amf8AzP8A//8zAP8zM/8zZv8zmf8zzP8z//9mAP9mM/9mZv9mmf9mzP9m//+ZAP+ZM/+ZZv+Zmf+ZzP+Z///MAP/MM//MZv/Mmf/MzP/M////AP//M///Zv//mf//zP////X19QAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAANgALAAAAAAFAAUAAAgQALEJHEgQgEGD2A4OBCAwIAA7) 4px 10px no-repeat;\r\n        cursor: pointer;\r\n        border-bottom: 1px solid rgba(255, 255, 255, 0.2);\r\n        margin-left: -4px; }\r\n      .pgp ul li.cr {\r\n        clear: both;\r\n        border-left: 3px solid transparent;\r\n        /** Name-half (left) */\r\n        /** Controllers */\r\n        /** Controller-half (right) */ }\r\n        .pgp ul li.cr.asset {\r\n          border-left-color: #e8e8e8; }\r\n        .pgp ul li.cr.boolean {\r\n          border-left-color: #e8e8e8; }\r\n        .pgp ul li.cr.integer {\r\n          border-left-color: #806787; }\r\n          .pgp ul li.cr.integer input[type=text] {\r\n            color: #1a1a1a; }\r\n        .pgp ul li.cr.float {\r\n          border-left-color: #2FA1D6; }\r\n          .pgp ul li.cr.float input[type=text] {\r\n            color: #1a1a1a; }\r\n        .pgp ul li.cr.number {\r\n          border-left-color: #2FA1D6; }\r\n          .pgp ul li.cr.number input[type=text] {\r\n            color: #2FA1D6; }\r\n        .pgp ul li.cr.string {\r\n          border-left-color: #e8e8e8; }\r\n          .pgp ul li.cr.string input[type=text] {\r\n            color: #1a1a1a; }\r\n        .pgp ul li.cr.custom {\r\n          border-left-color: #FFFF00; }\r\n        .pgp ul li.cr .property-name {\r\n          cursor: default;\r\n          float: left;\r\n          clear: left;\r\n          width: 40%;\r\n          overflow: hidden;\r\n          text-overflow: ellipsis; }\r\n          .pgp ul li.cr .property-name.p-reset {\r\n            width: 30%; }\r\n        .pgp ul li.cr div.p-reset {\r\n          width: 10%;\r\n          text-align: right;\r\n          float: left; }\r\n          .pgp ul li.cr div.p-reset i.reset-badge {\r\n            margin-left: 1px;\r\n            margin-right: 2px; }\r\n            .pgp ul li.cr div.p-reset i.reset-badge.btn-reset:hover {\r\n              cursor: pointer; }\r\n        .pgp ul li.cr .c {\r\n          float: left;\r\n          width: 60%;\r\n          height: 27px;\r\n          overflow: hidden;\r\n          text-overflow: ellipsis;\r\n          /** Controller placement */ }\r\n          .pgp ul li.cr .c.has-invalid-value {\r\n            background-color: #f98980; }\r\n          .pgp ul li.cr .c input {\r\n            font-size: 12px;\r\n            height: 19px;\r\n            line-height: 19px;\r\n            box-sizing: border-box; }\r\n          .pgp ul li.cr .c input[type=checkbox] {\r\n            margin-top: -2px; }\r\n          .pgp ul li.cr .c input[type=text] {\r\n            border: 0;\r\n            margin-top: -2px;\r\n            margin-bottom: 0;\r\n            padding: 3px;\r\n            width: 100%;\r\n            outline: none; }\r\n          .pgp ul li.cr .c input[type=number] {\r\n            border: 0;\r\n            margin-top: -2px;\r\n            margin-bottom: 0;\r\n            padding-left: 2px;\r\n            padding-bottom: 0;\r\n            padding-top: 0;\r\n            width: 100%;\r\n            outline: none; }\r\n          .pgp ul li.cr .c input[type=text]:not([disabled]) {\r\n            background: white; }\r\n            .pgp ul li.cr .c input[type=text]:not([disabled]):hover {\r\n              background: white; }\r\n            .pgp ul li.cr .c input[type=text]:not([disabled]):focus {\r\n              background: white; }\r\n          .pgp ul li.cr .c div.iCheckBox {\r\n            margin-top: 5px; }\r\n          .pgp ul li.cr .c select {\r\n            margin-top: 2px;\r\n            width: 100%;\r\n            height: 23px;\r\n            border: 0;\r\n            padding: 3px;\r\n            color: #1a1a1a;\r\n            font-size: 11px; }\r\n          .pgp ul li.cr .c select:not([disabled]) {\r\n            background: white; }\r\n          .pgp ul li.cr .c .btn-dialog-open {\r\n            margin-top: 2px;\r\n            position: absolute;\r\n            right: 2px; }\r\n          .pgp ul li.cr .c div.color-picker {\r\n            height: 19px;\r\n            width: 100%;\r\n            margin-top: 4px;\r\n            cursor: pointer;\r\n            border-radius: 4px;\r\n            border-style: solid;\r\n            border-width: 1px;\r\n            border-color: darkgrey; }\r\n          .pgp ul li.cr .c div.asset-widget {\r\n            height: 25px;\r\n            line-height: 25px;\r\n            width: 98%; }\r\n            .pgp ul li.cr .c div.asset-widget .btn-dialog-open {\r\n              top: -1px;\r\n              padding: 0 3px; }\r\n    .pgp ul.closed li:not(.title),\r\n    .pgp ul.closed ul li,\r\n    .pgp ul.closed ul li > * {\r\n      height: 0;\r\n      overflow: hidden;\r\n      border: 0; }\r\n    .pgp ul.closed li.title {\r\n      background-image: url(data:image/gif;base64,R0lGODlhBQAFAPcAAAAAAAAAMwAAZgAAmQAAzAAA/wAzAAAzMwAzZgAzmQAzzAAz/wBmAABmMwBmZgBmmQBmzABm/wCZAACZMwCZZgCZmQCZzACZ/wDMAADMMwDMZgDMmQDMzADM/wD/AAD/MwD/ZgD/mQD/zAD//zMAADMAMzMAZjMAmTMAzDMA/zMzADMzMzMzZjMzmTMzzDMz/zNmADNmMzNmZjNmmTNmzDNm/zOZADOZMzOZZjOZmTOZzDOZ/zPMADPMMzPMZjPMmTPMzDPM/zP/ADP/MzP/ZjP/mTP/zDP//2YAAGYAM2YAZmYAmWYAzGYA/2YzAGYzM2YzZmYzmWYzzGYz/2ZmAGZmM2ZmZmZmmWZmzGZm/2aZAGaZM2aZZmaZmWaZzGaZ/2bMAGbMM2bMZmbMmWbMzGbM/2b/AGb/M2b/Zmb/mWb/zGb//5kAAJkAM5kAZpkAmZkAzJkA/5kzAJkzM5kzZpkzmZkzzJkz/5lmAJlmM5lmZplmmZlmzJlm/5mZAJmZM5mZZpmZmZmZzJmZ/5nMAJnMM5nMZpnMmZnMzJnM/5n/AJn/M5n/Zpn/mZn/zJn//8wAAMwAM8wAZswAmcwAzMwA/8wzAMwzM8wzZswzmcwzzMwz/8xmAMxmM8xmZsxmmcxmzMxm/8yZAMyZM8yZZsyZmcyZzMyZ/8zMAMzMM8zMZszMmczMzMzM/8z/AMz/M8z/Zsz/mcz/zMz///8AAP8AM/8AZv8Amf8AzP8A//8zAP8zM/8zZv8zmf8zzP8z//9mAP9mM/9mZv9mmf9mzP9m//+ZAP+ZM/+ZZv+Zmf+ZzP+Z///MAP/MM//MZv/Mmf/MzP/M////AP//M///Zv//mf//zP////X19QAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAANgALAAAAAAFAAUAAAgQALFhAyBQIACCBg8mLIgwIAA7); }\r\n/*\r\n * Copyright (C) 2013 Vanderbilt University, All rights reserved.\r\n * \r\n * Author: Robert Kereskenyi\r\n */\r\n.decorator-svg-dialog .modal-header .header-icon {\r\n  font-size: 30px;\r\n  margin-right: 1ex;\r\n  margin-left: 0.4ex;\r\n  display: inline-block;\r\n  color: #2e6da4; }\r\n.decorator-svg-dialog .modal-header span {\r\n  font-size: 30px; }\r\n.decorator-svg-dialog .pre-body {\r\n  padding: 15px 15px 0 15px; }\r\n  .decorator-svg-dialog .pre-body .tabContainer ul.nav.nav-tabs {\r\n    margin-bottom: 0; }\r\n    .decorator-svg-dialog .pre-body .tabContainer ul.nav.nav-tabs li {\r\n      text-align: center; }\r\n.decorator-svg-dialog .image-container {\r\n  margin: 3px;\r\n  padding: 5px;\r\n  border: 1px solid #EFEFEF;\r\n  height: 100px;\r\n  width: 112px;\r\n  float: left;\r\n  text-align: center;\r\n  position: relative;\r\n  cursor: pointer; }\r\n  .decorator-svg-dialog .image-container.not-in-tab-group {\r\n    display: none; }\r\n  .decorator-svg-dialog .image-container.not-in-filter {\r\n    display: none; }\r\n  .decorator-svg-dialog .image-container img {\r\n    display: inline;\r\n    margin: 0;\r\n    padding: 3px;\r\n    max-width: 100%;\r\n    max-height: 48px; }\r\n  .decorator-svg-dialog .image-container div.desc {\r\n    text-align: center;\r\n    font-weight: normal;\r\n    line-height: 20px;\r\n    width: 100%;\r\n    padding: 0 .5ex;\r\n    margin: 0;\r\n    position: absolute;\r\n    left: 0;\r\n    bottom: 0;\r\n    overflow: hidden;\r\n    text-overflow: ellipsis; }\r\n  .decorator-svg-dialog .image-container:hover {\r\n    border-color: #ababab;\r\n    background-color: #efefef; }\r\n  .decorator-svg-dialog .image-container.selected {\r\n    border-color: #52a8ec;\r\n    background-color: #dbeafc;\r\n    -webkit-box-shadow: 0 0 15px 0 #1276d4 !important;\r\n    -moz-box-shadow: 0 0 15px 0 #1276d4 !important;\r\n    box-shadow: 0 0 15px 0 #1276d4 !important; }\r\n\r\n.selected > div.desc {\r\n  -webkit-box-shadow: none;\r\n  -moz-box-shadow: none;\r\n  box-shadow: none; }\r\n/*\r\n * @author pmeijer / https://github.com/pmeijer\r\n */\r\ndiv.valid-visualizers-dialog div.modal-header .header-icon {\r\n  font-size: 24px;\r\n  margin-right: 1ex;\r\n  display: inline-block;\r\n  color: #333; }\r\ndiv.valid-visualizers-dialog div.modal-header span {\r\n  font-size: 24px; }\r\ndiv.valid-visualizers-dialog .modal-content .toggle-info-btn {\r\n  font-size: 65%;\r\n  vertical-align: top;\r\n  cursor: pointer;\r\n  color: #333; }\r\n  div.valid-visualizers-dialog .modal-content .toggle-info-btn:hover {\r\n    color: #2a6496; }\r\ndiv.valid-visualizers-dialog .modal-content .info-message {\r\n  display: inline-block;\r\n  width: 95%;\r\n  margin-bottom: 2ex;\r\n  margin-left: 0.5ex;\r\n  opacity: 0.90; }\r\n  div.valid-visualizers-dialog .modal-content .info-message.hidden {\r\n    display: none; }\r\ndiv.valid-visualizers-dialog .modal-content .visualizers-selection-container {\r\n  width: 40%;\r\n  float: left;\r\n  margin-right: 10px; }\r\n  div.valid-visualizers-dialog .modal-content .visualizers-selection-container ul {\r\n    border: 1px solid #eee;\r\n    min-height: 30px;\r\n    list-style-type: none;\r\n    padding: 5px 0 0 0; }\r\n  div.valid-visualizers-dialog .modal-content .visualizers-selection-container li {\r\n    margin: 0 5px 5px 5px;\r\n    padding: 5px;\r\n    text-overflow: ellipsis;\r\n    overflow: hidden;\r\n    cursor: pointer; }\r\n/*\r\n * Copyright (C) 2013 Vanderbilt University, All rights reserved.\r\n * \r\n * Author: Robert Kereskenyi\r\n */\r\n.designer-item .decorator-edit {\r\n  opacity: 0.2; }\r\n.designer-item .conn-area-edit-bg {\r\n  position: absolute;\r\n  top: 0;\r\n  left: 0; }\r\n.designer-item path.conn-area-edit {\r\n  position: absolute;\r\n  top: 0;\r\n  left: 0;\r\n  opacity: 0.5;\r\n  stroke: lime; }\r\n  .designer-item path.conn-area-edit:hover {\r\n    stroke: #009900; }\r\n  .designer-item path.conn-area-edit.disabled {\r\n    stroke: red; }\r\n    .designer-item path.conn-area-edit.disabled:hover {\r\n      stroke: #990000; }\r\n.zoom-widget-container .btn-zoom {\r\n  display: block;\r\n  width: 14px;\r\n  height: 14px;\r\n  margin-left: -5px;\r\n  text-align: center;\r\n  cursor: pointer;\r\n  color: #3160ab;\r\n  text-decoration: none;\r\n  outline: none; }\r\n  .zoom-widget-container .btn-zoom.btn-zoom-in {\r\n    border-bottom-right-radius: 0;\r\n    border-bottom-left-radius: 0; }\r\n  .zoom-widget-container .btn-zoom.btn-zoom-out {\r\n    border-top-right-radius: 0;\r\n    border-top-left-radius: 0; }\r\n  .zoom-widget-container .btn-zoom i {\r\n    font-size: 9px;\r\n    display: block; }\r\n.zoom-widget-container .zoom-widget-label {\r\n  display: block;\r\n  margin-left: -5px;\r\n  margin-top: 2px;\r\n  font-family: Helvetica Neue, Helvetica, Arial, sans-serif;\r\n  font-size: 10px;\r\n  color: black;\r\n  font-weight: normal; }\r\n.zoom-widget-container .css-zoom {\r\n  width: 3px;\r\n  position: relative;\r\n  display: block;\r\n  border-radius: 0; }\r\n  .zoom-widget-container .css-zoom.hidden {\r\n    display: none; }\r\n  .zoom-widget-container .css-zoom .ui-slider-handle {\r\n    display: block;\r\n    width: 18px;\r\n    height: 7px;\r\n    line-height: 7px;\r\n    left: -8px;\r\n    outline: none;\r\n    margin-top: -1px;\r\n    margin-bottom: -6px;\r\n    cursor: pointer; }\r\n  .zoom-widget-container .css-zoom .css-zoom-label {\r\n    display: none; }\r\n.zoom-widget-container .popover {\r\n  min-width: 88px; }\r\n  .zoom-widget-container .popover .popover-content {\r\n    font-size: 10px; }\r\n  .zoom-widget-container .popover .popover-title {\r\n    font-size: 12px; }\r\n/*\r\n * Copyright (C) 2013 Vanderbilt University, All rights reserved.\r\n * \r\n * Author: Robert Kereskenyi\r\n */\r\n#context-menu-layer {\r\n  position: absolute;\r\n  z-index: 1000;\r\n  top: 0;\r\n  left: 0;\r\n  opacity: 0;\r\n  background-color: black;\r\n  display: block;\r\n  width: 100%;\r\n  height: 100%; }\r\n\r\n#context-menu {\r\n  position: absolute;\r\n  display: none;\r\n  z-index: 1000; }\r\n  #context-menu .dropdown-menu {\r\n    display: block; }\r\n    #context-menu .dropdown-menu a {\r\n      font-size: 14px; }\r\n      #context-menu .dropdown-menu a i.fa.fa-ellipsis-h {\r\n        padding-left: 1px;\r\n        padding-right: 3px; }\r\n      #context-menu .dropdown-menu a i.fa.fa-ellipsis-v {\r\n        padding-left: 5px;\r\n        padding-right: 7px; }\r\n  #context-menu.show {\r\n    display: block; }/*error decorator properties*/\r\n.diagram-designer {\r\n  outline: none; }\r\n  .diagram-designer .items {\r\n    position: absolute; }\r\n    .diagram-designer .items .designer-item,\r\n    .diagram-designer .items .designer-connection {\r\n      cursor: pointer; }\r\n    .diagram-designer .items .rubberband {\r\n      background: rgba(219, 234, 252, 0.49);\r\n      border: #52A8EC solid 1px;\r\n      z-index: 100000; }\r\n    .diagram-designer .items .selection-outline {\r\n      background: rgba(255, 255, 0, 0.05);\r\n      border: rgba(0, 0, 0, 0.5) dashed 1px;\r\n      position: absolute;\r\n      pointer-events: none;\r\n      z-index: 100;\r\n      -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075) 0 0 4px rgba(0, 0, 0, 0.3);\r\n      -moz-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 4px rgba(0, 0, 0, 0.3);\r\n      box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 4px rgba(0, 0, 0, 0.3); }\r\n      .diagram-designer .items .selection-outline .s-btn {\r\n        position: absolute;\r\n        background-color: #FFFFFF;\r\n        border: none;\r\n        line-height: 14px;\r\n        padding: 3px 4px;\r\n        border-radius: 4px;\r\n        pointer-events: all;\r\n        cursor: pointer;\r\n        -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075) 0 0 4px rgba(0, 0, 0, 0.3);\r\n        -moz-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 4px rgba(0, 0, 0, 0.3);\r\n        box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 4px rgba(0, 0, 0, 0.3);\r\n        background-color: #000;\r\n        color: #fff; }\r\n        .diagram-designer .items .selection-outline .s-btn.delete {\r\n          top: -13px;\r\n          right: -13px; }\r\n        .diagram-designer .items .selection-outline .s-btn.rotate.bottom {\r\n          left: 50%;\r\n          margin-left: -13px;\r\n          bottom: -13px; }\r\n        .diagram-designer .items .selection-outline .s-btn.contextmenu {\r\n          bottom: -13px;\r\n          right: -13px; }\r\n        .diagram-designer .items .selection-outline .s-btn.align {\r\n          bottom: -13px;\r\n          left: -13px; }\r\n        .diagram-designer .items .selection-outline .s-btn.move {\r\n          top: -13px;\r\n          left: -13px;\r\n          margin-left: -13px; }\r\n        .diagram-designer .items .selection-outline .s-btn.open {\r\n          top: -13px;\r\n          left: -13px; }\r\n        .diagram-designer .items .selection-outline .s-btn:hover {\r\n          background-color: #428bca; }\r\n      .diagram-designer .items .selection-outline .rotation-deg {\r\n        text-align: center;\r\n        vertical-align: middle;\r\n        position: absolute;\r\n        width: 100%;\r\n        height: 30px;\r\n        margin-top: -15px;\r\n        top: 50%;\r\n        line-height: 30px;\r\n        font-size: 30px;\r\n        color: #666666; }\r\n    .diagram-designer .items .connection-connector.connector {\r\n      background-color: #FEFEFE;\r\n      height: 10px;\r\n      width: 10px;\r\n      position: absolute;\r\n      cursor: pointer;\r\n      border: 1px solid #0000FF;\r\n      z-index: 10;\r\n      background-color: #FFFFFF;\r\n      border-radius: 12px;\r\n      margin-left: -6px;\r\n      margin-top: -6px; }\r\n      .diagram-designer .items .connection-connector.connector:hover {\r\n        border-color: rgba(82, 168, 236, 0.8);\r\n        -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6);\r\n        -moz-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6);\r\n        box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6); }\r\n    .diagram-designer .items .c-area {\r\n      position: absolute;\r\n      width: 8px;\r\n      height: 8px;\r\n      background-color: #000000;\r\n      border-radius: 4px;\r\n      margin-top: -4px;\r\n      margin-left: -4px; }\r\n    .diagram-designer .items .c-d-end {\r\n      background-color: #FEFEFE;\r\n      height: 10px;\r\n      width: 10px;\r\n      position: absolute;\r\n      cursor: pointer;\r\n      border: 1px solid #0000FF;\r\n      z-index: 10;\r\n      margin-top: -6px;\r\n      margin-left: -6px;\r\n      line-height: 10px;\r\n      font-size: 8px;\r\n      text-align: center;\r\n      font-weight: bold;\r\n      font-family: Verdana; }\r\n      .diagram-designer .items .c-d-end:hover {\r\n        border-color: rgba(82, 168, 236, 0.8);\r\n        -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6);\r\n        -moz-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6);\r\n        box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6); }\r\n      .diagram-designer .items .c-d-end.src {\r\n        border-color: #FF0000;\r\n        color: #FF0000; }\r\n      .diagram-designer .items .c-d-end.dst {\r\n        border-color: #0000FF;\r\n        color: #0000FF; }\r\n    .diagram-designer .items .error-decorator {\r\n      background-color: #F2DEDE;\r\n      padding: 3px;\r\n      text-align: center;\r\n      border: 2px solid #000000; }\r\n    .diagram-designer .items svg.connection-container {\r\n      z-index: -1; }\r\n      .diagram-designer .items svg.connection-container .new-segment-point-marker {\r\n        pointer-events: none;\r\n        fill: #FFFF00;\r\n        stroke: #FF0000; }\r\n      .diagram-designer .items svg.connection-container .path-edit-segment {\r\n        stroke: transparent;\r\n        opacity: 0; }\r\n      .diagram-designer .items svg.connection-container .segment-point {\r\n        fill: #FFFF00;\r\n        stroke: #000000;\r\n        cursor: pointer; }\r\n        .diagram-designer .items svg.connection-container .segment-point:hover {\r\n          fill: #FF7800; }\r\n      .diagram-designer .items svg.connection-container .segment-point-move-path {\r\n        stroke: #FF7800; }\r\n      .diagram-designer .items svg.connection-container .segment-point-bezier-control {\r\n        fill: #FFFFFF;\r\n        stroke: #000000;\r\n        cursor: pointer; }\r\n        .diagram-designer .items svg.connection-container .segment-point-bezier-control:hover {\r\n          fill: #FF7800; }\r\n    .diagram-designer .items div.c-t {\r\n      position: absolute;\r\n      top: 0;\r\n      left: 0;\r\n      width: 0;\r\n      height: 0; }\r\n      .diagram-designer .items div.c-t div.c-text {\r\n        position: absolute;\r\n        font-size: 10px;\r\n        white-space: nowrap; }\r\n        .diagram-designer .items div.c-t div.c-text .c-name {\r\n          position: relative;\r\n          left: -50%;\r\n          cursor: default; }\r\n          .diagram-designer .items div.c-t div.c-text .c-name.v {\r\n            left: 1px; }\r\n        .diagram-designer .items div.c-t div.c-text input {\r\n          height: 20px !important;\r\n          min-width: 50px; }\r\n    .diagram-designer .items.highlight-mode .designer-item,\r\n    .diagram-designer .items.highlight-mode .designer-connection,\r\n    .diagram-designer .items.highlight-mode .c-t {\r\n      opacity: 0.1;\r\n      cursor: pointer; }\r\n    .diagram-designer .items.highlight-mode .designer-item.highlighted,\r\n    .diagram-designer .items.highlight-mode .designer-connection.highlighted,\r\n    .diagram-designer .items.highlight-mode .c-t.highlighted {\r\n      opacity: 1.0; }\r\n    .diagram-designer .items.connection-drawing .connector:hover {\r\n      background-color: #00FF00; }\r\n  .diagram-designer .drop-region {\r\n    width: 0;\r\n    height: 0;\r\n    position: absolute;\r\n    top: 0;\r\n    left: 0; }\r\n    .diagram-designer .drop-region.accept-droppable {\r\n      background-color: rgba(0, 255, 0, 0.1); }\r\n    .diagram-designer .drop-region.reject-droppable {\r\n      background-color: rgba(255, 0, 0, 0.1); }\r\n\r\n.diagram-designer-zoom-container {\r\n  position: absolute;\r\n  top: 30px;\r\n  left: 10px; }\r\n\r\n.w-tabs .diagram-designer-zoom-container {\r\n  top: 70px; }\r\n\r\ndiv.diagram-designer-drag-outline {\r\n  white-space: nowrap; }\r\n\r\n/* TABS CONTAINER */\r\n.active-panel .diagram-designer-tabs-container {\r\n  background-color: #F7FAFF; }\r\n\r\n.diagram-designer-tabs-container {\r\n  position: absolute;\r\n  top: 3px;\r\n  width: 100%;\r\n  height: 26px;\r\n  background-color: #FDFDFD;\r\n  padding-top: 1px; }\r\n  .diagram-designer-tabs-container > div {\r\n    display: table-cell;\r\n    vertical-align: middle;\r\n    white-space: nowrap; }\r\n  .diagram-designer-tabs-container div.add-tab-container {\r\n    border-bottom: 1px solid #ddd;\r\n    padding-left: 3px;\r\n    padding-right: 3px;\r\n    padding-bottom: 0; }\r\n  .diagram-designer-tabs-container div.add-tab-container > div {\r\n    display: inline-block;\r\n    margin-right: 3px; }\r\n  .diagram-designer-tabs-container div.add-tab-container ul.dropdown-menu li a [class^="icon-"],\r\n  .diagram-designer-tabs-container div.add-tab-container ul.dropdown-menu li a [class*=" icon-"] {\r\n    margin-left: -17px;\r\n    margin-right: 3px; }\r\n  .diagram-designer-tabs-container .btn {\r\n    padding: 0 12px; }\r\n  .diagram-designer-tabs-container div.tab-list-container {\r\n    width: 100%;\r\n    overflow: hidden; }\r\n    .diagram-designer-tabs-container div.tab-list-container ul.nav {\r\n      position: relative;\r\n      margin-bottom: 0px;\r\n      height: 24px; }\r\n      .diagram-designer-tabs-container div.tab-list-container ul.nav.nav-tabs > li {\r\n        display: inline-block;\r\n        float: none; }\r\n        .diagram-designer-tabs-container div.tab-list-container ul.nav.nav-tabs > li > a {\r\n          padding-top: 5px;\r\n          padding-bottom: 5px;\r\n          line-height: 13px; }\r\n          .diagram-designer-tabs-container div.tab-list-container ul.nav.nav-tabs > li > a .tab-title {\r\n            white-space: nowrap;\r\n            display: inline-block;\r\n            max-width: 120px;\r\n            overflow: hidden;\r\n            text-overflow: ellipsis; }\r\n            .diagram-designer-tabs-container div.tab-list-container ul.nav.nav-tabs > li > a .tab-title input {\r\n              min-width: 50px !important; }\r\n          .diagram-designer-tabs-container div.tab-list-container ul.nav.nav-tabs > li > a i.delete-tab-btn {\r\n            cursor: pointer;\r\n            font-size: 100%;\r\n            margin-left: 5px; }\r\n            .diagram-designer-tabs-container div.tab-list-container ul.nav.nav-tabs > li > a i.delete-tab-btn:hover {\r\n              color: #b30404; }\r\n          .diagram-designer-tabs-container div.tab-list-container ul.nav.nav-tabs > li > a [class^="icon-"],\r\n          .diagram-designer-tabs-container div.tab-list-container ul.nav.nav-tabs > li > a [class*=" icon-"] {\r\n            margin-top: -2px;\r\n            margin-left: 2px;\r\n            cursor: pointer;\r\n            display: none; }\r\n        .diagram-designer-tabs-container div.tab-list-container ul.nav.nav-tabs > li.active > a [class^="icon-"],\r\n        .diagram-designer-tabs-container div.tab-list-container ul.nav.nav-tabs > li.active > a [class*=" icon-"] {\r\n          display: inline-block; }\r\n      .diagram-designer-tabs-container div.tab-list-container ul.nav.nav-tabs.ui-sortable li.ui-sortable-placeholder {\r\n        height: 0px !important; }\r\n      .diagram-designer-tabs-container div.tab-list-container ul.nav.nav-tabs.ui-sortable li.ui-sortable-helper {\r\n        top: 0px !important;\r\n        pointer-events: none; }\r\n\r\n.read-only .diagram-designer-tabs-container div.tab-list-container ul.nav.nav-tabs > li.active > a [class^="icon-"],\r\n.read-only .diagram-designer-tabs-container div.tab-list-container ul.nav.nav-tabs > li.active > a [class*=" icon-"] {\r\n  display: none; }\r\n\r\n.rotate-options {\r\n  top: -52px;\r\n  left: 16px;\r\n  display: none; }\r\n/**\r\n * @author rkereskenyi / https://github.com/rkereskenyi\r\n */\r\n/**\r\n * @author rkereskenyi / https://github.com/rkereskenyi\r\n */\r\n.meta-editor-widget.w-tabs .diagram-designer-zoom-container {\r\n  top: 45px; }\r\n\r\ndiv.filterPanel {\r\n  position: absolute;\r\n  top: 34px;\r\n  right: 11px;\r\n  background-color: #FFFFFF;\r\n  border: 1px solid rgba(0, 0, 0, 0.2);\r\n  -webkit-border-radius: 6px;\r\n  -moz-border-radius: 6px;\r\n  border-radius: 6px;\r\n  -webkit-box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);\r\n  -moz-box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);\r\n  box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);\r\n  -webkit-background-clip: padding-box;\r\n  -moz-background-clip: padding;\r\n  background-clip: padding-box; }\r\n  div.filterPanel .header {\r\n    min-width: 100px;\r\n    text-align: center;\r\n    margin: 0 5px; }\r\n  div.filterPanel .body {\r\n    display: none;\r\n    list-style: none;\r\n    padding: 5px;\r\n    margin: 0; }\r\n    div.filterPanel .body li.filterItem {\r\n      margin: 3px 0; }\r\n      div.filterPanel .body li.filterItem .iCheckBox {\r\n        float: right;\r\n        margin-top: 6px;\r\n        margin-left: 3px; }\r\n      div.filterPanel .body li.filterItem div > svg {\r\n        margin-top: 4px; }\r\n  div.filterPanel:hover .header {\r\n    border-bottom: 1px solid rgba(0, 0, 0, 0.2); }\r\n  div.filterPanel:hover .body {\r\n    display: block; }/*\r\n * @author pmeijer / https://github.com/pmeijer\r\n */\r\ndiv.replace-base-dialog div.modal-header .header-icon {\r\n  font-size: 20px;\r\n  margin-right: 1ex;\r\n  display: inline-block;\r\n  color: #333; }\r\ndiv.replace-base-dialog div.modal-header span {\r\n  font-size: 24px; }\r\ndiv.replace-base-dialog .modal-content .toggle-info-btn {\r\n  font-size: 65%;\r\n  vertical-align: top;\r\n  cursor: pointer;\r\n  color: #333; }\r\n  div.replace-base-dialog .modal-content .toggle-info-btn:hover {\r\n    color: #2a6496; }\r\ndiv.replace-base-dialog .modal-content .info-message {\r\n  display: inline-block;\r\n  width: 95%;\r\n  margin-bottom: 2ex;\r\n  margin-left: 0.5ex;\r\n  opacity: 0.90; }\r\n  div.replace-base-dialog .modal-content .info-message.hidden {\r\n    display: none; }\r\ndiv.replace-base-dialog .modal-content .message-badge {\r\n  margin-bottom: 0;\r\n  margin-top: 12px; }\r\n.set-editor-widget .diagram-designer-tabs-container .tab-list-container .nav.nav-tabs .delete-set-tab {\r\n  cursor: pointer;\r\n  font-size: 100%;\r\n  margin-left: 5px; }\r\n/**\r\n * @author rkereskenyi / https://github.com/rkereskenyi\r\n */\r\n.graph-viz {\r\n  outline: none; }\r\n  .graph-viz .node {\r\n    cursor: pointer; }\r\n  .graph-viz .node circle {\r\n    fill: #FFF;\r\n    stroke: steelblue;\r\n    stroke-width: 1.5px; }\r\n  .graph-viz .node text {\r\n    font: 10px sans-serif; }\r\n  .graph-viz .link {\r\n    fill: none;\r\n    stroke: #CCC;\r\n    stroke-width: 1.5px; }\r\n\r\n.graph-viz-zoom-container {\r\n  position: absolute;\r\n  top: 40px;\r\n  left: 10px; }\r\n/**\r\n * @author rkereskenyi / https://github.com/rkereskenyi\r\n */\r\n/**\r\n * @author rkereskenyi / https://github.com/rkereskenyi\r\n */\r\ndiv.designer-item .circle-decorator {\r\n  position: relative;\r\n  width: 11px;\r\n  height: 11px; }\r\n  div.designer-item .circle-decorator svg {\r\n    top: -3px;\r\n    position: relative; }\r\n  div.designer-item .circle-decorator .name {\r\n    white-space: nowrap;\r\n    font-size: 11px;\r\n    font-weight: bold;\r\n    font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;\r\n    position: relative; }\r\n  div.designer-item .circle-decorator .circle-shadow {\r\n    position: absolute;\r\n    top: 0;\r\n    left: 0;\r\n    display: none;\r\n    width: 11px;\r\n    height: 11px;\r\n    border-radius: 11px;\r\n    z-index: -1; }\r\ndiv.designer-item .circle-decorator .name {\r\n  top: -10px; }\r\ndiv.designer-item .circle-decorator .connector {\r\n  background-color: #FEFEFE;\r\n  height: 9px;\r\n  width: 9px;\r\n  position: absolute;\r\n  cursor: pointer;\r\n  border: 1px solid #0000FF;\r\n  z-index: 10;\r\n  position: absolute;\r\n  top: 0;\r\n  left: 0; }\r\n  div.designer-item .circle-decorator .connector:hover {\r\n    border-color: rgba(82, 168, 236, 0.8);\r\n    -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6);\r\n    -moz-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6);\r\n    box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6); }\r\ndiv.designer-item.selected .circle-decorator svg circle {\r\n  fill: #DBEAFC; }\r\ndiv.designer-item.selected .circle-decorator .circle-shadow {\r\n  display: block; }\r\n/**\r\n * @author rkereskenyi / https://github.com/rkereskenyi\r\n */\r\n/**\r\n * @author rkereskenyi / https://github.com/rkereskenyi\r\n */\r\ndiv.part .circle-decorator {\r\n  position: relative;\r\n  width: 11px;\r\n  height: 11px; }\r\n  div.part .circle-decorator svg {\r\n    top: -3px;\r\n    position: relative; }\r\n  div.part .circle-decorator .name {\r\n    white-space: nowrap;\r\n    font-size: 11px;\r\n    font-weight: bold;\r\n    font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;\r\n    position: relative; }\r\n  div.part .circle-decorator .circle-shadow {\r\n    position: absolute;\r\n    top: 0;\r\n    left: 0;\r\n    display: none;\r\n    width: 11px;\r\n    height: 11px;\r\n    border-radius: 11px;\r\n    z-index: -1; }\r\ndiv.part .circle-decorator .name {\r\n  position: absolute;\r\n  top: 10px; }\r\n/**\r\n * @author rkereskenyi / https://github.com/rkereskenyi\r\n */\r\n.default-decorator {\r\n  min-width: 65px;\r\n  height: 40px;\r\n  border: 1px solid #000000;\r\n  background-color: #DEDEDE;\r\n  padding: 3px;\r\n  text-align: center; }\r\n  .default-decorator .name {\r\n    margin-top: 10px;\r\n    white-space: nowrap;\r\n    font-size: 11px;\r\n    font-weight: bold;\r\n    font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;\r\n    text-align: center; }\r\n  .default-decorator .connector {\r\n    background-color: #FEFEFE;\r\n    height: 10px;\r\n    width: 10px;\r\n    position: absolute;\r\n    cursor: pointer;\r\n    border: 1px solid #0000FF;\r\n    z-index: 10;\r\n    height: 14px;\r\n    width: 14px;\r\n    margin-left: -8px;\r\n    left: 50%; }\r\n    .default-decorator .connector:hover {\r\n      border-color: rgba(82, 168, 236, 0.8);\r\n      -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6);\r\n      -moz-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6);\r\n      box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6); }\r\n    .default-decorator .connector.top {\r\n      top: -10px; }\r\n    .default-decorator .connector.bottom {\r\n      bottom: -10px; }\r\n\r\n.selected .default-decorator {\r\n  border: 1px solid #52A8EC;\r\n  background-color: #DBEAFC; }\r\n/**\r\n * @author rkereskenyi / https://github.com/rkereskenyi\r\n */\r\n.part-browser .default-decorator .name {\r\n  max-width: 150px;\r\n  overflow: hidden;\r\n  text-overflow: ellipsis; }\r\n/**\r\n * @author rkereskenyi / https://github.com/rkereskenyi\r\n * @author Qishen Zhang  https://github.com/VictorCoder123\r\n */\r\n.Document-decorator {\r\n  min-width: 65px;\r\n  max-width: 400px;\r\n  height: auto;\r\n  width: auto;\r\n  border: 1px solid black;\r\n  background-color: #dedede;\r\n  padding: 2ex;\r\n  text-align: center;\r\n  font-weight: normal; }\r\n  .Document-decorator i.text-meta:hover {\r\n    font-weight: bolder; }\r\n  .Document-decorator i.text-meta.not-activated {\r\n    cursor: not-allowed; }\r\n  .Document-decorator .doc {\r\n    text-align: left; }\r\n  .Document-decorator .name {\r\n    white-space: nowrap;\r\n    font-size: 11px;\r\n    font-weight: bold;\r\n    font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;\r\n    text-align: center; }\r\n  .Document-decorator .connector {\r\n    background-color: #fefefe;\r\n    height: 10px;\r\n    width: 10px;\r\n    position: absolute;\r\n    cursor: pointer;\r\n    border: 1px solid blue;\r\n    z-index: 10;\r\n    margin-left: -6px;\r\n    left: 50%; }\r\n    .Document-decorator .connector:hover {\r\n      border-color: rgba(82, 168, 236, 0.8);\r\n      -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6);\r\n      -moz-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6);\r\n      box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6); }\r\n    .Document-decorator .connector.top {\r\n      top: -6px; }\r\n    .Document-decorator .connector.bottom {\r\n      bottom: -6px; }\r\n\r\n.selected .Document-decorator {\r\n  border: 1px solid #52a8ec;\r\n  background-color: #dbeafc; }\r\n/**\r\n * @author rkereskenyi / https://github.com/rkereskenyi\r\n */\r\n.part-browser .Document-decorator .name {\r\n  max-width: 150px;\r\n  overflow: hidden;\r\n  text-overflow: ellipsis; }\r\n.part-browser .Document-decorator .embeddedsvg {\r\n  width: 40px;\r\n  position: relative; }\r\n/**\r\n * @author rkereskenyi / https://github.com/rkereskenyi\r\n */\r\n/**\r\n * @author rkereskenyi / https://github.com/rkereskenyi\r\n */\r\n.constraint-details-dialog .modal-body {\r\n  max-height: 500px; }\r\n  .constraint-details-dialog .modal-body label.control-label {\r\n    width: 15%; }\r\n  .constraint-details-dialog .modal-body div.controls {\r\n    width: 80%; }\r\n    .constraint-details-dialog .modal-body div.controls input.name-input {\r\n      width: 30%; }\r\n    .constraint-details-dialog .modal-body div.controls input.info-input {\r\n      width: 60%; }/**\r\n * @author rkereskenyi / https://github.com/rkereskenyi\r\n */\r\n.aspect-details-dialog .modal-body {\r\n  max-height: 500px; }\r\n/**\r\n * @author rkereskenyi / https://github.com/rkereskenyi\r\n */\r\n/**\r\n * @author rkereskenyi / https://github.com/rkereskenyi\r\n */\r\n.meta-decorator {\r\n  min-width: 90px;\r\n  min-height: 40px;\r\n  border: 1px solid #000000;\r\n  background-color: #FFFFFF;\r\n  text-align: center; }\r\n  .meta-decorator .name {\r\n    white-space: nowrap;\r\n    font-size: 11px;\r\n    font-weight: bold;\r\n    font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;\r\n    text-align: center;\r\n    overflow: hidden;\r\n    text-overflow: ellipsis;\r\n    border-bottom: 1px solid #000000;\r\n    padding: 0 17px 0 17px; }\r\n    .meta-decorator .name input {\r\n      height: 16px !important;\r\n      line-height: 16px !important;\r\n      font-size: 11px !important; }\r\n  .meta-decorator .attributes,\r\n  .meta-decorator .constraints,\r\n  .meta-decorator .aspects {\r\n    font-size: 10px;\r\n    min-height: 1px;\r\n    margin-bottom: 0;\r\n    padding: 0 3px 0 3px; }\r\n    .meta-decorator .attributes li div,\r\n    .meta-decorator .constraints li div,\r\n    .meta-decorator .aspects li div {\r\n      white-space: nowrap;\r\n      position: relative;\r\n      height: 16px;\r\n      line-height: 16px; }\r\n      .meta-decorator .attributes li div:hover,\r\n      .meta-decorator .constraints li div:hover,\r\n      .meta-decorator .aspects li div:hover {\r\n        cursor: pointer;\r\n        background-color: #EEE; }\r\n      .meta-decorator .attributes li div .n,\r\n      .meta-decorator .constraints li div .n,\r\n      .meta-decorator .aspects li div .n {\r\n        float: left;\r\n        margin-right: 3px;\r\n        max-width: 90px;\r\n        overflow: hidden;\r\n        text-overflow: ellipsis;\r\n        text-align: left; }\r\n      .meta-decorator .attributes li div .t,\r\n      .meta-decorator .constraints li div .t,\r\n      .meta-decorator .aspects li div .t {\r\n        float: right;\r\n        text-align: right; }\r\n  .meta-decorator .add-new-attribute,\r\n  .meta-decorator .add-new-constraint,\r\n  .meta-decorator .add-new-aspect {\r\n    font-size: 10px;\r\n    cursor: pointer;\r\n    position: absolute;\r\n    top: 0;\r\n    left: 3px; }\r\n    .meta-decorator .add-new-attribute:hover,\r\n    .meta-decorator .add-new-constraint:hover,\r\n    .meta-decorator .add-new-aspect:hover {\r\n      background-color: #DBEAFC;\r\n      color: #000000; }\r\n  .meta-decorator .attributes-title,\r\n  .meta-decorator .constraints-title,\r\n  .meta-decorator .aspects-title {\r\n    font-size: 9px;\r\n    font-weight: bold;\r\n    text-transform: uppercase;\r\n    text-align: center;\r\n    background-color: #F3F3F3;\r\n    color: #000000;\r\n    line-height: 13px;\r\n    position: relative; }\r\n  .meta-decorator .constraints-title,\r\n  .meta-decorator .aspects-title {\r\n    border-top: 1px dashed #999999; }\r\n  .meta-decorator input[type=text].new-attr {\r\n    font-size: 10px; }\r\n  .meta-decorator .control-group {\r\n    margin-bottom: 0; }\r\n  .meta-decorator .connector {\r\n    background-color: #FEFEFE;\r\n    height: 10px;\r\n    width: 10px;\r\n    position: absolute;\r\n    cursor: pointer;\r\n    border: 1px solid #0000FF;\r\n    z-index: 10;\r\n    height: 14px;\r\n    width: 14px;\r\n    margin-left: -8px;\r\n    left: 50%; }\r\n    .meta-decorator .connector:hover {\r\n      border-color: rgba(82, 168, 236, 0.8);\r\n      -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6);\r\n      -moz-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6);\r\n      box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6); }\r\n    .meta-decorator .connector.top {\r\n      top: -10px; }\r\n    .meta-decorator .connector.bottom {\r\n      bottom: -10px; }\r\n  .meta-decorator .text-meta {\r\n    position: absolute;\r\n    top: 0;\r\n    right: 1px;\r\n    height: 15px;\r\n    width: 15px;\r\n    margin-top: 2px;\r\n    border-radius: 5px; }\r\n  .meta-decorator .meta-lock {\r\n    position: absolute;\r\n    top: 0;\r\n    left: 1px;\r\n    height: 15px;\r\n    width: 15px;\r\n    margin-top: 2px;\r\n    border-radius: 5px; }\r\n  .meta-decorator.abstract .name {\r\n    font-style: italic;\r\n    color: #AAAAAA; }\r\n\r\n.selected .meta-decorator .add-new-attribute:hover,\r\n.selected .meta-decorator .add-new-constraint:hover,\r\n.selected .meta-decorator .add-new-aspect:hover {\r\n  background-color: #FFFFC0; }\r\n\r\n.items.highlight-mode .meta-decorator .attributes li div:hover,\r\n.items.highlight-mode .meta-decorator .constraints li div:hover,\r\n.items.highlight-mode .meta-decorator .aspects li div:hover {\r\n  cursor: default;\r\n  background-color: #FFFFFF; }\r\n/**\r\n * @author rkereskenyi / https://github.com/rkereskenyi\r\n */\r\n/**\r\n * @author rkereskenyi / https://github.com/rkereskenyi\r\n */\r\n/**\r\n * @author rkereskenyi / https://github.com/rkereskenyi\r\n */\r\n.model-decorator {\r\n  min-width: 65px;\r\n  min-height: 40px;\r\n  border: 1px solid #000000;\r\n  background-color: #ECECEC;\r\n  padding: 3px;\r\n  text-align: center;\r\n  position: relative;\r\n  -webkit-box-shadow: inset 0px 0px 7px 0px rgba(0, 0, 0, 0.15);\r\n  -moz-box-shadow: inset 0px 0px 7px 0px rgba(0, 0, 0, 0.15);\r\n  box-shadow: inset 0px 0px 7px 0px rgba(0, 0, 0, 0.15); }\r\n  .model-decorator .name {\r\n    white-space: nowrap;\r\n    font-size: 11px;\r\n    font-weight: bold;\r\n    font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;\r\n    text-align: center;\r\n    overflow: hidden;\r\n    text-overflow: ellipsis;\r\n    width: 121px;\r\n    border-bottom: none;\r\n    height: 16px;\r\n    line-height: 16px; }\r\n  .model-decorator div.conn-type {\r\n    font-size: 9px;\r\n    line-height: 12px;\r\n    color: #AAAAAA; }\r\n  .model-decorator .ports {\r\n    font-size: 10px;\r\n    min-height: 1px;\r\n    width: 121px;\r\n    position: relative; }\r\n    .model-decorator .ports .left {\r\n      display: inline-block;\r\n      vertical-align: top;\r\n      width: 50px;\r\n      min-height: 1px; }\r\n    .model-decorator .ports .center {\r\n      display: inline-block;\r\n      vertical-align: top;\r\n      width: 15px;\r\n      height: 1px; }\r\n    .model-decorator .ports .right {\r\n      display: inline-block;\r\n      vertical-align: top;\r\n      width: 50px;\r\n      min-height: 1px; }\r\n    .model-decorator .ports .port {\r\n      white-space: nowrap;\r\n      position: relative;\r\n      height: 15px;\r\n      line-height: 15px; }\r\n      .model-decorator .ports .port:hover {\r\n        cursor: pointer; }\r\n      .model-decorator .ports .port .title-wrapper {\r\n        display: inline-block;\r\n        width: 100%;\r\n        overflow: hidden;\r\n        text-overflow: ellipsis; }\r\n      .model-decorator .ports .port img.svg-icon {\r\n        height: 11px;\r\n        width: 5px;\r\n        position: absolute;\r\n        display: inline-block;\r\n        top: 2px; }\r\n      .model-decorator .ports .port span.dot {\r\n        position: absolute;\r\n        display: inline-block;\r\n        background: #666666;\r\n        border: 1px solid #666666;\r\n        width: 3px;\r\n        height: 7px;\r\n        top: 4px; }\r\n      .model-decorator .ports .port.w-icon span.dot {\r\n        display: none; }\r\n    .model-decorator .ports .left .port .title-wrapper {\r\n      text-align: left; }\r\n    .model-decorator .ports .left .port img.svg-icon {\r\n      left: -8px; }\r\n    .model-decorator .ports .left .port span.dot {\r\n      left: -6px;\r\n      border-top-left-radius: 5px;\r\n      border-bottom-left-radius: 5px; }\r\n    .model-decorator .ports .right .port .title-wrapper {\r\n      text-align: right; }\r\n    .model-decorator .ports .right .port img.svg-icon {\r\n      right: -8px;\r\n      -webkit-transform: scaleX(-1);\r\n      -moz-transform: scaleX(-1);\r\n      -ms-transform: scaleX(-1);\r\n      -o-transform: scaleX(-1);\r\n      transform: scaleX(-1); }\r\n    .model-decorator .ports .right .port span.dot {\r\n      left: 54px;\r\n      border-top-right-radius: 5px;\r\n      border-bottom-right-radius: 5px; }\r\n  .model-decorator .progress-bar .loader-progressbar {\r\n    position: relative;\r\n    left: 50%;\r\n    margin-left: -8px; }\r\n  .model-decorator .ptr {\r\n    position: absolute;\r\n    top: 0;\r\n    right: 2px;\r\n    height: 15px;\r\n    width: 15px;\r\n    margin-top: 2px;\r\n    border-radius: 5px; }\r\n    .model-decorator .ptr.ptr-nonset {\r\n      opacity: 0.4; }\r\n    .model-decorator .ptr.inverse-on-hover:hover {\r\n      background-color: rgba(82, 168, 236, 0.8);\r\n      -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6);\r\n      -moz-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6);\r\n      box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6); }\r\n      .model-decorator .ptr.inverse-on-hover:hover [class^="icon-"]:not(.icon-white),\r\n      .model-decorator .ptr.inverse-on-hover:hover [class*=" icon-"]:not(.icon-white) {\r\n        background-image: url("../src/client/img/glyphicons-halflings-white.png"); }\r\n    .model-decorator .ptr [class^="icon-"],\r\n    .model-decorator .ptr [class*=" icon-"] {\r\n      margin-top: -2px; }\r\n  .model-decorator.abstract .name {\r\n    font-style: italic;\r\n    color: #AAAAAA; }\r\n  .model-decorator img.embeddedsvg {\r\n    width: 40px;\r\n    position: relative; }\r\n\r\n.model-decorator .connector {\r\n  background-color: #FEFEFE;\r\n  height: 10px;\r\n  width: 10px;\r\n  position: absolute;\r\n  cursor: pointer;\r\n  border: 1px solid #0000FF;\r\n  z-index: 10;\r\n  height: 14px;\r\n  width: 14px;\r\n  margin-left: -8px;\r\n  left: 50%; }\r\n  .model-decorator .connector:hover {\r\n    border-color: rgba(82, 168, 236, 0.8);\r\n    -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6);\r\n    -moz-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6);\r\n    box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6); }\r\n  .model-decorator .connector.top {\r\n    top: -10px; }\r\n  .model-decorator .connector.bottom {\r\n    bottom: -9px; }\r\n.model-decorator .ports .port div.connector {\r\n  top: 0.5px; }\r\n.model-decorator .ports .left .port .connector {\r\n  left: -8px; }\r\n.model-decorator .ports .right .port .connector {\r\n  left: 60px; }\r\n.model-decorator.accept-droppable {\r\n  background-color: #00FF00 !important;\r\n  cursor: alias; }\r\n/**\r\n * @author rkereskenyi / https://github.com/rkereskenyi\r\n */\r\n/**\r\n * @author rkereskenyi / https://github.com/rkereskenyi\r\n */\r\n/**\r\n * @author rkereskenyi / https://github.com/rkereskenyi\r\n */\r\n.model-decorator {\r\n  min-width: 65px;\r\n  min-height: 40px;\r\n  border: 1px solid #000000;\r\n  background-color: #ECECEC;\r\n  padding: 3px;\r\n  text-align: center;\r\n  position: relative;\r\n  -webkit-box-shadow: inset 0px 0px 7px 0px rgba(0, 0, 0, 0.15);\r\n  -moz-box-shadow: inset 0px 0px 7px 0px rgba(0, 0, 0, 0.15);\r\n  box-shadow: inset 0px 0px 7px 0px rgba(0, 0, 0, 0.15); }\r\n  .model-decorator .name {\r\n    white-space: nowrap;\r\n    font-size: 11px;\r\n    font-weight: bold;\r\n    font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;\r\n    text-align: center;\r\n    overflow: hidden;\r\n    text-overflow: ellipsis;\r\n    width: 121px;\r\n    border-bottom: none;\r\n    height: 16px;\r\n    line-height: 16px; }\r\n  .model-decorator div.conn-type {\r\n    font-size: 9px;\r\n    line-height: 12px;\r\n    color: #AAAAAA; }\r\n  .model-decorator .ports {\r\n    font-size: 10px;\r\n    min-height: 1px;\r\n    width: 121px;\r\n    position: relative; }\r\n    .model-decorator .ports .left {\r\n      display: inline-block;\r\n      vertical-align: top;\r\n      width: 50px;\r\n      min-height: 1px; }\r\n    .model-decorator .ports .center {\r\n      display: inline-block;\r\n      vertical-align: top;\r\n      width: 15px;\r\n      height: 1px; }\r\n    .model-decorator .ports .right {\r\n      display: inline-block;\r\n      vertical-align: top;\r\n      width: 50px;\r\n      min-height: 1px; }\r\n    .model-decorator .ports .port {\r\n      white-space: nowrap;\r\n      position: relative;\r\n      height: 15px;\r\n      line-height: 15px; }\r\n      .model-decorator .ports .port:hover {\r\n        cursor: pointer; }\r\n      .model-decorator .ports .port .title-wrapper {\r\n        display: inline-block;\r\n        width: 100%;\r\n        overflow: hidden;\r\n        text-overflow: ellipsis; }\r\n      .model-decorator .ports .port img.svg-icon {\r\n        height: 11px;\r\n        width: 5px;\r\n        position: absolute;\r\n        display: inline-block;\r\n        top: 2px; }\r\n      .model-decorator .ports .port span.dot {\r\n        position: absolute;\r\n        display: inline-block;\r\n        background: #666666;\r\n        border: 1px solid #666666;\r\n        width: 3px;\r\n        height: 7px;\r\n        top: 4px; }\r\n      .model-decorator .ports .port.w-icon span.dot {\r\n        display: none; }\r\n    .model-decorator .ports .left .port .title-wrapper {\r\n      text-align: left; }\r\n    .model-decorator .ports .left .port img.svg-icon {\r\n      left: -8px; }\r\n    .model-decorator .ports .left .port span.dot {\r\n      left: -6px;\r\n      border-top-left-radius: 5px;\r\n      border-bottom-left-radius: 5px; }\r\n    .model-decorator .ports .right .port .title-wrapper {\r\n      text-align: right; }\r\n    .model-decorator .ports .right .port img.svg-icon {\r\n      right: -8px;\r\n      -webkit-transform: scaleX(-1);\r\n      -moz-transform: scaleX(-1);\r\n      -ms-transform: scaleX(-1);\r\n      -o-transform: scaleX(-1);\r\n      transform: scaleX(-1); }\r\n    .model-decorator .ports .right .port span.dot {\r\n      left: 54px;\r\n      border-top-right-radius: 5px;\r\n      border-bottom-right-radius: 5px; }\r\n  .model-decorator .progress-bar .loader-progressbar {\r\n    position: relative;\r\n    left: 50%;\r\n    margin-left: -8px; }\r\n  .model-decorator .ptr {\r\n    position: absolute;\r\n    top: 0;\r\n    right: 2px;\r\n    height: 15px;\r\n    width: 15px;\r\n    margin-top: 2px;\r\n    border-radius: 5px; }\r\n    .model-decorator .ptr.ptr-nonset {\r\n      opacity: 0.4; }\r\n    .model-decorator .ptr.inverse-on-hover:hover {\r\n      background-color: rgba(82, 168, 236, 0.8);\r\n      -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6);\r\n      -moz-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6);\r\n      box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6); }\r\n      .model-decorator .ptr.inverse-on-hover:hover [class^="icon-"]:not(.icon-white),\r\n      .model-decorator .ptr.inverse-on-hover:hover [class*=" icon-"]:not(.icon-white) {\r\n        background-image: url("../src/client/img/glyphicons-halflings-white.png"); }\r\n    .model-decorator .ptr [class^="icon-"],\r\n    .model-decorator .ptr [class*=" icon-"] {\r\n      margin-top: -2px; }\r\n  .model-decorator.abstract .name {\r\n    font-style: italic;\r\n    color: #AAAAAA; }\r\n  .model-decorator img.embeddedsvg {\r\n    width: 40px;\r\n    position: relative; }\r\n/**\r\n * @author rkereskenyi / https://github.com/rkereskenyi\r\n */\r\n/**\r\n * @author rkereskenyi / https://github/rkereskenyi\r\n */\r\n/*#DBEAFC;*/\r\n.svg-decorator {\r\n  text-align: center;\r\n  position: relative; }\r\n  .svg-decorator .svg-content svg {\r\n    vertical-align: top; }\r\n    .svg-decorator .svg-content svg .connection-area {\r\n      stroke: #FF0000;\r\n      stroke-width: 5.5; }\r\n  .svg-decorator .name {\r\n    white-space: nowrap;\r\n    font-size: 11px;\r\n    font-weight: bold;\r\n    font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;\r\n    text-align: center;\r\n    overflow: hidden;\r\n    text-overflow: ellipsis;\r\n    height: 16px;\r\n    line-height: 16px; }\r\n  .svg-decorator.abstract .name {\r\n    font-style: italic;\r\n    color: #AAAAAA; }\r\n  .svg-decorator .ports {\r\n    position: absolute;\r\n    top: 0;\r\n    font-size: 10px; }\r\n    .svg-decorator .ports.ports-l {\r\n      left: 0px; }\r\n    .svg-decorator .ports.ports-r {\r\n      left: 100px; }\r\n    .svg-decorator .ports .port {\r\n      position: absolute;\r\n      height: 13px;\r\n      line-height: 13px; }\r\n      .svg-decorator .ports .port .title {\r\n        position: absolute;\r\n        overflow: hidden;\r\n        text-overflow: ellipsis; }\r\n      .svg-decorator .ports .port .icon {\r\n        position: absolute; }\r\n        .svg-decorator .ports .port .icon img {\r\n          width: 13px;\r\n          height: 13px; }\r\n      .svg-decorator .ports .port .connector {\r\n        margin-left: 0;\r\n        margin-top: 0; }\r\n    .svg-decorator .ports.ports-l .port .title {\r\n      text-align: left; }\r\n    .svg-decorator .ports.ports-r .port .title {\r\n      text-align: right; }\r\n    .svg-decorator .ports.ports-r .port .icon img {\r\n      -webkit-transform: scaleX(-1);\r\n      -moz-transform: scaleX(-1);\r\n      -ms-transform: scaleX(-1);\r\n      -o-transform: scaleX(-1);\r\n      transform: scaleX(-1); }\r\n\r\n.designer-item .svg-decorator .svg-content svg {\r\n  border: none; }\r\n  .designer-item .svg-decorator .svg-content svg .connector {\r\n    fill: #FEFEFE;\r\n    stroke: #0000FF;\r\n    stroke-width: 1px; }\r\n    .designer-item .svg-decorator .svg-content svg .connector:hover {\r\n      stroke: rgba(82, 168, 236, 0.8); }\r\n.designer-item .svg-decorator .connector {\r\n  background-color: #FEFEFE;\r\n  height: 10px;\r\n  width: 10px;\r\n  position: absolute;\r\n  cursor: pointer;\r\n  border: 1px solid #0000FF;\r\n  z-index: 10;\r\n  margin-left: -6px;\r\n  margin-top: -6px; }\r\n  .designer-item .svg-decorator .connector:hover {\r\n    border-color: rgba(82, 168, 236, 0.8);\r\n    -webkit-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6);\r\n    -moz-box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6);\r\n    box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6); }\r\n.designer-item .svg-decorator.accept-droppable {\r\n  background-color: #00FF00 !important;\r\n  cursor: alias; }\r\n/**\r\n * @author rkereskenyi / https://github.com/rkereskenyi\r\n */\r\n/**\r\n * @author rkereskenyi / https://github/rkereskenyi\r\n */\r\n/*#DBEAFC;*/\r\n.part .svg-decorator {\r\n  text-align: center;\r\n  position: relative; }\r\n  .part .svg-decorator .svg-content svg {\r\n    vertical-align: top; }\r\n    .part .svg-decorator .svg-content svg .connection-area {\r\n      stroke: #FF0000;\r\n      stroke-width: 5.5; }\r\n  .part .svg-decorator .name {\r\n    white-space: nowrap;\r\n    font-size: 11px;\r\n    font-weight: bold;\r\n    font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;\r\n    text-align: center;\r\n    overflow: hidden;\r\n    text-overflow: ellipsis;\r\n    height: 16px;\r\n    line-height: 16px; }\r\n  .part .svg-decorator.abstract .name {\r\n    font-style: italic;\r\n    color: #aaaaaa; }\r\n  .part .svg-decorator .ports {\r\n    position: absolute;\r\n    top: 0;\r\n    font-size: 10px; }\r\n    .part .svg-decorator .ports.ports-l {\r\n      left: 0px; }\r\n    .part .svg-decorator .ports.ports-r {\r\n      left: 100px; }\r\n    .part .svg-decorator .ports .port {\r\n      position: absolute;\r\n      height: 13px;\r\n      line-height: 13px; }\r\n      .part .svg-decorator .ports .port .title {\r\n        position: absolute;\r\n        overflow: hidden;\r\n        text-overflow: ellipsis; }\r\n      .part .svg-decorator .ports .port .icon {\r\n        position: absolute; }\r\n        .part .svg-decorator .ports .port .icon img {\r\n          width: 13px;\r\n          height: 13px; }\r\n      .part .svg-decorator .ports .port .connector {\r\n        margin-left: 0;\r\n        margin-top: 0; }\r\n    .part .svg-decorator .ports.ports-l .port .title {\r\n      text-align: left; }\r\n    .part .svg-decorator .ports.ports-r .port .title {\r\n      text-align: right; }\r\n    .part .svg-decorator .ports.ports-r .port .icon img {\r\n      -webkit-transform: scaleX(-1);\r\n      -moz-transform: scaleX(-1);\r\n      -ms-transform: scaleX(-1);\r\n      -o-transform: scaleX(-1);\r\n      transform: scaleX(-1); }\r\n');
//# sourceMappingURL=webgme.dist.build.js.map